import{aT as e,aU as a,x as l,y as s,aB as t,H as o}from"./base-BBwbuMrY.js";/* empty css                *//* empty css               */import"./tag-CxKPM5Nx.js";import{E as i,a as r}from"./select-D4OJKeW_.js";import"./scrollbar-Cg0Qc4lf.js";import{E as n}from"./popper-CF2HgFfE.js";/* empty css              */import{E as d}from"./alert-bZCV4XKB.js";import"./tooltip-l0sNRNKZ.js";import{E as m}from"./switch-DP8XpaVB.js";import{_ as p}from"./SvgIcon-CP4hezaL.js";import{Z as u,a as c}from"./ZFormItem-DqyrjkCI.js";import{p as f,q as v,l as b,r as j}from"./admin-storage-D0L6B7uH.js";import{u as x,r as g}from"./common-D92ZSWsJ.js";import{r as y,I as h,M as k,o as V,a6 as _,J as I,u as w,a as U,b as E,w as C,k as R,i as T,t as q,O as B,N as M,e as z,F as D,v as F,j as G,P as S,Q as Z}from"./index-B6LbRxzB.js";import{S as A}from"./sortable.esm-CQGo0vDY.js";import{E as H}from"./request-B2kMKzxx.js";import{E as J}from"./index-XSoVjJxG.js";import L from"./readme-editor-dialog-BAZHyHiH.js";import{b as O}from"./route-block-B_A1xBdJ.js";import{_ as P}from"./plugin-vue_export-helper-BCo6x5W8.js";import{r as Q}from"./CheckBadgeIcon-Cn-PgIwF.js";import{E as K}from"./index-KUFYR68Z.js";import{v as N}from"./directive-c3Zp8yaa.js";import"./castArray-Cx7RYULx.js";import"./event-BwRzfsZt.js";import"./scroll-Ck97Tz0c.js";import"./index-CfE48oVh.js";import"./_Uint8Array-FYYXr4ha.js";import"./debounce-Da1en5bL.js";import"./index-Cd2l2kYr.js";import"./validator-EOLRKd5b.js";import"./index-58WTuj8x.js";import"./dialog-w9q4kLUr.js";import"./overlay-DME-vEE1.js";import"./refs-BFRRN0-g.js";let W=y([]),$=y(!1);const X=e=>(S("data-v-d1896884"),e=e(),Z(),e),Y={class:"flex justify-between"},ee=X((()=>R("span",{class:"mr-4 text-sm text-gray-500"},"兼容为读取 readme.md",-1))),ae=X((()=>R("div",{class:"rules-tips"},"Glob 表达式规则：",-1))),le=X((()=>R("div",{class:"rules-tips"},[R("b",null,"/"),M(": 根目录, 如 "),R("span",{class:"code select-all"},"/"),M(" 表示根路径下会加载此文档显示. ")],-1))),se=X((()=>R("div",{class:"rules-tips"},[R("b",null,"*"),M("：单级路径通配符，如表达式 "),R("span",{class:"code select-all"},"/*"),M(" 表示根路径下的直接子文件夹会加载此文档显示. ")],-1))),te=X((()=>R("div",{class:"rules-tips"},[R("b",null,"**"),M("：多级路径通配符，如表达式 "),R("span",{class:"code select-all"},"/music/**"),M(" 表示 /music 文件夹及以下所有文件夹都会加载此文档. ")],-1))),oe=X((()=>R("div",{class:"rules-tips"}," 注：系统匹配到第一个符合的规则就会取文档进行显示，所以请调整好规则顺序，下方规则可进行拖拽排序。 ",-1))),ie={class:"rules-tips-link"},re={target:"_blank",class:"link",href:"http://www.ruanyifeng.com/blog/2018/09/bash-wildcards.html"},ne=X((()=>R("span",null,"参考文章 (Wikipedia)",-1))),de={target:"_blank",class:"link",href:"http://www.ruanyifeng.com/blog/2018/09/bash-wildcards.html"},me={target:"_blank",class:"link",href:"https://github.com/whinc/blog/issues/18"},pe={class:"sm:flex sm:space-x-2 sm:border-b-0 sm:pb-0 border-b pb-2"},ue={__name:"[storageId]",setup(S){let Z=h(),O=k(),P=Z.params.storageId;const{loading:X,loadReadmeData:ue,readmeList:ce,addReadmeItem:fe,deleteReadmeItem:ve,saveReadmeData:be}=function(e,a){let l=a.params.storageId;const s=()=>{const e=document.querySelector(".z-form-body");A.create(e,{draggable:".expression-item",filter:".el-button, .editor-input",onEnd:e=>{if(e.oldIndex===e.newIndex)return;const a=W.value.splice(e.oldIndex-1,1)[0];W.value.splice(e.newIndex-1,0,a)}})},t=()=>{W.value.push({description:"表达式 - "+(W.value.length+1),expression:"",readmeText:"",displayMode:"top",storageId:l})};return{loading:$,loadReadmeData:()=>{f(l).then((e=>{W.value=e.data,0===W.value.length&&t(),s()}))},readmeList:W,addReadmeItem:t,deleteReadmeItem:e=>{W.value.splice(e,1)},saveReadmeData:()=>{if(!W.value.find((e=>{if(x.isEmpty(e.description)||x.isEmpty(e.expression)||x.isEmpty(e.readmeText))return H.warning("请检查数据填写是否完整"),!0}))){$.value=!0;for(let e=0;e<W.value.length;e++)W.value[e].id=e+1;v(l,W.value).then((()=>{J.confirm("保存成功, 是否返回存储源列表？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success",callback:a=>{"confirm"===a&&e.push("/admin/storage-list")}})})).finally((()=>{$.value=!1}))}}}}(O,Z);V((()=>{ue(),xe()}));const je=y(),xe=()=>{b(P).then((e=>{e.data.type=e.data.type.key,je.value=e.data}))};let ge=y(!1);b(Z.params.storageId).then((e=>{ge.value=e.data.compatibilityReadme||!1}));const ye=()=>{j(Z.params.storageId,ge.value).then((e=>{H.success("保存成功")}))};let he=y({}),ke=y(!1);return(f,v)=>{const b=p,j=_("router-link"),x=m,y=n,h=d,k=K,V=i,S=r,Z=o,A=N;return I((U(),E(c,{model:w(ce),class:"zfile-admin-readme-form"},{"form-title":C((()=>[R("div",Y,[R("div",null,[T(j,{to:"/admin/storage-list"},{default:C((()=>[T(b,{class:"inline mr-2 cursor-pointer",name:"file-type-back"})])),_:1}),R("span",null,"目录文档（"+q(w(je)?.name)+"）",1)]),T(y,{placement:"top",content:"启用后下发的规则设置会失效，仅会为读取目录下的 readme.md 文件来渲染文档, 且固定在底部显示."},{default:C((()=>[R("div",null,[ee,T(x,{onChange:ye,"active-text":"是","inline-prompt":"","inactive-text":"否",modelValue:w(ge),"onUpdate:modelValue":v[0]||(v[0]=e=>B(ge)?ge.value=e:ge=e)},null,8,["modelValue"])])])),_:1})])])),"form-sub-title":C((()=>[T(h,{closable:!1,type:"info"},{default:C((()=>[ae,le,se,te,oe,R("div",ie,[R("a",re,[T(w(e),{class:"inline mr-1"}),ne]),R("a",de,[T(w(e),{class:"inline mr-1"}),M("参考文章 (阮一峰)")]),R("a",me,[T(w(e),{class:"inline mr-1"}),M("参考文章 (Github)")])])])),_:1})])),footer:C((()=>[T(Z,{type:"primary",size:"default",icon:w(Q),onClick:w(be)},{default:C((()=>[M("保存设置")])),_:1},8,["icon","onClick"])])),default:C((()=>[(U(!0),z(D,null,F(w(ce),((e,t)=>(U(),E(u,{required:!0,key:e,class:"expression-item"},{default:C((()=>[R("div",pe,[T(y,{content:"此处可填写表达书描述，用于辅助记忆，防止时间过长后不知道表达式含义.",placement:"top"},{default:C((()=>[T(k,{"prefix-icon":w(a),placeholder:"请输入表达式描述",modelValue:e.description,"onUpdate:modelValue":a=>e.description=a},null,8,["prefix-icon","modelValue","onUpdate:modelValue"])])),_:2},1024),T(k,{"prefix-icon":w(g),placeholder:"请输入表达式",modelValue:e.expression,"onUpdate:modelValue":a=>e.expression=a,modelModifiers:{trim:!0}},null,8,["prefix-icon","modelValue","onUpdate:modelValue"]),T(k,{class:"editor-input",onClick:a=>{return l=e,ke.value=!0,void(he.value=l);var l},readonly:"","prefix-icon":w(l),placeholder:"请点击编辑文档",modelValue:e.readmeText,"onUpdate:modelValue":a=>e.readmeText=a},null,8,["onClick","prefix-icon","modelValue","onUpdate:modelValue"]),T(S,{class:"editor-input",modelValue:e.displayMode,"onUpdate:modelValue":a=>e.displayMode=a},{default:C((()=>[T(V,{label:"顶部显示",value:"top"}),T(V,{label:"底部显示",value:"bottom"}),T(V,{label:"弹窗显示",value:"dialog"})])),_:2},1032,["modelValue","onUpdate:modelValue"]),T(Z,{type:"danger",onClick:e=>w(ve)(t),icon:w(s)},null,8,["onClick","icon"])])])),_:2},1024)))),128)),T(u,null,{default:C((()=>[T(Z,{type:"primary",size:"default",icon:w(t),onClick:w(fe)},{default:C((()=>[M("添加更多")])),_:1},8,["icon","onClick"])])),_:1}),w(ke)?(U(),E(L,{key:0,modelValue:w(he).readmeText,"onUpdate:modelValue":v[1]||(v[1]=e=>w(he).readmeText=e),visible:w(ke),"onUpdate:visible":v[2]||(v[2]=e=>B(ke)?ke.value=e:ke=e)},null,8,["modelValue","visible"])):G("",!0)])),_:1},8,["model"])),[[A,w(X)]])}}};"function"==typeof O&&O(ue);const ce=P(ue,[["__scopeId","data-v-d1896884"]]);export{ce as default};
