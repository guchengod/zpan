import{K as e,y as a,H as t}from"./base-BBwbuMrY.js";import{E as l}from"./card-CeAUe5Xt.js";import{g as o,d as r,b as s,a as n,E as i,c as d,e as p,f as m}from"./admin-download-link-DveZV8Jj.js";import{E as u}from"./tag-CxKPM5Nx.js";import{E as c,a as f}from"./select-D4OJKeW_.js";import"./scrollbar-Cg0Qc4lf.js";import{E as g}from"./popper-CF2HgFfE.js";/* empty css              */import{E as h,a as y}from"./table-B8ZsFwsh.js";import"./checkbox-C28m1aVK.js";import"./tooltip-l0sNRNKZ.js";/* empty css                *//* empty css               */import{_ as w}from"./SvgIcon-CP4hezaL.js";/* empty css                     */import{E as j,a as v}from"./form-item-BRZ0j9EI.js";import{E as b}from"./switch-DP8XpaVB.js";import{u as _}from"./useLinkSetting-D8Br4RFU.js";import{a as x}from"./admin-storage-D0L6B7uH.js";import{t as k}from"./vue3-clipboard.esm-DdTLQ7ZB.js";import{l as V}from"./admin-setting-DFIt9dmd.js";import{c as C}from"./common-B1W1rpUW.js";import{E as K,r as U,o as E,a as A,e as D,i as $,w as z,k as S,u as T,j as P,O as I,F as L,v as Y,b as F,t as R,N as H,P as M,Q as N}from"./index-B6LbRxzB.js";import{b as O}from"./route-block-B_A1xBdJ.js";import{_ as q}from"./plugin-vue_export-helper-BCo6x5W8.js";import{E as G}from"./request-B2kMKzxx.js";import{E as J}from"./index-XSoVjJxG.js";import{E as Q}from"./index-KUFYR68Z.js";import"./index-Bs7CflaZ.js";import"./debounce-Da1en5bL.js";import"./index-CfE48oVh.js";import"./_Uint8Array-FYYXr4ha.js";import"./castArray-Cx7RYULx.js";import"./event-BwRzfsZt.js";import"./scroll-Ck97Tz0c.js";import"./index-Cd2l2kYr.js";import"./_initCloneObject-CVPj0KFk.js";import"./validator-EOLRKd5b.js";import"./unit-DqtDPlxk.js";import"./index-58WTuj8x.js";const X=e=>(M("data-v-5dacd582"),e=e(),N(),e),Z={class:"zfile-admin-down-link"},B={class:"flex justify-between"},W=X((()=>S("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"下载日志",-1))),ee={key:0,class:"flex space-x-1.5 justify-center items-center cursor-pointer"},ae=X((()=>S("span",{class:"text-gray-400 text-sm font-bold"},"记录下载日志：",-1))),te={class:"mt-4"},le={class:"flex justify-between space-x-20"},oe={class:"text-gray-400"},re={class:"mb-2"},se={key:0,class:"space-x-2"},ne={key:1},ie={__name:"log",setup(M){const{data:N,saveData:O,saveLoading:q}=_(),X=K({shortKey:"",storageKey:null,page:1,limit:10,path:"",ip:"",userAgent:"",referer:"",date:"",dateFrom:"",dateTo:"",total:0}),ie=e=>{X.limit=e,X.page=1,ue()},de=e=>{X.page=e,ue()},pe=()=>(X.date instanceof Array?(X.dateFrom=X.date[0],X.dateTo=X.date[1]):(X.dateFrom="",X.dateTo=""),X),me=U(),ue=()=>{o(pe()).then((e=>{me.value=e.data,X.total=e.dataCount}))};E((()=>{ue(),he(),fe()}));const ce=U(),fe=()=>{V().then((e=>{ce.value=e.data}))},ge=U(),he=()=>{x().then((e=>{ge.value=e.data}))},ye=U(),we=()=>{let e=ye.value.getSelectionRows();0!==e.length?J.confirm("是否确认删除？","提示",{type:"warning"}).then((()=>{let a=e.map((e=>e.id));s({ids:a}).then((e=>{G.success("删除成功"),ue()}))})):G.warning("请至少选择一条数据")},je=()=>{J.confirm(`是否确认删除当前查询条件下的 ${X.total} 条直链下载日志？(如数量不对，请先点击查询后再用该功能按条件删除)`,"提示",{type:"warning"}).then((()=>{n(pe()).then((e=>{G.success("清空成功"),ue()}))}))};let ve=e=>{k(e).then((()=>{G.success("复制成功")}))},be=e=>{window.open(e)},_e=e=>C.removeDuplicateSeparator(`${ce?.value?.domain}/s/${e}`),xe=e=>C.removeDuplicateSeparator(`${ce?.value?.domain}/${ce?.value?.directLinkPrefix}/${e.storageKey}/${e.path}`);return(o,s)=>{const n=b,_=c,x=f,k=j,V=Q,C=i,K=t,U=v,E=h,M=g,q=u,J=w,pe=d,ce=y,fe=p,he=m,ke=l;return A(),D("div",Z,[$(ke,null,{default:z((()=>[S("div",B,[W,T(N)?(A(),D("div",ee,[ae,$(n,{onChange:T(O),"active-text":"是","inline-prompt":"","inactive-text":"否",modelValue:T(N).recordDownloadLog,"onUpdate:modelValue":s[0]||(s[0]=e=>T(N).recordDownloadLog=e)},null,8,["onChange","modelValue"])])):P("",!0)]),S("div",te,[$(U,{inline:"",modelValue:T(X),"onUpdate:modelValue":s[8]||(s[8]=e=>I(X)?X.value=e:null)},{default:z((()=>[$(k,{label:"存储源"},{default:z((()=>[$(x,{clearable:"",teleported:!1,modelValue:T(X).storageKey,"onUpdate:modelValue":s[1]||(s[1]=e=>T(X).storageKey=e),placeholder:"请选择存储源"},{default:z((()=>[(A(!0),D(L,null,Y(T(ge),(e=>(A(),F(_,{key:e.id,label:e.name,value:e.key},{default:z((()=>[S("div",le,[S("span",null,R(e.name),1),S("span",oe,R(e.type.description),1)])])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),$(k,{label:"短链 Key"},{default:z((()=>[$(V,{modelValue:T(X).shortKey,"onUpdate:modelValue":s[2]||(s[2]=e=>T(X).shortKey=e)},null,8,["modelValue"])])),_:1}),$(k,{label:"文件路径"},{default:z((()=>[$(V,{modelValue:T(X).path,"onUpdate:modelValue":s[3]||(s[3]=e=>T(X).path=e)},null,8,["modelValue"])])),_:1}),$(k,{label:"请求 IP"},{default:z((()=>[$(V,{modelValue:T(X).ip,"onUpdate:modelValue":s[4]||(s[4]=e=>T(X).ip=e)},null,8,["modelValue"])])),_:1}),$(k,{label:"UserAgent"},{default:z((()=>[$(V,{modelValue:T(X).userAgent,"onUpdate:modelValue":s[5]||(s[5]=e=>T(X).userAgent=e)},null,8,["modelValue"])])),_:1}),$(k,{label:"Referer"},{default:z((()=>[$(V,{modelValue:T(X).referer,"onUpdate:modelValue":s[6]||(s[6]=e=>T(X).referer=e)},null,8,["modelValue"])])),_:1}),$(k,{label:"下载时间"},{default:z((()=>[$(C,{modelValue:T(X).date,"onUpdate:modelValue":s[7]||(s[7]=e=>T(X).date=e),type:"daterange","value-format":"YYYY-MM-DD HH:mm:ss","default-time":[new Date(2e3,1,1,0,0,0),new Date(2e3,2,1,23,59,59)],"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue","default-time"])])),_:1}),$(k,null,{default:z((()=>[$(K,{type:"primary",icon:T(e),onClick:ue},{default:z((()=>[H("查询")])),_:1},8,["icon"])])),_:1})])),_:1},8,["modelValue"]),S("div",re,[$(K,{onClick:we,icon:T(a),type:"danger"},{default:z((()=>[H("批量删除选中")])),_:1},8,["icon"]),$(K,{onClick:je,icon:T(a),type:"danger"},{default:z((()=>[H("删除全部页")])),_:1},8,["icon"])]),$(ce,{border:"",ref_key:"linkTableRef",ref:ye,size:"large",data:T(me),style:{width:"100%"}},{default:z((()=>[$(E,{type:"selection",width:"55"}),$(E,{fixed:"",width:"120",label:"存储源名称"},{default:z((e=>[$(M,{content:e.row.storageType?.description,placement:"right"},{default:z((()=>[S("span",null,R(e.row.storageName),1)])),_:2},1032,["content"])])),_:1}),$(E,{fixed:"",width:"90",align:"center",label:"下载类型"},{default:z((e=>[e.row.shortKey?(A(),F(q,{key:0,type:"success"},{default:z((()=>[H("短链")])),_:1})):(A(),F(q,{key:1},{default:z((()=>[H("直链")])),_:1}))])),_:1}),$(E,{"min-width":"400","show-overflow-tooltip":!0,prop:"shortKey",label:"下载链接"},{default:z((e=>[e.row.shortKey?(A(),D("div",se,[S("span",null,R(T(_e)(e.row.shortKey)),1),$(J,{onClick:a=>T(ve)(T(_e)(e.row.shortKey)),class:"ml-2 inline cursor-pointer",name:"copy"},null,8,["onClick"]),$(J,{onClick:a=>T(be)(T(_e)(e.row.shortKey)),class:"ml-1 inline cursor-pointer text-blue-500 text-sm",name:"target"},null,8,["onClick"])])):(A(),D("div",ne,[S("span",null,R(T(xe)(e.row)),1),$(J,{onClick:a=>T(ve)(T(xe)(e.row)),class:"ml-2 inline cursor-pointer",name:"copy"},null,8,["onClick"]),$(J,{onClick:a=>T(be)(T(xe)(e.row)),class:"ml-1 inline cursor-pointer text-blue-500 text-sm",name:"target"},null,8,["onClick"])]))])),_:1}),$(E,{width:"300","show-overflow-tooltip":!0,prop:"path",label:"文件路径"}),$(E,{width:"100","show-overflow-tooltip":!0,prop:"ip",label:"请求 IP"}),$(E,{width:"250","show-overflow-tooltip":!0,prop:"userAgent",label:"UserAgent"}),$(E,{width:"200","show-overflow-tooltip":!0,prop:"referer",label:"Referer"}),$(E,{width:"155",prop:"createTime",label:"下载时间"}),$(E,{fixed:"right",width:"120",label:"操作"},{default:z((e=>[$(pe,{title:"是否确认删除?",onConfirm:a=>{return t=e.row.id,void r(t).then((e=>{G.success("删除成功"),ue()}));var t}},{reference:z((()=>[$(K,{icon:T(a),type:"danger"},{default:z((()=>[H("删除")])),_:1},8,["icon"])])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"]),$(he,null,{default:z((()=>[$(fe,{class:"mt-3","page-size":T(X).limit,background:"",layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:de,onSizeChange:ie,"current-page":T(X).page,"onUpdate:currentPage":s[9]||(s[9]=e=>T(X).page=e),"default-current-page":10,"page-sizes":[10,50,100,200,1e3,99999999],total:T(X).total},null,8,["page-size","current-page","total"])])),_:1})])])),_:1})])}}};"function"==typeof O&&O(ie);const de=q(ie,[["__scopeId","data-v-5dacd582"]]);export{de as default};
