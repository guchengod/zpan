import{J as e,H as o}from"./base-BBwbuMrY.js";/* empty css                */import{Z as a,a as l}from"./ZFormItem-DqyrjkCI.js";/* empty css              */import"./tooltip-l0sNRNKZ.js";import{E as i}from"./popper-CF2HgFfE.js";import{E as t}from"./image-viewer-Cx9Jqjr0.js";/* empty css               */import{E as n}from"./radio-CZQuNt_K.js";import{E as s}from"./switch-DP8XpaVB.js";import{l as r,u as d,g as m,v as u}from"./admin-setting-DFIt9dmd.js";import{r as c,$ as f,m as p,u as y,J as V,a as g,b as v,w as j,N as b,i as k,D as _,e as C,j as M,P as x,Q as h,k as w}from"./index-B6LbRxzB.js";import{t as A}from"./vue3-clipboard.esm-DdTLQ7ZB.js";import{E as B}from"./request-B2kMKzxx.js";import{E as S}from"./index-XSoVjJxG.js";import{b as E}from"./route-block-B_A1xBdJ.js";import{_ as F}from"./plugin-vue_export-helper-BCo6x5W8.js";import{E as U}from"./index-KUFYR68Z.js";import{v as T}from"./directive-c3Zp8yaa.js";import"./index-Cd2l2kYr.js";import"./debounce-Da1en5bL.js";import"./scroll-Ck97Tz0c.js";import"./event-BwRzfsZt.js";import"./validator-EOLRKd5b.js";import"./index-58WTuj8x.js";const D=c({});const I=e=>(x("data-v-4b34e889"),e=e(),h(),e),L=I((()=>w("b",null,"Google 身份验证器",-1))),P=I((()=>w("b",null,"Microsoft Authenticator",-1))),z=I((()=>w("br",null,null,-1))),J={key:0,class:"w-full"},q={key:1},G={__name:"index",setup(c){const{data:x,saveData:h,saveLoading:w,load2FAInfo:E,twoFAData:F,copyTwoFASecret:I,verifyCodeAndBind:G,rebind:H,cancelBind:N,validBind:Z}=function(){const{data:e,reload:o}=f(r,{formatResult:e=>e.data}),{loading:a,run:l}=f(d,{manual:!0,onSuccess(){B({message:"保存成功",type:"success"})}}),i=()=>{m().then((e=>{D.value=e.data}))};return{data:e,reload:o,saveData:()=>{l(e.value)},saveLoading:a,load2FAInfo:i,twoFAData:D,copyTwoFASecret:()=>{A(D.value.secret).then((()=>{B.success("复制成功")}))},verifyCodeAndBind:()=>{u(D.value).then((e=>{B.success("绑定成功"),o()}))},rebind:()=>{e.value.loginVerifySecret="",i()},cancelBind:()=>{S.confirm("是否确认取消绑定，确认后将自动恢复为图形验证码","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success",callback:o=>{"confirm"===o&&(e.value.loginVerifySecret="",e.value.loginVerifyMode="image")}})},validBind:()=>{S.prompt("请输入双因素认证 APP 中的验证码","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputValidator:e=>!!e,inputErrorMessage:"验证码不能为空."}).then((({value:o})=>{let a={secret:e.value.loginVerifySecret,code:o};u(a).then((()=>{B.success("验证成功")}))}))}}}();return p((()=>x.value?.loginVerifyMode),((e,o)=>{"off"!==e&&"image"!==e||!o||h(),"2fa"!==e||x.value.loginVerifySecret||E()})),p((()=>x.value?.showLogin),((e,o)=>{e!==o&&void 0!==o&&h()})),(r,d)=>{const m=s,u=a,c=n,f=o,p=t,h=i,A=U,B=l,S=T;return y(x)?V((g(),v(B,{key:0,model:y(x)},{"form-title":j((()=>[b(" 安全设置 ")])),"form-sub-title":j((()=>[b(" 此处设置可保护您的站点安全 ")])),default:j((()=>[k(u,{label:"是否显示登录入口"},{tips:j((()=>[b(" 启用后，会在门户显示后台登录入口，请根据自身情况选择是否启用 ")])),default:j((()=>[k(m,{modelValue:y(x).showLogin,"onUpdate:modelValue":d[0]||(d[0]=e=>y(x).showLogin=e)},null,8,["modelValue"])])),_:1}),k(u,{label:"登录验证方式"},_({default:j((()=>[k(c,{modelValue:y(x).loginVerifyMode,"onUpdate:modelValue":d[1]||(d[1]=e=>y(x).loginVerifyMode=e),label:"off"},{default:j((()=>[b("不启用登录验证")])),_:1},8,["modelValue"]),k(c,{modelValue:y(x).loginVerifyMode,"onUpdate:modelValue":d[2]||(d[2]=e=>y(x).loginVerifyMode=e),label:"image"},{default:j((()=>[b("启用图片验证码")])),_:1},8,["modelValue"]),k(c,{modelValue:y(x).loginVerifyMode,"onUpdate:modelValue":d[3]||(d[3]=e=>y(x).loginVerifyMode=e),label:"2fa"},{default:j((()=>[b("启用双因素认证")])),_:1},8,["modelValue"])])),_:2},["image"===y(x).loginVerifyMode?{name:"tips",fn:j((()=>[b(" 图片验证码也可能会被识别，不能完全抵挡暴力破解。 ")])),key:"0"}:void 0,"2fa"===y(x).loginVerifyMode?{name:"tips",fn:j((()=>[b(" 双因素认证可完美保护登录认证，可使用任意支持 2FA 认证的软件，如 "),L,b("、"),P,b(" 等软件. "),z])),key:"1"}:void 0]),1024),"2fa"===y(x).loginVerifyMode?(g(),v(u,{key:0,label:"双因素认证密钥"},_({default:j((()=>[y(x).loginVerifySecret?(g(),C("div",J,[k(f,{size:"small",type:"primary",onClick:y(H)},{default:j((()=>[b("重新绑定")])),_:1},8,["onClick"]),k(f,{size:"small",type:"primary",onClick:y(N)},{default:j((()=>[b("取消绑定")])),_:1},8,["onClick"]),k(f,{size:"small",type:"primary",onClick:y(Z)},{default:j((()=>[b("验证绑定")])),_:1},8,["onClick"])])):(g(),C("div",q,[k(p,{onClick:y(E),src:y(F)?.qrcode},null,8,["onClick","src"]),k(A,{readonly:"",modelValue:y(F).secret,"onUpdate:modelValue":d[4]||(d[4]=e=>y(F).secret=e)},{append:j((()=>[k(h,{class:"item",effect:"dark",content:"复制",placement:"bottom"},{default:j((()=>[k(f,{onClick:y(I),icon:y(e)},null,8,["onClick","icon"])])),_:1})])),_:1},8,["modelValue"])]))])),_:2},[y(x).loginVerifySecret?void 0:{name:"tips",fn:j((()=>[b(" 可扫描上方二维码或复制下方密钥到支持双因素认证的软件中添加。 ")])),key:"0"}]),1024)):M("",!0),"2fa"!==y(x).loginVerifyMode||y(x).loginVerifySecret?M("",!0):(g(),v(u,{key:1,label:"双因素认证验证码"},{tips:j((()=>[b(" 请绑定双因素认证软件后，输入显示的验证码进行绑定 ")])),default:j((()=>[k(A,{modelValue:y(F).code,"onUpdate:modelValue":d[5]||(d[5]=e=>y(F).code=e)},null,8,["modelValue"]),k(f,{onClick:y(G),type:"primary"},{default:j((()=>[b("验证并绑定")])),_:1},8,["onClick"])])),_:1}))])),_:1},8,["model"])),[[S,y(w)]]):M("",!0)}}};"function"==typeof E&&E(G);const H=F(G,[["__scopeId","data-v-4b34e889"]]);export{H as default};
