import{m as e,u as a}from"./request-B2kMKzxx.js";import{d as t,S as n,r as l,ad as o,s,c as i,m as r,W as c,o as u,a as d,b as f,w as v,i as m,T as p,k as g,f as y,u as b,n as k,g as h,j as w,e as x,F as z,l as C,v as I,J as _,K as O,h as S,a0 as N,t as T,x as E}from"./index-B6LbRxzB.js";import{E as L,a as R}from"./index-Cd2l2kYr.js";import{ab as j,ak as Y,b as A,d as X,m as B,aF as M,aG as $,s as F,a as P,aH as W,E as q,i as D,a0 as H,a1 as K,aI as G,z as V,aJ as J,aK as Z,_ as Q,V as U,aL as ee,w as ae,aM as te,q as ne,u as le,aq as oe,k as se}from"./base-BBwbuMrY.js";import{d as ie}from"./debounce-Da1en5bL.js";import{u as re}from"./index-KUFYR68Z.js";import{g as ce}from"./scroll-Ck97Tz0c.js";function ue(e,a,t){var n=!0,l=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return j(t)&&(n="leading"in t?!!t.leading:n,l="trailing"in t?!!t.trailing:l),ie(e,a,{leading:n,maxWait:a,trailing:l})}const de=e=>{let a,t;return"touchend"===e.type?(t=e.changedTouches[0].clientY,a=e.changedTouches[0].clientX):e.type.startsWith("touch")?(t=e.touches[0].clientY,a=e.touches[0].clientX):(t=e.clientY,a=e.clientX),{clientX:a,clientY:t}},fe=A({urlList:{type:X(Array),default:()=>e([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:X(String)}}),ve={close:()=>!0,switch:e=>B(e),rotate:e=>B(e)},me=t({name:"ElImageViewer"});const pe=ae(Q(t({...me,props:fe,emits:ve,setup(e,{expose:t,emit:N}){var T;const E=e,j={CONTAIN:{name:"contain",icon:n(M)},ORIGINAL:{name:"original",icon:n($)}},{t:Y}=F(),A=P("image-viewer"),{nextZIndex:X}=W(),B=l(),Q=l([]),ae=o(),te=l(!0),ne=l(E.initialIndex),le=s(j.CONTAIN),oe=l({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),se=l(null!=(T=E.zIndex)?T:X()),ie=i((()=>{const{urlList:e}=E;return e.length<=1})),re=i((()=>0===ne.value)),ce=i((()=>ne.value===E.urlList.length-1)),de=i((()=>E.urlList[ne.value])),fe=i((()=>[A.e("btn"),A.e("prev"),A.is("disabled",!E.infinite&&re.value)])),ve=i((()=>[A.e("btn"),A.e("next"),A.is("disabled",!E.infinite&&ce.value)])),me=i((()=>{const{scale:e,deg:a,offsetX:t,offsetY:n,enableTransition:l}=oe.value;let o=t/e,s=n/e;const i=a*Math.PI/180,r=Math.cos(i),c=Math.sin(i);o=o*r+s*c,s=s*r-t/e*c;const u={transform:`scale(${e}) rotate(${a}deg) translate(${o}px, ${s}px)`,transition:l?"transform .3s":""};return le.value.name===j.CONTAIN.name&&(u.maxWidth=u.maxHeight="100%"),u}));function pe(){ae.stop(),N("close")}function ge(){te.value=!1}function ye(e){te.value=!1,e.target.alt=Y("el.image.error")}function be(e){if(te.value||0!==e.button||!B.value)return;oe.value.enableTransition=!1;const{offsetX:t,offsetY:n}=oe.value,l=e.pageX,o=e.pageY,s=ue((e=>{oe.value={...oe.value,offsetX:t+e.pageX-l,offsetY:n+e.pageY-o}})),i=a(document,"mousemove",s);a(document,"mouseup",(()=>{i()})),e.preventDefault()}function ke(){oe.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function he(){if(te.value)return;const e=ee(j),a=Object.values(j),t=le.value.name,n=(a.findIndex((e=>e.name===t))+1)%e.length;le.value=j[e[n]],ke()}function we(e){const a=E.urlList.length;ne.value=(e+a)%a}function xe(){re.value&&!E.infinite||we(ne.value-1)}function ze(){ce.value&&!E.infinite||we(ne.value+1)}function Ce(e,a={}){if(te.value)return;const{minScale:t,maxScale:n}=E,{zoomRate:l,rotateDeg:o,enableTransition:s}={zoomRate:E.zoomRate,rotateDeg:90,enableTransition:!0,...a};switch(e){case"zoomOut":oe.value.scale>t&&(oe.value.scale=Number.parseFloat((oe.value.scale/l).toFixed(3)));break;case"zoomIn":oe.value.scale<n&&(oe.value.scale=Number.parseFloat((oe.value.scale*l).toFixed(3)));break;case"clockwise":oe.value.deg+=o,N("rotate",oe.value.deg);break;case"anticlockwise":oe.value.deg-=o,N("rotate",oe.value.deg)}oe.value.enableTransition=s}function Ie(e){var a;"pointer"===(null==(a=e.detail)?void 0:a.focusReason)&&e.preventDefault()}function _e(){E.closeOnPressEscape&&pe()}return r(de,(()=>{c((()=>{const e=Q.value[0];(null==e?void 0:e.complete)||(te.value=!0)}))})),r(ne,(e=>{ke(),N("switch",e)})),u((()=>{!function(){const e=ue((e=>{switch(e.code){case U.esc:E.closeOnPressEscape&&pe();break;case U.space:he();break;case U.left:xe();break;case U.up:Ce("zoomIn");break;case U.right:ze();break;case U.down:Ce("zoomOut")}})),t=ue((e=>{Ce((e.deltaY||e.deltaX)<0?"zoomIn":"zoomOut",{zoomRate:E.zoomRate,enableTransition:!1})}));ae.run((()=>{a(document,"keydown",e),a(document,"wheel",t)}))}()})),t({setActiveItem:we}),(e,a)=>(d(),f(b(R),{to:"body",disabled:!e.teleported},{default:v((()=>[m(p,{name:"viewer-fade",appear:""},{default:v((()=>[g("div",{ref_key:"wrapper",ref:B,tabindex:-1,class:y(b(A).e("wrapper")),style:k({zIndex:se.value})},[m(b(L),{loop:"",trapped:"","focus-trap-el":B.value,"focus-start-el":"container",onFocusoutPrevented:Ie,onReleaseRequested:_e},{default:v((()=>[g("div",{class:y(b(A).e("mask")),onClick:h((a=>e.hideOnClickModal&&pe()),["self"])},null,10,["onClick"]),w(" CLOSE "),g("span",{class:y([b(A).e("btn"),b(A).e("close")]),onClick:pe},[m(b(q),null,{default:v((()=>[m(b(D))])),_:1})],2),w(" ARROW "),b(ie)?w("v-if",!0):(d(),x(z,{key:0},[g("span",{class:y(b(fe)),onClick:xe},[m(b(q),null,{default:v((()=>[m(b(H))])),_:1})],2),g("span",{class:y(b(ve)),onClick:ze},[m(b(q),null,{default:v((()=>[m(b(K))])),_:1})],2)],64)),w(" ACTIONS "),g("div",{class:y([b(A).e("btn"),b(A).e("actions")])},[g("div",{class:y(b(A).e("actions__inner"))},[m(b(q),{onClick:e=>Ce("zoomOut")},{default:v((()=>[m(b(G))])),_:1},8,["onClick"]),m(b(q),{onClick:e=>Ce("zoomIn")},{default:v((()=>[m(b(V))])),_:1},8,["onClick"]),g("i",{class:y(b(A).e("actions__divider"))},null,2),m(b(q),{onClick:he},{default:v((()=>[(d(),f(C(b(le).icon)))])),_:1}),g("i",{class:y(b(A).e("actions__divider"))},null,2),m(b(q),{onClick:e=>Ce("anticlockwise")},{default:v((()=>[m(b(J))])),_:1},8,["onClick"]),m(b(q),{onClick:e=>Ce("clockwise")},{default:v((()=>[m(b(Z))])),_:1},8,["onClick"])],2)],2),w(" CANVAS "),g("div",{class:y(b(A).e("canvas"))},[(d(!0),x(z,null,I(e.urlList,((a,t)=>_((d(),x("img",{ref_for:!0,ref:e=>Q.value[t]=e,key:a,src:a,style:k(b(me)),class:y(b(A).e("img")),crossorigin:e.crossorigin,onLoad:ge,onError:ye,onMousedown:be},null,46,["src","crossorigin"])),[[O,t===ne.value]]))),128))],2),S(e.$slots,"default")])),_:3},8,["focus-trap-el"])],6)])),_:3})])),_:3},8,["disabled"]))}}),[["__file","image-viewer.vue"]])),ge=A({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:X([String,Object])},previewSrcList:{type:X(Array),default:()=>e([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:X(String)}}),ye={load:e=>e instanceof Event,error:e=>e instanceof Event,switch:e=>B(e),close:()=>!0,show:()=>!0},be=t({name:"ElImage",inheritAttrs:!1});const ke=ae(Q(t({...be,props:ge,emits:ye,setup(e,{emit:t}){const n=e;let o="";const{t:s}=F(),m=P("image"),p=N(),k=i((()=>te(Object.entries(p).filter((([e])=>/^(data-|on[A-Z])/i.test(e)||["id","style"].includes(e)))))),h=re({excludeListeners:!0,excludeKeys:i((()=>Object.keys(k.value)))}),C=l(),I=l(!1),_=l(!0),O=l(!1),L=l(),R=l(),j=Y&&"loading"in HTMLImageElement.prototype;let A,X;const B=i((()=>[m.e("inner"),$.value&&m.e("preview"),_.value&&m.is("loading")])),M=i((()=>{const{fit:e}=n;return Y&&e?{objectFit:e}:{}})),$=i((()=>{const{previewSrcList:e}=n;return ne(e)&&e.length>0})),W=i((()=>{const{previewSrcList:e,initialIndex:a}=n;let t=a;return a>e.length-1&&(t=0),t})),q=i((()=>"eager"!==n.loading&&(!j&&"lazy"===n.loading||n.lazy))),D=()=>{Y&&(_.value=!0,I.value=!1,C.value=n.src)};function H(e){_.value=!1,I.value=!1,t("load",e)}function K(e){_.value=!1,I.value=!0,t("error",e)}function G(){((e,a)=>{if(!Y||!e||!a)return!1;const t=e.getBoundingClientRect();let n;return n=a instanceof Element?a.getBoundingClientRect():{top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},t.top<n.bottom&&t.bottom>n.top&&t.right>n.left&&t.left<n.right})(L.value,R.value)&&(D(),Z())}const V=le(G,200,!0);async function J(){var e;if(!Y)return;await c();const{scrollContainer:t}=n;oe(t)?R.value=t:se(t)&&""!==t?R.value=null!=(e=document.querySelector(t))?e:void 0:L.value&&(R.value=ce(L.value)),R.value&&(A=a(R,"scroll",V),setTimeout((()=>G()),100))}function Z(){Y&&R.value&&V&&(null==A||A(),R.value=void 0)}function Q(e){if(e.ctrlKey)return e.deltaY<0||e.deltaY>0?(e.preventDefault(),!1):void 0}function U(){$.value&&(X=a("wheel",Q,{passive:!1}),o=document.body.style.overflow,document.body.style.overflow="hidden",O.value=!0,t("show"))}function ee(){null==X||X(),document.body.style.overflow=o,O.value=!1,t("close")}function ae(e){t("switch",e)}return r((()=>n.src),(()=>{q.value?(_.value=!0,I.value=!1,Z(),J()):D()})),u((()=>{q.value?J():D()})),(e,a)=>(d(),x("div",E({ref_key:"container",ref:L},b(k),{class:[b(m).b(),e.$attrs.class]}),[I.value?S(e.$slots,"error",{key:0},(()=>[g("div",{class:y(b(m).e("error"))},T(b(s)("el.image.error")),3)])):(d(),x(z,{key:1},[void 0!==C.value?(d(),x("img",E({key:0},b(h),{src:C.value,loading:e.loading,style:b(M),class:b(B),crossorigin:e.crossorigin,onClick:U,onLoad:H,onError:K}),null,16,["src","loading","crossorigin"])):w("v-if",!0),_.value?(d(),x("div",{key:1,class:y(b(m).e("wrapper"))},[S(e.$slots,"placeholder",{},(()=>[g("div",{class:y(b(m).e("placeholder"))},null,2)]))],2)):w("v-if",!0)],64)),b($)?(d(),x(z,{key:2},[O.value?(d(),f(b(pe),{key:0,"z-index":e.zIndex,"initial-index":b(W),infinite:e.infinite,"zoom-rate":e.zoomRate,"min-scale":e.minScale,"max-scale":e.maxScale,"url-list":e.previewSrcList,crossorigin:e.crossorigin,"hide-on-click-modal":e.hideOnClickModal,teleported:e.previewTeleported,"close-on-press-escape":e.closeOnPressEscape,onClose:ee,onSwitch:ae},{default:v((()=>[e.$slots.viewer?(d(),x("div",{key:0},[S(e.$slots,"viewer")])):w("v-if",!0)])),_:3},8,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):w("v-if",!0)],64)):w("v-if",!0)],16))}}),[["__file","image.vue"]]));export{ke as E,de as g};
