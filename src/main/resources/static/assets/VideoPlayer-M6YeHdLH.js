import{H as e}from"./base-BBwbuMrY.js";import"./tooltip-l0sNRNKZ.js";import{E as t}from"./popper-CF2HgFfE.js";/* empty css               */import{R as i,L as r,S as s,a as n,e as a,k as o,I as l,G as d,r as c,o as h,u,i as f,w as p,N as m,j as g,F as y,f as v,P as _,Q as E}from"./index-B6LbRxzB.js";import{c as b}from"./_commonjs-dynamic-modules-BHR_E30J.js";import{a as S,u as T,k as A,m as w}from"./useFileUpload-DuqU_uzX.js";import{u as L,a as I}from"./useCommon-CGwVn2w-.js";import{_ as R}from"./plugin-vue_export-helper-BCo6x5W8.js";import"./request-B2kMKzxx.js";import"./index-Cd2l2kYr.js";import"./common-B1W1rpUW.js";import"./checkbox-C28m1aVK.js";import"./event-BwRzfsZt.js";import"./index-CfE48oVh.js";import"./_Uint8Array-FYYXr4ha.js";/* empty css              */import"./index-KUFYR68Z.js";import"./use-outside-click-ez4SFYwU.js";import"./directive-c3Zp8yaa.js";import"./XCircleIcon-C5fQ6vrv.js";import"./index-XSoVjJxG.js";import"./index-58WTuj8x.js";import"./scroll-Ck97Tz0c.js";import"./validator-EOLRKd5b.js";import"./index-X5TNrnOa.js";var D,k,x={exports:{}};
/*!
 * artplayer.js v4.6.2
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2023 Harvey Zack
 * Released under the MIT License.
 */const C=r((D||(D=1,k=x,function(e,t,r,s){var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i?i:{},a="function"==typeof n[s]&&n[s],o=a.cache||{},l="function"==typeof b&&b.bind(k);function d(t,i){if(!o[t]){if(!e[t]){var r="function"==typeof n[s]&&n[s];if(!i&&r)return r(t,!0);if(a)return a(t,!0);if(l&&"string"==typeof t)return l(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}u.resolve=function(i){var r=e[t][1][i];return null!=r?r:i},u.cache={};var h=o[t]=new d.Module(t);e[t][0].call(h.exports,u,h,h.exports,this)}return o[t].exports;function u(e){var t=u.resolve(e);return!1===t?{}:d(t)}}d.isParcelRequire=!0,d.Module=function(e){this.id=e,this.bundle=d,this.exports={}},d.modules=e,d.cache=o,d.parent=a,d.register=function(t,i){e[t]=[function(e,t){t.exports=i},{}]},Object.defineProperty(d,"root",{get:function(){return n[s]}}),n[s]=d;for(var c=0;c<t.length;c++)d(t[c]);var h=d("5lTcX");k.exports=h}({"5lTcX":[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i);var s=e("bundle-text:./style/index.less"),n=r.interopDefault(s),a=e("option-validator"),o=r.interopDefault(a),l=e("./utils/emitter"),d=r.interopDefault(l),c=e("./utils"),h=e("./scheme"),u=r.interopDefault(h),f=e("./config"),p=r.interopDefault(f),m=e("./whitelist"),g=r.interopDefault(m),y=e("./template"),v=r.interopDefault(y),_=e("./i18n"),E=r.interopDefault(_),b=e("./player"),S=r.interopDefault(b),T=e("./control"),A=r.interopDefault(T),w=e("./contextmenu"),L=r.interopDefault(w),I=e("./info"),R=r.interopDefault(I),D=e("./subtitle"),k=r.interopDefault(D),x=e("./events"),C=r.interopDefault(x),M=e("./hotkey"),P=r.interopDefault(M),O=e("./layer"),N=r.interopDefault(O),F=e("./loading"),B=r.interopDefault(F),U=e("./notice"),j=r.interopDefault(U),G=e("./mask"),z=r.interopDefault(G),V=e("./icons"),$=r.interopDefault(V),H=e("./setting"),Y=r.interopDefault(H),K=e("./storage"),W=r.interopDefault(K),q=e("./plugins"),Q=r.interopDefault(q),Z=e("./mobile"),X=r.interopDefault(Z);let J=0;const ee=[];class te extends d.default{constructor(e,t){super(),this.id=++J;const i=c.mergeDeep(te.option,e);if(this.option=(0,o.default)(i,u.default),this.isLock=!1,this.isReady=!1,this.isFocus=!1,this.isInput=!1,this.isRotate=!1,this.isDestroy=!1,this.whitelist=new g.default(this),this.template=new v.default(this),this.events=new C.default(this),this.whitelist.state?(this.storage=new W.default(this),this.icons=new $.default(this),this.i18n=new E.default(this),this.notice=new j.default(this),this.player=new S.default(this),this.layers=new N.default(this),this.controls=new A.default(this),this.contextmenu=new L.default(this),this.subtitle=new k.default(this),this.info=new R.default(this),this.loading=new B.default(this),this.hotkey=new P.default(this),this.mask=new z.default(this),this.setting=new Y.default(this),this.plugins=new Q.default(this)):this.mobile=new X.default(this),"function"==typeof t&&this.on("ready",(()=>t.call(this,this))),te.DEBUG){const e=e=>{};e("Version@"+te.version),e("Env@"+te.env),e("Build@"+te.build);for(let t=0;t<p.default.events.length;t++)this.on("video:"+p.default.events[t],(t=>e("Event@"+t.type)))}ee.push(this)}static get instances(){return ee}static get version(){return"4.6.2"}static get env(){return"production"}static get build(){return"2023-01-26 15:26:58"}static get config(){return p.default}static get utils(){return c}static get scheme(){return u.default}static get Emitter(){return d.default}static get validator(){return o.default}static get kindOf(){return o.default.kindOf}static get html(){return v.default.html}static get option(){return{id:"",container:"#artplayer",url:"",poster:"",title:"",type:"",theme:"#f00",volume:.7,isLive:!1,muted:!1,autoplay:!1,autoSize:!1,autoMini:!1,loop:!1,flip:!1,playbackRate:!1,aspectRatio:!1,screenshot:!1,setting:!1,hotkey:!0,pip:!1,mutex:!0,backdrop:!0,fullscreen:!1,fullscreenWeb:!1,subtitleOffset:!1,miniProgressBar:!1,useSSR:!1,playsInline:!0,lock:!1,fastForward:!1,autoPlayback:!1,autoOrientation:!1,airplay:!1,layers:[],contextmenu:[],controls:[],settings:[],quality:[],highlight:[],plugins:[],whitelist:[],thumbnails:{url:"",number:60,column:10,width:0,height:0},subtitle:{url:"",type:"",style:{},escape:!0,encoding:"utf-8"},moreVideoAttr:{controls:!1,preload:c.isSafari?"auto":"metadata"},i18n:{},icons:{},customType:{},lang:navigator.language.toLowerCase()}}get proxy(){return this.events.proxy}get query(){return this.template.query}get video(){return this.template.$video}destroy(e=!0){this.events.destroy(),this.template.destroy(e),ee.splice(ee.indexOf(this),1),this.isDestroy=!0,this.emit("destroy")}}if(i.default=te,te.DEBUG=!1,te.CONTEXTMENU=!0,te.NOTICE_TIME=2e3,te.SETTING_WIDTH=250,te.SETTING_ITEM_WIDTH=200,te.SETTING_ITEM_HEIGHT=35,te.INDICATOR_SIZE=14,te.INDICATOR_SIZE_ICON=16,te.INDICATOR_SIZE_MOBILE=18,te.INDICATOR_SIZE_MOBILE_ICON=20,te.VOLUME_PANEL_WIDTH=60,te.VOLUME_HANDLE_WIDTH=12,te.RESIZE_TIME=500,te.SCROLL_TIME=200,te.SCROLL_GAP=50,te.AUTO_PLAYBACK_MAX=10,te.AUTO_PLAYBACK_MIN=5,te.AUTO_PLAYBACK_TIMEOUT=3e3,te.RECONNECT_TIME_MAX=5,te.RECONNECT_SLEEP_TIME=1e3,te.CONTROL_HIDE_TIME=3e3,te.DB_CLICE_TIME=300,te.MOBILE_AUTO_PLAYBACKRATE=3,te.MOBILE_AUTO_PLAYBACKRATE_TIME=1e3,te.MOBILE_AUTO_ORIENTATION_TIME=200,te.INFO_LOOP_TIME=1e3,te.FAST_FORWARD_VALUE=3,te.FAST_FORWARD_TIME=1e3,te.TOUCH_MOVE_RATIO=.5,te.VOLUME_STEP=.1,te.SEEK_STEP=5,te.PROGRESS_HEIGHT=6,te.PLAYBACK_RATE=[.5,.75,1,1.25,1.5,2],te.ASPECT_RATIO=["default","4:3","16:9"],te.FLIP=["normal","horizontal","vertical"],te.FULLSCREEN_WEB_IN_BODY=!1,"undefined"!=typeof document&&!document.getElementById("artplayer-style")){const e=c.createElement("style");e.id="artplayer-style",e.textContent=n.default,document.head.appendChild(e)}"undefined"!=typeof window&&(window.Artplayer=te)},{"bundle-text:./style/index.less":"0016T","option-validator":"bAWi2","./utils/emitter":"66mFZ","./utils":"71aH7","./scheme":"AKEiO","./config":"lyjeQ","./whitelist":"9L0ao","./template":"X13Zf","./i18n":"3jKkj","./player":"a90nx","./control":"8Z0Uf","./contextmenu":"2KYsr","./info":"02ajl","./subtitle":"eSWto","./events":"jo4S1","./hotkey":"6NoFy","./layer":"6G6hZ","./loading":"3dsEe","./notice":"dWGTw","./mask":"5POkG","./icons":"6OeNg","./setting":"3eYNH","./storage":"2aaJe","./plugins":"8MTUM","./mobile":"7mil2","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"0016T":[function(e,t,i){t.exports='.art-video-player{z-index:20;width:100%;height:100%;zoom:1;color:#eee;text-align:left;direction:ltr;user-select:none;-webkit-tap-highlight-color:#0000;touch-action:manipulation;-ms-high-contrast-adjust:none;background-color:#000;outline:0;margin:0 auto;font-family:Roboto,Arial,Helvetica,sans-serif;font-size:14px;line-height:1.3;display:flex;position:relative}.art-video-player *,.art-video-player :before,.art-video-player :after{box-sizing:border-box;margin:0;padding:0}.art-video-player ::-webkit-scrollbar{width:5px;height:5px}.art-video-player ::-webkit-scrollbar-thumb{background-color:#666}.art-video-player ::-webkit-scrollbar-thumb:hover{background-color:#ccc}.art-video-player .art-icon{justify-content:center;align-items:center;line-height:1.5;display:inline-flex}.art-video-player .art-icon svg{fill:#fff}.art-video-player img{max-width:100%;vertical-align:top}@supports ((-webkit-backdrop-filter: initial) or (backdrop-filter: initial)){.art-video-player .art-backdrop-filter{-webkit-backdrop-filter:saturate(180%)blur(20px);backdrop-filter:saturate(180%)blur(20px);background-color:#000000b3!important}}.art-video-player .art-video{z-index:10;width:100%;height:100%;cursor:pointer;background-color:#000;position:absolute;inset:0}.art-video-player .art-poster{z-index:11;width:100%;height:100%;user-select:none;pointer-events:none;background-position:50%;background-repeat:no-repeat;background-size:cover;position:absolute;inset:0}.art-video-player .art-subtitle{z-index:20;width:100%;text-align:center;color:#fff;pointer-events:none;text-shadow:1px 0 1px #000,0 1px 1px #000,-1px 0 1px #000,0 -1px 1px #000,1px 1px 1px #000,-1px -1px 1px #000,1px -1px 1px #000,-1px 1px 1px #000;padding:0 20px;font-size:20px;transition:bottom .2s;display:none;position:absolute;bottom:10px}.art-video-player .art-subtitle p{word-break:break-all;height:fit-content;margin:5px 0 0;line-height:1.2}.art-video-player.art-subtitle-show .art-subtitle{display:block}.art-video-player.art-control-show .art-subtitle{bottom:50px}.art-video-player .art-danmuku{z-index:30;width:100%;height:100%;pointer-events:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-layers{z-index:40;width:100%;height:100%;pointer-events:none;display:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-layers .art-layer{pointer-events:auto}.art-video-player.art-layer-show .art-layers{display:block}.art-video-player .art-mask{z-index:50;width:100%;height:100%;pointer-events:none;justify-content:center;align-items:center;display:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-mask .art-state{width:60px;height:60px;opacity:.85;cursor:pointer;pointer-events:auto;justify-content:center;align-items:center;display:flex;position:absolute;bottom:65px;right:30px}.art-video-player.art-mask-show .art-mask{display:flex}.art-video-player.art-mobile .art-state{position:static}.art-video-player .art-loading{z-index:70;width:100%;height:100%;pointer-events:none;justify-content:center;align-items:center;display:none;position:absolute;inset:0}.art-video-player.art-loading-show .art-loading{display:flex}.art-video-player .art-bottom{z-index:60;height:100px;opacity:0;visibility:hidden;pointer-events:none;background-image:linear-gradient(#0000,#0006,#000);background-position:bottom;background-repeat:repeat-x;flex-direction:column;justify-content:space-between;padding:50px 10px 0;transition:all .2s ease-in-out;display:flex;position:absolute;bottom:0;left:0;right:0}.art-video-player .art-bottom .art-progress{z-index:0;pointer-events:auto;flex:1;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress{height:4px;cursor:pointer;flex-direction:row;align-items:center;display:flex;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner{height:50%;width:100%;background:#fff3;align-items:center;transition:all .2s;display:flex;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-loaded{z-index:10;height:100%;width:0;background:#fff6;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-played{z-index:20;height:100%;width:0;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight{z-index:30;height:100%;pointer-events:none;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight span{width:7px;height:100%;pointer-events:auto;background:#ffffff80;display:inline-block;position:absolute;top:0;left:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{visibility:hidden;z-index:40;border-radius:50%;justify-content:center;align-items:center;transition:transform .1s ease-in-out;position:absolute;transform:scale(.1)}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator .art-icon{width:100%;height:100%;pointer-events:none;user-select:none}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator:hover{transform:scale(1.2)!important}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-tip{z-index:50;height:20px;color:#fff;text-align:center;white-space:nowrap;background:#000000b3;border-radius:3px;padding:0 5px;font-size:12px;font-weight:700;line-height:20px;display:none;position:absolute;top:-25px;left:0}.art-video-player .art-bottom .art-progress .art-control-thumbnails{pointer-events:none;background-color:#000000b3;border-radius:3px;display:none;position:absolute;bottom:10px;left:0;box-shadow:0 1px 3px #0003,0 1px 2px -1px #0003}.art-video-player .art-bottom .art-progress .art-control-loop{width:100%;height:100%;pointer-events:none;display:none;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-loop .art-loop-point{width:2px;height:8px;background:#ffffffbf;position:absolute;top:-2px;left:0}.art-video-player .art-bottom .art-controls{z-index:1;pointer-events:auto;height:45px;justify-content:space-between;align-items:center;display:flex;position:relative}.art-video-player .art-bottom .art-controls .art-controls-left,.art-video-player .art-bottom .art-controls .art-controls-right{display:flex}.art-video-player .art-bottom .art-controls .art-controls-center{height:100%;flex:1;justify-content:center;align-items:center;padding:0 10px;display:flex}.art-video-player .art-bottom .art-controls .art-controls-right{justify-content:flex-end}.art-video-player .art-bottom .art-controls .art-control{opacity:.75;min-height:36px;min-width:36px;text-align:center;cursor:pointer;white-space:nowrap;justify-content:center;align-items:center;font-size:12px;line-height:1;transition:opacity .1s ease-in-out;display:flex}.art-video-player .art-bottom .art-controls .art-control .art-icon{float:left;height:36px;width:36px;justify-content:center;align-items:center;transition:transform .2s ease-in-out;display:flex;transform:scale(1)}.art-video-player .art-bottom .art-controls .art-control .art-icon:active{transform:scale(.85)}.art-video-player .art-bottom .art-controls .art-control:hover{opacity:1}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel{float:left;width:0;height:100%;transition:margin .2s cubic-bezier(.4,0,1,1),width .2s cubic-bezier(.4,0,1,1);position:relative;overflow:hidden}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle{width:12px;height:12px;background:#fff;border-radius:12px;margin-top:-6px;position:absolute;top:50%;left:0}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:before{background:#fff;left:-54px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:after{background:#fff3;left:6px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:before,.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:after{content:"";height:3px;width:60px;margin-top:-2px;display:block;position:absolute;top:50%}.art-video-player .art-bottom .art-controls .art-control-volume:hover .art-volume-panel{width:60px}.art-video-player .art-bottom .art-controls .art-control-quality{z-index:30;position:relative}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys{width:100px;text-align:center;color:#fff;background:#000c;border-radius:3px;padding:5px 0;display:none;position:absolute;bottom:35px}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys .art-quality-item{height:30px;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;line-height:30px;overflow:hidden}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys .art-quality-item:hover{background-color:#ffffff1a}.art-video-player .art-bottom .art-controls .art-control-quality:hover .art-qualitys{display:block}.art-video-player .art-bottom:hover .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{visibility:visible;transform:scale(1)}.art-video-player.art-control-show .art-bottom,.art-video-player.art-hover .art-bottom{opacity:1;visibility:visible}.art-video-player.art-error .art-progress-indicator,.art-video-player.art-destroy .art-progress-indicator,.art-video-player.art-error .art-progress-tip,.art-video-player.art-destroy .art-progress-tip{display:none!important}.art-video-player.art-mobile .art-bottom{height:105px;padding:50px 7px 0}.art-video-player.art-mobile .art-bottom .art-controls{height:40px}.art-video-player.art-mobile .art-bottom .art-progress-indicator{visibility:visible!important;transform:scale(1)!important}.art-video-player .art-notice{z-index:80;width:100%;pointer-events:none;padding:10px;font-size:14px;display:none;position:absolute;top:0;left:0}.art-video-player .art-notice .art-notice-inner{color:#fff;background-color:#0009;border-radius:3px;padding:5px 10px;display:inline-block}.art-video-player.art-notice-show .art-notice{display:flex}.art-video-player .art-contextmenus{z-index:120;min-width:200px;background-color:#000000e6;border-radius:3px;flex-direction:column;padding:5px 0;display:none;position:absolute;top:10px;left:10px}.art-video-player .art-contextmenus .art-contextmenu{cursor:pointer;color:#fff;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;border-bottom:1px solid #ffffff1a;padding:10px 15px;font-size:12px;display:block;overflow:hidden}.art-video-player .art-contextmenus .art-contextmenu a{color:#fff;text-decoration:none}.art-video-player .art-contextmenus .art-contextmenu span{padding:0 7px;display:inline-block}.art-video-player .art-contextmenus .art-contextmenu span:hover,.art-video-player .art-contextmenus .art-contextmenu span.art-current{color:var(--theme)}.art-video-player .art-contextmenus .art-contextmenu:hover{background-color:#ffffff1a}.art-video-player .art-contextmenus .art-contextmenu:last-child{border-bottom:none}.art-video-player.art-contextmenu-show .art-contextmenus{display:flex}.art-video-player .art-settings{z-index:90;height:auto;max-height:300px;background-color:#000000e6;border-radius:3px;font-size:13px;transition:all .2s;display:none;position:absolute;bottom:60px;left:0;overflow:auto}.art-video-player .art-settings .art-setting-panel{display:none}.art-video-player .art-settings .art-setting-panel.art-current{display:block}.art-video-player .art-settings .art-setting-panel .art-setting-item{height:35px;cursor:pointer;color:#fffc;justify-content:space-between;align-items:center;padding:0 5px;line-height:1;display:flex;overflow:hidden}.art-video-player .art-settings .art-setting-panel .art-setting-item:hover{color:#fff;background-color:#ffffff1a}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current{color:var(--theme)}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon{width:30px;height:30px;justify-content:center;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon-check{visibility:hidden;height:15px}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current .art-icon-check{visibility:visible}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left{white-space:nowrap;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left .art-setting-item-left-icon{height:24px;width:24px;justify-content:center;align-items:center;margin-right:10px;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right{align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-tooltip{white-space:nowrap;color:#ffffff80;margin-right:5px;font-size:12px}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-icon{height:24px;justify-content:center;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-range{height:3px;width:80px;appearance:none;background-color:#fff3;outline:none}.art-video-player .art-settings .art-setting-panel .art-setting-item-back{border-bottom:1px solid #ffffff1a}.art-video-player.art-setting-show .art-settings{display:block}.art-video-player.art-mobile .art-settings{max-height:200px}.art-video-player .art-info{z-index:100;width:350px;color:#fff;-webkit-font-smoothing:antialiased;background-color:#000000e6;flex-direction:column;padding:10px;font-family:Noto Sans CJK SC DemiLight,Roboto,Segoe UI,Tahoma,Arial,Helvetica,sans-serif;font-size:12px;display:none;position:absolute;top:10px;left:10px}.art-video-player .art-info .art-info-item{margin-bottom:5px;display:flex}.art-video-player .art-info .art-info-item .art-info-title{width:100px;text-align:right}.art-video-player .art-info .art-info-item .art-info-content{text-overflow:ellipsis;white-space:nowrap;user-select:all;flex:1;padding-left:5px;overflow:hidden}.art-video-player .art-info .art-info-item:last-child{margin-bottom:0}.art-video-player .art-info .art-info-close{cursor:pointer;position:absolute;top:5px;right:5px}.art-video-player.art-info-show .art-info{display:flex}.art-video-player.art-hide-cursor *{cursor:none!important}.art-video-player[data-aspect-ratio] video{box-sizing:content-box;object-fit:fill}.art-video-player.art-fullscreen-web{z-index:9999;width:100%;height:100%;position:fixed;inset:0}.art-video-player .art-mini-header{z-index:110;height:35px;color:#fff;opacity:0;visibility:hidden;background-color:#00000080;justify-content:space-between;align-items:center;line-height:35px;transition:all .2s ease-in-out;display:none;position:absolute;top:0;left:0;right:0}.art-video-player .art-mini-header .art-mini-title{text-overflow:ellipsis;white-space:nowrap;cursor:move;flex:1;padding:0 10px;overflow:hidden}.art-video-player .art-mini-header .art-mini-close{width:35px;text-align:center;cursor:pointer;font-size:22px}.art-video-player.art-is-dragging{opacity:.7}.art-video-player.art-mini{z-index:9999;width:400px;height:225px;position:fixed;box-shadow:0 2px 5px #00000029,0 3px 6px #0003}.art-video-player.art-mini .art-mini-header{user-select:none;display:flex}.art-video-player.art-mini.art-hover .art-mini-header{opacity:1;visibility:visible}.art-video-player.art-mini .art-mask .art-state{position:static}.art-video-player.art-mini .art-contextmenu,.art-video-player.art-mini .art-bottom,.art-video-player.art-mini .art-danmu,.art-video-player.art-mini .art-info,.art-video-player.art-mini .art-layers,.art-video-player.art-mini .art-notice,.art-video-player.art-mini .art-settings,.art-video-player.art-mini .art-subtitle{display:none!important}.art-auto-size{justify-content:center;align-items:center;display:flex}.art-auto-size .art-video-player{transition:all .2s}.art-video-player[data-flip=horizontal] .art-video{transform:scaleX(-1)}.art-video-player[data-flip=vertical] .art-video{transform:scaleY(-1)}.art-video-player .art-layer-miniProgressBar{height:2px;background-color:var(--theme);display:block;position:absolute;bottom:0;left:0;right:0}.art-video-player .art-layer-lock{height:34px;width:34px;color:#fff;background-color:#00000080;border-radius:50%;justify-content:center;align-items:center;display:none;position:absolute;top:calc(50% - 17px);left:15px}.art-video-player .art-layer-autoPlayback{background-color:#000c;border-radius:3px;align-items:center;padding:10px;line-height:1;display:none;position:absolute;bottom:60px;left:20px}.art-video-player .art-layer-autoPlayback .art-autoPlayback-close{cursor:pointer;align-items:center;margin-right:10px;display:flex}.art-video-player .art-layer-autoPlayback .art-autoPlayback-close svg{width:15px;height:15px;fill:var(--theme)}.art-video-player .art-layer-autoPlayback .art-autoPlayback-last{margin-right:10px}.art-video-player .art-layer-autoPlayback .art-autoPlayback-jump{color:var(--theme);cursor:pointer}.art-video-player.art-lock .art-bottom{display:none!important}.art-video-player.art-lock .art-subtitle{bottom:10px!important}.art-video-player.art-lock .art-layer-miniProgressBar{display:block!important}.art-video-player.art-control-show .art-layer-miniProgressBar{display:none}.art-video-player.art-control-show .art-layer-lock{display:flex}.art-video-player .art-control-selector{position:relative}.art-video-player .art-control-selector .art-selector-list{min-width:100px;max-width:200px;max-height:200px;text-align:center;color:#fff;background-color:#000c;border-radius:3px;padding:5px 0;display:none;position:absolute;bottom:35px;overflow:auto}.art-video-player .art-control-selector .art-selector-list .art-selector-item{height:30px;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;padding:0 5px;line-height:30px;overflow:hidden}.art-video-player .art-control-selector .art-selector-list .art-selector-item:hover{background-color:#ffffff1a}.art-video-player .art-control-selector .art-selector-list .art-selector-item:hover,.art-video-player .art-control-selector .art-selector-list .art-selector-item.art-current{color:var(--theme)}.art-video-player .art-control-selector:hover .art-selector-list{display:block}[class*=hint--]{font-style:normal;display:inline-block;position:relative}[class*=hint--]:before,[class*=hint--]:after{visibility:hidden;opacity:0;z-index:1000000;pointer-events:none;transition:all .3s;position:absolute;transform:translate(0,0)}[class*=hint--]:hover:before,[class*=hint--]:hover:after{visibility:visible;opacity:1;transition-delay:.1s}[class*=hint--]:before{content:"";z-index:1000001;background:0 0;border:6px solid #0000;position:absolute}[class*=hint--]:after{color:#fff;white-space:nowrap;background:#000;padding:8px 10px;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:12px;line-height:12px}[class*=hint--][aria-label]:after{content:attr(aria-label)}[class*=hint--][data-hint]:after{content:attr(data-hint)}[aria-label=""]:before,[aria-label=""]:after,[data-hint=""]:before,[data-hint=""]:after{display:none!important}.hint--top-left:before,.hint--top-right:before,.hint--top:before{border-top-color:#000}.hint--bottom-left:before,.hint--bottom-right:before,.hint--bottom:before{border-bottom-color:#000}.hint--left:before{border-left-color:#000}.hint--right:before{border-right-color:#000}.hint--top:before{margin-bottom:-11px}.hint--top:before,.hint--top:after{bottom:100%;left:50%}.hint--top:before{left:calc(50% - 6px)}.hint--top:after{transform:translate(-50%)}.hint--top:hover:before{transform:translateY(-8px)}.hint--top:hover:after{transform:translate(-50%)translateY(-8px)}.hint--bottom:before{margin-top:-11px}.hint--bottom:before,.hint--bottom:after{top:100%;left:50%}.hint--bottom:before{left:calc(50% - 6px)}.hint--bottom:after{transform:translate(-50%)}.hint--bottom:hover:before{transform:translateY(8px)}.hint--bottom:hover:after{transform:translate(-50%)translateY(8px)}.hint--right:before{margin-bottom:-6px;margin-left:-11px}.hint--right:after{margin-bottom:-14px}.hint--right:before,.hint--right:after{bottom:50%;left:100%}.hint--right:hover:before,.hint--right:hover:after{transform:translate(8px)}.hint--left:before{margin-bottom:-6px;margin-right:-11px}.hint--left:after{margin-bottom:-14px}.hint--left:before,.hint--left:after{bottom:50%;right:100%}.hint--left:hover:before,.hint--left:hover:after{transform:translate(-8px)}.hint--top-left:before{margin-bottom:-11px}.hint--top-left:before,.hint--top-left:after{bottom:100%;left:50%}.hint--top-left:before{left:calc(50% - 6px)}.hint--top-left:after{margin-left:12px;transform:translate(-100%)}.hint--top-left:hover:before{transform:translateY(-8px)}.hint--top-left:hover:after{transform:translate(-100%)translateY(-8px)}.hint--top-right:before{margin-bottom:-11px}.hint--top-right:before,.hint--top-right:after{bottom:100%;left:50%}.hint--top-right:before{left:calc(50% - 6px)}.hint--top-right:after{margin-left:-12px;transform:translate(0)}.hint--top-right:hover:before,.hint--top-right:hover:after{transform:translateY(-8px)}.hint--bottom-left:before{margin-top:-11px}.hint--bottom-left:before,.hint--bottom-left:after{top:100%;left:50%}.hint--bottom-left:before{left:calc(50% - 6px)}.hint--bottom-left:after{margin-left:12px;transform:translate(-100%)}.hint--bottom-left:hover:before{transform:translateY(8px)}.hint--bottom-left:hover:after{transform:translate(-100%)translateY(8px)}.hint--bottom-right:before{margin-top:-11px}.hint--bottom-right:before,.hint--bottom-right:after{top:100%;left:50%}.hint--bottom-right:before{left:calc(50% - 6px)}.hint--bottom-right:after{margin-left:-12px;transform:translate(0)}.hint--bottom-right:hover:before,.hint--bottom-right:hover:after{transform:translateY(8px)}.hint--small:after,.hint--medium:after,.hint--large:after{white-space:normal;word-wrap:break-word;line-height:1.4em}.hint--small:after{width:80px}.hint--medium:after{width:150px}.hint--large:after{width:300px}[class*=hint--]:after{text-shadow:0 -1px #000;box-shadow:4px 4px 8px #0000004d}.hint--error:after{text-shadow:0 -1px #592726;background-color:#b34e4d}.hint--error.hint--top-left:before,.hint--error.hint--top-right:before,.hint--error.hint--top:before{border-top-color:#b34e4d}.hint--error.hint--bottom-left:before,.hint--error.hint--bottom-right:before,.hint--error.hint--bottom:before{border-bottom-color:#b34e4d}.hint--error.hint--left:before{border-left-color:#b34e4d}.hint--error.hint--right:before{border-right-color:#b34e4d}.hint--warning:after{text-shadow:0 -1px #6c5328;background-color:#c09854}.hint--warning.hint--top-left:before,.hint--warning.hint--top-right:before,.hint--warning.hint--top:before{border-top-color:#c09854}.hint--warning.hint--bottom-left:before,.hint--warning.hint--bottom-right:before,.hint--warning.hint--bottom:before{border-bottom-color:#c09854}.hint--warning.hint--left:before{border-left-color:#c09854}.hint--warning.hint--right:before{border-right-color:#c09854}.hint--info:after{text-shadow:0 -1px #1a3c4d;background-color:#3986ac}.hint--info.hint--top-left:before,.hint--info.hint--top-right:before,.hint--info.hint--top:before{border-top-color:#3986ac}.hint--info.hint--bottom-left:before,.hint--info.hint--bottom-right:before,.hint--info.hint--bottom:before{border-bottom-color:#3986ac}.hint--info.hint--left:before{border-left-color:#3986ac}.hint--info.hint--right:before{border-right-color:#3986ac}.hint--success:after{text-shadow:0 -1px #1a321a;background-color:#458746}.hint--success.hint--top-left:before,.hint--success.hint--top-right:before,.hint--success.hint--top:before{border-top-color:#458746}.hint--success.hint--bottom-left:before,.hint--success.hint--bottom-right:before,.hint--success.hint--bottom:before{border-bottom-color:#458746}.hint--success.hint--left:before{border-left-color:#458746}.hint--success.hint--right:before{border-right-color:#458746}.hint--always:after,.hint--always:before{opacity:1;visibility:visible}.hint--always.hint--top:before{transform:translateY(-8px)}.hint--always.hint--top:after{transform:translate(-50%)translateY(-8px)}.hint--always.hint--top-left:before{transform:translateY(-8px)}.hint--always.hint--top-left:after{transform:translate(-100%)translateY(-8px)}.hint--always.hint--top-right:before,.hint--always.hint--top-right:after{transform:translateY(-8px)}.hint--always.hint--bottom:before{transform:translateY(8px)}.hint--always.hint--bottom:after{transform:translate(-50%)translateY(8px)}.hint--always.hint--bottom-left:before{transform:translateY(8px)}.hint--always.hint--bottom-left:after{transform:translate(-100%)translateY(8px)}.hint--always.hint--bottom-right:before,.hint--always.hint--bottom-right:after{transform:translateY(8px)}.hint--always.hint--left:before,.hint--always.hint--left:after{transform:translate(-8px)}.hint--always.hint--right:before,.hint--always.hint--right:after{transform:translate(8px)}.hint--rounded:after{border-radius:4px}.hint--no-animate:before,.hint--no-animate:after{transition-duration:0s}.hint--bounce:before,.hint--bounce:after{-webkit-transition:opacity .3s,visibility .3s,-webkit-transform .3s cubic-bezier(.71,1.7,.77,1.24);-moz-transition:opacity .3s,visibility .3s,-moz-transform .3s cubic-bezier(.71,1.7,.77,1.24);transition:opacity .3s,visibility .3s,transform .3s cubic-bezier(.71,1.7,.77,1.24)}.hint--no-shadow:before,.hint--no-shadow:after{text-shadow:initial;box-shadow:initial}.hint--no-arrow:before{display:none}'},{}],bAWi2:[function(e,t,i){t.exports=function(){function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}var t=Object.prototype.toString,i=function(i){if(void 0===i)return"undefined";if(null===i)return"null";var s=e(i);if("boolean"===s)return"boolean";if("string"===s)return"string";if("number"===s)return"number";if("symbol"===s)return"symbol";if("function"===s)return"GeneratorFunction"===r(i)?"generatorfunction":"function";if(function(e){return Array.isArray?Array.isArray(e):e instanceof Array}(i))return"array";if(function(e){return!(!e.constructor||"function"!=typeof e.constructor.isBuffer)&&e.constructor.isBuffer(e)}(i))return"buffer";if(function(e){try{if("number"==typeof e.length&&"function"==typeof e.callee)return!0}catch(t){if(-1!==t.message.indexOf("callee"))return!0}return!1}(i))return"arguments";if(function(e){return e instanceof Date||"function"==typeof e.toDateString&&"function"==typeof e.getDate&&"function"==typeof e.setDate}(i))return"date";if(function(e){return e instanceof Error||"string"==typeof e.message&&e.constructor&&"number"==typeof e.constructor.stackTraceLimit}(i))return"error";if(function(e){return e instanceof RegExp||"string"==typeof e.flags&&"boolean"==typeof e.ignoreCase&&"boolean"==typeof e.multiline&&"boolean"==typeof e.global}(i))return"regexp";switch(r(i)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(e){return"function"==typeof e.throw&&"function"==typeof e.return&&"function"==typeof e.next}(i))return"generator";switch(s=t.call(i)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return s.slice(8,-1).toLowerCase().replace(/\s/g,"")};function r(e){return e.constructor?e.constructor.name:null}function s(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:["option"];return n(e,t,r),a(e,t,r),function(e,t,r){var o=i(t),l=i(e);if("object"===o){if("object"!==l)throw new Error("[Type Error]: '".concat(r.join("."),"' require 'object' type, but got '").concat(l,"'"));Object.keys(t).forEach((function(i){var o=e[i],l=t[i],d=r.slice();d.push(i),n(o,l,d),a(o,l,d),s(o,l,d)}))}if("array"===o){if("array"!==l)throw new Error("[Type Error]: '".concat(r.join("."),"' require 'array' type, but got '").concat(l,"'"));e.forEach((function(i,o){var l=e[o],d=t[o]||t[0],c=r.slice();c.push(o),n(l,d,c),a(l,d,c),s(l,d,c)}))}}(e,t,r),e}function n(e,t,r){if("string"===i(t)){var s=i(e);if("?"===t[0]&&(t=t.slice(1)+"|undefined"),!(-1<t.indexOf("|")?t.split("|").map((function(e){return e.toLowerCase().trim()})).filter(Boolean).some((function(e){return s===e})):t.toLowerCase().trim()===s))throw new Error("[Type Error]: '".concat(r.join("."),"' require '").concat(t,"' type, but got '").concat(s,"'"))}}function a(e,t,r){if("function"===i(t)){var s=t(e,i(e),r);if(!0!==s){var n=i(s);throw"string"===n?new Error(s):"error"===n?s:new Error("[Validator Error]: The scheme for '".concat(r.join("."),"' validator require return true, but got '").concat(s,"'"))}}}return s.kindOf=i,s}()},{}],"66mFZ":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i),i.default=class{on(e,t,i){const r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:i}),this}once(e,t,i){const r=this;function s(...n){r.off(e,s),t.apply(i,n)}return s._=t,this.on(e,s,i)}emit(e,...t){const i=((this.e||(this.e={}))[e]||[]).slice();for(let r=0;r<i.length;r+=1)i[r].fn.apply(i[r].ctx,t);return this}off(e,t){const i=this.e||(this.e={}),r=i[e],s=[];if(r&&t)for(let n=0,a=r.length;n<a;n+=1)r[n].fn!==t&&r[n].fn._!==t&&s.push(r[n]);return s.length?i[e]=s:delete i[e],this}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9pCYc":[function(e,t,i){i.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},i.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.exportAll=function(e,t){return Object.keys(e).forEach((function(i){"default"===i||"__esModule"===i||t.hasOwnProperty(i)||Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[i]}})})),t},i.export=function(e,t,i){Object.defineProperty(e,t,{enumerable:!0,get:i})}},{}],"71aH7":[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i);var s=e("./dom");r.exportAll(s,i);var n=e("./error");r.exportAll(n,i);var a=e("./subtitle");r.exportAll(a,i);var o=e("./file");r.exportAll(o,i);var l=e("./property");r.exportAll(l,i);var d=e("./time");r.exportAll(d,i);var c=e("./format");r.exportAll(c,i);var h=e("./compatibility");r.exportAll(h,i)},{"./dom":"bSNiV","./error":"hwmZz","./subtitle":"inzwq","./file":"6b7Ip","./property":"5NSdr","./time":"epmNy","./format":"gapRl","./compatibility":"6ZTr6","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],bSNiV:[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i),r.export(i,"query",(()=>n)),r.export(i,"queryAll",(()=>a)),r.export(i,"addClass",(()=>o)),r.export(i,"removeClass",(()=>l)),r.export(i,"hasClass",(()=>d)),r.export(i,"append",(()=>c)),r.export(i,"remove",(()=>h)),r.export(i,"setStyle",(()=>u)),r.export(i,"setStyles",(()=>f)),r.export(i,"getStyle",(()=>p)),r.export(i,"sublings",(()=>m)),r.export(i,"inverseClass",(()=>g)),r.export(i,"tooltip",(()=>y)),r.export(i,"isInViewport",(()=>v)),r.export(i,"includeFromEvent",(()=>_)),r.export(i,"replaceElement",(()=>E)),r.export(i,"createElement",(()=>b));var s=e("./compatibility");function n(e,t=document){return t.querySelector(e)}function a(e,t=document){return Array.from(t.querySelectorAll(e))}function o(e,t){return e.classList.add(t)}function l(e,t){return e.classList.remove(t)}function d(e,t){return e.classList.contains(t)}function c(e,t){return t instanceof Element?e.appendChild(t):e.insertAdjacentHTML("beforeend",String(t)),e.lastElementChild||e.lastChild}function h(e){return e.parentNode.removeChild(e)}function u(e,t,i){return e.style[t]=i,e}function f(e,t){return Object.keys(t).forEach((i=>{u(e,i,t[i])})),e}function p(e,t,i=!0){const r=window.getComputedStyle(e,null).getPropertyValue(t);return i?parseFloat(r):r}function m(e){return Array.from(e.parentElement.children).filter((t=>t!==e))}function g(e,t){m(e).forEach((e=>l(e,t))),o(e,t)}function y(e,t,i="top"){s.isMobile||(e.setAttribute("aria-label",t),o(e,"hint--rounded"),o(e,`hint--${i}`))}function v(e,t=0){const i=e.getBoundingClientRect(),r=window.innerHeight||document.documentElement.clientHeight,s=window.innerWidth||document.documentElement.clientWidth,n=i.top-t<=r&&i.top+i.height+t>=0,a=i.left-t<=s+t&&i.left+i.width+t>=0;return n&&a}function _(e,t){return e.composedPath&&e.composedPath().indexOf(t)>-1}function E(e,t){return t.parentNode.replaceChild(e,t),e}function b(e){return document.createElement(e)}},{"./compatibility":"6ZTr6","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6ZTr6":[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i),r.export(i,"userAgent",(()=>s)),r.export(i,"isMobile",(()=>n)),r.export(i,"isSafari",(()=>a)),r.export(i,"isWechat",(()=>o)),r.export(i,"isIE",(()=>l)),r.export(i,"isAndroid",(()=>d)),r.export(i,"isIOS",(()=>c));const s="undefined"!=typeof window?window.navigator.userAgent:"",n=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(s),a=/^((?!chrome|android).)*safari/i.test(s),o=/MicroMessenger/i.test(s),l=/MSIE|Trident/i.test(s),d=/android/i.test(s),c=/iPad|iPhone|iPod/i.test(s)&&!window.MSStream},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],hwmZz:[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i),r.export(i,"ArtPlayerError",(()=>s)),r.export(i,"errorHandle",(()=>n));class s extends Error{constructor(e,t){super(e),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t||this.constructor),this.name="ArtPlayerError"}}function n(e,t){if(!e)throw new s(t);return e}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],inzwq:[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");function s(e){return"WEBVTT \r\n\r\n".concat((t=e,t.replace(/(\d\d:\d\d:\d\d)[,.](\d+)/g,((e,t,i)=>{let r=i.slice(0,3);return 1===i.length&&(r=i+"00"),2===i.length&&(r=i+"0"),`${t},${r}`}))).replace(/\{\\([ibu])\}/g,"</$1>").replace(/\{\\([ibu])1\}/g,"<$1>").replace(/\{([ibu])\}/g,"<$1>").replace(/\{\/([ibu])\}/g,"</$1>").replace(/(\d\d:\d\d:\d\d),(\d\d\d)/g,"$1.$2").replace(/{[\s\S]*?}/g,"").concat("\r\n\r\n"));var t}function n(e){return URL.createObjectURL(new Blob([e],{type:"text/vtt"}))}function a(e){const t=new RegExp("Dialogue:\\s\\d,(\\d+:\\d\\d:\\d\\d.\\d\\d),(\\d+:\\d\\d:\\d\\d.\\d\\d),([^,]*),([^,]*),(?:[^,]*,){4}([\\s\\S]*)$","i");function i(e=""){return e.split(/[:.]/).map(((e,t,i)=>{if(t===i.length-1){if(1===e.length)return`.${e}00`;if(2===e.length)return`.${e}0`}else if(1===e.length)return(0===t?"0":":0")+e;return 0===t?e:t===i.length-1?`.${e}`:`:${e}`})).join("")}return`WEBVTT\n\n${e.split(/\r?\n/).map((e=>{const r=e.match(t);return r?{start:i(r[1].trim()),end:i(r[2].trim()),text:r[5].replace(/{[\s\S]*?}/g,"").replace(/(\\N)/g,"\n").trim().split(/\r?\n/).map((e=>e.trim())).join("\n")}:null})).filter((e=>e)).map(((e,t)=>e?`${t+1}\n${e.start} --\x3e ${e.end}\n${e.text}`:"")).filter((e=>e.trim())).join("\n\n")}`}r.defineInteropFlag(i),r.export(i,"srtToVtt",(()=>s)),r.export(i,"vttToBlob",(()=>n)),r.export(i,"assToVtt",(()=>a))},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6b7Ip":[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");function s(e){return e.includes("?")?s(e.split("?")[0]):e.includes("#")?s(e.split("#")[0]):e.trim().toLowerCase().split(".").pop()}function n(e,t){const i=document.createElement("a");i.style.display="none",i.href=e,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i)}r.defineInteropFlag(i),r.export(i,"getExt",(()=>s)),r.export(i,"download",(()=>n))},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5NSdr":[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i),r.export(i,"def",(()=>s)),r.export(i,"has",(()=>a)),r.export(i,"get",(()=>o)),r.export(i,"mergeDeep",(()=>l));const s=Object.defineProperty,{hasOwnProperty:n}=Object.prototype;function a(e,t){return n.call(e,t)}function o(e,t){return Object.getOwnPropertyDescriptor(e,t)}function l(...e){const t=e=>e&&"object"==typeof e&&!Array.isArray(e);return e.reduce(((e,i)=>(Object.keys(i).forEach((r=>{const s=e[r],n=i[r];Array.isArray(s)&&Array.isArray(n)?e[r]=s.concat(...n):!t(s)||!t(n)||n instanceof Element?e[r]=n:e[r]=l(s,n)})),e)),{})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],epmNy:[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");function s(e=0){return new Promise((t=>setTimeout(t,e)))}function n(e,t,i){let r;function s(...s){clearTimeout(r),r=setTimeout((function(){r=null,e.apply(i,s)}),t)}return s.clearTimeout=function(){clearTimeout(r)},s}function a(e,t){let i,r,s=!1;return function n(...a){if(s)return i=a,void(r=this);s=!0,e.apply(this,a),setTimeout((()=>{s=!1,i&&(n.apply(r,i),i=null,r=null)}),t)}}r.defineInteropFlag(i),r.export(i,"sleep",(()=>s)),r.export(i,"debounce",(()=>n)),r.export(i,"throttle",(()=>a))},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gapRl:[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");function s(e,t,i){return Math.max(Math.min(e,Math.max(t,i)),Math.min(t,i))}function n(e){return e.charAt(0).toUpperCase()+e.slice(1)}function a(e){return["string","number"].includes(typeof e)}function o(e){const t=Math.floor(e/3600),i=Math.floor((e-3600*t)/60),r=Math.floor(e-3600*t-60*i);return(t>0?[t,i,r]:[i,r]).map((e=>e<10?`0${e}`:String(e))).join(":")}function l(e){return e.replace(/[&<>'"]/g,(e=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"}[e]||e)))}r.defineInteropFlag(i),r.export(i,"clamp",(()=>s)),r.export(i,"capitalize",(()=>n)),r.export(i,"isStringOrNumber",(()=>a)),r.export(i,"secondToTime",(()=>o)),r.export(i,"escape",(()=>l))},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],AKEiO:[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i),r.export(i,"ComponentOption",(()=>u));var s=e("../utils");const n="array",a="boolean",o="string",l="number",d="object",c="function";function h(e,t,i){return(0,s.errorHandle)(t===o||t===l||e instanceof Element,`${i.join(".")} require '${o}' or 'Element' type`)}const u={html:h,disable:`?${a}`,name:`?${o}`,index:`?${l}`,style:`?${d}`,click:`?${c}`,mounted:`?${c}`,tooltip:`?${o}|${l}`,width:`?${l}`,selector:`?${n}`,onSelect:`?${c}`,switch:`?${a}`,onSwitch:`?${c}`,range:`?${n}`,onRange:`?${c}`,onChange:`?${c}`};i.default={id:o,container:h,url:o,poster:o,title:o,type:o,theme:o,lang:o,volume:l,isLive:a,muted:a,autoplay:a,autoSize:a,autoMini:a,loop:a,flip:a,playbackRate:a,aspectRatio:a,screenshot:a,setting:a,hotkey:a,pip:a,mutex:a,backdrop:a,fullscreen:a,fullscreenWeb:a,subtitleOffset:a,miniProgressBar:a,useSSR:a,playsInline:a,lock:a,fastForward:a,autoPlayback:a,autoOrientation:a,airplay:a,plugins:[c],whitelist:[`${o}|${c}|regexp`],layers:[u],contextmenu:[u],settings:[u],controls:[{...u,position:(e,t,i)=>{const r=["top","left","right"];return(0,s.errorHandle)(r.includes(e),`${i.join(".")} only accept ${r.toString()} as parameters`)}}],quality:[{default:`?${a}`,html:o,url:o}],highlight:[{time:l,text:o}],thumbnails:{url:o,number:l,column:l,width:l,height:l},subtitle:{url:o,type:o,style:d,escape:a,encoding:o},moreVideoAttr:d,i18n:d,icons:d,customType:d}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],lyjeQ:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i),i.default={propertys:["audioTracks","autoplay","buffered","controller","controls","crossOrigin","currentSrc","currentTime","defaultMuted","defaultPlaybackRate","duration","ended","error","loop","mediaGroup","muted","networkState","paused","playbackRate","played","preload","readyState","seekable","seeking","src","startDate","textTracks","videoTracks","volume"],methods:["addTextTrack","canPlayType","load","play","pause"],events:["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],prototypes:["width","height","videoWidth","videoHeight","poster","webkitDecodedFrameCount","webkitDroppedFrameCount","playsInline","webkitSupportsFullscreen","webkitDisplayingFullscreen","onenterpictureinpicture","onleavepictureinpicture","disablePictureInPicture","cancelVideoFrameCallback","requestVideoFrameCallback","getVideoPlaybackQuality","requestPictureInPicture","webkitEnterFullScreen","webkitEnterFullscreen","webkitExitFullScreen","webkitExitFullscreen"]}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9L0ao":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("./utils");i.default=class{constructor(e){this.art=e}get state(){const{option:e,constructor:{kindOf:t}}=this.art;return!r.isMobile||!e.whitelist.length||e.whitelist.some((e=>{switch(t(e)){case"string":return"*"===e||r.userAgent.indexOf(e)>-1;case"function":return e(r.userAgent);case"regexp":return e.test(r.userAgent);default:return!1}}))}}},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],X13Zf:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("./utils");class s{constructor(e){this.art=e;const{option:t,constructor:i,whitelist:s}=e;t.container instanceof Element?this.$container=t.container:(this.$container=(0,r.query)(t.container),(0,r.errorHandle)(this.$container,`No container element found by ${t.container}`));const n=this.$container.tagName.toLowerCase();(0,r.errorHandle)("div"===n,`Unsupported container element type, only support 'div' but got '${n}'`),(0,r.errorHandle)(i.instances.every((e=>e.template.$container!==this.$container)),"Cannot mount multiple instances on the same dom element"),this.query=this.query.bind(this),this.$container.dataset.artId=e.id,this.$original=this.$container.cloneNode(!0),s.state?this.desktop():this.mobile()}static get html(){return'<div class="art-video-player art-subtitle-show art-layer-show art-control-show art-mask-show"><video class="art-video"><track default kind="metadata" src=""></track></video><div class="art-poster"></div><div class="art-subtitle"></div><div class="art-danmuku"></div><div class="art-layers"></div><div class="art-mask"><div class="art-state"></div></div><div class="art-bottom"><div class="art-progress"></div><div class="art-controls"><div class="art-controls-left"></div><div class="art-controls-center"></div><div class="art-controls-right"></div></div></div><div class="art-loading"></div><div class="art-notice"><div class="art-notice-inner"></div></div><div class="art-settings"></div><div class="art-info"><div class="art-info-panel"><div class="art-info-item"><div class="art-info-title">Player version:</div><div class="art-info-content">4.6.2</div></div><div class="art-info-item"><div class="art-info-title">Video url:</div><div class="art-info-content" data-video="src"></div></div><div class="art-info-item"><div class="art-info-title">Video volume:</div><div class="art-info-content" data-video="volume"></div></div><div class="art-info-item"><div class="art-info-title">Video time:</div><div class="art-info-content" data-video="currentTime"></div></div><div class="art-info-item"><div class="art-info-title">Video duration:</div><div class="art-info-content" data-video="duration"></div></div><div class="art-info-item"><div class="art-info-title">Video resolution:</div><div class="art-info-content"><span data-video="videoWidth"></span> x <span data-video="videoHeight"></span></div></div></div><div class="art-info-close">[x]</div></div><div class="art-mini-header"><div class="art-mini-title"></div><div class="art-mini-close">×</div></div><div class="art-contextmenus"></div></div>'}query(e){return(0,r.query)(e,this.$container)}desktop(){const{option:e}=this.art;e.useSSR||(this.$container.innerHTML=s.html),this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video"),this.$track=this.query("track"),this.$poster=this.query(".art-poster"),this.$subtitle=this.query(".art-subtitle"),this.$danmuku=this.query(".art-danmuku"),this.$bottom=this.query(".art-bottom"),this.$progress=this.query(".art-progress"),this.$controls=this.query(".art-controls"),this.$controlsLeft=this.query(".art-controls-left"),this.$controlsCenter=this.query(".art-controls-center"),this.$controlsRight=this.query(".art-controls-right"),this.$layer=this.query(".art-layers"),this.$loading=this.query(".art-loading"),this.$notice=this.query(".art-notice"),this.$noticeInner=this.query(".art-notice-inner"),this.$mask=this.query(".art-mask"),this.$state=this.query(".art-state"),this.$setting=this.query(".art-settings"),this.$info=this.query(".art-info"),this.$infoPanel=this.query(".art-info-panel"),this.$infoClose=this.query(".art-info-close"),this.$miniHeader=this.query(".art-mini-header"),this.$miniTitle=this.query(".art-mini-title"),this.$miniClose=this.query(".art-mini-close"),this.$contextmenu=this.query(".art-contextmenus"),e.backdrop&&((0,r.addClass)(this.$setting,"art-backdrop-filter"),(0,r.addClass)(this.$contextmenu,"art-backdrop-filter"),(0,r.addClass)(this.$info,"art-backdrop-filter")),r.isMobile&&(0,r.addClass)(this.$player,"art-mobile")}mobile(){this.$container.innerHTML='<div class="art-video-player"><video class="art-video"></video></div>',this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video")}destroy(e){e?(0,r.replaceElement)(this.$original,this.$container):(0,r.addClass)(this.$player,"art-destroy")}}i.default=s},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3jKkj":[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i);var s=e("../utils"),n=e("./zh-cn.json"),a=r.interopDefault(n),o=e("./zh-tw.json"),l=r.interopDefault(o),d=e("./pl.json"),c=r.interopDefault(d),h=e("./cs.json"),u=r.interopDefault(h),f=e("./es.json"),p=r.interopDefault(f),m=e("./fa.json"),g=r.interopDefault(m);i.default=class{constructor(e){this.art=e,this.languages={"zh-cn":a.default,"zh-tw":l.default,pl:c.default,cs:u.default,es:p.default,fa:g.default},this.update(e.option.i18n)}init(){const e=this.art.option.lang.toLowerCase();this.language=this.languages[e]||{}}get(e){return this.language[e]||e}update(e){this.languages=(0,s.mergeDeep)(this.languages,e),this.init()}}},{"../utils":"71aH7","./zh-cn.json":"lNQi5","./zh-tw.json":"eRpom","./pl.json":"iEpPa","./cs.json":"dBgp3","./es.json":"dNIrL","./fa.json":"7Plhe","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],lNQi5:[function(e,t,i){t.exports=JSON.parse('{"Video Info":"统计信息","Close":"关闭","Video Load Failed":"加载失败","Volume":"音量","Play":"播放","Pause":"暂停","Rate":"速度","Mute":"静音","Video Flip":"画面翻转","Horizontal":"水平","Vertical":"垂直","Reconnect":"重新连接","Show Setting":"显示设置","Hide Setting":"隐藏设置","Screenshot":"截图","Play Speed":"播放速度","Aspect Ratio":"画面比例","Default":"默认","Normal":"正常","Open":"打开","Switch Video":"切换","Switch Subtitle":"切换字幕","Fullscreen":"全屏","Exit Fullscreen":"退出全屏","Web Fullscreen":"网页全屏","Exit Web Fullscreen":"退出网页全屏","Mini Player":"迷你播放器","PIP Mode":"开启画中画","Exit PIP Mode":"退出画中画","PIP Not Supported":"不支持画中画","Fullscreen Not Supported":"不支持全屏","Subtitle Offset":"字幕偏移","Last Seen":"上次看到","Jump Play":"跳转播放","AirPlay":"隔空播放","AirPlay Not Available":"隔空播放不可用"}')},{}],eRpom:[function(e,t,i){t.exports=JSON.parse('{"Video Info":"統計訊息","Close":"關閉","Video Load Failed":"載入失敗","Volume":"音量","Play":"播放","Pause":"暫停","Rate":"速度","Mute":"靜音","Video Flip":"畫面翻轉","Horizontal":"水平","Vertical":"垂直","Reconnect":"重新連接","Show Setting":"顯示设置","Hide Setting":"隱藏设置","Screenshot":"截圖","Play Speed":"播放速度","Aspect Ratio":"畫面比例","Default":"默認","Normal":"正常","Open":"打開","Switch Video":"切換","Switch Subtitle":"切換字幕","Fullscreen":"全屏","Exit Fullscreen":"退出全屏","Web Fullscreen":"網頁全屏","Exit Web Fullscreen":"退出網頁全屏","Mini Player":"迷你播放器","PIP Mode":"開啟畫中畫","Exit PIP Mode":"退出畫中畫","PIP Not Supported":"不支持畫中畫","Fullscreen Not Supported":"不支持全屏","Subtitle Offset":"字幕偏移","Last Seen":"上次看到","Jump Play":"跳轉播放","AirPlay":"隔空播放","AirPlay Not Available":"隔空播放不可用"}')},{}],iEpPa:[function(e,t,i){t.exports=JSON.parse('{"Video Info":"Informacje o wideo","Close":"Zamknij","Video Load Failed":"Błąd ładowania wideo","Volume":"Głośność","Play":"Odtwórz","Pause":"Wstrzymaj","Rate":"Oceń","Mute":"Wycisz","Video Flip":"Rotacja wideo","Horizontal":"Pozioma","Vertical":"Pionowa","Reconnect":"Połącz ponownie","Show Setting":"Pokaż ustawienia","Hide Setting":"Ukryj ustawienia","Screenshot":"Zrzut ekranu","Play Speed":"Prędkość odtwarzania","Aspect Ratio":"Współczynnik proporcji","Default":"Domyślny","Normal":"Normalny","Open":"Otwórz","Switch Video":"Przełącz wideo","Switch Subtitle":"Przełącz napisy","Fullscreen":"Pełny ekran","Exit Fullscreen":"Zamknij pełny ekran","Web Fullscreen":"Tryb pełnej strony","Exit Web Fullscreen":"Zamknij tryb pełnej strony","Mini Player":"Miniodtwarzacz","PIP Mode":"Tryb PiP","Exit PIP Mode":"Zamknij tryb PiP","PIP Not Supported":"Tryb PiP nieobsługiwany","Fullscreen Not Supported":"Pełny ekran nieobsługiwany","Subtitle Offset":"Przesunięcie napisów","Last Seen":"Ostatnio widziany","Jump Play":"Skocz do gry","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay nie jest dostępny"}')},{}],dBgp3:[function(e,t,i){t.exports=JSON.parse('{"Video Info":"Info o videu","Close":"Zavřít","Video Load Failed":"Nahrání videa selhalo","Volume":"Hlasitost","Play":"Přehrát","Pause":"Pozastavit","Rate":"Hodnocení","Mute":"Ztlumit","Video Flip":"Otočit video","Horizontal":"Horizontálně","Vertical":"Vertikálně","Reconnect":"Opětovné připojení","Show Setting":"Zobrazit nastavení","Hide Setting":"Skrýt nastavení","Screenshot":"Snímek obrazovky","Play Speed":"Rychlost přehrávání","Aspect Ratio":"Poměr stran","Default":"Výchozí","Normal":"Normální","Open":"Otevřít","Switch Video":"Přepnout video","Switch Subtitle":"Přepnout titulky","Fullscreen":"Celá obrazovka","Exit Fullscreen":"Opustit režim celé obrazovky","Web Fullscreen":"Celá stránka","Exit Web Fullscreen":"Zavřít režim celé stránky","Mini Player":"Mini přehrávač","PIP Mode":"Režim PIP","Exit PIP Mode":"Opustit režim PIP","PIP Not Supported":"Režim PIP není podporován","Fullscreen Not Supported":"Režim celé obrazovky není podporován","Subtitle Offset":"Posun titulků","Last Seen":"Naposledy viděn","Jump Play":"Hra na skok","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay není k dispozici"}')},{}],dNIrL:[function(e,t,i){t.exports=JSON.parse('{"Video Info":"Información del video","Close":"Cerrar","Video Load Failed":"Falló carga de video","Volume":"Volumen","Play":"Reproduciendo","Pause":"Pausa","Rate":"Velocidad","Mute":"Silencio","Video Flip":"Rotar video","Horizontal":"Horizontal","Vertical":"Vertical","Reconnect":"Reconectando","Show Setting":"Mostrar ajustes","Hide Setting":"Ocultar ajustes","Screenshot":"Captura de Pantalla","Play Speed":"Velocidad de reproducción","Aspect Ratio":"Relación de aspecto","Default":"Por defecto","Normal":"Normal","Open":"Abrir","Switch Video":"Cambiar video","Switch Subtitle":"Cambiar subtítulo","Fullscreen":"Pantalla completa","Exit Fullscreen":"Salir de Pantalla completa","Web Fullscreen":"Pantalla completa Web","Exit Web Fullscreen":"Salir de Pantalla completa","Mini Player":"Mini reproductor","PIP Mode":"Modo PiP","Exit PIP Mode":"Cerrar modo PiP","PIP Not Supported":"Modo PiP no compatible","Fullscreen Not Supported":"Pantalla completa no soportada","Subtitle Offset":"Ajuste subtítulo","Last Seen":"Visto última vez","Jump Play":"Saltar","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay no disponible"}')},{}],"7Plhe":[function(e,t,i){t.exports=JSON.parse('{"Video Info":"اطلاعات ویدیو","Close":"بستن","Video Load Failed":"بارگذاری ناموفق","Play":"پخش","Volume":"میزان صدا","Pause":"توقف","Rate":"نرخ","Mute":"سکوت","Video Flip":"چرخش تصویر","Horizontal":"افقی","Vertical":"عمودی","Reconnect":"اتصال مجدد","Show Setting":"تنظیمات","Hide Setting":"بستن تنظیمات","Screenshot":"عکس از صفحه","Play Speed":"سرعت پخش","Aspect Ratio":"نسبت تصویر","Default":"حالت پیشفرض","Normal":" حالت عادی","Open":"بازکردن","Switch Video":"تغییر ویدیو","Switch Subtitle":"نغییر زیرنویس","Fullscreen":"تمام صفحه","Exit Fullscreen":"کوچک کردن","Web Fullscreen":"حالت تئاتر","Exit Web Fullscreen":"خروج از حالت تئاتر","Mini Player":"حالت پخش کوچک","PIP Mode":" مینی پلیر","Exit PIP Mode":"خروج از مینی پلیر","PIP Not Supported":"عدم پشتیبانی از مینی پلیر","Fullscreen Not Supported":"عدم پشتیبانی از حالت تمام صفحه","Subtitle Offset":"افست زیرنویس","Last Seen":"آخرین بازدید","Jump Play":"جامپ پلی","AirPlay":"ایر پلی","AirPlay Not Available":"عدم پشتیبانی از ایرپلی"}')},{}],a90nx:[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i);var s=e("./urlMix"),n=r.interopDefault(s),a=e("./attrMix"),o=r.interopDefault(a),l=e("./playMix"),d=r.interopDefault(l),c=e("./pauseMix"),h=r.interopDefault(c),u=e("./toggleMix"),f=r.interopDefault(u),p=e("./seekMix"),m=r.interopDefault(p),g=e("./volumeMix"),y=r.interopDefault(g),v=e("./currentTimeMix"),_=r.interopDefault(v),E=e("./durationMix"),b=r.interopDefault(E),S=e("./switchMix"),T=r.interopDefault(S),A=e("./playbackRateMix"),w=r.interopDefault(A),L=e("./aspectRatioMix"),I=r.interopDefault(L),R=e("./screenshotMix"),D=r.interopDefault(R),k=e("./fullscreenMix"),x=r.interopDefault(k),C=e("./fullscreenWebMix"),M=r.interopDefault(C),P=e("./pipMix"),O=r.interopDefault(P),N=e("./loadedMix"),F=r.interopDefault(N),B=e("./playedMix"),U=r.interopDefault(B),j=e("./playingMix"),G=r.interopDefault(j),z=e("./autoSizeMix"),V=r.interopDefault(z),$=e("./rectMix"),H=r.interopDefault($),Y=e("./flipMix"),K=r.interopDefault(Y),W=e("./miniMix"),q=r.interopDefault(W),Q=e("./loopMix"),Z=r.interopDefault(Q),X=e("./posterMix"),J=r.interopDefault(X),ee=e("./autoHeightMix"),te=r.interopDefault(ee),ie=e("./themeMix"),re=r.interopDefault(ie),se=e("./titleMix"),ne=r.interopDefault(se),ae=e("./typeMix"),oe=r.interopDefault(ae),le=e("./normalSizeMix"),de=r.interopDefault(le),ce=e("./subtitleOffsetMix"),he=r.interopDefault(ce),ue=e("./airplayMix"),fe=r.interopDefault(ue),pe=e("./optionInit"),me=r.interopDefault(pe),ge=e("./eventInit"),ye=r.interopDefault(ge);i.default=class{constructor(e){(0,n.default)(e),(0,o.default)(e),(0,d.default)(e),(0,h.default)(e),(0,f.default)(e),(0,m.default)(e),(0,y.default)(e),(0,_.default)(e),(0,b.default)(e),(0,T.default)(e),(0,w.default)(e),(0,I.default)(e),(0,D.default)(e),(0,x.default)(e),(0,M.default)(e),(0,O.default)(e),(0,F.default)(e),(0,U.default)(e),(0,G.default)(e),(0,V.default)(e),(0,H.default)(e),(0,K.default)(e),(0,q.default)(e),(0,Z.default)(e),(0,J.default)(e),(0,te.default)(e),(0,re.default)(e),(0,ne.default)(e),(0,oe.default)(e),(0,de.default)(e),(0,he.default)(e),(0,fe.default)(e),(0,ye.default)(e),(0,me.default)(e)}}},{"./urlMix":"kQoac","./attrMix":"deCma","./playMix":"fOJuP","./pauseMix":"fzHAy","./toggleMix":"cBHxQ","./seekMix":"koAPr","./volumeMix":"6eyuR","./currentTimeMix":"faaWv","./durationMix":"5y91K","./switchMix":"iceD8","./playbackRateMix":"keKwh","./aspectRatioMix":"jihET","./screenshotMix":"36kPY","./fullscreenMix":"2GYOJ","./fullscreenWebMix":"5aYAP","./pipMix":"7EnIB","./loadedMix":"3N9mP","./playedMix":"et96R","./playingMix":"9DzzM","./autoSizeMix":"i1LDY","./rectMix":"IqARI","./flipMix":"7E7Vs","./miniMix":"gpugx","./loopMix":"f1hVG","./posterMix":"1SuFS","./autoHeightMix":"8x4te","./themeMix":"2FqhO","./titleMix":"7Am53","./typeMix":"1fQQs","./normalSizeMix":"ePkBr","./subtitleOffsetMix":"6vlBV","./airplayMix":"eftqT","./optionInit":"fCWZK","./eventInit":"f8Lv3","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kQoac:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{option:t,template:{$video:i}}=e;(0,r.def)(e,"url",{get:()=>i.currentSrc,async set(s){if(s){const n=t.type||(0,r.getExt)(s),a=t.customType[n];n&&a?(await(0,r.sleep)(),e.loading.show=!0,a.call(e,i,s,e)):(e.url&&e.url!==s&&e.once("video:canplay",(()=>{e.isReady&&e.emit("restart")})),i.src=s,e.option.url=s,e.emit("url",s))}else await(0,r.sleep)(),e.loading.show=!0}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],deCma:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{template:{$video:t}}=e;(0,r.def)(e,"attr",{value(e,i){if(void 0===i)return t[e];t[e]=i}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fOJuP:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{i18n:t,notice:i,option:s,constructor:{instances:n},template:{$video:a}}=e;(0,r.def)(e,"play",{value:async function(){const r=await a.play();if(i.show=t.get("Play"),e.emit("play"),s.mutex)for(let t=0;t<n.length;t++){const i=n[t];i!==e&&i.pause()}return r}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fzHAy:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{template:{$video:t},i18n:i,notice:s}=e;(0,r.def)(e,"pause",{value(){const r=t.pause();return s.show=i.get("Pause"),e.emit("pause"),r}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],cBHxQ:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){(0,r.def)(e,"toggle",{value:()=>e.playing?e.pause():e.play()})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],koAPr:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{notice:t}=e;(0,r.def)(e,"seek",{set(i){e.currentTime=i,e.emit("seek",e.currentTime),e.duration&&(t.show=`${(0,r.secondToTime)(e.currentTime)} / ${(0,r.secondToTime)(e.duration)}`)}}),(0,r.def)(e,"forward",{set(t){e.seek=e.currentTime+t}}),(0,r.def)(e,"backward",{set(t){e.seek=e.currentTime-t}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6eyuR":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{template:{$video:t},i18n:i,notice:s,storage:n}=e;(0,r.def)(e,"volume",{get:()=>t.volume||0,set:e=>{t.volume=(0,r.clamp)(e,0,1),s.show=`${i.get("Volume")}: ${parseInt(100*t.volume,10)}`,0!==t.volume&&n.set("volume",t.volume)}}),(0,r.def)(e,"muted",{get:()=>t.muted,set:e=>{t.muted=e}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],faaWv:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{$video:t}=e.template;(0,r.def)(e,"currentTime",{get:()=>t.currentTime||0,set:i=>{i=parseFloat(i),Number.isNaN(i)||(t.currentTime=(0,r.clamp)(i,0,e.duration))}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5y91K":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){(0,r.def)(e,"duration",{get:()=>{const{duration:t}=e.template.$video;return t===1/0?0:t||0}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],iceD8:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{i18n:t,option:i,notice:s}=e;function n(r,n,a){return new Promise((o=>{if(r===e.url)return o(r);const{playing:l}=e;e.pause(),URL.revokeObjectURL(e.url),e.url=r,e.once("video:canplay",(()=>{e.playbackRate=!1,e.aspectRatio=!1,e.flip="normal",e.autoSize=i.autoSize,e.currentTime=a,e.notice.show="",l&&e.play(),n&&(s.show=`${t.get("Switch Video")}: ${n}`),o(r)}))}))}(0,r.def)(e,"switchQuality",{value:(t,i)=>n(t,i,e.currentTime)}),(0,r.def)(e,"switchUrl",{value:(e,t)=>n(e,t,0)})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],keKwh:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{template:{$video:t},i18n:i,notice:s}=e;(0,r.def)(e,"playbackRate",{get:()=>t.playbackRate,set(r){if(r){if(r===t.playbackRate)return;t.playbackRate=r,s.show=`${i.get("Rate")}: ${1===r?i.get("Normal"):`${r}x`}`}else e.playbackRate=1}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jihET:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{template:{$video:t,$player:i},i18n:s,notice:n}=e;(0,r.def)(e,"aspectRatio",{get:()=>i.dataset.aspectRatio||"default",set(a){if(a||(a="default"),"default"===a)(0,r.setStyle)(t,"width",null),(0,r.setStyle)(t,"height",null),(0,r.setStyle)(t,"padding",null),delete i.dataset.aspectRatio;else{const e=a.split(":").map(Number),{videoWidth:s,videoHeight:n}=t,{clientWidth:o,clientHeight:l}=i,d=s/n,c=e[0]/e[1];if(d>c){const e=c*n/s;(0,r.setStyle)(t,"width",100*e+"%"),(0,r.setStyle)(t,"height","100%"),(0,r.setStyle)(t,"padding",`0 ${(o-o*e)/2}px`)}else{const e=s/c/n;(0,r.setStyle)(t,"width","100%"),(0,r.setStyle)(t,"height",100*e+"%"),(0,r.setStyle)(t,"padding",(l-l*e)/2+"px 0")}i.dataset.aspectRatio=a}n.show=`${s.get("Aspect Ratio")}: ${"default"===a?s.get("Default"):a}`,e.emit("aspectRatio",a)}}),(0,r.def)(e,"aspectRatioReset",{set(t){if(t){const{aspectRatio:t}=e;e.aspectRatio=t}}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"36kPY":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{option:t,notice:i,template:{$video:s}}=e,n=(0,r.createElement)("canvas");(0,r.def)(e,"getDataURL",{value:()=>new Promise(((e,t)=>{try{n.width=s.videoWidth,n.height=s.videoHeight,n.getContext("2d").drawImage(s,0,0),e(n.toDataURL("image/png"))}catch(r){i.show=r,t(r)}}))}),(0,r.def)(e,"getBlobUrl",{value:()=>new Promise(((e,t)=>{try{n.width=s.videoWidth,n.height=s.videoHeight,n.getContext("2d").drawImage(s,0,0),n.toBlob((t=>{e(URL.createObjectURL(t))}))}catch(r){i.show=r,t(r)}}))}),(0,r.def)(e,"screenshot",{value:async()=>{const i=await e.getDataURL();return(0,r.download)(i,`${t.title||"artplayer"}_${(0,r.secondToTime)(s.currentTime)}.png`),e.emit("screenshot",i),i}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2GYOJ":[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i);var s=e("../libs/screenfull"),n=r.interopDefault(s),a=e("../utils");i.default=function(e){const{i18n:t,notice:i,template:{$video:r,$player:s}}=e;e.once("video:loadedmetadata",(()=>{var o;n.default.isEnabled?(o=e,n.default.on("change",(()=>{o.emit("fullscreen",n.default.isFullscreen)})),(0,a.def)(o,"fullscreen",{get:()=>n.default.isFullscreen,async set(e){e?(o.normalSize="fullscreen",o.aspectRatioReset=!0,o.autoSize=!1,await n.default.request(s),(0,a.addClass)(s,"art-fullscreen"),o.emit("resize"),i.show=""):(o.aspectRatioReset=!0,o.autoSize=o.option.autoSize,await n.default.exit(),(0,a.removeClass)(s,"art-fullscreen"),o.emit("resize"),i.show="")}})):document.fullscreenEnabled||r.webkitSupportsFullscreen?(e=>{(0,a.def)(e,"fullscreen",{get:()=>r.webkitDisplayingFullscreen,set(t){t?(e.normalSize="fullscreen",r.webkitEnterFullscreen(),e.emit("fullscreen",!0),i.show=""):(r.webkitExitFullscreen(),e.emit("fullscreen",!1),i.show="")}})})(e):(0,a.def)(e,"fullscreen",{get:()=>!1,set(){i.show=t.get("Fullscreen Not Supported")}}),(0,a.def)(e,"fullscreen",(0,a.get)(e,"fullscreen"))}))}},{"../libs/screenfull":"8v40z","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8v40z":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);const r=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],s=(()=>{if("undefined"==typeof document)return!1;const e=r[0],t={};for(const i of r)if(i[1]in document){for(const[r,s]of i.entries())t[e[r]]=s;return t}return!1})(),n={change:s.fullscreenchange,error:s.fullscreenerror};let a={request:(e=document.documentElement,t)=>new Promise(((i,r)=>{const n=()=>{a.off("change",n),i()};a.on("change",n);const o=e[s.requestFullscreen](t);o instanceof Promise&&o.then(n).catch(r)})),exit:()=>new Promise(((e,t)=>{if(!a.isFullscreen)return void e();const i=()=>{a.off("change",i),e()};a.on("change",i);const r=document[s.exitFullscreen]();r instanceof Promise&&r.then(i).catch(t)})),toggle:(e,t)=>a.isFullscreen?a.exit():a.request(e,t),onchange(e){a.on("change",e)},onerror(e){a.on("error",e)},on(e,t){const i=n[e];i&&document.addEventListener(i,t,!1)},off(e,t){const i=n[e];i&&document.removeEventListener(i,t,!1)},raw:s};Object.defineProperties(a,{isFullscreen:{get:()=>Boolean(document[s.fullscreenElement])},element:{enumerable:!0,get:()=>document[s.fullscreenElement]},isEnabled:{enumerable:!0,get:()=>Boolean(document[s.fullscreenEnabled])}}),s||(a={isEnabled:!1}),i.default=a},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5aYAP":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{notice:t,constructor:i,template:{$container:s,$player:n}}=e;(0,r.def)(e,"fullscreenWeb",{get:()=>(0,r.hasClass)(n,"art-fullscreen-web"),set(a){a?(i.FULLSCREEN_WEB_IN_BODY&&(0,r.append)(document.body,n),e.normalSize="fullscreenWeb",(0,r.addClass)(n,"art-fullscreen-web"),e.aspectRatioReset=!0,e.autoSize=!1,e.emit("resize"),e.emit("fullscreenWeb",!0),t.show=""):(i.FULLSCREEN_WEB_IN_BODY&&(0,r.append)(s,n),(0,r.removeClass)(n,"art-fullscreen-web"),e.aspectRatioReset=!0,e.autoSize=e.option.autoSize,e.emit("resize"),e.emit("fullscreenWeb",!1),t.show="")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7EnIB":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{i18n:t,notice:i,template:{$video:s}}=e;document.pictureInPictureEnabled?function(e){const{template:{$video:t},proxy:i,notice:s}=e;t.disablePictureInPicture=!1,(0,r.def)(e,"pip",{get:()=>document.pictureInPictureElement,set(i){i?(e.normalSize="pip",t.requestPictureInPicture().catch((e=>{throw s.show=e,e}))):document.exitPictureInPicture().catch((e=>{throw s.show=e,e}))}}),i(t,"enterpictureinpicture",(()=>{e.emit("pip",!0)})),i(t,"leavepictureinpicture",(()=>{e.emit("pip",!1)}))}(e):s.webkitSupportsPresentationMode?function(e){const{$video:t}=e.template;t.webkitSetPresentationMode("inline"),(0,r.def)(e,"pip",{get:()=>"picture-in-picture"===t.webkitPresentationMode,set(i){i?(e.normalSize="pip",t.webkitSetPresentationMode("picture-in-picture"),e.emit("pip",!0)):(t.webkitSetPresentationMode("inline"),e.emit("pip",!1))}})}(e):(0,r.def)(e,"pip",{get:()=>!1,set(){i.show=t.get("PIP Not Supported")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3N9mP":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{$video:t}=e.template;(0,r.def)(e,"loaded",{get:()=>e.loadedTime/t.duration}),(0,r.def)(e,"loadedTime",{get:()=>t.buffered.length?t.buffered.end(t.buffered.length-1):0})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],et96R:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){(0,r.def)(e,"played",{get:()=>e.currentTime/e.duration})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9DzzM":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{$video:t}=e.template;(0,r.def)(e,"playing",{get:()=>!!(t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>2)})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],i1LDY:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{$container:t,$player:i,$video:s}=e.template;(0,r.def)(e,"autoSize",{get:()=>(0,r.hasClass)(t,"art-auto-size"),set(n){if(n){const{videoWidth:n,videoHeight:a}=s,{width:o,height:l}=t.getBoundingClientRect(),d=n/a,c=o/l;if((0,r.addClass)(t,"art-auto-size"),c>d){const e=l*d/o*100;(0,r.setStyle)(i,"width",`${e}%`),(0,r.setStyle)(i,"height","100%")}else{const e=o/d/l*100;(0,r.setStyle)(i,"width","100%"),(0,r.setStyle)(i,"height",`${e}%`)}e.emit("autoSize",{width:e.width,height:e.height})}else(0,r.removeClass)(t,"art-auto-size"),(0,r.setStyle)(i,"width",null),(0,r.setStyle)(i,"height",null),e.emit("autoSize")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],IqARI:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){(0,r.def)(e,"rect",{get:()=>e.template.$player.getBoundingClientRect()});const t=["bottom","height","left","right","top","width"];for(let i=0;i<t.length;i++){const s=t[i];(0,r.def)(e,s,{get:()=>e.rect[s]})}(0,r.def)(e,"x",{get:()=>e.left+window.pageXOffset}),(0,r.def)(e,"y",{get:()=>e.top+window.pageYOffset})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7E7Vs":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{template:{$player:t},i18n:i,notice:s}=e;(0,r.def)(e,"flip",{get:()=>t.dataset.flip||"normal",set(n){n||(n="normal"),"normal"===n?delete t.dataset.flip:t.dataset.flip=n,s.show=`${i.get("Video Flip")}: ${i.get((0,r.capitalize)(n))}`,e.emit("flip",n)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gpugx:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{i18n:t,option:i,storage:s,proxy:n,template:{$player:a,$miniClose:o,$miniTitle:l,$miniHeader:d}}=e;let c=!1,h=0,u=0,f=0,p=0;n(d,"mousedown",(t=>{c=!0,h=t.pageX,u=t.pageY,f=e.left,p=e.top})),n(document,"mousemove",(e=>{if(c){(0,r.addClass)(a,"art-is-dragging");const t=p+e.pageY-u,i=f+e.pageX-h;(0,r.setStyle)(a,"top",`${t}px`),(0,r.setStyle)(a,"left",`${i}px`),s.set("top",t),s.set("left",i)}})),n(document,"mouseup",(()=>{c=!1,(0,r.removeClass)(a,"art-is-dragging")})),n(o,"click",(()=>{e.mini=!1,c=!1,(0,r.removeClass)(a,"art-is-dragging")})),(0,r.append)(l,i.title||t.get("Mini Player")),(0,r.def)(e,"mini",{get:()=>(0,r.hasClass)(a,"art-mini"),set(t){if(t){e.normalSize="mini",e.autoSize=!1,(0,r.addClass)(a,"art-mini");const t=s.get("top"),i=s.get("left");if(t&&i)(0,r.setStyle)(a,"top",`${t}px`),(0,r.setStyle)(a,"left",`${i}px`),(0,r.isInViewport)(d)||(s.del("top"),s.del("left"),e.mini=!0);else{const t=window.innerHeight-e.height-50,i=window.innerWidth-e.width-50;s.set("top",t),s.set("left",i),(0,r.setStyle)(a,"top",`${t}px`),(0,r.setStyle)(a,"left",`${i}px`)}e.aspectRatio=!1,e.playbackRate=!1,e.notice.show="",e.emit("mini",!0)}else(0,r.removeClass)(a,"art-mini"),(0,r.setStyle)(a,"top",null),(0,r.setStyle)(a,"left",null),e.aspectRatio=!1,e.playbackRate=!1,e.autoSize=i.autoSize,e.notice.show="",e.emit("mini",!1)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],f1hVG:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){let t=[];(0,r.def)(e,"loop",{get:()=>t,set:i=>{if(Array.isArray(i)&&"number"==typeof i[0]&&"number"==typeof i[1]){const s=(0,r.clamp)(i[0],0,Math.min(i[1],e.duration)),n=(0,r.clamp)(i[1],s,e.duration);t=n-s>=1?[s,n]:[]}else t=[]}}),e.on("video:timeupdate",(()=>{t.length&&(e.currentTime<t[0]||e.currentTime>t[1])&&(e.seek=t[0])}))}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1SuFS":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{option:t,template:{$poster:i}}=e;(0,r.def)(e,"poster",{get:()=>t.poster,set(e){t.poster=e,(0,r.setStyle)(i,"backgroundImage",`url(${e})`)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8x4te":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{option:t,template:{$container:i,$video:s}}=e,n=i.style.height;(0,r.def)(e,"autoHeight",{get:()=>(0,r.hasClass)(i,"art-auto-height"),set(a){if(a){const{clientWidth:n}=i,{videoHeight:a,videoWidth:o}=s,l=a*(n/o);(0,r.setStyle)(i,"height",l+"px"),(0,r.addClass)(i,"art-auto-height"),e.autoSize=t.autoSize,e.emit("autoHeight",l)}else(0,r.setStyle)(i,"height",n),(0,r.removeClass)(i,"art-auto-height"),e.autoSize=t.autoSize,e.emit("autoHeight")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2FqhO":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{option:t,template:{$player:i}}=e;(0,r.def)(e,"theme",{get:()=>getComputedStyle(i).getPropertyValue("--theme"),set(e){t.theme=e,i.style.setProperty("--theme",e)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7Am53":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){(0,r.def)(e,"title",{get:()=>e.option.title,set(t){e.option.title=t}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1fQQs":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){(0,r.def)(e,"type",{get:()=>e.option.type,set(t){e.option.type=t}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ePkBr:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const t=["mini","pip","fullscreen","fullscreenWeb"];(0,r.def)(e,"normalSize",{get:()=>t.every((t=>!e[t])),set(i){t.filter((e=>e!==i)).forEach((t=>{e[t]&&(e[t]=!1)}))}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6vlBV":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{clamp:t}=e.constructor.utils,{notice:i,template:s,i18n:n}=e;let a=0,o=[];e.on("subtitle:switch",(()=>{o=[]})),(0,r.def)(e,"subtitleOffset",{get:()=>a,set(r){if(s.$track&&s.$track.track){const l=Array.from(s.$track.track.cues);a=t(r,-5,5);for(let i=0;i<l.length;i++){const r=l[i];o[i]||(o[i]={startTime:r.startTime,endTime:r.endTime}),r.startTime=t(o[i].startTime+a,0,e.duration),r.endTime=t(o[i].endTime+a,0,e.duration)}e.subtitle.update(),i.show=`${n.get("Subtitle Offset")}: ${r}s`,e.emit("subtitleOffset",r)}else e.emit("subtitleOffset",0)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eftqT:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{i18n:t,notice:i,proxy:s,template:{$video:n}}=e;let a=!0;window.WebKitPlaybackTargetAvailabilityEvent&&n.webkitShowPlaybackTargetPicker?s(n,"webkitplaybacktargetavailabilitychanged",(e=>{switch(e.availability){case"available":a=!0;break;case"not-available":a=!1}})):a=!1,(0,r.def)(e,"airplay",{value(){a?(n.webkitShowPlaybackTargetPicker(),e.emit("airplay")):i.show=t.get("AirPlay Not Available")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fCWZK:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{option:t,storage:i,template:{$video:s,$poster:n}}=e;Object.keys(t.moreVideoAttr).forEach((i=>{e.attr(i,t.moreVideoAttr[i])})),t.muted&&(e.muted=t.muted),t.volume&&(s.volume=(0,r.clamp)(t.volume,0,1));const a=i.get("volume");"number"==typeof a&&(s.volume=(0,r.clamp)(a,0,1)),t.poster&&(0,r.setStyle)(n,"backgroundImage",`url(${t.poster})`),t.autoplay&&(s.autoplay=t.autoplay),t.playsInline&&(s.playsInline=!0,s["webkit-playsinline"]=!0),t.theme&&(e.theme=t.theme),e.url=t.url}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],f8Lv3:[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i);var s=e("../config"),n=r.interopDefault(s),a=e("../utils");i.default=function(e){const{i18n:t,notice:i,option:r,constructor:s,proxy:o,template:{$player:l,$video:d,$poster:c}}=e;let h=0;for(let a=0;a<n.default.events.length;a++)o(d,n.default.events[a],(t=>{e.emit(`video:${t.type}`,t)}));e.on("video:canplay",(()=>{h=0,e.loading.show=!1})),e.once("video:canplay",(()=>{e.loading.show=!1,e.controls.show=!0,e.mask.show=!0,e.isReady=!0,e.emit("ready")})),e.on("video:ended",(()=>{r.loop?(e.seek=0,e.play(),e.controls.show=!1,e.mask.show=!1):(e.controls.show=!0,e.mask.show=!0)})),e.on("video:error",(async n=>{h<s.RECONNECT_TIME_MAX?(await(0,a.sleep)(s.RECONNECT_SLEEP_TIME),h+=1,e.url=r.url,i.show=`${t.get("Reconnect")}: ${h}`,e.emit("error",n,h)):(e.mask.show=!0,e.loading.show=!1,e.controls.show=!0,(0,a.addClass)(l,"art-error"),await(0,a.sleep)(s.RECONNECT_SLEEP_TIME),i.show=t.get("Video Load Failed"),e.destroy(!1))})),e.on("video:loadedmetadata",(()=>{e.autoSize=r.autoSize,a.isMobile&&(e.loading.show=!1,e.controls.show=!0,e.mask.show=!0)})),e.on("video:loadstart",(()=>{e.loading.show=!0,e.mask.show=!1,e.controls.show=!0})),e.on("video:pause",(()=>{e.controls.show=!0,e.mask.show=!0})),e.on("video:play",(()=>{e.mask.show=!1,(0,a.setStyle)(c,"display","none")})),e.on("video:playing",(()=>{e.mask.show=!1})),e.on("video:seeked",(()=>{e.loading.show=!1})),e.on("video:seeking",(()=>{e.loading.show=!0,e.mask.show=!1})),e.on("video:timeupdate",(()=>{e.mask.show=!1})),e.on("video:waiting",(()=>{e.loading.show=!0,e.mask.show=!1}))}},{"../config":"lyjeQ","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8Z0Uf":[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i);var s=e("../utils"),n=e("../utils/component"),a=r.interopDefault(n),o=e("./fullscreen"),l=r.interopDefault(o),d=e("./fullscreenWeb"),c=r.interopDefault(d),h=e("./pip"),u=r.interopDefault(h),f=e("./playAndPause"),p=r.interopDefault(f),m=e("./progress"),g=r.interopDefault(m),y=e("./time"),v=r.interopDefault(y),_=e("./volume"),E=r.interopDefault(_),b=e("./setting"),S=r.interopDefault(b),T=e("./thumbnails"),A=r.interopDefault(T),w=e("./screenshot"),L=r.interopDefault(w),I=e("./quality"),R=r.interopDefault(I),D=e("./loop"),k=r.interopDefault(D),x=e("./airplay"),C=r.interopDefault(x);class M extends a.default{constructor(e){super(e),this.name="control";const{proxy:t,constructor:i,template:{$player:r}}=e;let n=Date.now();t(r,["click","mousemove","touchstart","touchmove"],(()=>{this.show=!0,(0,s.removeClass)(r,"art-hide-cursor"),(0,s.addClass)(r,"art-hover"),n=Date.now()})),e.on("video:timeupdate",(()=>{!e.isInput&&e.playing&&this.show&&Date.now()-n>=i.CONTROL_HIDE_TIME&&(this.show=!1,(0,s.addClass)(r,"art-hide-cursor"),(0,s.removeClass)(r,"art-hover"))})),this.init()}init(){const{option:e}=this.art;e.isLive||this.add((0,g.default)({name:"progress",position:"top",index:10})),!e.thumbnails.url||e.isLive||s.isMobile||this.add((0,A.default)({name:"thumbnails",position:"top",index:20})),this.add((0,k.default)({name:"loop",position:"top",index:30})),this.add((0,p.default)({name:"playAndPause",position:"left",index:10})),this.add((0,E.default)({name:"volume",position:"left",index:20})),e.isLive||this.add((0,v.default)({name:"time",position:"left",index:30})),e.quality.length&&this.add((0,R.default)({name:"quality",position:"right",index:10})),e.screenshot&&!s.isMobile&&this.add((0,L.default)({name:"screenshot",position:"right",index:20})),e.setting&&this.add((0,S.default)({name:"setting",position:"right",index:30})),e.pip&&this.add((0,u.default)({name:"pip",position:"right",index:40})),e.airplay&&window.WebKitPlaybackTargetAvailabilityEvent&&this.add((0,C.default)({name:"airplay",position:"right",index:50})),e.fullscreenWeb&&this.add((0,c.default)({name:"fullscreenWeb",position:"right",index:60})),e.fullscreen&&this.add((0,l.default)({name:"fullscreen",position:"right",index:70}));for(let t=0;t<e.controls.length;t++)this.add(e.controls[t])}add(e){const t="function"==typeof e?e(this.art):e,{$progress:i,$controlsLeft:r,$controlsRight:n}=this.art.template;switch(t.position){case"top":this.$parent=i;break;case"left":this.$parent=r;break;case"right":this.$parent=n;break;default:(0,s.errorHandle)(!1,"Control option.position must one of 'top', 'left', 'right'")}super.add(t)}}i.default=M},{"../utils":"71aH7","../utils/component":"18nVI","./fullscreen":"c61Lj","./fullscreenWeb":"03jeB","./pip":"u8l8e","./playAndPause":"ebXtb","./progress":"bgoVP","./time":"ikc2j","./volume":"b8NFx","./setting":"03o9l","./thumbnails":"eCVx2","./screenshot":"4KCF5","./quality":"efgTY","./loop":"2hIff","./airplay":"4IS2d","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"18nVI":[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i);var s=e("./dom"),n=e("option-validator"),a=r.interopDefault(n),o=e("../scheme"),l=e("./property"),d=e("./error");i.default=class{constructor(e){this.id=0,this.art=e,this.add=this.add.bind(this)}get show(){return(0,s.hasClass)(this.art.template.$player,`art-${this.name}-show`)}set show(e){const{$player:t}=this.art.template,i=`art-${this.name}-show`;e?(0,s.addClass)(t,i):(0,s.removeClass)(t,i),this.art.emit(this.name,e)}set toggle(e){e&&(this.show=!this.show)}add(e){const t="function"==typeof e?e(this.art):e;if(t.html=t.html||"",(0,a.default)(t,o.ComponentOption),!this.$parent||!this.name||t.disable)return;const i=t.name||`${this.name}${this.id}`;(0,d.errorHandle)(!(0,l.has)(this,i),`Cannot add an existing name [${i}] to the [${this.name}]`),this.id+=1;const r=(0,s.createElement)("div");(0,s.addClass)(r,`art-${this.name}`),(0,s.addClass)(r,`art-${this.name}-${i}`);const n=Array.from(this.$parent.children);r.dataset.index=t.index||this.id;const c=n.find((e=>Number(e.dataset.index)>=Number(r.dataset.index)));return c?c.insertAdjacentElement("beforebegin",r):(0,s.append)(this.$parent,r),t.html&&(0,s.append)(r,t.html),t.style&&(0,s.setStyles)(r,t.style),t.tooltip&&(0,s.tooltip)(r,t.tooltip),t.click&&this.art.events.proxy(r,"click",(e=>{e.preventDefault(),t.click.call(this.art,this,e)})),t.selector&&["left","right"].includes(t.position)&&this.selector(t,r),t.mounted&&t.mounted.call(this.art,r),(0,l.def)(this,i,{value:r}),r}selector(e,t){const{hover:i,proxy:r}=this.art.events;(0,s.addClass)(t,"art-control-selector");const n=(0,s.createElement)("div");(0,s.addClass)(n,"art-selector-value"),(0,s.append)(n,e.html),t.innerText="",(0,s.append)(t,n);const a=e.selector.map(((e,t)=>`<div class="art-selector-item ${e.default?"art-current":""}" data-index="${t}">${e.html}</div>`)).join(""),o=(0,s.createElement)("div");(0,s.addClass)(o,"art-selector-list"),(0,s.append)(o,a),(0,s.append)(t,o),this.art.option.backdrop&&(0,s.addClass)(o,"art-backdrop-filter");const l=()=>{const e=(0,s.getStyle)(t,"width")/2-(0,s.getStyle)(o,"width")/2;o.style.left=`${e}px`};i(t,l),r(o,"click",(async t=>{const i=(t.composedPath()||[]).find((e=>(0,s.hasClass)(e,"art-selector-item")));if(!i)return;(0,s.inverseClass)(i,"art-current");const r=Number(i.dataset.index),a=e.selector[r]||{};if(n.innerText=i.innerText,e.onSelect){const r=await e.onSelect.call(this.art,a,i,t);"string"!=typeof r&&"number"!=typeof r||(n.innerHTML=r)}l()}))}}},{"./dom":"bSNiV","option-validator":"bAWi2","../scheme":"AKEiO","./property":"5NSdr","./error":"hwmZz","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],c61Lj:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){return t=>({...e,tooltip:t.i18n.get("Fullscreen"),mounted:e=>{const{proxy:i,icons:s,i18n:n}=t,a=(0,r.append)(e,s.fullscreenOn),o=(0,r.append)(e,s.fullscreenOff);(0,r.setStyle)(o,"display","none"),i(e,"click",(()=>{t.fullscreen=!t.fullscreen})),t.on("fullscreen",(t=>{t?((0,r.tooltip)(e,n.get("Exit Fullscreen")),(0,r.setStyle)(a,"display","none"),(0,r.setStyle)(o,"display","inline-flex")):((0,r.tooltip)(e,n.get("Fullscreen")),(0,r.setStyle)(a,"display","inline-flex"),(0,r.setStyle)(o,"display","none"))}))}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"03jeB":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){return t=>({...e,tooltip:t.i18n.get("Web Fullscreen"),mounted:e=>{const{proxy:i,icons:s,i18n:n}=t,a=(0,r.append)(e,s.fullscreenWebOn),o=(0,r.append)(e,s.fullscreenWebOff);(0,r.setStyle)(o,"display","none"),i(e,"click",(()=>{t.fullscreenWeb=!t.fullscreenWeb})),t.on("fullscreenWeb",(t=>{t?((0,r.tooltip)(e,n.get("Exit Web Fullscreen")),(0,r.setStyle)(a,"display","none"),(0,r.setStyle)(o,"display","inline-flex")):((0,r.tooltip)(e,n.get("Web Fullscreen")),(0,r.setStyle)(a,"display","inline-flex"),(0,r.setStyle)(o,"display","none"))}))}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],u8l8e:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){return t=>({...e,tooltip:t.i18n.get("PIP Mode"),mounted:e=>{const{proxy:i,icons:s,i18n:n}=t;(0,r.append)(e,s.pip),i(e,"click",(()=>{t.pip=!t.pip})),t.on("pip",(t=>{(0,r.tooltip)(e,n.get(t?"Exit PIP Mode":"PIP Mode"))}))}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ebXtb:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){return t=>({...e,mounted:e=>{const{proxy:i,icons:s,i18n:n}=t,a=(0,r.append)(e,s.play),o=(0,r.append)(e,s.pause);function l(){(0,r.setStyle)(a,"display","flex"),(0,r.setStyle)(o,"display","none")}function d(){(0,r.setStyle)(a,"display","none"),(0,r.setStyle)(o,"display","flex")}(0,r.tooltip)(a,n.get("Play")),(0,r.tooltip)(o,n.get("Pause")),i(a,"click",(()=>{t.play()})),i(o,"click",(()=>{t.pause()})),t.playing?d():l(),t.on("video:playing",(()=>{d()})),t.on("video:pause",(()=>{l()}))}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],bgoVP:[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i),r.export(i,"getPosFromEvent",(()=>n)),r.export(i,"setCurrentTime",(()=>a));var s=e("../utils");function n(e,t){const{$progress:i}=e.template,{left:r}=i.getBoundingClientRect(),n=s.isMobile?t.touches[0].clientX:t.pageX,a=(0,s.clamp)(n-r,0,i.clientWidth),o=a/i.clientWidth*e.duration;return{second:o,time:(0,s.secondToTime)(o),width:a,percentage:(0,s.clamp)(a/i.clientWidth,0,1)}}function a(e,t){if(e.isRotate){const i=t.touches[0].clientY/e.height,r=i*e.duration;e.emit("setBar","played",i),e.seek=r}else{const{second:i,percentage:r}=n(e,t);e.emit("setBar","played",r),e.seek=i}}i.default=function(e){return t=>{const{icons:i,option:r,proxy:o}=t;return{...e,html:'<div class="art-control-progress-inner"><div class="art-progress-loaded"></div><div class="art-progress-played"></div><div class="art-progress-highlight"></div><div class="art-progress-indicator"></div><div class="art-progress-tip"></div></div>',mounted:e=>{let l=!1;const d=(0,s.query)(".art-progress-loaded",e),c=(0,s.query)(".art-progress-played",e),h=(0,s.query)(".art-progress-highlight",e),u=(0,s.query)(".art-progress-indicator",e),f=(0,s.query)(".art-progress-tip",e),{PROGRESS_HEIGHT:p,INDICATOR_SIZE:m,INDICATOR_SIZE_ICON:g,INDICATOR_SIZE_MOBILE:y,INDICATOR_SIZE_MOBILE_ICON:v}=t.constructor;(0,s.setStyle)(e,"height",`${p}px`),(0,s.setStyle)(c,"backgroundColor","var(--theme)");let _=m;function E(e,t){"loaded"===e&&(0,s.setStyle)(d,"width",100*t+"%"),"played"===e&&((0,s.setStyle)(c,"width",100*t+"%"),(0,s.setStyle)(u,"left",`calc(${100*t}% - ${_/2}px)`))}i.indicator?(_=g,(0,s.append)(u,i.indicator)):(0,s.setStyles)(u,{backgroundColor:"var(--theme)"}),s.isMobile&&(_=y,i.indicator&&(_=v)),(0,s.setStyles)(u,{left:`-${_/2}px`,width:`${_}px`,height:`${_}px`}),t.on("video:loadedmetadata",(()=>{for(let e=0;e<r.highlight.length;e++){const i=r.highlight[e],n=(0,s.clamp)(i.time,0,t.duration)/t.duration*100;(0,s.append)(h,`<span data-text="${i.text}" data-time="${i.time}" style="left: ${n}%"></span>`)}})),E("loaded",t.loaded),t.on("setBar",((e,t)=>{E(e,t)})),t.on("video:progress",(()=>{E("loaded",t.loaded)})),t.on("video:timeupdate",(()=>{E("played",t.played)})),t.on("video:ended",(()=>{E("played",1)})),s.isMobile||(o(e,"click",(e=>{e.target!==u&&a(t,e)})),o(e,"mousemove",(i=>{(0,s.setStyle)(f,"display","block"),(0,s.includeFromEvent)(i,h)?function(i){const{width:r}=n(t,i),{text:a}=i.target.dataset;f.innerHTML=a;const o=f.clientWidth;r<=o/2?(0,s.setStyle)(f,"left",0):r>e.clientWidth-o/2?(0,s.setStyle)(f,"left",e.clientWidth-o+"px"):(0,s.setStyle)(f,"left",r-o/2+"px")}(i):function(i){const{width:r,time:a}=n(t,i);f.innerHTML=a;const o=f.clientWidth;r<=o/2?(0,s.setStyle)(f,"left",0):r>e.clientWidth-o/2?(0,s.setStyle)(f,"left",e.clientWidth-o+"px"):(0,s.setStyle)(f,"left",r-o/2+"px")}(i)})),o(e,"mouseleave",(()=>{(0,s.setStyle)(f,"display","none")})),o(e,"mousedown",(()=>{l=!0})),o(document,"mousemove",(e=>{if(l){const{second:i,percentage:r}=n(t,e);E("played",r),t.seek=i}})),o(document,"mouseup",(()=>{l&&(l=!1)})))}}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ikc2j:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){return t=>({...e,style:{cursor:"auto",marginLeft:"10px"},mounted:e=>{function i(){const i=`${(0,r.secondToTime)(t.currentTime)} / ${(0,r.secondToTime)(t.duration)}`;i!==e.innerText&&(e.innerText=i)}i();const s=["video:loadedmetadata","video:timeupdate","video:progress"];for(let r=0;r<s.length;r++)t.on(s[r],i)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],b8NFx:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){return t=>({...e,mounted:e=>{const{proxy:i,icons:s,i18n:n}=t;let a=!1;const o=t.constructor.VOLUME_PANEL_WIDTH,l=t.constructor.VOLUME_HANDLE_WIDTH,d=(0,r.append)(e,s.volume),c=(0,r.append)(e,s.volumeClose),h=(0,r.append)(e,'<div class="art-volume-panel"></div>'),u=(0,r.append)(h,'<div class="art-volume-slider-handle"></div>');function f(e){const{left:t}=h.getBoundingClientRect();return(0,r.clamp)(e.pageX-t-l/2,0,o-l/2)/(o-l)}function p(e=.7){if(t.muted||0===e)(0,r.setStyle)(d,"display","none"),(0,r.setStyle)(c,"display","flex"),(0,r.setStyle)(u,"left","0");else{const t=(o-l)*e;(0,r.setStyle)(d,"display","flex"),(0,r.setStyle)(c,"display","none"),(0,r.setStyle)(u,"left",`${t}px`)}}(0,r.tooltip)(d,n.get("Mute")),(0,r.setStyle)(c,"display","none"),r.isMobile&&(0,r.setStyle)(h,"display","none"),p(t.volume),t.on("video:volumechange",(()=>{p(t.volume)})),i(d,"click",(()=>{t.muted=!0})),i(c,"click",(()=>{t.muted=!1})),i(h,"click",(e=>{t.muted=!1,t.volume=f(e)})),i(u,"mousedown",(()=>{a=!0})),i(e,"mousemove",(e=>{a&&(t.muted=!1,t.volume=f(e))})),i(document,"mouseup",(()=>{a&&(a=!1)}))}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"03o9l":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){return t=>({...e,tooltip:t.i18n.get("Show Setting"),mounted:e=>{const{proxy:i,icons:s,i18n:n}=t;(0,r.append)(e,s.setting),i(e,"click",(()=>{t.setting.toggle=!0,t.setting.updateStyle()})),t.on("setting",(t=>{(0,r.tooltip)(e,n.get(t?"Hide Setting":"Show Setting"))}))}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eCVx2:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils"),s=e("./progress");i.default=function(e){return t=>({...e,mounted:e=>{const{option:i,template:{$progress:n,$video:a},events:{proxy:o,loadImg:l}}=t;let d=null,c=!1,h=!1;o(n,"mousemove",(async o=>{if(!c){c=!0;const e=await l(i.thumbnails.url);d=e,h=!0}h&&((0,r.setStyle)(e,"display","block"),function(o){const{width:l}=(0,s.getPosFromEvent)(t,o),{url:c,number:h,column:u,width:f,height:p}=i.thumbnails,m=f||d.naturalWidth/u,g=p||m/(a.videoWidth/a.videoHeight),y=n.clientWidth/h,v=Math.floor(l/y),_=Math.ceil(v/u)-1,E=v%u||u-1;(0,r.setStyle)(e,"backgroundImage",`url(${c})`),(0,r.setStyle)(e,"height",`${g}px`),(0,r.setStyle)(e,"width",`${m}px`),(0,r.setStyle)(e,"backgroundPosition",`-${E*m}px -${_*g}px`),l<=m/2?(0,r.setStyle)(e,"left",0):l>n.clientWidth-m/2?(0,r.setStyle)(e,"left",n.clientWidth-m+"px"):(0,r.setStyle)(e,"left",l-m/2+"px")}(o))})),o(n,"mouseleave",(()=>{(0,r.setStyle)(e,"display","none")})),t.on("hover",(t=>{t||(0,r.setStyle)(e,"display","none")}))}})}},{"../utils":"71aH7","./progress":"bgoVP","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4KCF5":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){return t=>({...e,tooltip:t.i18n.get("Screenshot"),mounted:e=>{const{proxy:i,icons:s}=t;(0,r.append)(e,s.screenshot),i(e,"click",(()=>{t.screenshot()}))}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],efgTY:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i),i.default=function(e){return t=>{const i=t.option.quality,r=i.find((e=>e.default))||i[0];return{...e,style:{marginRight:"10px"},html:r?r.html:"",selector:i,onSelect(e){t.switchQuality(e.url,e.html)}}}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2hIff":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){return t=>({...e,mounted:e=>{const i=(0,r.append)(e,'<span class="art-loop-point"></span>'),s=(0,r.append)(e,'<span class="art-loop-point"></span>');t.on("loop",(n=>{n&&n.length?((0,r.setStyle)(e,"display","block"),(0,r.setStyle)(i,"left",`calc(${n[0]/t.duration*100}% - ${i.clientWidth}px)`),(0,r.setStyle)(s,"left",n[1]/t.duration*100+"%")):(0,r.setStyle)(e,"display","none")}))}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4IS2d":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){return t=>({...e,tooltip:t.i18n.get("AirPlay"),mounted:e=>{const{proxy:i,icons:s}=t;(0,r.append)(e,s.airplay),i(e,"click",(()=>t.airplay()))}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2KYsr":[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i);var s=e("../utils"),n=e("../utils/component"),a=r.interopDefault(n),o=e("./playbackRate"),l=r.interopDefault(o),d=e("./aspectRatio"),c=r.interopDefault(d),h=e("./flip"),u=r.interopDefault(h),f=e("./info"),p=r.interopDefault(f),m=e("./version"),g=r.interopDefault(m),y=e("./close"),v=r.interopDefault(y);class _ extends a.default{constructor(e){super(e),this.name="contextmenu",this.$parent=e.template.$contextmenu,s.isMobile||this.init()}init(){const{option:e,proxy:t,template:{$player:i,$contextmenu:r}}=this.art;e.playbackRate&&this.add((0,l.default)({name:"playbackRate",index:10})),e.aspectRatio&&this.add((0,c.default)({name:"aspectRatio",index:20})),e.flip&&this.add((0,u.default)({name:"flip",index:30})),this.add((0,p.default)({name:"info",index:40})),this.add((0,g.default)({name:"version",index:50})),this.add((0,v.default)({name:"close",index:60}));for(let s=0;s<e.contextmenu.length;s++)this.add(e.contextmenu[s]);t(i,"contextmenu",(e=>{if(e.preventDefault(),!this.art.constructor.CONTEXTMENU)return;this.show=!0;const t=e.clientX,n=e.clientY,{height:a,width:o,left:l,top:d}=i.getBoundingClientRect(),{height:c,width:h}=r.getBoundingClientRect();let u=t-l,f=n-d;t+h>l+o&&(u=o-h),n+c>d+a&&(f=a-c),(0,s.setStyles)(r,{top:`${f}px`,left:`${u}px`})})),t(i,"click",(e=>{(0,s.includeFromEvent)(e,r)||(this.show=!1)})),this.art.on("blur",(()=>{this.show=!1}))}}i.default=_},{"../utils":"71aH7","../utils/component":"18nVI","./playbackRate":"69eLi","./aspectRatio":"lUefg","./flip":"kysiM","./info":"gqIgJ","./version":"kRU7C","./close":"jQ8Pm","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"69eLi":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){return t=>{const{i18n:i,constructor:{PLAYBACK_RATE:s}}=t;return{...e,html:`${i.get("Play Speed")}:\n                ${s.map((e=>`<span data-value="${e}">${1===e?i.get("Normal"):e}</span>`)).join("")}\n            `,click:(e,i)=>{const{value:r}=i.target.dataset;r&&(t.playbackRate=Number(r),e.show=!1)},mounted:e=>{const i=(0,r.query)('[data-value="1"]',e);i&&(0,r.inverseClass)(i,"art-current"),t.on("video:ratechange",(()=>{const i=(0,r.queryAll)("span",e).find((e=>Number(e.dataset.value)===t.playbackRate));i&&(0,r.inverseClass)(i,"art-current")}))}}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],lUefg:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){return t=>{const{i18n:i,constructor:{ASPECT_RATIO:s}}=t;return{...e,html:`${i.get("Aspect Ratio")}:\n                ${s.map((e=>`<span data-value="${e}">${"default"===e?i.get("Default"):e}</span>`)).join("")}\n            `,click:(e,i)=>{const{value:r}=i.target.dataset;r&&(t.aspectRatio=r,e.show=!1)},mounted:e=>{const i=(0,r.query)('[data-value="default"]',e);i&&(0,r.inverseClass)(i,"art-current"),t.on("aspectRatio",(t=>{const i=(0,r.queryAll)("span",e).find((e=>e.dataset.value===t));i&&(0,r.inverseClass)(i,"art-current")}))}}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kysiM:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){return t=>{const{i18n:i,constructor:{FLIP:s}}=t;return{...e,html:`${i.get("Video Flip")}:\n                ${s.map((e=>`<span data-value="${e}">${i.get((0,r.capitalize)(e))}</span>`)).join("")}\n            `,click:(e,i)=>{const{value:r}=i.target.dataset;r&&(t.flip=r.toLowerCase(),e.show=!1)},mounted:e=>{const i=(0,r.query)('[data-value="normal"]',e);i&&(0,r.inverseClass)(i,"art-current"),t.on("flip",(t=>{const i=(0,r.queryAll)("span",e).find((e=>e.dataset.value===t));i&&(0,r.inverseClass)(i,"art-current")}))}}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gqIgJ:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i),i.default=function(e){return t=>({...e,html:t.i18n.get("Video Info"),click:e=>{t.info.show=!0,e.show=!1}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kRU7C:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i),i.default=function(e){return{...e,html:'<a href="https://artplayer.org" target="_blank">ArtPlayer 4.6.2</a>'}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jQ8Pm:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i),i.default=function(e){return t=>({...e,html:t.i18n.get("Close"),click:e=>{e.show=!1}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"02ajl":[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i);var s=e("./utils"),n=e("./utils/component"),a=r.interopDefault(n);class o extends a.default{constructor(e){super(e),this.name="info",s.isMobile||this.init()}init(){const{proxy:e,constructor:t,template:{$infoPanel:i,$infoClose:r,$video:n}}=this.art;e(r,"click",(()=>{this.show=!1}));let a=null;const o=(0,s.queryAll)("[data-video]",i)||[];this.art.on("destroy",(()=>{clearTimeout(a)})),function e(){for(let t=0;t<o.length;t++){const e=o[t],i=n[e.dataset.video],r="number"==typeof i?i.toFixed(2):i;e.innerText!==r&&(e.innerText=r)}a=setTimeout(e,t.INFO_LOOP_TIME)}()}}i.default=o},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eSWto:[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i);var s=e("./utils"),n=e("./utils/component"),a=r.interopDefault(n),o=e("option-validator"),l=r.interopDefault(o),d=e("./scheme"),c=r.interopDefault(d);class h extends a.default{constructor(e){super(e),this.name="subtitle",this.eventDestroy=()=>null,this.init(e.option.subtitle);let t=!1;e.on("video:timeupdate",(()=>{if(!this.url)return;const e=this.art.template.$video.webkitDisplayingFullscreen;"boolean"==typeof e&&e!==t&&(t=e,this.createTrack(e?"subtitles":"metadata",this.url))}))}get url(){return this.art.template.$track.src}set url(e){this.switch(e)}get textTrack(){return this.art.template.$video.textTracks[0]}get activeCue(){return this.textTrack.activeCues[0]}style(e,t){const{$subtitle:i}=this.art.template;return"object"==typeof e?(0,s.setStyles)(i,e):(0,s.setStyle)(i,e,t)}update(){const{$subtitle:e}=this.art.template;e.innerHTML="",this.activeCue&&(this.art.option.subtitle.escape?e.innerHTML=this.activeCue.text.split(/\r?\n/).map((e=>`<p>${(0,s.escape)(e)}</p>`)).join(""):e.innerHTML=this.activeCue.text,this.art.emit("subtitleUpdate",this.activeCue.text))}async switch(e,t={}){const{i18n:i,notice:r,option:s}=this.art,n={...s.subtitle,...t,url:e},a=await this.init(n);return t.name&&(r.show=`${i.get("Switch Subtitle")}: ${t.name}`),a}createTrack(e,t){const{template:i,proxy:r}=this.art,{$video:n,$track:a}=i,o=(0,s.createElement)("track");o.default=!0,o.kind=e,o.src=t,o.track.mode="hidden",this.eventDestroy(),(0,s.remove)(a),(0,s.append)(n,o),i.$track=o,this.eventDestroy=r(this.textTrack,"cuechange",(()=>this.update()))}async init(e){const{notice:t,template:{$subtitle:i}}=this.art;if((0,l.default)(e,c.default.subtitle),e.url)return this.style(e.style),fetch(e.url).then((e=>e.arrayBuffer())).then((t=>{const i=new TextDecoder(e.encoding).decode(t);switch(this.art.emit("subtitleLoad",e.url),e.type||(0,s.getExt)(e.url)){case"srt":return(0,s.vttToBlob)((0,s.srtToVtt)(i));case"ass":return(0,s.vttToBlob)((0,s.assToVtt)(i));case"vtt":return(0,s.vttToBlob)(i);default:return e.url}})).then((e=>(i.innerHTML="",this.url===e||(URL.revokeObjectURL(this.url),this.createTrack("metadata",e),this.art.emit("subtitleSwitch",e)),e))).catch((e=>{throw t.show=e,e}))}}i.default=h},{"./utils":"71aH7","./utils/component":"18nVI","option-validator":"bAWi2","./scheme":"AKEiO","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jo4S1:[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i);var s=e("../utils/error"),n=e("./clickInit"),a=r.interopDefault(n),o=e("./hoverInit"),l=r.interopDefault(o),d=e("./mousemoveInit"),c=r.interopDefault(d),h=e("./resizeInit"),u=r.interopDefault(h),f=e("./gestureInit"),p=r.interopDefault(f),m=e("./viewInit"),g=r.interopDefault(m);i.default=class{constructor(e){this.destroyEvents=[],this.proxy=this.proxy.bind(this),this.hover=this.hover.bind(this),this.loadImg=this.loadImg.bind(this),e.whitelist.state&&((0,a.default)(e,this),(0,l.default)(e,this),(0,c.default)(e,this),(0,u.default)(e,this),(0,p.default)(e,this),(0,g.default)(e,this))}proxy(e,t,i,r={}){if(Array.isArray(t))return t.map((t=>this.proxy(e,t,i,r)));e.addEventListener(t,i,r);const s=()=>e.removeEventListener(t,i,r);return this.destroyEvents.push(s),s}hover(e,t,i){t&&this.proxy(e,"mouseenter",t),i&&this.proxy(e,"mouseleave",i)}loadImg(e){return new Promise(((t,i)=>{let r;if(e instanceof HTMLImageElement)r=e;else{if("string"!=typeof e)return i(new s.ArtPlayerError("Unable to get Image"));r=new Image,r.src=e}if(r.complete)return t(r);this.proxy(r,"load",(()=>t(r))),this.proxy(r,"error",(()=>i(new s.ArtPlayerError(`Failed to load Image: ${r.src}`))))}))}destroy(){for(let e=0;e<this.destroyEvents.length;e++)this.destroyEvents[e]()}}},{"../utils/error":"hwmZz","./clickInit":"6UrCm","./hoverInit":"4jWHi","./mousemoveInit":"bMF9b","./resizeInit":"eDXPO","./gestureInit":"95GtS","./viewInit":"InUBx","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6UrCm":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e,t){const{constructor:i,template:{$player:s,$video:n}}=e;t.proxy(document,["click","contextmenu"],(t=>{(0,r.includeFromEvent)(t,s)?(e.isInput="INPUT"===t.target.tagName,e.isFocus=!0,e.emit("focus")):(e.isInput=!1,e.isFocus=!1,e.emit("blur"))}));let a=0;t.proxy(n,"click",(()=>{const t=Date.now();t-a<=i.DB_CLICE_TIME?(e.emit("dblclick"),r.isMobile?e.isLock||e.toggle():e.fullscreen=!e.fullscreen):(e.emit("click"),r.isMobile||e.toggle()),a=t}))}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4jWHi":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e,t){const{$player:i}=e.template;t.hover(i,(t=>{(0,r.addClass)(i,"art-hover"),e.emit("hover",!0,t)}),(t=>{(0,r.removeClass)(i,"art-hover"),e.emit("hover",!1,t)}))}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],bMF9b:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i),i.default=function(e,t){const{$player:i}=e.template;t.proxy(i,"mousemove",(t=>{e.emit("mousemove",t)}))}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eDXPO:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e,t){const{option:i}=e,s=(0,r.throttle)((()=>{e.normalSize&&(e.autoSize=i.autoSize),e.aspectRatioReset=!0,e.notice.show="",e.emit("resize")}),e.constructor.RESIZE_TIME);t.proxy(window,["orientationchange","resize"],(()=>{s()})),screen&&screen.orientation&&screen.orientation.onchange&&t.proxy(screen.orientation,"change",(()=>{s()}))}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"95GtS":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils"),s=e("../control/progress");i.default=function(e,t){if(r.isMobile&&!e.option.isLive){const{$video:i,$progress:n}=e.template;let a=null,o=!1,l=0,d=0,c=0;const h=t=>{if(1===t.touches.length&&!e.isLock){a===n&&(0,s.setCurrentTime)(e,t),o=!0;const{clientX:i,clientY:r}=t.touches[0];l=i,d=r,c=e.currentTime}},u=t=>{if(1===t.touches.length&&o&&e.duration){const{clientX:s,clientY:n}=t.touches[0],o=(0,r.clamp)((s-l)/e.width,-1,1),h=(0,r.clamp)((n-d)/e.height,-1,1),u=e.isRotate?h:o,f=a===i?e.constructor.TOUCH_MOVE_RATIO:1,p=(0,r.clamp)(c+e.duration*u*f,0,e.duration);e.seek=p,e.emit("setBar","played",(0,r.clamp)(p/e.duration,0,1)),e.notice.show=`${(0,r.secondToTime)(p)} / ${(0,r.secondToTime)(e.duration)}`}},f=()=>{o&&(l=0,d=0,c=0,o=!1,a=null)};t.proxy(n,"touchstart",(e=>{a=n,h(e)})),t.proxy(i,"touchstart",(e=>{a=i,h(e)})),t.proxy(i,"touchmove",u),t.proxy(n,"touchmove",u),t.proxy(document,"touchend",f)}}},{"../utils":"71aH7","../control/progress":"bgoVP","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],InUBx:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e,t){const{option:i,constructor:s,template:{$container:n}}=e,a=(0,r.throttle)((()=>{e.emit("view",(0,r.isInViewport)(n,s.SCROLL_GAP))}),s.SCROLL_TIME);t.proxy(window,"scroll",(()=>{a()})),e.on("view",(t=>{i.autoMini&&(e.mini=!t)}))}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6NoFy":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("./utils");i.default=class{constructor(e){this.art=e,this.keys={},e.option.hotkey&&!r.isMobile&&this.init()}init(){const{proxy:e,constructor:t}=this.art;this.add(27,(()=>{this.art.fullscreenWeb&&(this.art.fullscreenWeb=!1)})),this.add(32,(()=>{this.art.toggle()})),this.add(37,(()=>{this.art.backward=t.SEEK_STEP})),this.add(38,(()=>{this.art.volume+=t.VOLUME_STEP})),this.add(39,(()=>{this.art.forward=t.SEEK_STEP})),this.add(40,(()=>{this.art.volume-=t.VOLUME_STEP})),e(window,"keydown",(e=>{if(this.art.isFocus){const t=document.activeElement.tagName.toUpperCase(),i=document.activeElement.getAttribute("contenteditable");if("INPUT"!==t&&"TEXTAREA"!==t&&""!==i&&"true"!==i){const t=this.keys[e.keyCode];if(t){e.preventDefault();for(let i=0;i<t.length;i++)t[i].call(this.art,e);this.art.emit("hotkey",e)}}}}))}add(e,t){return this.keys[e]?this.keys[e].push(t):this.keys[e]=[t],this}remove(e,t){if(this.keys[e]){const i=this.keys[e].indexOf(t);-1!==i&&this.keys[e].splice(i,1)}return this}}},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6G6hZ":[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i);var s=e("./utils/component"),n=r.interopDefault(s);class a extends n.default{constructor(e){super(e);const{option:t,template:{$layer:i}}=e;this.name="layer",this.$parent=i;for(let r=0;r<t.layers.length;r++)this.add(t.layers[r])}}i.default=a},{"./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3dsEe":[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i);var s=e("./utils"),n=e("./utils/component"),a=r.interopDefault(n);class o extends a.default{constructor(e){super(e),this.name="loading",(0,s.append)(e.template.$loading,e.icons.loading)}}i.default=o},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],dWGTw:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("./utils");i.default=class{constructor(e){this.art=e,this.timer=null}set show(e){const{constructor:t,template:{$player:i,$noticeInner:s}}=this.art;e?(s.innerText=e instanceof Error?e.message.trim():e,(0,r.addClass)(i,"art-notice-show"),clearTimeout(this.timer),this.timer=setTimeout((()=>{s.innerText="",(0,r.removeClass)(i,"art-notice-show")}),t.NOTICE_TIME)):(0,r.removeClass)(i,"art-notice-show")}}},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5POkG":[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i);var s=e("./utils"),n=e("./utils/component"),a=r.interopDefault(n);class o extends a.default{constructor(e){super(e),this.name="mask";const{template:t,icons:i,events:r}=e,n=(0,s.append)(t.$state,i.state),a=(0,s.append)(t.$state,i.error);(0,s.setStyle)(a,"display","none"),e.on("destroy",(()=>{(0,s.setStyle)(n,"display","none"),(0,s.setStyle)(a,"display",null)})),r.proxy(t.$state,"click",(()=>e.play()))}}i.default=o},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6OeNg":[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i);var s=e("../utils"),n=e("bundle-text:./loading.svg"),a=r.interopDefault(n),o=e("bundle-text:./state.svg"),l=r.interopDefault(o),d=e("bundle-text:./check.svg"),c=r.interopDefault(d),h=e("bundle-text:./play.svg"),u=r.interopDefault(h),f=e("bundle-text:./pause.svg"),p=r.interopDefault(f),m=e("bundle-text:./volume.svg"),g=r.interopDefault(m),y=e("bundle-text:./volume-close.svg"),v=r.interopDefault(y),_=e("bundle-text:./screenshot.svg"),E=r.interopDefault(_),b=e("bundle-text:./setting.svg"),S=r.interopDefault(b),T=e("bundle-text:./arrow-left.svg"),A=r.interopDefault(T),w=e("bundle-text:./arrow-right.svg"),L=r.interopDefault(w),I=e("bundle-text:./playback-rate.svg"),R=r.interopDefault(I),D=e("bundle-text:./aspect-ratio.svg"),k=r.interopDefault(D),x=e("bundle-text:./config.svg"),C=r.interopDefault(x),M=e("bundle-text:./pip.svg"),P=r.interopDefault(M),O=e("bundle-text:./lock.svg"),N=r.interopDefault(O),F=e("bundle-text:./unlock.svg"),B=r.interopDefault(F),U=e("bundle-text:./fullscreen-off.svg"),j=r.interopDefault(U),G=e("bundle-text:./fullscreen-on.svg"),z=r.interopDefault(G),V=e("bundle-text:./fullscreen-web-off.svg"),$=r.interopDefault(V),H=e("bundle-text:./fullscreen-web-on.svg"),Y=r.interopDefault(H),K=e("bundle-text:./switch-on.svg"),W=r.interopDefault(K),q=e("bundle-text:./switch-off.svg"),Q=r.interopDefault(q),Z=e("bundle-text:./flip.svg"),X=r.interopDefault(Z),J=e("bundle-text:./error.svg"),ee=r.interopDefault(J),te=e("bundle-text:./close.svg"),ie=r.interopDefault(te),re=e("bundle-text:./airplay.svg"),se=r.interopDefault(re);i.default=class{constructor(e){const t={loading:a.default,state:l.default,play:u.default,pause:p.default,check:c.default,volume:g.default,volumeClose:v.default,screenshot:E.default,setting:S.default,pip:P.default,arrowLeft:A.default,arrowRight:L.default,playbackRate:R.default,aspectRatio:k.default,config:C.default,lock:N.default,flip:X.default,unlock:B.default,fullscreenOff:j.default,fullscreenOn:z.default,fullscreenWebOff:$.default,fullscreenWebOn:Y.default,switchOn:W.default,switchOff:Q.default,error:ee.default,close:ie.default,airplay:se.default,...e.option.icons};Object.keys(t).forEach((e=>{(0,s.def)(this,e,{get:()=>{const i=(0,s.createElement)("i");return(0,s.addClass)(i,"art-icon"),(0,s.addClass)(i,`art-icon-${e}`),(0,s.append)(i,t[e]),i}})}))}}},{"../utils":"71aH7","bundle-text:./loading.svg":"7tDub","bundle-text:./state.svg":"1ElZc","bundle-text:./check.svg":"lmgoP","bundle-text:./play.svg":"lVWoQ","bundle-text:./pause.svg":"5Mnax","bundle-text:./volume.svg":"w3eIa","bundle-text:./volume-close.svg":"rHjo1","bundle-text:./screenshot.svg":"2KcqM","bundle-text:./setting.svg":"8rQMV","bundle-text:./arrow-left.svg":"kqGBE","bundle-text:./arrow-right.svg":"aFjpC","bundle-text:./playback-rate.svg":"lx7ZM","bundle-text:./aspect-ratio.svg":"2sEjf","bundle-text:./config.svg":"fQTgE","bundle-text:./pip.svg":"2CaxO","bundle-text:./lock.svg":"aCGnW","bundle-text:./unlock.svg":"bTrAV","bundle-text:./fullscreen-off.svg":"bA3p0","bundle-text:./fullscreen-on.svg":"fTuY8","bundle-text:./fullscreen-web-off.svg":"tvKf4","bundle-text:./fullscreen-web-on.svg":"1F1oB","bundle-text:./switch-on.svg":"7qNHs","bundle-text:./switch-off.svg":"28aV8","bundle-text:./flip.svg":"1uXI6","bundle-text:./error.svg":"9f4dh","bundle-text:./close.svg":"4nTtS","bundle-text:./airplay.svg":"cDPXC","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7tDub":[function(e,t,i){t.exports='<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-default"><path fill="none" class="bk" d="M0 0h100v100H0z"/><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-1s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(30 105.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.9166666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(60 75.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.8333333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(90 65 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.75s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(120 58.66 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.6666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(150 54.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5833333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(180 50 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-150 45.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.4166666666666667s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-120 41.34 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.3333333333333333s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-90 35 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.25s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-60 24.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.16666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-30 -5.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.08333333333333333s" repeatCount="indefinite"/></rect></svg>'},{}],"1ElZc":[function(e,t,i){t.exports='<svg xmlns="http://www.w3.org/2000/svg" height="60" width="60" style="filter:drop-shadow(0 1px 1px #000)" viewBox="0 0 24 24"><path d="M20 2H4C1.8 2 0 3.8 0 6v12c0 2.2 1.8 4 4 4h16c2.2 0 4-1.8 4-4V6c0-2.2-1.8-4-4-4zm-4.4 10.8L10.5 16c-.6.5-1.5 0-1.5-.8V8.8c0-.8.9-1.3 1.5-.8l5.1 3.2c.7.3.7 1.3 0 1.6z"/></svg>'},{}],lmgoP:[function(e,t,i){t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:100%;height:100%"><path d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z" fill="#fff"/></svg>'},{}],lVWoQ:[function(e,t,i){t.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M17.982 9.275 8.06 3.27A2.013 2.013 0 0 0 5 4.994v12.011a2.017 2.017 0 0 0 3.06 1.725l9.922-6.005a2.017 2.017 0 0 0 0-3.45z"/></svg>'},{}],"5Mnax":[function(e,t,i){t.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M7 3a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2zm8 0a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2z"/></svg>'},{}],w3eIa:[function(e,t,i){t.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M10.188 4.65 6 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39V5.04a.498.498 0 0 0-.812-.39zm4.258-.872a1 1 0 0 0-.862 1.804 6.002 6.002 0 0 1-.007 10.838 1 1 0 0 0 .86 1.806A8.001 8.001 0 0 0 19 11a8.001 8.001 0 0 0-4.554-7.222z"/><path d="M15 11a3.998 3.998 0 0 0-2-3.465v6.93A3.998 3.998 0 0 0 15 11z"/></svg>'},{}],rHjo1:[function(e,t,i){t.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M15 11a3.998 3.998 0 0 0-2-3.465v2.636l1.865 1.865A4.02 4.02 0 0 0 15 11z"/><path d="M13.583 5.583A5.998 5.998 0 0 1 17 11a6 6 0 0 1-.585 2.587l1.477 1.477a8.001 8.001 0 0 0-3.446-11.286 1 1 0 0 0-.863 1.805zm5.195 13.195-2.121-2.121-1.414-1.414-1.415-1.415L13 13l-2-2-3.889-3.889-3.889-3.889a.999.999 0 1 0-1.414 1.414L5.172 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39v-3.131l2.587 2.587-.01.005a1 1 0 0 0 .86 1.806c.215-.102.424-.214.627-.333l2.3 2.3a1.001 1.001 0 0 0 1.414-1.416zM11 5.04a.5.5 0 0 0-.813-.39L8.682 5.854 11 8.172V5.04z"/></svg>'},{}],"2KcqM":[function(e,t,i){t.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 50 50"><path d="M19.402 6a5 5 0 0 0-4.902 4.012L14.098 12H9a5 5 0 0 0-5 5v21a5 5 0 0 0 5 5h32a5 5 0 0 0 5-5V17a5 5 0 0 0-5-5h-5.098l-.402-1.988A5 5 0 0 0 30.598 6ZM25 17c5.52 0 10 4.48 10 10s-4.48 10-10 10-10-4.48-10-10 4.48-10 10-10Zm0 2c-4.41 0-8 3.59-8 8s3.59 8 8 8 8-3.59 8-8-3.59-8-8-8Z"/></svg>'},{}],"8rQMV":[function(e,t,i){t.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><circle cx="11" cy="11" r="2"/><path d="M19.164 8.861 17.6 8.6a6.978 6.978 0 0 0-1.186-2.099l.574-1.533a1 1 0 0 0-.436-1.217l-1.997-1.153a1.001 1.001 0 0 0-1.272.23l-1.008 1.225a7.04 7.04 0 0 0-2.55.001L8.716 2.829a1 1 0 0 0-1.272-.23L5.447 3.751a1 1 0 0 0-.436 1.217l.574 1.533A6.997 6.997 0 0 0 4.4 8.6l-1.564.261A.999.999 0 0 0 2 9.847v2.306c0 .489.353.906.836.986l1.613.269a7 7 0 0 0 1.228 2.075l-.558 1.487a1 1 0 0 0 .436 1.217l1.997 1.153c.423.244.961.147 1.272-.23l1.04-1.263a7.089 7.089 0 0 0 2.272 0l1.04 1.263a1 1 0 0 0 1.272.23l1.997-1.153a1 1 0 0 0 .436-1.217l-.557-1.487c.521-.61.94-1.31 1.228-2.075l1.613-.269a.999.999 0 0 0 .835-.986V9.847a.999.999 0 0 0-.836-.986zM11 15a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/></svg>'},{}],kqGBE:[function(e,t,i){t.exports='<svg xmlns="http://www.w3.org/2000/svg" height="32" width="32"><path d="m19.41 20.09-4.58-4.59 4.58-4.59L18 9.5l-6 6 6 6z" fill="#fff"/></svg>'},{}],aFjpC:[function(e,t,i){t.exports='<svg xmlns="http://www.w3.org/2000/svg" height="32" width="32"><path d="m12.59 20.34 4.58-4.59-4.58-4.59L14 9.75l6 6-6 6z" fill="#fff"/></svg>'},{}],lx7ZM:[function(e,t,i){t.exports='<svg height="24" width="24"><path d="M10 8v8l6-4-6-4zM6.3 5l-.6-.8C7.2 3 9 2.2 11 2l.1 1c-1.8.2-3.4.9-4.8 2zM5 6.3l-.8-.6C3 7.2 2.2 9 2 11l1 .1c.2-1.8.9-3.4 2-4.8zm0 11.4c-1.1-1.4-1.8-3.1-2-4.8L2 13c.2 2 1 3.8 2.2 5.4l.8-.7zm6.1 3.3c-1.8-.2-3.4-.9-4.8-2l-.6.8C7.2 21 9 21.8 11 22l.1-1zM22 12c0-5.2-3.9-9.4-9-10l-.1 1c4.6.5 8.1 4.3 8.1 9s-3.5 8.5-8.1 9l.1 1c5.2-.5 9-4.8 9-10z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],"2sEjf":[function(e,t,i){t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 88 88" style="width:100%;height:100%;transform:translate(0,0)"><defs><clipPath id="__lottie_element_216"><path d="M0 0h88v88H0z"/></clipPath></defs><g style="display:block" clip-path="url(\'#__lottie_element_216\')"><path fill="#FFF" d="m12.438-12.702-2.82 2.82c-.79.79-.79 2.05 0 2.83l7.07 7.07-7.07 7.07c-.79.79-.79 2.05 0 2.83l2.82 2.83c.79.78 2.05.78 2.83 0l11.32-11.31c.78-.78.78-2.05 0-2.83l-11.32-11.31c-.78-.79-2.04-.79-2.83 0zm-24.88 0c-.74-.74-1.92-.78-2.7-.12l-.13.12-11.31 11.31a2 2 0 0 0-.12 2.7l.12.13 11.31 11.31a2 2 0 0 0 2.7.12l.13-.12 2.83-2.83c.74-.74.78-1.91.11-2.7l-.11-.13-7.07-7.07 7.07-7.07c.74-.74.78-1.91.11-2.7l-.11-.13-2.83-2.82zM28-28c4.42 0 8 3.58 8 8v40c0 4.42-3.58 8-8 8h-56c-4.42 0-8-3.58-8-8v-40c0-4.42 3.58-8 8-8h56z" style="--darkreader-inline-fill:#a8a6a4" transform="translate(44 44)"/></g></svg>'},{}],fQTgE:[function(e,t,i){t.exports='<svg height="24" width="24"><path d="M15 17h6v1h-6v-1zm-4 0H3v1h8v2h1v-5h-1v2zm3-9h1V3h-1v2H3v1h11v2zm4-3v1h3V5h-3zM6 14h1V9H6v2H3v1h3v2zm4-2h11v-1H10v1z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],"2CaxO":[function(e,t,i){t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" height="32" width="32"><path d="M25 17h-8v6h8v-6Zm4 8V10.98C29 9.88 28.1 9 27 9H9c-1.1 0-2 .88-2 1.98V25c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2Zm-2 .02H9V10.97h18v14.05Z"/></svg>'},{}],aCGnW:[function(e,t,i){t.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="M298.667 426.667v-85.334a213.333 213.333 0 1 1 426.666 0v85.334H768A85.333 85.333 0 0 1 853.333 512v256A85.333 85.333 0 0 1 768 853.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667zM512 213.333a128 128 0 0 0-128 128v85.334h256v-85.334a128 128 0 0 0-128-128z" fill="#fff"/></svg>'},{}],bTrAV:[function(e,t,i){t.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="m666.752 194.517-49.365 74.112A128 128 0 0 0 384 341.333l.043 85.334h384A85.333 85.333 0 0 1 853.376 512v256a85.333 85.333 0 0 1-85.333 85.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667v-85.334a213.333 213.333 0 0 1 368.085-146.816z" fill="#fff"/></svg>'},{}],bA3p0:[function(e,t,i){t.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M768 298.667h170.667V384h-256V128H768v170.667zM341.333 384h-256v-85.333H256V128h85.333v256zM768 725.333V896h-85.333V640h256v85.333H768zM341.333 640v256H256V725.333H85.333V640h256z"/></svg>'},{}],fTuY8:[function(e,t,i){t.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M625.778 256H768v142.222h113.778v-256h-256V256zM256 398.222V256h142.222V142.222h-256v256H256zm512 227.556V768H625.778v113.778h256v-256H768zM398.222 768H256V625.778H142.222v256h256V768z"/></svg>'},{}],tvKf4:[function(e,t,i){t.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zM896 512a64 64 0 0 1 7.488 127.552L896 640H768v128a64 64 0 0 1-56.512 63.552L704 832a64 64 0 0 1-63.552-56.512L640 768V582.592c0-34.496 25.024-66.112 61.632-70.208l8-.384H896zm-640 0a64 64 0 0 1-7.488-127.552L256 384h128V256a64 64 0 0 1 56.512-63.552L448 192a64 64 0 0 1 63.552 56.512L512 256v185.408c0 34.432-25.024 66.112-61.632 70.144l-8 .448H256z"/></svg>'},{}],"1F1oB":[function(e,t,i){t.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zm-576 64a64 64 0 0 1 7.488 127.552L448 320H320v128a64 64 0 0 1-56.512 63.552L256 512a64 64 0 0 1-63.552-56.512L192 448V262.592c0-34.432 25.024-66.112 61.632-70.144l8-.448H448zm256 640a64 64 0 0 1-7.488-127.552L704 704h128V576a64 64 0 0 1 56.512-63.552L896 512a64 64 0 0 1 63.552 56.512L960 576v185.408c0 34.496-25.024 66.112-61.632 70.208l-8 .384H704z"/></svg>'},{}],"7qNHs":[function(e,t,i){t.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1664 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#648FFC" d="M1152 0H512a512 512 0 0 0 0 1024h640a512 512 0 0 0 0-1024zm0 960a448 448 0 1 1 448-448 448 448 0 0 1-448 448z"/></svg>'},{}],"28aV8":[function(e,t,i){t.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1740 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M511.898 1024h670.515c282.419-.41 511.18-229.478 511.18-511.898 0-282.419-228.761-511.488-511.18-511.897H511.898C229.478.615.717 229.683.717 512.102c0 282.42 228.761 511.488 511.18 511.898zm-.564-975.36A464.589 464.589 0 1 1 48.026 513.024 463.872 463.872 0 0 1 511.334 48.435v.205z"/></svg>'},{}],"1uXI6":[function(e,t,i){t.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M554.667 810.667V896h-85.334v-85.333h85.334zm-384-632.662a42.667 42.667 0 0 1 34.986 18.219l203.904 291.328a42.667 42.667 0 0 1 0 48.896L205.611 827.776A42.667 42.667 0 0 1 128 803.328V220.672a42.667 42.667 0 0 1 42.667-42.667zm682.666 0a42.667 42.667 0 0 1 42.368 37.718l.299 4.949v582.656a42.667 42.667 0 0 1-74.24 28.63l-3.413-4.182-203.904-291.328a42.667 42.667 0 0 1-3.03-43.861l3.03-5.035 203.946-291.328a42.667 42.667 0 0 1 34.944-18.219zM554.667 640v85.333h-85.334V640h85.334zm-358.4-320.896V716.8L335.957 512 196.31 319.104zm358.4 150.23v85.333h-85.334v-85.334h85.334zm0-170.667V384h-85.334v-85.333h85.334zm0-170.667v85.333h-85.334V128h85.334z" fill="#fff"/></svg>'},{}],"9f4dh":[function(e,t,i){t.exports='<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="50" height="50"><path d="M593.818 168.55 949.82 763.76c26.153 43.746 10.732 99.738-34.447 125.052-14.397 8.069-30.72 12.308-47.37 12.308H155.976c-52.224 0-94.536-40.96-94.536-91.505 0-16.097 4.383-31.928 12.718-45.875l356.004-595.19c26.173-43.724 84.009-58.654 129.208-33.341a93.082 93.082 0 0 1 34.448 33.341zM512 819.2a61.44 61.44 0 1 0 0-122.88 61.44 61.44 0 0 0 0 122.88zm0-512a72.315 72.315 0 0 0-71.762 81.306l25.723 205.721a46.408 46.408 0 0 0 92.078 0l25.723-205.742A72.315 72.315 0 0 0 512 307.2z"/></svg>'},{}],"4nTtS":[function(e,t,i){t.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="22" height="22"><path d="m571.733 512 268.8-268.8c17.067-17.067 17.067-42.667 0-59.733-17.066-17.067-42.666-17.067-59.733 0L512 452.267l-268.8-268.8c-17.067-17.067-42.667-17.067-59.733 0-17.067 17.066-17.067 42.666 0 59.733l268.8 268.8-268.8 268.8c-17.067 17.067-17.067 42.667 0 59.733 8.533 8.534 19.2 12.8 29.866 12.8s21.334-4.266 29.867-12.8l268.8-268.8 268.8 268.8c8.533 8.534 19.2 12.8 29.867 12.8s21.333-4.266 29.866-12.8c17.067-17.066 17.067-42.666 0-59.733L571.733 512z"/></svg>'},{}],cDPXC:[function(e,t,i){t.exports='<svg width="18" height="18" xmlns="http://www.w3.org/2000/svg"><g fill="#fff"><path d="M16 1H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h3v-2H3V3h12v8h-2v2h3a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1Z"/><path d="M4 17h10l-5-6z"/></g></svg>'},{}],"3eYNH":[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i);var s=e("./flip"),n=r.interopDefault(s),a=e("./aspectRatio"),o=r.interopDefault(a),l=e("./playbackRate"),d=r.interopDefault(l),c=e("./subtitleOffset"),h=r.interopDefault(c),u=e("../utils/component"),f=r.interopDefault(u),p=e("../utils");class m extends f.default{constructor(e){super(e);const{option:t,proxy:i,template:{$setting:r,$player:s}}=e;if(this.name="setting",this.$parent=r,this.option=[],this.events=[],this.cache=new Map,t.setting){t.playbackRate&&this.option.push((0,d.default)(e)),t.aspectRatio&&this.option.push((0,o.default)(e)),t.flip&&this.option.push((0,n.default)(e)),t.subtitleOffset&&this.option.push((0,h.default)(e));for(let e=0;e<t.settings.length;e++)this.option.push(t.settings[e]);this.update(),e.on("blur",(()=>{this.show&&(this.show=!1,this.init(this.option))})),i(s,"click",(t=>{!this.show||(0,p.includeFromEvent)(t,e.controls.setting)||(0,p.includeFromEvent)(t,this.$parent)||(this.show=!1,this.init(this.option))}))}}static makeRecursion(e,t,i){for(let r=0;r<e.length;r++){const s=e[r];s.$parentItem=t,s.$parentList=i,s.selector&&m.makeRecursion(s.selector,s,e)}return e}update(){return this.cache=new Map,this.events.forEach((e=>e())),this.events=[],this.$parent.innerHTML="",this.option=m.makeRecursion(this.option),this.init(this.option),this.option}add(e){return this.option.push(e),this.update(),e}creatHeader(e){const{icons:t,proxy:i}=this.art,r=(0,p.createElement)("div");(0,p.addClass)(r,"art-setting-item"),(0,p.addClass)(r,"art-setting-item-back");const s=(0,p.append)(r,'<div class="art-setting-item-left"></div>'),n=(0,p.createElement)("div");(0,p.addClass)(n,"art-setting-item-left-icon"),(0,p.append)(n,t.arrowLeft),(0,p.append)(s,n),(0,p.append)(s,e.$parentItem.html);const a=i(r,"click",(()=>this.init(e.$parentList)));return this.events.push(a),r}creatItem(e,t){const{icons:i,proxy:r}=this.art,s=(0,p.createElement)("div");(0,p.addClass)(s,"art-setting-item"),(0,p.isStringOrNumber)(t.name)&&(s.dataset.name=t.name),(0,p.isStringOrNumber)(t.value)&&(s.dataset.value=t.value);const n=(0,p.append)(s,'<div class="art-setting-item-left"></div>'),a=(0,p.append)(s,'<div class="art-setting-item-right"></div>'),o=(0,p.createElement)("div");switch((0,p.addClass)(o,"art-setting-item-left-icon"),e){case"switch":case"range":(0,p.append)(o,(0,p.isStringOrNumber)(t.icon)||t.icon instanceof Element?t.icon:i.config);break;case"selector":t.selector&&t.selector.length?(0,p.append)(o,(0,p.isStringOrNumber)(t.icon)||t.icon instanceof Element?t.icon:i.config):(0,p.append)(o,i.check)}(0,p.append)(n,o),t.$icon=o,(0,p.def)(t,"icon",{configurable:!0,get:()=>o.innerHTML,set(e){(0,p.isStringOrNumber)(e)&&(o.innerHTML=e)}});const l=(0,p.createElement)("div");(0,p.addClass)(l,"art-setting-item-left-text"),(0,p.append)(l,t.html||""),(0,p.append)(n,l),t.$html=l,(0,p.def)(t,"html",{configurable:!0,get:()=>l.innerHTML,set(e){(0,p.isStringOrNumber)(e)&&(l.innerHTML=e)}});const d=(0,p.createElement)("div");switch((0,p.addClass)(d,"art-setting-item-right-tooltip"),(0,p.append)(d,t.tooltip||""),(0,p.append)(a,d),t.$tooltip=d,(0,p.def)(t,"tooltip",{configurable:!0,get:()=>d.innerHTML,set(e){(0,p.isStringOrNumber)(e)&&(d.innerHTML=e)}}),e){case"switch":{const e=(0,p.createElement)("div");(0,p.addClass)(e,"art-setting-item-right-icon");const r=(0,p.append)(e,i.switchOn),s=(0,p.append)(e,i.switchOff);(0,p.setStyle)(t.switch?s:r,"display","none"),(0,p.append)(a,e),t.$switch=t.switch,(0,p.def)(t,"switch",{configurable:!0,get:()=>t.$switch,set(e){t.$switch=e,e?((0,p.setStyle)(s,"display","none"),(0,p.setStyle)(r,"display",null)):((0,p.setStyle)(s,"display",null),(0,p.setStyle)(r,"display","none"))}});break}case"range":{const e=(0,p.createElement)("div");(0,p.addClass)(e,"art-setting-item-right-icon");const i=(0,p.append)(e,'<input type="range">');i.value=t.range[0]||0,i.min=t.range[1]||0,i.max=t.range[2]||10,i.step=t.range[3]||1,(0,p.addClass)(i,"art-setting-range"),(0,p.append)(a,e),t.$range=i,(0,p.def)(t,"range",{configurable:!0,get:()=>i.valueAsNumber,set(e){i.value=Number(e)}})}break;case"selector":if(t.selector&&t.selector.length){const e=(0,p.createElement)("div");(0,p.addClass)(e,"art-setting-item-right-icon"),(0,p.append)(e,i.arrowRight),(0,p.append)(a,e)}}switch(e){case"switch":if(t.onSwitch){const e=r(s,"click",(async e=>{t.switch=await t.onSwitch.call(this.art,t,s,e)}));this.events.push(e)}break;case"range":if(t.$range){if(t.onRange){const e=r(t.$range,"change",(async e=>{t.tooltip=await t.onRange.call(this.art,t,s,e)}));this.events.push(e)}if(t.onChange){const e=r(t.$range,"input",(async e=>{t.tooltip=await t.onChange.call(this.art,t,s,e)}));this.events.push(e)}}break;case"selector":{const e=r(s,"click",(async e=>{if(t.selector&&t.selector.length)this.init(t.selector,t.width);else{(0,p.inverseClass)(s,"art-current");for(let e=0;e<t.$parentItem.selector.length;e++){const i=t.$parentItem.selector[e];i.default=i===t}if(t.$parentList&&this.init(t.$parentList),t.$parentItem&&t.$parentItem.onSelect){const i=await t.$parentItem.onSelect.call(this.art,t,s,e);t.$parentItem.$tooltip&&(0,p.isStringOrNumber)(i)&&(t.$parentItem.$tooltip.innerHTML=i)}}}));this.events.push(e),t.default&&(0,p.addClass)(s,"art-current")}}return s}updateStyle(e){const{controls:t,constructor:i,template:{$player:r,$setting:s}}=this.art;if(t.setting){const n=e||i.SETTING_WIDTH,{left:a,width:o}=t.setting.getBoundingClientRect(),{left:l,width:d}=r.getBoundingClientRect(),c=a-l+o/2-n/2;c+n>d?((0,p.setStyle)(s,"left","auto"),(0,p.setStyle)(s,"right","10px")):((0,p.setStyle)(s,"left",`${c}px`),(0,p.setStyle)(s,"right","auto"))}else(0,p.setStyle)(s,"left","auto"),(0,p.setStyle)(s,"right","10px")}init(e,t){const{constructor:i}=this.art;if(this.cache.has(e)){const t=this.cache.get(e);(0,p.inverseClass)(t,"art-current"),(0,p.setStyle)(this.$parent,"width",`${t.dataset.width}px`),(0,p.setStyle)(this.$parent,"height",`${t.dataset.height}px`),this.updateStyle(Number(t.dataset.width))}else{const r=(0,p.createElement)("div");(0,p.addClass)(r,"art-setting-panel"),r.dataset.width=t||i.SETTING_WIDTH,r.dataset.height=e.length*i.SETTING_ITEM_HEIGHT,e[0]&&e[0].$parentItem&&((0,p.append)(r,this.creatHeader(e[0])),r.dataset.height=Number(r.dataset.height)+i.SETTING_ITEM_HEIGHT);for(let t=0;t<e.length;t++){const i=e[t];(0,p.has)(i,"switch")?(0,p.append)(r,this.creatItem("switch",i)):(0,p.has)(i,"range")?(0,p.append)(r,this.creatItem("range",i)):(0,p.append)(r,this.creatItem("selector",i))}(0,p.append)(this.$parent,r),this.cache.set(e,r),(0,p.inverseClass)(r,"art-current"),(0,p.setStyle)(this.$parent,"width",`${r.dataset.width}px`),(0,p.setStyle)(this.$parent,"height",`${r.dataset.height}px`),this.updateStyle(Number(r.dataset.width)),e[0]&&e[0].$parentItem&&e[0].$parentItem.mounted&&e[0].$parentItem.mounted.call(this.art,r,e[0].$parentItem)}}}i.default=m},{"./flip":"kONUB","./aspectRatio":"84NBV","./playbackRate":"aetWt","./subtitleOffset":"fIBkO","../utils/component":"18nVI","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kONUB:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{i18n:t,icons:i,constructor:{SETTING_ITEM_WIDTH:s,FLIP:n}}=e;function a(e,i,s){i&&(i.innerText=t.get((0,r.capitalize)(s)));const n=(0,r.queryAll)(".art-setting-item",e).find((e=>e.dataset.value===s));n&&(0,r.inverseClass)(n,"art-current")}return{width:s,html:t.get("Video Flip"),tooltip:t.get((0,r.capitalize)(e.flip)),icon:i.flip,selector:n.map((i=>({value:i,default:i===e.flip,html:t.get((0,r.capitalize)(i))}))),onSelect:t=>(e.flip=t.value,t.value),mounted:(t,i)=>{a(t,i.$tooltip,e.flip),e.on("flip",(()=>{a(t,i.$tooltip,e.flip)}))}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"84NBV":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{i18n:t,icons:i,constructor:{SETTING_ITEM_WIDTH:s,ASPECT_RATIO:n}}=e;function a(e){return"default"===e?t.get("Default"):e}function o(e,t,i){t&&(t.innerText=a(i));const s=(0,r.queryAll)(".art-setting-item",e).find((e=>e.dataset.value===i));s&&(0,r.inverseClass)(s,"art-current")}return{width:s,html:t.get("Aspect Ratio"),icon:i.aspectRatio,tooltip:a(e.aspectRatio),selector:n.map((t=>({value:t,default:t===e.aspectRatio,html:a(t)}))),onSelect:t=>(e.aspectRatio=t.value,t.value),mounted:(t,i)=>{o(t,i.$tooltip,e.aspectRatio),e.on("aspectRatio",(()=>{o(t,i.$tooltip,e.aspectRatio)}))}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],aetWt:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{i18n:t,icons:i,constructor:{SETTING_ITEM_WIDTH:s,PLAYBACK_RATE:n}}=e;function a(e){return 1===e?t.get("Normal"):e}function o(e,t,i){t&&(t.innerText=a(i));const s=(0,r.queryAll)(".art-setting-item",e).find((e=>Number(e.dataset.value)===i));s&&(0,r.inverseClass)(s,"art-current")}return{width:s,html:t.get("Play Speed"),tooltip:a(e.playbackRate),icon:i.playbackRate,selector:n.map((t=>({value:t,default:t===e.playbackRate,html:a(t)}))),onSelect:t=>(e.playbackRate=t.value,t.value),mounted:(t,i)=>{o(t,i.$tooltip,e.playbackRate),e.on("video:ratechange",(()=>{o(t,i.$tooltip,e.playbackRate)}))}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fIBkO:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i),i.default=function(e){const{i18n:t,icons:i,constructor:r}=e;return{width:r.SETTING_ITEM_WIDTH,html:t.get("Subtitle Offset"),icon:i.subtitle,tooltip:"0s",range:[0,-5,5,.1],onChange:t=>(e.subtitleOffset=t.range,t.range+"s")}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2aaJe":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i),i.default=class{constructor(){this.name="artplayer_settings",this.settings={}}get(e){try{const t=JSON.parse(window.localStorage.getItem(this.name))||{};return e?t[e]:t}catch(t){return e?this.settings[e]:this.settings}}set(e,t){try{const i=Object.assign({},this.get(),{[e]:t});window.localStorage.setItem(this.name,JSON.stringify(i))}catch(i){this.settings[e]=t}}del(e){try{const t=this.get();delete t[e],window.localStorage.setItem(this.name,JSON.stringify(t))}catch(t){delete this.settings[e]}}clear(){try{window.localStorage.removeItem(this.name)}catch(e){this.settings={}}}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8MTUM":[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i);var s=e("../utils"),n=e("./miniProgressBar"),a=r.interopDefault(n),o=e("./autoOrientation"),l=r.interopDefault(o),d=e("./autoPlayback"),c=r.interopDefault(d),h=e("./fastForward"),u=r.interopDefault(h),f=e("./lock"),p=r.interopDefault(f);i.default=class{constructor(e){this.art=e,this.id=0;const{option:t}=e;t.miniProgressBar&&!t.isLive&&this.add(a.default),t.lock&&s.isMobile&&this.add(p.default),t.autoPlayback&&!t.isLive&&this.add(c.default),t.autoOrientation&&s.isMobile&&this.add(l.default),t.fastForward&&s.isMobile&&!t.isLive&&this.add(u.default);for(let i=0;i<t.plugins.length;i++)this.add(t.plugins[i])}add(e){this.id+=1;const t=e.call(this.art,this.art),i=t&&t.name||e.name||`plugin${this.id}`;return(0,s.errorHandle)(!(0,s.has)(this,i),`Cannot add a plugin that already has the same name: ${i}`),(0,s.def)(this,i,{value:t}),this}}},{"../utils":"71aH7","./miniProgressBar":"87pSL","./autoOrientation":"ePEg5","./autoPlayback":"cVO99","./fastForward":"hFDwt","./lock":"1hsTH","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"87pSL":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i),i.default=function(e){return e.on("ready",(()=>{e.layers.add({name:"miniProgressBar",mounted(t){e.on("destroy",(()=>{t.style.display="none"})),e.on("video:timeupdate",(()=>{t.style.width=100*e.played+"%"})),e.on("setBar",((e,i)=>{"played"===e&&(t.style.width=100*i+"%")}))}})})),{name:"miniProgressBar"}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ePEg5:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{option:t,constructor:i,template:{$player:s,$video:n}}=e;return e.on("fullscreenWeb",(a=>{if(a){const{videoWidth:t,videoHeight:a}=n,{clientWidth:o,clientHeight:l}=document.documentElement;(t>a&&o<l||t<a&&o>l)&&setTimeout((()=>{(0,r.setStyle)(s,"width",`${l}px`),(0,r.setStyle)(s,"height",`${o}px`),(0,r.setStyle)(s,"transform-origin","0 0"),(0,r.setStyle)(s,"transform",`rotate(90deg) translate(0, -${o}px)`),(0,r.addClass)(s,"art-auto-orientation"),e.isRotate=!0,e.emit("resize")}),i.MOBILE_AUTO_ORIENTATION_TIME)}else(0,r.hasClass)(s,"art-auto-orientation")&&((0,r.setStyle)(s,"width",null),(0,r.setStyle)(s,"height",null),(0,r.setStyle)(s,"transform",null),(0,r.setStyle)(s,"transform-origin",null),(0,r.removeClass)(s,"art-auto-orientation"),e.isRotate=!1,e.aspectRatioReset=!0,e.autoSize=t.autoSize,e.notice.show="",e.emit("resize"))})),e.on("fullscreen",(async e=>{const t=screen.orientation.type;if(e){const{videoWidth:e,videoHeight:i}=n,{clientWidth:a,clientHeight:o}=document.documentElement;if(e>i&&a<o||e<i&&a>o){const e=t.startsWith("portrait")?"landscape":"portrait";await screen.orientation.lock(e),(0,r.addClass)(s,"art-auto-orientation-fullscreen")}}else(0,r.hasClass)(s,"art-auto-orientation-fullscreen")&&(await screen.orientation.lock(t),(0,r.removeClass)(s,"art-auto-orientation-fullscreen"))})),{name:"autoOrientation",get state(){return(0,r.hasClass)(s,"art-auto-orientation")}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],cVO99:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{i18n:t,icons:i,storage:s,constructor:n,proxy:a,template:{$poster:o}}=e,l=e.layers.add({name:"autoPlayback",html:'<div class="art-autoPlayback-close"></div><div class="art-autoPlayback-last"></div><div class="art-autoPlayback-jump"></div>'}),d=(0,r.query)(".art-autoPlayback-last",l),c=(0,r.query)(".art-autoPlayback-jump",l),h=(0,r.query)(".art-autoPlayback-close",l);return e.on("video:timeupdate",(()=>{const t=s.get("times")||{},i=Object.keys(t);i.length>n.AUTO_PLAYBACK_MAX&&delete t[i[0]],t[e.option.id||e.option.url]=e.currentTime,s.set("times",t)})),e.on("ready",(()=>{const u=(s.get("times")||{})[e.option.id||e.option.url];u&&u>=n.AUTO_PLAYBACK_MIN&&((0,r.append)(h,i.close),(0,r.setStyle)(l,"display","flex"),d.innerText=`${t.get("Last Seen")} ${(0,r.secondToTime)(u)}`,c.innerText=t.get("Jump Play"),a(h,"click",(()=>{(0,r.setStyle)(l,"display","none")})),a(c,"click",(()=>{e.seek=u,e.play(),(0,r.setStyle)(o,"display","none"),(0,r.setStyle)(l,"display","none")})),e.once("video:timeupdate",(()=>{setTimeout((()=>{(0,r.setStyle)(l,"display","none")}),n.AUTO_PLAYBACK_TIMEOUT)})))})),{name:"autoPlayback",get times(){return s.get("times")||{}},clear:()=>s.del("times"),delete(e){const t=s.get("times")||{};return delete t[e],s.set("times",t),t}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],hFDwt:[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{constructor:t,proxy:i,template:{$player:s,$video:n}}=e;let a=null,o=!1,l=1;const d=()=>{clearTimeout(a),o&&(o=!1,e.playbackRate=l,(0,r.removeClass)(s,"art-fast-forward"))};return i(n,"touchstart",(i=>{1===i.touches.length&&e.playing&&!e.isLock&&(a=setTimeout((()=>{o=!0,l=e.playbackRate,e.playbackRate=t.FAST_FORWARD_VALUE,(0,r.addClass)(s,"art-fast-forward")}),t.FAST_FORWARD_TIME))})),i(document,"touchmove",d),i(document,"touchend",d),{name:"fastForward",get state(){return(0,r.hasClass)(s,"art-fast-forward")}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1hsTH":[function(e,t,i){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var r=e("../utils");i.default=function(e){const{layers:t,icons:i,template:{$player:s}}=e;return t.add({name:"lock",mounted(t){const s=(0,r.append)(t,i.lock),n=(0,r.append)(t,i.unlock);(0,r.setStyle)(s,"display","none"),e.on("lock",(e=>{e?((0,r.setStyle)(s,"display","inline-flex"),(0,r.setStyle)(n,"display","none")):((0,r.setStyle)(s,"display","none"),(0,r.setStyle)(n,"display","inline-flex"))}))},click(){(0,r.hasClass)(s,"art-lock")?((0,r.removeClass)(s,"art-lock"),this.isLock=!1):((0,r.addClass)(s,"art-lock"),this.isLock=!0)}}),{name:"lock",get state(){return(0,r.hasClass)(s,"art-lock")}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7mil2":[function(e,t,i){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(i);var s=e("./config"),n=r.interopDefault(s),a=e("./utils");i.default=class{constructor(e){const{option:t,proxy:i,template:{$video:r}}=e;for(let a=0;a<n.default.events.length;a++)i(r,n.default.events[a],(t=>{e.emit(`video:${t.type}`,t)}));Object.keys(t.moreVideoAttr).forEach((e=>{r[e]=t.moreVideoAttr[e]})),r.controls=!0,t.muted&&(r.muted=t.muted),t.volume&&(r.volume=(0,a.clamp)(t.volume,0,1)),t.poster&&(r.poster=t.poster),t.autoplay&&(r.autoplay=t.autoplay),t.playsInline&&(r.playsInline=!0,r["webkit-playsinline"]=!0);const s=t.type||(0,a.getExt)(t.url),o=t.customType[s];s&&o?o(r,t.url,e):(r.src=t.url,e.emit("url",r.src))}}},{"./config":"lyjeQ","./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}]},["5lTcX"],0,"parcelRequire4dc0")),x.exports)),M={style:{transform:"scale(-1,1)"},height:"25",width:"25",viewBox:"0 0 22 22",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},P=[o("path",{d:"M16 5a1 1 0 00-1 1v4.615a1.431 1.431 0 00-.615-.829L7.21 5.23A1.439 1.439 0 005 6.445v9.11a1.44 1.44 0 002.21 1.215l7.175-4.555a1.436 1.436 0 00.616-.828V16a1 1 0 002 0V6C17 5.448 16.552 5 16 5z"},null,-1)];const O=s({name:"custom-prev",render:function(e,t){return n(),a("svg",M,P)}}),N={height:"25",width:"25",viewBox:"0 0 22 22",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},F=[o("path",{d:"M16 5a1 1 0 00-1 1v4.615a1.431 1.431 0 00-.615-.829L7.21 5.23A1.439 1.439 0 005 6.445v9.11a1.44 1.44 0 002.21 1.215l7.175-4.555a1.436 1.436 0 00.616-.828V16a1 1 0 002 0V6C17 5.448 16.552 5 16 5z"},null,-1)];const B=s({name:"custom-next",render:function(e,t){return n(),a("svg",N,F)}});var U,j={exports:{}};const G=r((U||(U=1,window,j.exports=function(e){var t={};function i(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(r,s,function(t){return e[t]}.bind(null,s));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=14)}([function(e,t,i){var r=i(6),s=i.n(r),n=function(){function e(){}return e.e=function(t,i){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var r="["+t+"] > "+i;e.ENABLE_CALLBACK&&e.emitter.emit("log","error",r),e.ENABLE_ERROR&&(console.error||console.warn)},e.i=function(t,i){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var r="["+t+"] > "+i;e.ENABLE_CALLBACK&&e.emitter.emit("log","info",r),e.ENABLE_INFO&&console.info},e.w=function(t,i){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var r="["+t+"] > "+i;e.ENABLE_CALLBACK&&e.emitter.emit("log","warn",r),e.ENABLE_WARN&&console.warn},e.d=function(t,i){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var r="["+t+"] > "+i;e.ENABLE_CALLBACK&&e.emitter.emit("log","debug",r),e.ENABLE_DEBUG&&console.debug},e.v=function(t,i){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var r="["+t+"] > "+i;e.ENABLE_CALLBACK&&e.emitter.emit("log","verbose",r),e.ENABLE_VERBOSE},e}();n.GLOBAL_TAG="mpegts.js",n.FORCE_GLOBAL_TAG=!1,n.ENABLE_ERROR=!0,n.ENABLE_INFO=!0,n.ENABLE_WARN=!0,n.ENABLE_DEBUG=!0,n.ENABLE_VERBOSE=!0,n.ENABLE_CALLBACK=!1,n.emitter=new s.a,t.a=n},function(e,t,i){t.a={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",TIMED_ID3_METADATA_ARRIVED:"timed_id3_metadata_arrived",SMPTE2038_METADATA_ARRIVED:"smpte2038_metadata_arrived",SCTE35_METADATA_ARRIVED:"scte35_metadata_arrived",PES_PRIVATE_DATA_DESCRIPTOR:"pes_private_data_descriptor",PES_PRIVATE_DATA_ARRIVED:"pes_private_data_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"}},function(e,t,i){i.d(t,"c",(function(){return s})),i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return a}));var r=i(3),s={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},n={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},a=function(){function e(e){this._type=e||"undefined",this._status=s.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return e.prototype.destroy=function(){this._status=s.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},e.prototype.isWorking=function(){return this._status===s.kConnecting||this._status===s.kBuffering},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(e){this._onContentLengthKnown=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(e){this._onURLRedirect=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onComplete",{get:function(){return this._onComplete},set:function(e){this._onComplete=e},enumerable:!1,configurable:!0}),e.prototype.open=function(e,t){throw new r.c("Unimplemented abstract function!")},e.prototype.abort=function(){throw new r.c("Unimplemented abstract function!")},e}()},function(e,t,i){i.d(t,"d",(function(){return n})),i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return l}));var r,s=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=function(){function e(e){this._message=e}return Object.defineProperty(e.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return this.name+": "+this.message},e}(),a=function(e){function t(t){return e.call(this,t)||this}return s(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),t}(n),o=function(e){function t(t){return e.call(this,t)||this}return s(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),t}(n),l=function(e){function t(t){return e.call(this,t)||this}return s(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),t}(n)},function(e,t,i){var r={};!function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],i=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],s={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:i[0]||""},n={};if(s.browser){n[s.browser]=!0;var a=s.majorVersion.split(".");n.version={major:parseInt(s.majorVersion,10),string:s.version},a.length>1&&(n.version.minor=parseInt(a[1],10)),a.length>2&&(n.version.build=parseInt(a[2],10))}for(var o in s.platform&&(n[s.platform]=!0),(n.chrome||n.opr||n.safari)&&(n.webkit=!0),(n.rv||n.iemobile)&&(n.rv&&delete n.rv,s.browser="msie",n.msie=!0),n.edge&&(delete n.edge,s.browser="msedge",n.msedge=!0),n.opr&&(s.browser="opera",n.opera=!0),n.safari&&n.android&&(s.browser="android",n.android=!0),n.name=s.browser,n.platform=s.platform,r)r.hasOwnProperty(o)&&delete r[o];Object.assign(r,n)}(),t.a=r},function(e,t,i){t.a={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"}},function(e,t,i){var r,s="object"==typeof Reflect?Reflect:null,n=s&&"function"==typeof s.apply?s.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};r=s&&"function"==typeof s.ownKeys?s.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(i,r){function s(i){e.removeListener(t,n),r(i)}function n(){"function"==typeof e.removeListener&&e.removeListener("error",s),i([].slice.call(arguments))}var a,o,l;y(e,t,n,{once:!0}),"error"!==t&&(o=s,l={once:!0},"function"==typeof(a=e).on&&y(a,"error",o,l))}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var l=10;function d(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function h(e,t,i,r){var s,n,a;if(d(i),void 0===(n=e._events)?(n=e._events=Object.create(null),e._eventsCount=0):(void 0!==n.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),n=e._events),a=n[t]),void 0===a)a=n[t]=i,++e._eventsCount;else if("function"==typeof a?a=n[t]=r?[i,a]:[a,i]:r?a.unshift(i):a.push(i),(s=c(e))>0&&a.length>s&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=e,o.type=t,o.count=a.length,console&&console.warn}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,i){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},s=u.bind(r);return s.listener=i,r.wrapFn=s,s}function p(e,t,i){var r=e._events;if(void 0===r)return[];var s=r[t];return void 0===s?[]:"function"==typeof s?i?[s.listener||s]:[s]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(s):g(s,s.length)}function m(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function g(e,t){for(var i=new Array(t),r=0;r<t;++r)i[r]=e[r];return i}function y(e,t,i,r){if("function"==typeof e.on)r.once?e.once(t,i):e.on(t,i);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function s(n){r.once&&e.removeEventListener(t,s),i(n)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,s=this._events;if(void 0!==s)r=r&&void 0===s.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var l=s[e];if(void 0===l)return!1;if("function"==typeof l)n(l,this,t);else{var d=l.length,c=g(l,d);for(i=0;i<d;++i)n(c[i],this,t)}return!0},o.prototype.addListener=function(e,t){return h(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return h(this,e,t,!0)},o.prototype.once=function(e,t){return d(t),this.on(e,f(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return d(t),this.prependListener(e,f(this,e,t)),this},o.prototype.removeListener=function(e,t){var i,r,s,n,a;if(d(t),void 0===(r=this._events))return this;if(void 0===(i=r[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(s=-1,n=i.length-1;n>=0;n--)if(i[n]===t||i[n].listener===t){a=i[n].listener,s=n;break}if(s<0)return this;0===s?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,s),1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var s,n=Object.keys(i);for(r=0;r<n.length;++r)"removeListener"!==(s=n[r])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return p(this,e,!0)},o.prototype.rawListeners=function(e){return p(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},o.prototype.listenerCount=m,o.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,i){i.d(t,"d",(function(){return r})),i.d(t,"b",(function(){return s})),i.d(t,"a",(function(){return n})),i.d(t,"c",(function(){return a}));var r=function(e,t,i,r,s){this.dts=e,this.pts=t,this.duration=i,this.originalDts=r,this.isSyncPoint=s,this.fileposition=null},s=function(){function e(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return e.prototype.appendSyncPoint=function(e){e.isSyncPoint=!0,this.syncPoints.push(e)},e}(),n=function(){function e(){this._list=[]}return e.prototype.clear=function(){this._list=[]},e.prototype.appendArray=function(e){var t=this._list;0!==e.length&&(t.length>0&&e[0].originalDts<t[t.length-1].originalDts&&this.clear(),Array.prototype.push.apply(t,e))},e.prototype.getLastSyncPointBeforeDts=function(e){if(0==this._list.length)return null;var t=this._list,i=0,r=t.length-1,s=0,n=0,a=r;for(e<t[0].dts&&(i=0,n=a+1);n<=a;){if((s=n+Math.floor((a-n)/2))===r||e>=t[s].dts&&e<t[s+1].dts){i=s;break}t[s].dts<e?n=s+1:a=s-1}return this._list[i]},e}(),a=function(){function e(e){this._type=e,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),e.prototype.isEmpty=function(){return 0===this._list.length},e.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},e.prototype._searchNearestSegmentBefore=function(e){var t=this._list;if(0===t.length)return-2;var i=t.length-1,r=0,s=0,n=i,a=0;if(e<t[0].originalBeginDts)return-1;for(;s<=n;){if((r=s+Math.floor((n-s)/2))===i||e>t[r].lastSample.originalDts&&e<t[r+1].originalBeginDts){a=r;break}t[r].originalBeginDts<e?s=r+1:n=r-1}return a},e.prototype._searchNearestSegmentAfter=function(e){return this._searchNearestSegmentBefore(e)+1},e.prototype.append=function(e){var t=this._list,i=e,r=this._lastAppendLocation,s=0;-1!==r&&r<t.length&&i.originalBeginDts>=t[r].lastSample.originalDts&&(r===t.length-1||r<t.length-1&&i.originalBeginDts<t[r+1].originalBeginDts)?s=r+1:t.length>0&&(s=this._searchNearestSegmentBefore(i.originalBeginDts)+1),this._lastAppendLocation=s,this._list.splice(s,0,i)},e.prototype.getLastSegmentBefore=function(e){var t=this._searchNearestSegmentBefore(e);return t>=0?this._list[t]:null},e.prototype.getLastSampleBefore=function(e){var t=this.getLastSegmentBefore(e);return null!=t?t.lastSample:null},e.prototype.getLastSyncPointBefore=function(e){for(var t=this._searchNearestSegmentBefore(e),i=this._list[t].syncPoints;0===i.length&&t>0;)t--,i=this._list[t].syncPoints;return i.length>0?i[i.length-1]:null},e}()},function(e,t,i){var r=function(){function e(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return e.prototype.isComplete=function(){var e=!1===this.hasAudio||!0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,t=!1===this.hasVideo||!0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.refFrames&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!=this.mimeType&&e&&t},e.prototype.isSeekable=function(){return!0===this.hasKeyframesIndex},e.prototype.getNearestKeyframe=function(e){if(null==this.keyframesIndex)return null;var t=this.keyframesIndex,i=this._search(t.times,e);return{index:i,milliseconds:t.times[i],fileposition:t.filepositions[i]}},e.prototype._search=function(e,t){var i=0,r=e.length-1,s=0,n=0,a=r;for(t<e[0]&&(i=0,n=a+1);n<=a;){if((s=n+Math.floor((a-n)/2))===r||t>=e[s]&&t<e[s+1]){i=s;break}e[s]<t?n=s+1:a=s-1}return i},e}();t.a=r},function(e,t,i){var r=i(6),s=i.n(r),n=i(0),a=function(){function e(){}return Object.defineProperty(e,"forceGlobalTag",{get:function(){return n.a.FORCE_GLOBAL_TAG},set:function(t){n.a.FORCE_GLOBAL_TAG=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"globalTag",{get:function(){return n.a.GLOBAL_TAG},set:function(t){n.a.GLOBAL_TAG=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableAll",{get:function(){return n.a.ENABLE_VERBOSE&&n.a.ENABLE_DEBUG&&n.a.ENABLE_INFO&&n.a.ENABLE_WARN&&n.a.ENABLE_ERROR},set:function(t){n.a.ENABLE_VERBOSE=t,n.a.ENABLE_DEBUG=t,n.a.ENABLE_INFO=t,n.a.ENABLE_WARN=t,n.a.ENABLE_ERROR=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableDebug",{get:function(){return n.a.ENABLE_DEBUG},set:function(t){n.a.ENABLE_DEBUG=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableVerbose",{get:function(){return n.a.ENABLE_VERBOSE},set:function(t){n.a.ENABLE_VERBOSE=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableInfo",{get:function(){return n.a.ENABLE_INFO},set:function(t){n.a.ENABLE_INFO=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableWarn",{get:function(){return n.a.ENABLE_WARN},set:function(t){n.a.ENABLE_WARN=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableError",{get:function(){return n.a.ENABLE_ERROR},set:function(t){n.a.ENABLE_ERROR=t,e._notifyChange()},enumerable:!1,configurable:!0}),e.getConfig=function(){return{globalTag:n.a.GLOBAL_TAG,forceGlobalTag:n.a.FORCE_GLOBAL_TAG,enableVerbose:n.a.ENABLE_VERBOSE,enableDebug:n.a.ENABLE_DEBUG,enableInfo:n.a.ENABLE_INFO,enableWarn:n.a.ENABLE_WARN,enableError:n.a.ENABLE_ERROR,enableCallback:n.a.ENABLE_CALLBACK}},e.applyConfig=function(e){n.a.GLOBAL_TAG=e.globalTag,n.a.FORCE_GLOBAL_TAG=e.forceGlobalTag,n.a.ENABLE_VERBOSE=e.enableVerbose,n.a.ENABLE_DEBUG=e.enableDebug,n.a.ENABLE_INFO=e.enableInfo,n.a.ENABLE_WARN=e.enableWarn,n.a.ENABLE_ERROR=e.enableError,n.a.ENABLE_CALLBACK=e.enableCallback},e._notifyChange=function(){var t=e.emitter;if(t.listenerCount("change")>0){var i=e.getConfig();t.emit("change",i)}},e.registerListener=function(t){e.emitter.addListener("change",t)},e.removeListener=function(t){e.emitter.removeListener("change",t)},e.addLogListener=function(t){n.a.emitter.addListener("log",t),n.a.emitter.listenerCount("log")>0&&(n.a.ENABLE_CALLBACK=!0,e._notifyChange())},e.removeLogListener=function(t){n.a.emitter.removeListener("log",t),0===n.a.emitter.listenerCount("log")&&(n.a.ENABLE_CALLBACK=!1,e._notifyChange())},e}();a.emitter=new s.a,t.a=a},function(e,t,i){var r=i(6),s=i.n(r),n=i(0),a=i(4),o=i(8);function l(e,t,i){var r=e;if(t+i<r.length){for(;i--;)if(128!=(192&r[++t]))return!1;return!0}return!1}var d,c=function(e){for(var t=[],i=e,r=0,s=e.length;r<s;)if(i[r]<128)t.push(String.fromCharCode(i[r])),++r;else{if(i[r]<192);else if(i[r]<224){if(l(i,r,1)&&(n=(31&i[r])<<6|63&i[r+1])>=128){t.push(String.fromCharCode(65535&n)),r+=2;continue}}else if(i[r]<240){if(l(i,r,2)&&(n=(15&i[r])<<12|(63&i[r+1])<<6|63&i[r+2])>=2048&&55296!=(63488&n)){t.push(String.fromCharCode(65535&n)),r+=3;continue}}else if(i[r]<248){var n;if(l(i,r,3)&&(n=(7&i[r])<<18|(63&i[r+1])<<12|(63&i[r+2])<<6|63&i[r+3])>65536&&n<1114112){n-=65536,t.push(String.fromCharCode(n>>>10|55296)),t.push(String.fromCharCode(1023&n|56320)),r+=4;continue}}t.push(String.fromCharCode(65533)),++r}return t.join("")},h=i(3),u=(d=new ArrayBuffer(2),new DataView(d).setInt16(0,256,!0),256===new Int16Array(d)[0]),f=function(){function e(){}return e.parseScriptData=function(t,i,r){var s={};try{var a=e.parseValue(t,i,r),o=e.parseValue(t,i+a.size,r-a.size);s[a.data]=o.data}catch(l){n.a.e("AMF",l.toString())}return s},e.parseObject=function(t,i,r){if(r<3)throw new h.a("Data not enough when parse ScriptDataObject");var s=e.parseString(t,i,r),n=e.parseValue(t,i+s.size,r-s.size),a=n.objectEnd;return{data:{name:s.data,value:n.data},size:s.size+n.size,objectEnd:a}},e.parseVariable=function(t,i,r){return e.parseObject(t,i,r)},e.parseString=function(e,t,i){if(i<2)throw new h.a("Data not enough when parse String");var r=new DataView(e,t,i).getUint16(0,!u);return{data:r>0?c(new Uint8Array(e,t+2,r)):"",size:2+r}},e.parseLongString=function(e,t,i){if(i<4)throw new h.a("Data not enough when parse LongString");var r=new DataView(e,t,i).getUint32(0,!u);return{data:r>0?c(new Uint8Array(e,t+4,r)):"",size:4+r}},e.parseDate=function(e,t,i){if(i<10)throw new h.a("Data size invalid when parse Date");var r=new DataView(e,t,i),s=r.getFloat64(0,!u),n=r.getInt16(8,!u);return{data:new Date(s+=60*n*1e3),size:10}},e.parseValue=function(t,i,r){if(r<1)throw new h.a("Data not enough when parse Value");var s,a=new DataView(t,i,r),o=1,l=a.getUint8(0),d=!1;try{switch(l){case 0:s=a.getFloat64(1,!u),o+=8;break;case 1:s=!!a.getUint8(1),o+=1;break;case 2:var c=e.parseString(t,i+1,r-1);s=c.data,o+=c.size;break;case 3:s={};var f=0;for(9==(16777215&a.getUint32(r-4,!u))&&(f=3);o<r-4;){var p=e.parseObject(t,i+o,r-o-f);if(p.objectEnd)break;s[p.data.name]=p.data.value,o+=p.size}o<=r-3&&9==(16777215&a.getUint32(o-1,!u))&&(o+=3);break;case 8:for(s={},o+=4,f=0,9==(16777215&a.getUint32(r-4,!u))&&(f=3);o<r-8;){var m=e.parseVariable(t,i+o,r-o-f);if(m.objectEnd)break;s[m.data.name]=m.data.value,o+=m.size}o<=r-3&&9==(16777215&a.getUint32(o-1,!u))&&(o+=3);break;case 9:s=void 0,o=1,d=!0;break;case 10:s=[];var g=a.getUint32(1,!u);o+=4;for(var y=0;y<g;y++){var v=e.parseValue(t,i+o,r-o);s.push(v.data),o+=v.size}break;case 11:var _=e.parseDate(t,i+1,r-1);s=_.data,o+=_.size;break;case 12:var E=e.parseString(t,i+1,r-1);s=E.data,o+=E.size;break;default:o=r,n.a.w("AMF","Unsupported AMF value type "+l)}}catch(b){n.a.e("AMF",b.toString())}return{data:s,size:o,objectEnd:d}},e}(),p=function(){function e(e){this.TAG="ExpGolomb",this._buffer=e,this._buffer_index=0,this._total_bytes=e.byteLength,this._total_bits=8*e.byteLength,this._current_word=0,this._current_word_bits_left=0}return e.prototype.destroy=function(){this._buffer=null},e.prototype._fillCurrentWord=function(){var e=this._total_bytes-this._buffer_index;if(e<=0)throw new h.a("ExpGolomb: _fillCurrentWord() but no bytes available");var t=Math.min(4,e),i=new Uint8Array(4);i.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(i.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t},e.prototype.readBits=function(e){if(e>32)throw new h.b("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var i=this._current_word_bits_left?this._current_word:0;i>>>=32-this._current_word_bits_left;var r=e-this._current_word_bits_left;this._fillCurrentWord();var s=Math.min(r,this._current_word_bits_left),n=this._current_word>>>32-s;return this._current_word<<=s,this._current_word_bits_left-=s,i<<s|n},e.prototype.readBool=function(){return 1===this.readBits(1)},e.prototype.readByte=function(){return this.readBits(8)},e.prototype._skipLeadingZero=function(){var e;for(e=0;e<this._current_word_bits_left;e++)if(this._current_word&2147483648>>>e)return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()},e.prototype.readUEG=function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1},e.prototype.readSEG=function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)},e}(),m=function(){function e(){}return e._ebsp2rbsp=function(e){for(var t=e,i=t.byteLength,r=new Uint8Array(i),s=0,n=0;n<i;n++)n>=2&&3===t[n]&&0===t[n-1]&&0===t[n-2]||(r[s]=t[n],s++);return new Uint8Array(r.buffer,0,s)},e.parseSPS=function(t){for(var i=t.subarray(1,4),r="avc1.",s=0;s<3;s++){var n=i[s].toString(16);n.length<2&&(n="0"+n),r+=n}var a=e._ebsp2rbsp(t),o=new p(a);o.readByte();var l=o.readByte();o.readByte();var d=o.readByte();o.readUEG();var c=e.getProfileString(l),h=e.getLevelString(d),u=1,f=420,m=8,g=8;if((100===l||110===l||122===l||244===l||44===l||83===l||86===l||118===l||128===l||138===l||144===l)&&(3===(u=o.readUEG())&&o.readBits(1),u<=3&&(f=[0,420,422,444][u]),m=o.readUEG()+8,g=o.readUEG()+8,o.readBits(1),o.readBool()))for(var y=3!==u?8:12,v=0;v<y;v++)o.readBool()&&(v<6?e._skipScalingList(o,16):e._skipScalingList(o,64));o.readUEG();var _=o.readUEG();if(0===_)o.readUEG();else if(1===_){o.readBits(1),o.readSEG(),o.readSEG();var E=o.readUEG();for(v=0;v<E;v++)o.readSEG()}var b=o.readUEG();o.readBits(1);var S=o.readUEG(),T=o.readUEG(),A=o.readBits(1);0===A&&o.readBits(1),o.readBits(1);var w=0,L=0,I=0,R=0;o.readBool()&&(w=o.readUEG(),L=o.readUEG(),I=o.readUEG(),R=o.readUEG());var D=1,k=1,x=0,C=!0,M=0,P=0;if(o.readBool()){if(o.readBool()){var O=o.readByte();O>0&&O<16?(D=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][O-1],k=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][O-1]):255===O&&(D=o.readByte()<<8|o.readByte(),k=o.readByte()<<8|o.readByte())}if(o.readBool()&&o.readBool(),o.readBool()&&(o.readBits(4),o.readBool()&&o.readBits(24)),o.readBool()&&(o.readUEG(),o.readUEG()),o.readBool()){var N=o.readBits(32),F=o.readBits(32);C=o.readBool(),x=(M=F)/(P=2*N)}}var B=1;1===D&&1===k||(B=D/k);var U=0,j=0;0===u?(U=1,j=2-A):(U=3===u?1:2,j=(1===u?2:1)*(2-A));var G=16*(S+1),z=16*(T+1)*(2-A);G-=(w+L)*U,z-=(I+R)*j;var V=Math.ceil(G*B);return o.destroy(),o=null,{codec_mimetype:r,profile_idc:l,level_idc:d,profile_string:c,level_string:h,chroma_format_idc:u,bit_depth:m,bit_depth_luma:m,bit_depth_chroma:g,ref_frames:b,chroma_format:f,chroma_format_string:e.getChromaFormatString(f),frame_rate:{fixed:C,fps:x,fps_den:P,fps_num:M},sar_ratio:{width:D,height:k},codec_size:{width:G,height:z},present_size:{width:V,height:z}}},e._skipScalingList=function(e,t){for(var i=8,r=8,s=0;s<t;s++)0!==r&&(r=(i+e.readSEG()+256)%256),i=0===r?i:r},e.getProfileString=function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},e.getLevelString=function(e){return(e/10).toFixed(1)},e.getChromaFormatString=function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},e}(),g=i(5),y=function(){function e(){}return e._ebsp2rbsp=function(e){for(var t=e,i=t.byteLength,r=new Uint8Array(i),s=0,n=0;n<i;n++)n>=2&&3===t[n]&&0===t[n-1]&&0===t[n-2]||(r[s]=t[n],s++);return new Uint8Array(r.buffer,0,s)},e.parseVPS=function(t){var i=e._ebsp2rbsp(t),r=new p(i);return r.readByte(),r.readByte(),r.readBits(4),r.readBits(2),r.readBits(6),{num_temporal_layers:r.readBits(3)+1,temporal_id_nested:r.readBool()}},e.parseSPS=function(t){var i=e._ebsp2rbsp(t),r=new p(i);r.readByte(),r.readByte(),r.readBits(4);for(var s=r.readBits(3),n=(r.readBool(),r.readBits(2)),a=r.readBool(),o=r.readBits(5),l=r.readByte(),d=r.readByte(),c=r.readByte(),h=r.readByte(),u=r.readByte(),f=r.readByte(),m=r.readByte(),g=r.readByte(),y=r.readByte(),v=r.readByte(),_=r.readByte(),E=[],b=[],S=0;S<s;S++)E.push(r.readBool()),b.push(r.readBool());if(s>0)for(S=s;S<8;S++)r.readBits(2);for(S=0;S<s;S++)E[S]&&(r.readByte(),r.readByte(),r.readByte(),r.readByte(),r.readByte(),r.readByte(),r.readByte(),r.readByte(),r.readByte(),r.readByte(),r.readByte()),b[S]&&r.readByte();r.readUEG();var T=r.readUEG();3==T&&r.readBits(1);var A=r.readUEG(),w=r.readUEG();r.readBool()&&(r.readUEG(),r.readUEG(),r.readUEG(),r.readUEG());var L=r.readUEG(),I=r.readUEG(),R=r.readUEG();for(S=r.readBool()?0:s;S<=s;S++)r.readUEG(),r.readUEG(),r.readUEG();if(r.readUEG(),r.readUEG(),r.readUEG(),r.readUEG(),r.readUEG(),r.readUEG(),r.readBool()&&r.readBool())for(var D=0;D<4;D++)for(var k=0;k<(3===D?2:6);k++)if(r.readBool()){var x=Math.min(64,1<<4+(D<<1));for(D>1&&r.readSEG(),S=0;S<x;S++)r.readSEG()}else r.readUEG();r.readBool(),r.readBool(),r.readBool()&&(r.readByte(),r.readUEG(),r.readUEG(),r.readBool());var C=r.readUEG(),M=0;for(S=0;S<C;S++){var P=!1;if(0!==S&&(P=r.readBool()),P){S===C&&r.readUEG(),r.readBool(),r.readUEG();for(var O=0,N=0;N<=M;N++){var F=r.readBool(),B=!1;F||(B=r.readBool()),(F||B)&&O++}M=O}else{var U=r.readUEG(),j=r.readUEG();for(M=U+j,N=0;N<U;N++)r.readUEG(),r.readBool();for(N=0;N<j;N++)r.readUEG(),r.readBool()}}if(r.readBool()){var G=r.readUEG();for(S=0;S<G;S++){for(N=0;N<R+4;N++)r.readBits(1);r.readBits(1)}}var z=0,V=1,$=1,H=!1,Y=1,K=1;if(r.readBool(),r.readBool(),r.readBool()){if(r.readBool()){var W=r.readByte();W>0&&W<16?(V=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][W-1],$=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][W-1]):255===W&&(V=r.readBits(16),$=r.readBits(16))}if(r.readBool()&&r.readBool(),r.readBool()&&(r.readBits(3),r.readBool(),r.readBool()&&(r.readByte(),r.readByte(),r.readByte())),r.readBool()&&(r.readUEG(),r.readUEG()),r.readBool(),r.readBool(),r.readBool(),r.readBool()&&(r.readUEG(),r.readUEG(),r.readUEG(),r.readUEG()),r.readBool()&&(Y=r.readBits(32),K=r.readBits(32),r.readBool()&&(r.readUEG(),r.readBool()))){var q=!1,Q=!1,Z=!1;for(q=r.readBool(),Q=r.readBool(),(q||Q)&&((Z=r.readBool())&&(r.readByte(),r.readBits(5),r.readBool(),r.readBits(5)),r.readBits(4),r.readBits(4),Z&&r.readBits(4),r.readBits(5),r.readBits(5),r.readBits(5)),S=0;S<=s;S++){var X=r.readBool();H=X;var J=!1,ee=1;X||(J=r.readBool());var te=!1;if(J?r.readSEG():te=r.readBool(),te||(ee=r.readUEG()+1),q)for(N=0;N<ee;N++)r.readUEG(),r.readUEG(),Z&&(r.readUEG(),r.readUEG());if(Q)for(N=0;N<ee;N++)r.readUEG(),r.readUEG(),Z&&(r.readUEG(),r.readUEG())}}r.readBool()&&(r.readBool(),r.readBool(),r.readBool(),z=r.readUEG(),r.readUEG(),r.readUEG(),r.readUEG(),r.readUEG())}r.readBool();var ie="hvc1."+o+".1.L"+_+".B0",re=A,se=w,ne=1;return 1!==V&&1!==$&&(ne=V/$),r.destroy(),r=null,{codec_mimetype:ie,level_string:e.getLevelString(_),profile_idc:o,bit_depth:L+8,ref_frames:1,chroma_format:T,chroma_format_string:e.getChromaFormatString(T),general_level_idc:_,general_profile_space:n,general_tier_flag:a,general_profile_idc:o,general_profile_compatibility_flags_1:l,general_profile_compatibility_flags_2:d,general_profile_compatibility_flags_3:c,general_profile_compatibility_flags_4:h,general_constraint_indicator_flags_1:u,general_constraint_indicator_flags_2:f,general_constraint_indicator_flags_3:m,general_constraint_indicator_flags_4:g,general_constraint_indicator_flags_5:y,general_constraint_indicator_flags_6:v,min_spatial_segmentation_idc:z,constant_frame_rate:0,chroma_format_idc:T,bit_depth_luma_minus8:L,bit_depth_chroma_minus8:I,frame_rate:{fixed:H,fps:K/Y,fps_den:Y,fps_num:K},sar_ratio:{width:V,height:$},codec_size:{width:re,height:se},present_size:{width:re*ne,height:se}}},e.parsePPS=function(t){var i=e._ebsp2rbsp(t),r=new p(i);r.readByte(),r.readByte(),r.readUEG(),r.readUEG(),r.readBool(),r.readBool(),r.readBits(3),r.readBool(),r.readBool(),r.readUEG(),r.readUEG(),r.readSEG(),r.readBool(),r.readBool(),r.readBool()&&r.readUEG(),r.readSEG(),r.readSEG(),r.readBool(),r.readBool(),r.readBool(),r.readBool();var s=r.readBool(),n=r.readBool(),a=1;return n&&s?a=0:n?a=3:s&&(a=2),{parallelismType:a}},e.getChromaFormatString=function(e){switch(e){case 0:return"4:0:0";case 1:return"4:2:0";case 2:return"4:2:2";case 3:return"4:4:4";default:return"Unknown"}},e.getProfileString=function(e){switch(e){case 1:return"Main";case 2:return"Main10";case 3:return"MainSP";case 4:return"Rext";case 9:return"SCC";default:return"Unknown"}},e.getLevelString=function(e){return(e/30).toFixed(1)},e}();function v(e){return e.byteOffset%2==0&&e.byteLength%2==0}function _(e){return e.byteOffset%4==0&&e.byteLength%4==0}function E(e,t){for(var i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}var b,S,T=function(e,t){return e.byteLength===t.byteLength&&(_(e)&&_(t)?(i=e,r=t,E(new Uint32Array(i.buffer,i.byteOffset,i.byteLength/4),new Uint32Array(r.buffer,r.byteOffset,r.byteLength/4))):v(e)&&v(t)?function(e,t){return E(new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2))}(e,t):function(e,t){return E(e,t)}(e,t));var i,r},A=function(){function e(e,t){var i;this.TAG="FLVDemuxer",this._config=t,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=e.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=e.hasAudioTrack,this._hasVideo=e.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new o.a,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=(i=new ArrayBuffer(2),new DataView(i).setInt16(0,256,!0),256===new Int16Array(i)[0])}return e.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},e.probe=function(e){var t=new Uint8Array(e);if(t.byteLength<9)return{needMoreData:!0};var i={match:!1};if(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])return i;var r,s,n=(4&t[4])>>>2!=0,a=!!(1&t[4]),o=(r=t)[s=5]<<24|r[s+1]<<16|r[s+2]<<8|r[s+3];return o<9?i:{match:!0,consumed:o,dataOffset:o,hasAudioTrack:n,hasVideoTrack:a}},e.prototype.bindDataSource=function(e){return e.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(e.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(e){this._onTrackMetadata=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(e){this._onMediaInfo=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(e){this._onMetaDataArrived=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(e){this._onScriptDataArrived=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(e){this._onDataAvailable=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(e){this._timestampBase=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedDuration",{get:function(){return this._duration},set:function(e){this._durationOverrided=!0,this._duration=e,this._mediaInfo.duration=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedHasAudio",{set:function(e){this._hasAudioFlagOverrided=!0,this._hasAudio=e,this._mediaInfo.hasAudio=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedHasVideo",{set:function(e){this._hasVideoFlagOverrided=!0,this._hasVideo=e,this._mediaInfo.hasVideo=e},enumerable:!1,configurable:!0}),e.prototype.resetMediaInfo=function(){this._mediaInfo=new o.a},e.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched},e.prototype.parseChunks=function(t,i){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new h.a("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var r=0,s=this._littleEndian;if(0===i){if(!(t.byteLength>13))return 0;r=e.probe(t).dataOffset}for(this._firstParse&&(this._firstParse=!1,i+r!==this._dataOffset&&n.a.w(this.TAG,"First time parsing but chunk byteStart invalid!"),0!==(a=new DataView(t,r)).getUint32(0,!s)&&n.a.w(this.TAG,"PrevTagSize0 !== 0 !!!"),r+=4);r<t.byteLength;){this._dispatch=!0;var a=new DataView(t,r);if(r+11+4>t.byteLength)break;var o=a.getUint8(0),l=16777215&a.getUint32(0,!s);if(r+11+l+4>t.byteLength)break;if(8===o||9===o||18===o){var d=a.getUint8(4),c=a.getUint8(5),u=a.getUint8(6)|c<<8|d<<16|a.getUint8(7)<<24;16777215&a.getUint32(7,!s)&&n.a.w(this.TAG,"Meet tag which has StreamID != 0!");var f=r+11;switch(o){case 8:this._parseAudioData(t,f,l,u);break;case 9:this._parseVideoData(t,f,l,u,i+r);break;case 18:this._parseScriptData(t,f,l)}var p=a.getUint32(11+l,!s);p!==11+l&&n.a.w(this.TAG,"Invalid PrevTagSize "+p),r+=11+l+4}else n.a.w(this.TAG,"Unsupported tag type "+o+", skipped"),r+=11+l+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),r},e.prototype._parseScriptData=function(e,t,i){var r=f.parseScriptData(e,t,i);if(r.hasOwnProperty("onMetaData")){if(null==r.onMetaData||"object"!=typeof r.onMetaData)return void n.a.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&n.a.w(this.TAG,"Found another onMetaData tag!"),this._metadata=r;var s=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},s)),"boolean"==typeof s.hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=s.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),"boolean"==typeof s.hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=s.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),"number"==typeof s.audiodatarate&&(this._mediaInfo.audioDataRate=s.audiodatarate),"number"==typeof s.videodatarate&&(this._mediaInfo.videoDataRate=s.videodatarate),"number"==typeof s.width&&(this._mediaInfo.width=s.width),"number"==typeof s.height&&(this._mediaInfo.height=s.height),"number"==typeof s.duration){if(!this._durationOverrided){var a=Math.floor(s.duration*this._timescale);this._duration=a,this._mediaInfo.duration=a}}else this._mediaInfo.duration=0;if("number"==typeof s.framerate){var o=Math.floor(1e3*s.framerate);if(o>0){var l=o/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=l,this._referenceFrameRate.fps_num=o,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=l}}if("object"==typeof s.keyframes){this._mediaInfo.hasKeyframesIndex=!0;var d=s.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(d),s.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=s,n.a.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(r).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},r))},e.prototype._parseKeyframesIndex=function(e){for(var t=[],i=[],r=1;r<e.times.length;r++){var s=this._timestampBase+Math.floor(1e3*e.times[r]);t.push(s),i.push(e.filepositions[r])}return{times:t,filepositions:i}},e.prototype._parseAudioData=function(e,t,i,r){if(i<=1)n.a.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");else if(!0!==this._hasAudioFlagOverrided||!1!==this._hasAudio){this._littleEndian;var s=new DataView(e,t,i).getUint8(0),a=s>>>4;if(2===a||10===a){var o=0,l=(12&s)>>>2;if(l>=0&&l<=4){o=this._flvSoundRateTable[l];var d=1&s,c=this._audioMetadata,h=this._audioTrack;if(c||(!1===this._hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(c=this._audioMetadata={}).type="audio",c.id=h.id,c.timescale=this._timescale,c.duration=this._duration,c.audioSampleRate=o,c.channelCount=0===d?1:2),10===a){var u=this._parseAACAudioData(e,t+1,i-1);if(null==u)return;if(0===u.packetType){if(c.config){if(T(u.data.config,c.config))return;n.a.w(this.TAG,"AudioSpecificConfig has been changed, re-generate initialization segment")}var f=u.data;c.audioSampleRate=f.samplingRate,c.channelCount=f.channelCount,c.codec=f.codec,c.originalCodec=f.originalCodec,c.config=f.config,c.refSampleDuration=1024/c.audioSampleRate*c.timescale,n.a.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",c),(y=this._mediaInfo).audioCodec=c.originalCodec,y.audioSampleRate=c.audioSampleRate,y.audioChannelCount=c.channelCount,y.hasVideo?null!=y.videoCodec&&(y.mimeType='video/x-flv; codecs="'+y.videoCodec+","+y.audioCodec+'"'):y.mimeType='video/x-flv; codecs="'+y.audioCodec+'"',y.isComplete()&&this._onMediaInfo(y)}else if(1===u.packetType){var p=this._timestampBase+r,m={unit:u.data,length:u.data.byteLength,dts:p,pts:p};h.samples.push(m),h.length+=u.data.length}else n.a.e(this.TAG,"Flv: Unsupported AAC data type "+u.packetType)}else if(2===a){if(!c.codec){var y;if(null==(f=this._parseMP3AudioData(e,t+1,i-1,!0)))return;c.audioSampleRate=f.samplingRate,c.channelCount=f.channelCount,c.codec=f.codec,c.originalCodec=f.originalCodec,c.refSampleDuration=1152/c.audioSampleRate*c.timescale,n.a.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",c),(y=this._mediaInfo).audioCodec=c.codec,y.audioSampleRate=c.audioSampleRate,y.audioChannelCount=c.channelCount,y.audioDataRate=f.bitRate,y.hasVideo?null!=y.videoCodec&&(y.mimeType='video/x-flv; codecs="'+y.videoCodec+","+y.audioCodec+'"'):y.mimeType='video/x-flv; codecs="'+y.audioCodec+'"',y.isComplete()&&this._onMediaInfo(y)}var v=this._parseMP3AudioData(e,t+1,i-1,!1);if(null==v)return;p=this._timestampBase+r;var _={unit:v,length:v.byteLength,dts:p,pts:p};h.samples.push(_),h.length+=v.length}}else this._onError(g.a.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+l)}else this._onError(g.a.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+a)}},e.prototype._parseAACAudioData=function(e,t,i){if(!(i<=1)){var r={},s=new Uint8Array(e,t,i);return r.packetType=s[0],0===s[0]?r.data=this._parseAACAudioSpecificConfig(e,t+1,i-1):r.data=s.subarray(1),r}n.a.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")},e.prototype._parseAACAudioSpecificConfig=function(e,t,i){var r,s,n=new Uint8Array(e,t,i),a=null,o=0,l=null;if(o=r=n[0]>>>3,(s=(7&n[0])<<1|n[1]>>>7)<0||s>=this._mpegSamplingRates.length)this._onError(g.a.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");else{var d=this._mpegSamplingRates[s],c=(120&n[1])>>>3;if(!(c<0||c>=8)){5===o&&(l=(7&n[1])<<1|n[2]>>>7,n[2]);var h=self.navigator.userAgent.toLowerCase();return-1!==h.indexOf("firefox")?s>=6?(o=5,a=new Array(4),l=s-3):(o=2,a=new Array(2),l=s):-1!==h.indexOf("android")?(o=2,a=new Array(2),l=s):(o=5,l=s,a=new Array(4),s>=6?l=s-3:1===c&&(o=2,a=new Array(2),l=s)),a[0]=o<<3,a[0]|=(15&s)>>>1,a[1]=(15&s)<<7,a[1]|=(15&c)<<3,5===o&&(a[1]|=(15&l)>>>1,a[2]=(1&l)<<7,a[2]|=8,a[3]=0),{config:a,samplingRate:d,channelCount:c,codec:"mp4a.40."+o,originalCodec:"mp4a.40."+r}}this._onError(g.a.FORMAT_ERROR,"Flv: AAC invalid channel configuration")}},e.prototype._parseMP3AudioData=function(e,t,i,r){if(!(i<4)){this._littleEndian;var s=new Uint8Array(e,t,i),a=null;if(r){if(255!==s[0])return;var o=s[1]>>>3&3,l=(6&s[1])>>1,d=(240&s[2])>>>4,c=(12&s[2])>>>2,h=3&~(s[3]>>>6)?2:1,u=0,f=0;switch(o){case 0:u=this._mpegAudioV25SampleRateTable[c];break;case 2:u=this._mpegAudioV20SampleRateTable[c];break;case 3:u=this._mpegAudioV10SampleRateTable[c]}switch(l){case 1:d<this._mpegAudioL3BitRateTable.length&&(f=this._mpegAudioL3BitRateTable[d]);break;case 2:d<this._mpegAudioL2BitRateTable.length&&(f=this._mpegAudioL2BitRateTable[d]);break;case 3:d<this._mpegAudioL1BitRateTable.length&&(f=this._mpegAudioL1BitRateTable[d])}a={bitRate:f,samplingRate:u,channelCount:h,codec:"mp3",originalCodec:"mp3"}}else a=s;return a}n.a.w(this.TAG,"Flv: Invalid MP3 packet, header missing!")},e.prototype._parseVideoData=function(e,t,i,r,s){if(i<=1)n.a.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");else if(!0!==this._hasVideoFlagOverrided||!1!==this._hasVideo){var a=new Uint8Array(e,t,i)[0],o=(240&a)>>>4,l=15&a;if(7===l)this._parseAVCVideoPacket(e,t+1,i-1,r,s,o);else{if(12!==l)return void this._onError(g.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+l);this._parseHEVCVideoPacket(e,t+1,i-1,r,s,o)}}},e.prototype._parseAVCVideoPacket=function(e,t,i,r,s,a){if(i<4)n.a.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var o=this._littleEndian,l=new DataView(e,t,i),d=l.getUint8(0),c=(16777215&l.getUint32(0,!o))<<8>>8;if(0===d)this._parseAVCDecoderConfigurationRecord(e,t+4,i-4);else if(1===d)this._parseAVCVideoData(e,t+4,i-4,r,s,a,c);else if(2!==d)return void this._onError(g.a.FORMAT_ERROR,"Flv: Invalid video packet type "+d)}},e.prototype._parseHEVCVideoPacket=function(e,t,i,r,s,a){if(i<4)n.a.w(this.TAG,"Flv: Invalid HEVC packet, missing HEVCPacketType or/and CompositionTime");else{var o=this._littleEndian,l=new DataView(e,t,i),d=l.getUint8(0),c=(16777215&l.getUint32(0,!o))<<8>>8;if(0===d)this._parseHEVCDecoderConfigurationRecord(e,t+4,i-4);else if(1===d)this._parseHEVCVideoData(e,t+4,i-4,r,s,a,c);else if(2!==d)return void this._onError(g.a.FORMAT_ERROR,"Flv: Invalid video packet type "+d)}},e.prototype._parseAVCDecoderConfigurationRecord=function(e,t,i){if(i<7)n.a.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var r=this._videoMetadata,s=this._videoTrack,a=this._littleEndian,o=new DataView(e,t,i);if(r){if(void 0!==r.avcc){var l=new Uint8Array(e,t,i);if(T(l,r.avcc))return;n.a.w(this.TAG,"AVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(r=this._videoMetadata={}).type="video",r.id=s.id,r.timescale=this._timescale,r.duration=this._duration;var d=o.getUint8(0),c=o.getUint8(1);if(o.getUint8(2),o.getUint8(3),1===d&&0!==c)if(this._naluLengthSize=1+(3&o.getUint8(4)),3===this._naluLengthSize||4===this._naluLengthSize){var h=31&o.getUint8(5);if(0!==h){h>1&&n.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+h);for(var u=6,f=0;f<h;f++){var p=o.getUint16(u,!a);if(u+=2,0!==p){var y=new Uint8Array(e,t+u,p);u+=p;var v=m.parseSPS(y);if(0===f){r.codecWidth=v.codec_size.width,r.codecHeight=v.codec_size.height,r.presentWidth=v.present_size.width,r.presentHeight=v.present_size.height,r.profile=v.profile_string,r.level=v.level_string,r.bitDepth=v.bit_depth,r.chromaFormat=v.chroma_format,r.sarRatio=v.sar_ratio,r.frameRate=v.frame_rate,!1!==v.frame_rate.fixed&&0!==v.frame_rate.fps_num&&0!==v.frame_rate.fps_den||(r.frameRate=this._referenceFrameRate);var _=r.frameRate.fps_den,E=r.frameRate.fps_num;r.refSampleDuration=r.timescale*(_/E);for(var b=y.subarray(1,4),S="avc1.",A=0;A<3;A++){var w=b[A].toString(16);w.length<2&&(w="0"+w),S+=w}r.codec=S;var L=this._mediaInfo;L.width=r.codecWidth,L.height=r.codecHeight,L.fps=r.frameRate.fps,L.profile=r.profile,L.level=r.level,L.refFrames=v.ref_frames,L.chromaFormat=v.chroma_format_string,L.sarNum=r.sarRatio.width,L.sarDen=r.sarRatio.height,L.videoCodec=S,L.hasAudio?null!=L.audioCodec&&(L.mimeType='video/x-flv; codecs="'+L.videoCodec+","+L.audioCodec+'"'):L.mimeType='video/x-flv; codecs="'+L.videoCodec+'"',L.isComplete()&&this._onMediaInfo(L)}}}var I=o.getUint8(u);if(0!==I){for(I>1&&n.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+I),u++,f=0;f<I;f++)p=o.getUint16(u,!a),u+=2,0!==p&&(u+=p);r.avcc=new Uint8Array(i),r.avcc.set(new Uint8Array(e,t,i),0),n.a.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",r)}else this._onError(g.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS")}else this._onError(g.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS")}else this._onError(g.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(g.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord")}},e.prototype._parseHEVCDecoderConfigurationRecord=function(e,t,i){if(i<22)n.a.w(this.TAG,"Flv: Invalid HEVCDecoderConfigurationRecord, lack of data!");else{var r=this._videoMetadata,s=this._videoTrack,a=this._littleEndian,o=new DataView(e,t,i);if(r){if(void 0!==r.hvcc){var l=new Uint8Array(e,t,i);if(T(l,r.hvcc))return;n.a.w(this.TAG,"HEVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(r=this._videoMetadata={}).type="video",r.id=s.id,r.timescale=this._timescale,r.duration=this._duration;var d=o.getUint8(0),c=31&o.getUint8(1);if(1===d&&0!==c)if(this._naluLengthSize=1+(3&o.getUint8(21)),3===this._naluLengthSize||4===this._naluLengthSize){for(var h=o.getUint8(22),u=0,f=23;u<h;u++){var p=63&o.getUint8(f+0),m=o.getUint16(f+1,!a);f+=3;for(var v=0;v<m;v++){var _=o.getUint16(f+0,!a);if(0===v)if(33===p){f+=2;var E=new Uint8Array(e,t+f,_),b=y.parseSPS(E);r.codecWidth=b.codec_size.width,r.codecHeight=b.codec_size.height,r.presentWidth=b.present_size.width,r.presentHeight=b.present_size.height,r.profile=b.profile_string,r.level=b.level_string,r.bitDepth=b.bit_depth,r.chromaFormat=b.chroma_format,r.sarRatio=b.sar_ratio,r.frameRate=b.frame_rate,!1!==b.frame_rate.fixed&&0!==b.frame_rate.fps_num&&0!==b.frame_rate.fps_den||(r.frameRate=this._referenceFrameRate);var S=r.frameRate.fps_den,A=r.frameRate.fps_num;r.refSampleDuration=r.timescale*(S/A),r.codec=b.codec_mimetype;var w=this._mediaInfo;w.width=r.codecWidth,w.height=r.codecHeight,w.fps=r.frameRate.fps,w.profile=r.profile,w.level=r.level,w.refFrames=b.ref_frames,w.chromaFormat=b.chroma_format_string,w.sarNum=r.sarRatio.width,w.sarDen=r.sarRatio.height,w.videoCodec=b.codec_mimetype,w.hasAudio?null!=w.audioCodec&&(w.mimeType='video/x-flv; codecs="'+w.videoCodec+","+w.audioCodec+'"'):w.mimeType='video/x-flv; codecs="'+w.videoCodec+'"',w.isComplete()&&this._onMediaInfo(w),f+=_}else f+=2+_;else f+=2+_}}r.hvcc=new Uint8Array(i),r.hvcc.set(new Uint8Array(e,t,i),0),n.a.v(this.TAG,"Parsed HEVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",r)}else this._onError(g.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(g.a.FORMAT_ERROR,"Flv: Invalid HEVCDecoderConfigurationRecord")}},e.prototype._parseAVCVideoData=function(e,t,i,r,s,a,o){for(var l=this._littleEndian,d=new DataView(e,t,i),c=[],h=0,u=0,f=this._naluLengthSize,p=this._timestampBase+r,m=1===a;u<i;){if(u+4>=i){n.a.w(this.TAG,"Malformed Nalu near timestamp "+p+", offset = "+u+", dataSize = "+i);break}var g=d.getUint32(u,!l);if(3===f&&(g>>>=8),g>i-f)return void n.a.w(this.TAG,"Malformed Nalus near timestamp "+p+", NaluSize > DataSize!");var y=31&d.getUint8(u+f);5===y&&(m=!0);var v=new Uint8Array(e,t+u,f+g),_={type:y,data:v};c.push(_),h+=v.byteLength,u+=f+g}if(c.length){var E=this._videoTrack,b={units:c,length:h,isKeyframe:m,dts:p,cts:o,pts:p+o};m&&(b.fileposition=s),E.samples.push(b),E.length+=h}},e.prototype._parseHEVCVideoData=function(e,t,i,r,s,a,o){for(var l=this._littleEndian,d=new DataView(e,t,i),c=[],h=0,u=0,f=this._naluLengthSize,p=this._timestampBase+r,m=1===a;u<i;){if(u+4>=i){n.a.w(this.TAG,"Malformed Nalu near timestamp "+p+", offset = "+u+", dataSize = "+i);break}var g=d.getUint32(u,!l);if(3===f&&(g>>>=8),g>i-f)return void n.a.w(this.TAG,"Malformed Nalus near timestamp "+p+", NaluSize > DataSize!");var y=31&d.getUint8(u+f);19!==y&&20!==y||(m=!0);var v=new Uint8Array(e,t+u,f+g),_={type:y,data:v};c.push(_),h+=v.byteLength,u+=f+g}if(c.length){var E=this._videoTrack,b={units:c,length:h,isKeyframe:m,dts:p,cts:o,pts:p+o};m&&(b.fileposition=s),E.samples.push(b),E.length+=h}},e}(),w=function(){function e(){}return e.prototype.destroy=function(){this.onError=null,this.onMediaInfo=null,this.onMetaDataArrived=null,this.onTrackMetadata=null,this.onDataAvailable=null,this.onTimedID3Metadata=null,this.onSMPTE2038Metadata=null,this.onSCTE35Metadata=null,this.onPESPrivateData=null,this.onPESPrivateDataDescriptor=null},e}(),L=function(){this.program_pmt_pid={}};(S=b||(b={}))[S.kMPEG1Audio=3]="kMPEG1Audio",S[S.kMPEG2Audio=4]="kMPEG2Audio",S[S.kPESPrivateData=6]="kPESPrivateData",S[S.kADTSAAC=15]="kADTSAAC",S[S.kID3=21]="kID3",S[S.kSCTE35=134]="kSCTE35",S[S.kH264=27]="kH264",S[S.kH265=36]="kH265";var I,R=function(){this.pid_stream_type={},this.common_pids={h264:void 0,h265:void 0,adts_aac:void 0,mp3:void 0},this.pes_private_data_pids={},this.timed_id3_pids={},this.scte_35_pids={},this.smpte2038_pids={}},D=function(){},k=function(){},x=function(){this.slices=[],this.total_length=0,this.expected_length=0,this.file_position=0};!function(e){e[e.kUnspecified=0]="kUnspecified",e[e.kSliceNonIDR=1]="kSliceNonIDR",e[e.kSliceDPA=2]="kSliceDPA",e[e.kSliceDPB=3]="kSliceDPB",e[e.kSliceDPC=4]="kSliceDPC",e[e.kSliceIDR=5]="kSliceIDR",e[e.kSliceSEI=6]="kSliceSEI",e[e.kSliceSPS=7]="kSliceSPS",e[e.kSlicePPS=8]="kSlicePPS",e[e.kSliceAUD=9]="kSliceAUD",e[e.kEndOfSequence=10]="kEndOfSequence",e[e.kEndOfStream=11]="kEndOfStream",e[e.kFiller=12]="kFiller",e[e.kSPSExt=13]="kSPSExt",e[e.kReserved0=14]="kReserved0"}(I||(I={}));var C,M,P=function(){},O=function(e){var t=e.data.byteLength;this.type=e.type,this.data=new Uint8Array(4+t),new DataView(this.data.buffer).setUint32(0,t),this.data.set(e.data,4)},N=function(){function e(e){this.TAG="H264AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=e,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&n.a.e(this.TAG,"Could not find H264 startcode until payload end!")}return e.prototype.findNextStartCodeOffset=function(e){for(var t=e,i=this.data_;;){if(t+3>=i.byteLength)return this.eof_flag_=!0,i.byteLength;var r=i[t+0]<<24|i[t+1]<<16|i[t+2]<<8|i[t+3],s=i[t+0]<<16|i[t+1]<<8|i[t+2];if(1===r||1===s)return t;t++}},e.prototype.readNextNaluPayload=function(){for(var e=this.data_,t=null;null==t&&!this.eof_flag_;){var i=this.current_startcode_offset_,r=31&e[i+=1==(e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3])?4:3],s=(128&e[i])>>>7,n=this.findNextStartCodeOffset(i);if(this.current_startcode_offset_=n,!(r>=I.kReserved0)&&0===s){var a=e.subarray(i,n);(t=new P).type=r,t.data=a}}return t},e}(),F=function(){function e(e,t,i){var r=8+e.byteLength+1+2+t.byteLength,s=!1;66!==e[3]&&77!==e[3]&&88!==e[3]&&(s=!0,r+=4);var n=this.data=new Uint8Array(r);n[0]=1,n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=255,n[5]=225;var a=e.byteLength;n[6]=a>>>8,n[7]=255&a;var o=8;n.set(e,8),n[o+=a]=1;var l=t.byteLength;n[o+1]=l>>>8,n[o+2]=255&l,n.set(t,o+3),o+=3+l,s&&(n[o]=252|i.chroma_format_idc,n[o+1]=248|i.bit_depth_luma-8,n[o+2]=248|i.bit_depth_chroma-8,n[o+3]=0,o+=4)}return e.prototype.getData=function(){return this.data},e}();!function(e){e[e.kNull=0]="kNull",e[e.kAACMain=1]="kAACMain",e[e.kAAC_LC=2]="kAAC_LC",e[e.kAAC_SSR=3]="kAAC_SSR",e[e.kAAC_LTP=4]="kAAC_LTP",e[e.kAAC_SBR=5]="kAAC_SBR",e[e.kAAC_Scalable=6]="kAAC_Scalable",e[e.kLayer1=32]="kLayer1",e[e.kLayer2=33]="kLayer2",e[e.kLayer3=34]="kLayer3"}(C||(C={})),function(e){e[e.k96000Hz=0]="k96000Hz",e[e.k88200Hz=1]="k88200Hz",e[e.k64000Hz=2]="k64000Hz",e[e.k48000Hz=3]="k48000Hz",e[e.k44100Hz=4]="k44100Hz",e[e.k32000Hz=5]="k32000Hz",e[e.k24000Hz=6]="k24000Hz",e[e.k22050Hz=7]="k22050Hz",e[e.k16000Hz=8]="k16000Hz",e[e.k12000Hz=9]="k12000Hz",e[e.k11025Hz=10]="k11025Hz",e[e.k8000Hz=11]="k8000Hz",e[e.k7350Hz=12]="k7350Hz"}(M||(M={}));var B,U=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],j=function(){},G=function(){function e(e){this.TAG="AACADTSParser",this.data_=e,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&n.a.e(this.TAG,"Could not found ADTS syncword until payload end")}return e.prototype.findNextSyncwordOffset=function(e){for(var t=e,i=this.data_;;){if(t+7>=i.byteLength)return this.eof_flag_=!0,i.byteLength;if(4095==(i[t+0]<<8|i[t+1])>>>4)return t;t++}},e.prototype.readNextAACFrame=function(){for(var e=this.data_,t=null;null==t&&!this.eof_flag_;){var i=this.current_syncword_offset_,r=(8&e[i+1])>>>3,s=(6&e[i+1])>>>1,n=1&e[i+1],a=(192&e[i+2])>>>6,o=(60&e[i+2])>>>2,l=(1&e[i+2])<<2|(192&e[i+3])>>>6,d=(3&e[i+3])<<11|e[i+4]<<3|(224&e[i+5])>>>5;if(e[i+6],i+d>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var c=1===n?7:9,h=d-c;i+=c;var u=this.findNextSyncwordOffset(i+h);if(this.current_syncword_offset_=u,(0===r||1===r)&&0===s){var f=e.subarray(i,i+h);(t=new j).audio_object_type=a+1,t.sampling_freq_index=o,t.sampling_frequency=U[o],t.channel_config=l,t.data=f}}return t},e.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},e.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},e}(),z=function(e){var t=null,i=e.audio_object_type,r=e.audio_object_type,s=e.sampling_freq_index,n=e.channel_config,a=0,o=navigator.userAgent.toLowerCase();-1!==o.indexOf("firefox")?s>=6?(r=5,t=new Array(4),a=s-3):(r=2,t=new Array(2),a=s):-1!==o.indexOf("android")?(r=2,t=new Array(2),a=s):(r=5,a=s,t=new Array(4),s>=6?a=s-3:1===n&&(r=2,t=new Array(2),a=s)),t[0]=r<<3,t[0]|=(15&s)>>>1,t[1]=(15&s)<<7,t[1]|=(15&n)<<3,5===r&&(t[1]|=(15&a)>>>1,t[2]=(1&a)<<7,t[2]|=8,t[3]=0),this.config=t,this.sampling_rate=U[s],this.channel_count=n,this.codec_mimetype="mp4a.40."+r,this.original_codec_mimetype="mp4a.40."+i},V=function(){},$=function(){};!function(e){e[e.kSpliceNull=0]="kSpliceNull",e[e.kSpliceSchedule=4]="kSpliceSchedule",e[e.kSpliceInsert=5]="kSpliceInsert",e[e.kTimeSignal=6]="kTimeSignal",e[e.kBandwidthReservation=7]="kBandwidthReservation",e[e.kPrivateCommand=255]="kPrivateCommand"}(B||(B={}));var H,Y=function(e){var t=e.readBool();return t?(e.readBits(6),{time_specified_flag:t,pts_time:4*e.readBits(31)+e.readBits(2)}):(e.readBits(7),{time_specified_flag:t})},K=function(e){var t=e.readBool();return e.readBits(6),{auto_return:t,duration:4*e.readBits(31)+e.readBits(2)}},W=function(e,t){var i=t.readBits(8);return e?{component_tag:i}:{component_tag:i,splice_time:Y(t)}},q=function(e){return{component_tag:e.readBits(8),utc_splice_time:e.readBits(32)}},Q=function(e){var t=e.readBits(32),i=e.readBool();e.readBits(7);var r={splice_event_id:t,splice_event_cancel_indicator:i};if(i)return r;if(r.out_of_network_indicator=e.readBool(),r.program_splice_flag=e.readBool(),r.duration_flag=e.readBool(),e.readBits(5),r.program_splice_flag)r.utc_splice_time=e.readBits(32);else{r.component_count=e.readBits(8),r.components=[];for(var s=0;s<r.component_count;s++)r.components.push(q(e))}return r.duration_flag&&(r.break_duration=K(e)),r.unique_program_id=e.readBits(16),r.avail_num=e.readBits(8),r.avails_expected=e.readBits(8),r},Z=function(e,t,i,r){return{descriptor_tag:e,descriptor_length:t,identifier:i,provider_avail_id:r.readBits(32)}},X=function(e,t,i,r){var s=r.readBits(8),n=r.readBits(3);r.readBits(5);for(var a="",o=0;o<n;o++)a+=String.fromCharCode(r.readBits(8));return{descriptor_tag:e,descriptor_length:t,identifier:i,preroll:s,dtmf_count:n,DTMF_char:a}},J=function(e){var t=e.readBits(8);return e.readBits(7),{component_tag:t,pts_offset:4*e.readBits(31)+e.readBits(2)}},ee=function(e,t,i,r){var s=r.readBits(32),n=r.readBool();r.readBits(7);var a={descriptor_tag:e,descriptor_length:t,identifier:i,segmentation_event_id:s,segmentation_event_cancel_indicator:n};if(n)return a;if(a.program_segmentation_flag=r.readBool(),a.segmentation_duration_flag=r.readBool(),a.delivery_not_restricted_flag=r.readBool(),a.delivery_not_restricted_flag?r.readBits(5):(a.web_delivery_allowed_flag=r.readBool(),a.no_regional_blackout_flag=r.readBool(),a.archive_allowed_flag=r.readBool(),a.device_restrictions=r.readBits(2)),!a.program_segmentation_flag){a.component_count=r.readBits(8),a.components=[];for(var o=0;o<a.component_count;o++)a.components.push(J(r))}a.segmentation_duration_flag&&(a.segmentation_duration=r.readBits(40)),a.segmentation_upid_type=r.readBits(8),a.segmentation_upid_length=r.readBits(8);var l=new Uint8Array(a.segmentation_upid_length);for(o=0;o<a.segmentation_upid_length;o++)l[o]=r.readBits(8);return a.segmentation_upid=l.buffer,a.segmentation_type_id=r.readBits(8),a.segment_num=r.readBits(8),a.segments_expected=r.readBits(8),52!==a.segmentation_type_id&&54!==a.segmentation_type_id&&56!==a.segmentation_type_id&&58!==a.segmentation_type_id||(a.sub_segment_num=r.readBits(8),a.sub_segments_expected=r.readBits(8)),a},te=function(e,t,i,r){return{descriptor_tag:e,descriptor_length:t,identifier:i,TAI_seconds:r.readBits(48),TAI_ns:r.readBits(32),UTC_offset:r.readBits(16)}},ie=function(e){return{component_tag:e.readBits(8),ISO_code:String.fromCharCode(e.readBits(8),e.readBits(8),e.readBits(8)),Bit_Stream_Mode:e.readBits(3),Num_Channels:e.readBits(4),Full_Srvc_Audio:e.readBool()}},re=function(e,t,i,r){for(var s=r.readBits(4),n=[],a=0;a<s;a++)n.push(ie(r));return{descriptor_tag:e,descriptor_length:t,identifier:i,audio_count:s,components:n}},se=function(e){var t=new p(e),i=t.readBits(8),r=t.readBool(),s=t.readBool();t.readBits(2);var n=t.readBits(12),a=t.readBits(8),o=t.readBool(),l=t.readBits(6),d=4*t.readBits(31)+t.readBits(2),c=t.readBits(8),h=t.readBits(12),u=t.readBits(12),f=t.readBits(8),m=null;f===B.kSpliceNull?m={}:f===B.kSpliceSchedule?m=function(e){for(var t=e.readBits(8),i=[],r=0;r<t;r++)i.push(Q(e));return{splice_count:t,events:i}}(t):f===B.kSpliceInsert?m=function(e){var t=e.readBits(32),i=e.readBool();e.readBits(7);var r={splice_event_id:t,splice_event_cancel_indicator:i};if(i)return r;if(r.out_of_network_indicator=e.readBool(),r.program_splice_flag=e.readBool(),r.duration_flag=e.readBool(),r.splice_immediate_flag=e.readBool(),e.readBits(4),r.program_splice_flag&&!r.splice_immediate_flag&&(r.splice_time=Y(e)),!r.program_splice_flag){r.component_count=e.readBits(8),r.components=[];for(var s=0;s<r.component_count;s++)r.components.push(W(r.splice_immediate_flag,e))}return r.duration_flag&&(r.break_duration=K(e)),r.unique_program_id=e.readBits(16),r.avail_num=e.readBits(8),r.avails_expected=e.readBits(8),r}(t):f===B.kTimeSignal?m={splice_time:Y(t)}:f===B.kBandwidthReservation?m={}:f===B.kPrivateCommand?m=function(e,t){for(var i=String.fromCharCode(t.readBits(8),t.readBits(8),t.readBits(8),t.readBits(8)),r=new Uint8Array(e-4),s=0;s<e-4;s++)r[s]=t.readBits(8);return{identifier:i,private_data:r.buffer}}(u,t):t.readBits(8*u);for(var g=[],y=t.readBits(16),v=0;v<y;){var _=t.readBits(8),E=t.readBits(8),b=String.fromCharCode(t.readBits(8),t.readBits(8),t.readBits(8),t.readBits(8));0===_?g.push(Z(_,E,b,t)):1===_?g.push(X(_,E,b,t)):2===_?g.push(ee(_,E,b,t)):3===_?g.push(te(_,E,b,t)):4===_?g.push(re(_,E,b,t)):t.readBits(8*(E-4)),v+=2+E}var S={table_id:i,section_syntax_indicator:r,private_indicator:s,section_length:n,protocol_version:a,encrypted_packet:o,encryption_algorithm:l,pts_adjustment:d,cw_index:c,tier:h,splice_command_length:u,splice_command_type:f,splice_command:m,descriptor_loop_length:y,splice_descriptors:g,E_CRC32:o?t.readBits(32):void 0,CRC32:t.readBits(32)};if(f===B.kSpliceInsert){var T=m;if(T.splice_event_cancel_indicator)return{splice_command_type:f,detail:S,data:e};if(T.program_splice_flag&&!T.splice_immediate_flag){var A=T.duration_flag?T.break_duration.auto_return:void 0,w=T.duration_flag?T.break_duration.duration/90:void 0;return T.splice_time.time_specified_flag?{splice_command_type:f,pts:(d+T.splice_time.pts_time)%Math.pow(2,33),auto_return:A,duraiton:w,detail:S,data:e}:{splice_command_type:f,auto_return:A,duraiton:w,detail:S,data:e}}return{splice_command_type:f,auto_return:A=T.duration_flag?T.break_duration.auto_return:void 0,duraiton:w=T.duration_flag?T.break_duration.duration/90:void 0,detail:S,data:e}}if(f===B.kTimeSignal){var L=m;return L.splice_time.time_specified_flag?{splice_command_type:f,pts:(d+L.splice_time.pts_time)%Math.pow(2,33),detail:S,data:e}:{splice_command_type:f,detail:S,data:e}}return{splice_command_type:f,detail:S,data:e}};!function(e){e[e.kSliceIDR_W_RADL=19]="kSliceIDR_W_RADL",e[e.kSliceIDR_N_LP=20]="kSliceIDR_N_LP",e[e.kSliceCRA_NUT=21]="kSliceCRA_NUT",e[e.kSliceVPS=32]="kSliceVPS",e[e.kSliceSPS=33]="kSliceSPS",e[e.kSlicePPS=34]="kSlicePPS",e[e.kSliceAUD=35]="kSliceAUD"}(H||(H={}));var ne,ae=function(){},oe=function(e){var t=e.data.byteLength;this.type=e.type,this.data=new Uint8Array(4+t),new DataView(this.data.buffer).setUint32(0,t),this.data.set(e.data,4)},le=function(){function e(e){this.TAG="H265AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=e,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&n.a.e(this.TAG,"Could not find H265 startcode until payload end!")}return e.prototype.findNextStartCodeOffset=function(e){for(var t=e,i=this.data_;;){if(t+3>=i.byteLength)return this.eof_flag_=!0,i.byteLength;var r=i[t+0]<<24|i[t+1]<<16|i[t+2]<<8|i[t+3],s=i[t+0]<<16|i[t+1]<<8|i[t+2];if(1===r||1===s)return t;t++}},e.prototype.readNextNaluPayload=function(){for(var e=this.data_,t=null;null==t&&!this.eof_flag_;){var i=this.current_startcode_offset_,r=e[i+=1==(e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3])?4:3]>>1&63,s=(128&e[i])>>>7,n=this.findNextStartCodeOffset(i);if(this.current_startcode_offset_=n,0===s){var a=e.subarray(i,n);(t=new ae).type=r,t.data=a}}return t},e}(),de=function(){function e(e,t,i,r){var s=23+(5+e.byteLength)+(5+t.byteLength)+(5+i.byteLength),n=this.data=new Uint8Array(s);n[0]=1,n[1]=(3&r.general_profile_space)<<6|(r.general_tier_flag?1:0)<<5|31&r.general_profile_idc,n[2]=r.general_profile_compatibility_flags_1,n[3]=r.general_profile_compatibility_flags_2,n[4]=r.general_profile_compatibility_flags_3,n[5]=r.general_profile_compatibility_flags_4,n[6]=r.general_constraint_indicator_flags_1,n[7]=r.general_constraint_indicator_flags_2,n[8]=r.general_constraint_indicator_flags_3,n[9]=r.general_constraint_indicator_flags_4,n[10]=r.general_constraint_indicator_flags_5,n[11]=r.general_constraint_indicator_flags_6,n[12]=60,n[13]=240|(3840&r.min_spatial_segmentation_idc)>>8,n[14]=255&r.min_spatial_segmentation_idc,n[15]=252|3&r.parallelismType,n[16]=252|3&r.chroma_format_idc,n[17]=248|7&r.bit_depth_luma_minus8,n[18]=248|7&r.bit_depth_chroma_minus8,n[19]=0,n[20]=0,n[21]=(3&r.constant_frame_rate)<<6|(7&r.num_temporal_layers)<<3|(r.temporal_id_nested?1:0)<<2|3,n[22]=3,n[23]=128|H.kSliceVPS,n[24]=0,n[25]=1,n[26]=(65280&e.byteLength)>>8,n[27]=255&e.byteLength,n.set(e,28),n[23+(5+e.byteLength)+0]=128|H.kSliceSPS,n[23+(5+e.byteLength)+1]=0,n[23+(5+e.byteLength)+2]=1,n[23+(5+e.byteLength)+3]=(65280&t.byteLength)>>8,n[23+(5+e.byteLength)+4]=255&t.byteLength,n.set(t,23+(5+e.byteLength)+5),n[23+(5+e.byteLength+5+t.byteLength)+0]=128|H.kSlicePPS,n[23+(5+e.byteLength+5+t.byteLength)+1]=0,n[23+(5+e.byteLength+5+t.byteLength)+2]=1,n[23+(5+e.byteLength+5+t.byteLength)+3]=(65280&i.byteLength)>>8,n[23+(5+e.byteLength+5+t.byteLength)+4]=255&i.byteLength,n.set(i,23+(5+e.byteLength+5+t.byteLength)+5)}return e.prototype.getData=function(){return this.data},e}(),ce=function(){},he=function(){},ue=(ne=function(e,t){return(ne=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}ne(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),fe=function(){return(fe=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},pe=function(e){function t(t,i){var r=e.call(this)||this;return r.TAG="TSDemuxer",r.first_parse_=!0,r.media_info_=new o.a,r.timescale_=90,r.duration_=0,r.current_pmt_pid_=-1,r.program_pmt_map_={},r.pes_slice_queues_={},r.section_slice_queues_={},r.video_metadata_={vps:void 0,sps:void 0,pps:void 0,details:void 0},r.audio_metadata_={codec:void 0,audio_object_type:void 0,sampling_freq_index:void 0,sampling_frequency:void 0,channel_config:void 0},r.aac_last_sample_pts_=void 0,r.aac_last_incomplete_data_=null,r.has_video_=!1,r.has_audio_=!1,r.video_init_segment_dispatched_=!1,r.audio_init_segment_dispatched_=!1,r.video_metadata_changed_=!1,r.audio_metadata_changed_=!1,r.video_track_={type:"video",id:1,sequenceNumber:0,samples:[],length:0},r.audio_track_={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},r.ts_packet_size_=t.ts_packet_size,r.sync_offset_=t.sync_offset,r.config_=i,r}return ue(t,e),t.prototype.destroy=function(){this.media_info_=null,this.pes_slice_queues_=null,this.section_slice_queues_=null,this.video_metadata_=null,this.audio_metadata_=null,this.aac_last_incomplete_data_=null,this.video_track_=null,this.audio_track_=null,e.prototype.destroy.call(this)},t.probe=function(e){var t=new Uint8Array(e),i=-1,r=188;if(t.byteLength<=3*r)return{needMoreData:!0};for(;-1===i;){for(var s=Math.min(1e3,t.byteLength-3*r),a=0;a<s;){if(71===t[a]&&71===t[a+r]&&71===t[a+2*r]){i=a;break}a++}if(-1===i)if(188===r)r=192;else{if(192!==r)break;r=204}}return-1===i?{match:!1}:(192===r&&i>=4?(n.a.v("TSDemuxer","ts_packet_size = 192, m2ts mode"),i-=4):204===r&&n.a.v("TSDemuxer","ts_packet_size = 204, RS encoded MPEG2-TS stream"),{match:!0,consumed:0,ts_packet_size:r,sync_offset:i})},t.prototype.bindDataSource=function(e){return e.onDataArrival=this.parseChunks.bind(this),this},t.prototype.resetMediaInfo=function(){this.media_info_=new o.a},t.prototype.parseChunks=function(e,t){if(!(this.onError&&this.onMediaInfo&&this.onTrackMetadata&&this.onDataAvailable))throw new h.a("onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var i=0;for(this.first_parse_&&(this.first_parse_=!1,i=this.sync_offset_);i+this.ts_packet_size_<=e.byteLength;){var r=t+i;192===this.ts_packet_size_&&(i+=4);var s=new Uint8Array(e,i,188),a=s[0];if(71!==a){n.a.e(this.TAG,"sync_byte = "+a+", not 0x47");break}var o=(64&s[1])>>>6,l=(s[1],(31&s[1])<<8|s[2]),d=(48&s[3])>>>4,c=15&s[3],u={},f=4;if(2==d||3==d){var p=s[4];if(5+p===188){i+=188,204===this.ts_packet_size_&&(i+=16);continue}p>0&&(u=this.parseAdaptationField(e,i+4,1+p)),f=5+p}if(1==d||3==d)if(0===l||l===this.current_pmt_pid_||null!=this.pmt_&&this.pmt_.pid_stream_type[l]===b.kSCTE35){var m=188-f;this.handleSectionSlice(e,i+f,m,{pid:l,file_position:r,payload_unit_start_indicator:o,continuity_conunter:c,random_access_indicator:u.random_access_indicator})}else if(null!=this.pmt_&&null!=this.pmt_.pid_stream_type[l]){m=188-f;var g=this.pmt_.pid_stream_type[l];l!==this.pmt_.common_pids.h264&&l!==this.pmt_.common_pids.h265&&l!==this.pmt_.common_pids.adts_aac&&l!==this.pmt_.common_pids.mp3&&!0!==this.pmt_.pes_private_data_pids[l]&&!0!==this.pmt_.timed_id3_pids[l]||this.handlePESSlice(e,i+f,m,{pid:l,stream_type:g,file_position:r,payload_unit_start_indicator:o,continuity_conunter:c,random_access_indicator:u.random_access_indicator})}i+=188,204===this.ts_packet_size_&&(i+=16)}return this.dispatchAudioVideoMediaSegment(),i},t.prototype.parseAdaptationField=function(e,t,i){var r=new Uint8Array(e,t,i),s=r[0];return s>0?s>183?(n.a.w(this.TAG,"Illegal adaptation_field_length: "+s),{}):{discontinuity_indicator:(128&r[1])>>>7,random_access_indicator:(64&r[1])>>>6,elementary_stream_priority_indicator:(32&r[1])>>>5}:{}},t.prototype.handleSectionSlice=function(e,t,i,r){var s=new Uint8Array(e,t,i),n=this.section_slice_queues_[r.pid];if(r.payload_unit_start_indicator){var a=s[0];if(null!=n&&0!==n.total_length){var o=new Uint8Array(e,t+1,Math.min(i,a));n.slices.push(o),n.total_length+=o.byteLength,n.total_length===n.expected_length?this.emitSectionSlices(n,r):this.clearSlices(n,r)}for(var l=1+a;l<s.byteLength&&255!==s[l+0];){var d=(15&s[l+1])<<8|s[l+2];this.section_slice_queues_[r.pid]=new x,(n=this.section_slice_queues_[r.pid]).expected_length=d+3,n.file_position=r.file_position,n.random_access_indicator=r.random_access_indicator,o=new Uint8Array(e,t+l,Math.min(i-l,n.expected_length-n.total_length)),n.slices.push(o),n.total_length+=o.byteLength,n.total_length===n.expected_length?this.emitSectionSlices(n,r):n.total_length>=n.expected_length&&this.clearSlices(n,r),l+=o.byteLength}}else null!=n&&0!==n.total_length&&(o=new Uint8Array(e,t,Math.min(i,n.expected_length-n.total_length)),n.slices.push(o),n.total_length+=o.byteLength,n.total_length===n.expected_length?this.emitSectionSlices(n,r):n.total_length>=n.expected_length&&this.clearSlices(n,r))},t.prototype.handlePESSlice=function(e,t,i,r){var s=new Uint8Array(e,t,i),a=s[0]<<16|s[1]<<8|s[2],o=(s[3],s[4]<<8|s[5]);if(r.payload_unit_start_indicator){if(1!==a)return void n.a.e(this.TAG,"handlePESSlice: packet_start_code_prefix should be 1 but with value "+a);var l=this.pes_slice_queues_[r.pid];l&&(0===l.expected_length||l.expected_length===l.total_length?this.emitPESSlices(l,r):this.clearSlices(l,r)),this.pes_slice_queues_[r.pid]=new x,this.pes_slice_queues_[r.pid].file_position=r.file_position,this.pes_slice_queues_[r.pid].random_access_indicator=r.random_access_indicator}if(null!=this.pes_slice_queues_[r.pid]){var d=this.pes_slice_queues_[r.pid];d.slices.push(s),r.payload_unit_start_indicator&&(d.expected_length=0===o?0:o+6),d.total_length+=s.byteLength,d.expected_length>0&&d.expected_length===d.total_length?this.emitPESSlices(d,r):d.expected_length>0&&d.expected_length<d.total_length&&this.clearSlices(d,r)}},t.prototype.emitSectionSlices=function(e,t){for(var i=new Uint8Array(e.total_length),r=0,s=0;r<e.slices.length;r++){var n=e.slices[r];i.set(n,s),s+=n.byteLength}e.slices=[],e.expected_length=-1,e.total_length=0;var a=new k;a.pid=t.pid,a.data=i,a.file_position=e.file_position,a.random_access_indicator=e.random_access_indicator,this.parseSection(a)},t.prototype.emitPESSlices=function(e,t){for(var i=new Uint8Array(e.total_length),r=0,s=0;r<e.slices.length;r++){var n=e.slices[r];i.set(n,s),s+=n.byteLength}e.slices=[],e.expected_length=-1,e.total_length=0;var a=new D;a.pid=t.pid,a.data=i,a.stream_type=t.stream_type,a.file_position=e.file_position,a.random_access_indicator=e.random_access_indicator,this.parsePES(a)},t.prototype.clearSlices=function(e,t){e.slices=[],e.expected_length=-1,e.total_length=0},t.prototype.parseSection=function(e){var t=e.data,i=e.pid;0===i?this.parsePAT(t):i===this.current_pmt_pid_?this.parsePMT(t):null!=this.pmt_&&this.pmt_.scte_35_pids[i]&&this.parseSCTE35(t)},t.prototype.parsePES=function(e){var t=e.data,i=t[0]<<16|t[1]<<8|t[2],r=t[3],s=t[4]<<8|t[5];if(1===i)if(188!==r&&190!==r&&191!==r&&240!==r&&241!==r&&255!==r&&242!==r&&248!==r){t[6];var a=(192&t[7])>>>6,o=t[8],l=void 0,d=void 0;2!==a&&3!==a||(l=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,d=3===a?536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2:l);var c=9+o,h=void 0;if(0!==s){if(s<3+o)return void n.a.v(this.TAG,"Malformed PES: PES_packet_length < 3 + PES_header_data_length");h=s-3-o}else h=t.byteLength-c;var u=t.subarray(c,c+h);switch(e.stream_type){case b.kMPEG1Audio:case b.kMPEG2Audio:this.parseMP3Payload(u,l);break;case b.kPESPrivateData:this.pmt_.smpte2038_pids[e.pid]?this.parseSMPTE2038MetadataPayload(u,l,d,e.pid,r):this.parsePESPrivateDataPayload(u,l,d,e.pid,r);break;case b.kADTSAAC:this.parseAACPayload(u,l);break;case b.kID3:this.parseTimedID3MetadataPayload(u,l,d,e.pid,r);break;case b.kH264:this.parseH264Payload(u,l,d,e.file_position,e.random_access_indicator);break;case b.kH265:this.parseH265Payload(u,l,d,e.file_position,e.random_access_indicator)}}else 188!==r&&191!==r&&240!==r&&241!==r&&255!==r&&242!==r&&248!==r||e.stream_type!==b.kPESPrivateData||(c=6,h=void 0,h=0!==s?s:t.byteLength-c,u=t.subarray(c,c+h),this.parsePESPrivateDataPayload(u,void 0,void 0,e.pid,r));else n.a.e(this.TAG,"parsePES: packet_start_code_prefix should be 1 but with value "+i)},t.prototype.parsePAT=function(e){var t=e[0];if(0===t){var i=(15&e[1])<<8|e[2],r=(e[3],e[4],(62&e[5])>>>1),s=1&e[5],a=e[6],o=(e[7],null);if(1===s&&0===a)(o=new L).version_number=r;else if(null==(o=this.pat_))return;for(var l=i-5-4,d=-1,c=-1,h=8;h<8+l;h+=4){var u=e[h]<<8|e[h+1],f=(31&e[h+2])<<8|e[h+3];0===u?o.network_pid=f:(o.program_pmt_pid[u]=f,-1===d&&(d=u),-1===c&&(c=f))}1===s&&0===a&&(null==this.pat_&&n.a.v(this.TAG,"Parsed first PAT: "+JSON.stringify(o)),this.pat_=o,this.current_program_=d,this.current_pmt_pid_=c)}else n.a.e(this.TAG,"parsePAT: table_id "+t+" is not corresponded to PAT!")},t.prototype.parsePMT=function(e){var t=e[0];if(2===t){var i=(15&e[1])<<8|e[2],r=e[3]<<8|e[4],s=(62&e[5])>>>1,a=1&e[5],o=e[6],l=(e[7],null);if(1===a&&0===o)(l=new R).program_number=r,l.version_number=s,this.program_pmt_map_[r]=l;else if(null==(l=this.program_pmt_map_[r]))return;e[8],e[9];for(var d=(15&e[10])<<8|e[11],c=12+d,h=i-9-d-4,u=c;u<c+h;){var f=e[u],p=(31&e[u+1])<<8|e[u+2],m=(15&e[u+3])<<8|e[u+4];if(l.pid_stream_type[p]=f,f!==b.kH264||l.common_pids.h264||l.common_pids.h265)if(f!==b.kH265||l.common_pids.h264||l.common_pids.h265)if(f!==b.kADTSAAC||l.common_pids.adts_aac)if(f!==b.kMPEG1Audio&&f!==b.kMPEG2Audio||l.common_pids.mp3)if(f===b.kPESPrivateData){if(l.pes_private_data_pids[p]=!0,m>0){for(var g=u+5;g<u+5+m;){var y=e[g+0],v=e[g+1];5===y&&"VANC"===String.fromCharCode.apply(String,Array.from(e.subarray(g+2,g+2+v)))&&(l.smpte2038_pids[p]=!0),g+=2+v}var _=e.subarray(u+5,u+5+m);this.dispatchPESPrivateDataDescriptor(p,f,_)}}else f===b.kID3?l.timed_id3_pids[p]=!0:f===b.kSCTE35&&(l.scte_35_pids[p]=!0);else l.common_pids.mp3=p;else l.common_pids.adts_aac=p;else l.common_pids.h265=p;else l.common_pids.h264=p;u+=5+m}r===this.current_program_&&(null==this.pmt_&&n.a.v(this.TAG,"Parsed first PMT: "+JSON.stringify(l)),this.pmt_=l,(l.common_pids.h264||l.common_pids.h265)&&(this.has_video_=!0),(l.common_pids.adts_aac||l.common_pids.mp3)&&(this.has_audio_=!0))}else n.a.e(this.TAG,"parsePMT: table_id "+t+" is not corresponded to PMT!")},t.prototype.parseSCTE35=function(e){var t=se(e);if(null!=t.pts){var i=Math.floor(t.pts/this.timescale_);t.pts=i}else t.nearest_pts=this.aac_last_sample_pts_;this.onSCTE35Metadata&&this.onSCTE35Metadata(t)},t.prototype.parseH264Payload=function(e,t,i,r,s){for(var a=new N(e),o=null,l=[],d=0,c=!1;null!=(o=a.readNextNaluPayload());){var h=new O(o);if(h.type===I.kSliceSPS){var u=m.parseSPS(o.data);this.video_init_segment_dispatched_?!0===this.detectVideoMetadataChange(h,u)&&(n.a.v(this.TAG,"H264: Critical h264 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:h,pps:void 0,details:u}):(this.video_metadata_.sps=h,this.video_metadata_.details=u)}else h.type===I.kSlicePPS?this.video_init_segment_dispatched_&&!this.video_metadata_changed_||(this.video_metadata_.pps=h,this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):(h.type===I.kSliceIDR||h.type===I.kSliceNonIDR&&1===s)&&(c=!0);this.video_init_segment_dispatched_&&(l.push(h),d+=h.data.byteLength)}var f=Math.floor(t/this.timescale_),p=Math.floor(i/this.timescale_);if(l.length){var g=this.video_track_,y={units:l,length:d,isKeyframe:c,dts:p,pts:f,cts:f-p,file_position:r};g.samples.push(y),g.length+=d}},t.prototype.parseH265Payload=function(e,t,i,r,s){for(var a=new le(e),o=null,l=[],d=0,c=!1;null!=(o=a.readNextNaluPayload());){var h=new oe(o);if(h.type===H.kSliceVPS){if(!this.video_init_segment_dispatched_){var u=y.parseVPS(o.data);this.video_metadata_.vps=h,this.video_metadata_.details=fe(fe({},this.video_metadata_.details),u)}}else h.type===H.kSliceSPS?(u=y.parseSPS(o.data),this.video_init_segment_dispatched_?!0===this.detectVideoMetadataChange(h,u)&&(n.a.v(this.TAG,"H265: Critical h265 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:h,pps:void 0,details:u}):(this.video_metadata_.sps=h,this.video_metadata_.details=fe(fe({},this.video_metadata_.details),u))):h.type===H.kSlicePPS?this.video_init_segment_dispatched_&&!this.video_metadata_changed_||(u=y.parsePPS(o.data),this.video_metadata_.pps=h,this.video_metadata_.details=fe(fe({},this.video_metadata_.details),u),this.video_metadata_.vps&&this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):h.type!==H.kSliceIDR_W_RADL&&h.type!==H.kSliceIDR_N_LP&&h.type!==H.kSliceCRA_NUT||(c=!0);this.video_init_segment_dispatched_&&(l.push(h),d+=h.data.byteLength)}var f=Math.floor(t/this.timescale_),p=Math.floor(i/this.timescale_);if(l.length){var m=this.video_track_,g={units:l,length:d,isKeyframe:c,dts:p,pts:f,cts:f-p,file_position:r};m.samples.push(g),m.length+=d}},t.prototype.detectVideoMetadataChange=function(e,t){if(t.codec_mimetype!==this.video_metadata_.details.codec_mimetype)return n.a.v(this.TAG,"Video: Codec mimeType changed from "+this.video_metadata_.details.codec_mimetype+" to "+t.codec_mimetype),!0;if(t.codec_size.width!==this.video_metadata_.details.codec_size.width||t.codec_size.height!==this.video_metadata_.details.codec_size.height){var i=this.video_metadata_.details.codec_size,r=t.codec_size;return n.a.v(this.TAG,"Video: Coded Resolution changed from "+i.width+"x"+i.height+" to "+r.width+"x"+r.height),!0}return t.present_size.width!==this.video_metadata_.details.present_size.width&&(n.a.v(this.TAG,"Video: Present resolution width changed from "+this.video_metadata_.details.present_size.width+" to "+t.present_size.width),!0)},t.prototype.isInitSegmentDispatched=function(){return this.has_video_&&this.has_audio_?this.video_init_segment_dispatched_&&this.audio_init_segment_dispatched_:this.has_video_&&!this.has_audio_?this.video_init_segment_dispatched_:!(this.has_video_||!this.has_audio_)&&this.audio_init_segment_dispatched_},t.prototype.dispatchVideoInitSegment=function(){var e=this.video_metadata_.details,t={type:"video"};t.id=this.video_track_.id,t.timescale=1e3,t.duration=this.duration_,t.codecWidth=e.codec_size.width,t.codecHeight=e.codec_size.height,t.presentWidth=e.present_size.width,t.presentHeight=e.present_size.height,t.profile=e.profile_string,t.level=e.level_string,t.bitDepth=e.bit_depth,t.chromaFormat=e.chroma_format,t.sarRatio=e.sar_ratio,t.frameRate=e.frame_rate;var i=t.frameRate.fps_den,r=t.frameRate.fps_num;if(t.refSampleDuration=i/r*1e3,t.codec=e.codec_mimetype,this.video_metadata_.vps){var s=this.video_metadata_.vps.data.subarray(4),a=this.video_metadata_.sps.data.subarray(4),o=this.video_metadata_.pps.data.subarray(4),l=new de(s,a,o,e);t.hvcc=l.getData(),0==this.video_init_segment_dispatched_&&n.a.v(this.TAG,"Generated first HEVCDecoderConfigurationRecord for mimeType: "+t.codec)}else{a=this.video_metadata_.sps.data.subarray(4),o=this.video_metadata_.pps.data.subarray(4);var d=new F(a,o,e);t.avcc=d.getData(),0==this.video_init_segment_dispatched_&&n.a.v(this.TAG,"Generated first AVCDecoderConfigurationRecord for mimeType: "+t.codec)}this.onTrackMetadata("video",t),this.video_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var c=this.media_info_;c.hasVideo=!0,c.width=t.codecWidth,c.height=t.codecHeight,c.fps=t.frameRate.fps,c.profile=t.profile,c.level=t.level,c.refFrames=e.ref_frames,c.chromaFormat=e.chroma_format_string,c.sarNum=t.sarRatio.width,c.sarDen=t.sarRatio.height,c.videoCodec=t.codec,c.hasAudio&&c.audioCodec?c.mimeType='video/mp2t; codecs="'+c.videoCodec+","+c.audioCodec+'"':c.mimeType='video/mp2t; codecs="'+c.videoCodec+'"',c.isComplete()&&this.onMediaInfo(c)},t.prototype.dispatchVideoMediaSegment=function(){this.isInitSegmentDispatched()&&this.video_track_.length&&this.onDataAvailable(null,this.video_track_)},t.prototype.dispatchAudioMediaSegment=function(){this.isInitSegmentDispatched()&&this.audio_track_.length&&this.onDataAvailable(this.audio_track_,null)},t.prototype.dispatchAudioVideoMediaSegment=function(){this.isInitSegmentDispatched()&&(this.audio_track_.length||this.video_track_.length)&&this.onDataAvailable(this.audio_track_,this.video_track_)},t.prototype.parseAACPayload=function(e,t){if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var i=new Uint8Array(e.byteLength+this.aac_last_incomplete_data_.byteLength);i.set(this.aac_last_incomplete_data_,0),i.set(e,this.aac_last_incomplete_data_.byteLength),e=i}var r,s;if(null!=t&&(s=t/this.timescale_),"aac"===this.audio_metadata_.codec){if(null==t&&null!=this.aac_last_sample_pts_)r=1024/this.audio_metadata_.sampling_frequency*1e3,s=this.aac_last_sample_pts_+r;else if(null==t)return void n.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.aac_last_sample_pts_){r=1024/this.audio_metadata_.sampling_frequency*1e3;var a=this.aac_last_sample_pts_+r;Math.abs(a-s)>1&&(n.a.w(this.TAG,"AAC: Detected pts overlapped, expected: "+a+"ms, PES pts: "+s+"ms"),s=a)}}for(var o,l=new G(e),d=null,c=s;null!=(d=l.readNextAACFrame());){r=1024/d.sampling_frequency*1e3;var h={codec:"aac",data:d};0==this.audio_init_segment_dispatched_?(this.audio_metadata_={codec:"aac",audio_object_type:d.audio_object_type,sampling_freq_index:d.sampling_freq_index,sampling_frequency:d.sampling_frequency,channel_config:d.channel_config},this.dispatchAudioInitSegment(h)):this.detectAudioMetadataChange(h)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(h)),o=c;var u=Math.floor(c),f={unit:d.data,length:d.data.byteLength,pts:u,dts:u};this.audio_track_.samples.push(f),this.audio_track_.length+=d.data.byteLength,c+=r}l.hasIncompleteData()&&(this.aac_last_incomplete_data_=l.getIncompleteData()),o&&(this.aac_last_sample_pts_=o)}},t.prototype.parseMP3Payload=function(e,t){if(!this.has_video_||this.video_init_segment_dispatched_){var i=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],r=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],s=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],n=e[1]>>>3&3,a=(6&e[1])>>1,o=(240&e[2])>>>4,l=(12&e[2])>>>2,d=3&~(e[3]>>>6)?2:1,c=0,h=34;switch(n){case 0:c=[11025,12e3,8e3,0][l];break;case 2:c=[22050,24e3,16e3,0][l];break;case 3:c=[44100,48e3,32e3,0][l]}switch(a){case 1:h=34,o<s.length&&s[o];break;case 2:h=33,o<r.length&&r[o];break;case 3:h=32,o<i.length&&i[o]}var u=new he;u.object_type=h,u.sample_rate=c,u.channel_count=d,u.data=e;var f={codec:"mp3",data:u};0==this.audio_init_segment_dispatched_?(this.audio_metadata_={codec:"mp3",object_type:h,sample_rate:c,channel_count:d},this.dispatchAudioInitSegment(f)):this.detectAudioMetadataChange(f)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(f));var p={unit:e,length:e.byteLength,pts:t/this.timescale_,dts:t/this.timescale_};this.audio_track_.samples.push(p),this.audio_track_.length+=e.byteLength}},t.prototype.detectAudioMetadataChange=function(e){if(e.codec!==this.audio_metadata_.codec)return n.a.v(this.TAG,"Audio: Audio Codecs changed from "+this.audio_metadata_.codec+" to "+e.codec),!0;if("aac"===e.codec&&"aac"===this.audio_metadata_.codec){var t=e.data;if(t.audio_object_type!==this.audio_metadata_.audio_object_type)return n.a.v(this.TAG,"AAC: AudioObjectType changed from "+this.audio_metadata_.audio_object_type+" to "+t.audio_object_type),!0;if(t.sampling_freq_index!==this.audio_metadata_.sampling_freq_index)return n.a.v(this.TAG,"AAC: SamplingFrequencyIndex changed from "+this.audio_metadata_.sampling_freq_index+" to "+t.sampling_freq_index),!0;if(t.channel_config!==this.audio_metadata_.channel_config)return n.a.v(this.TAG,"AAC: Channel configuration changed from "+this.audio_metadata_.channel_config+" to "+t.channel_config),!0}else if("mp3"===e.codec&&"mp3"===this.audio_metadata_.codec){var i=e.data;if(i.object_type!==this.audio_metadata_.object_type)return n.a.v(this.TAG,"MP3: AudioObjectType changed from "+this.audio_metadata_.object_type+" to "+i.object_type),!0;if(i.sample_rate!==this.audio_metadata_.sample_rate)return n.a.v(this.TAG,"MP3: SamplingFrequencyIndex changed from "+this.audio_metadata_.sample_rate+" to "+i.sample_rate),!0;if(i.channel_count!==this.audio_metadata_.channel_count)return n.a.v(this.TAG,"MP3: Channel count changed from "+this.audio_metadata_.channel_count+" to "+i.channel_count),!0}return!1},t.prototype.dispatchAudioInitSegment=function(e){var t={type:"audio"};if(t.id=this.audio_track_.id,t.timescale=1e3,t.duration=this.duration_,"aac"===this.audio_metadata_.codec){var i=e.data,r=new z(i);t.audioSampleRate=r.sampling_rate,t.channelCount=r.channel_count,t.codec=r.codec_mimetype,t.originalCodec=r.original_codec_mimetype,t.config=r.config}else"mp3"===this.audio_metadata_.codec&&(t.audioSampleRate=this.audio_metadata_.sample_rate,t.channelCount=this.audio_metadata_.channel_count,t.codec="mp3",t.originalCodec="mp3",t.config=void 0);t.refSampleDuration=1024/t.audioSampleRate*t.timescale,0==this.audio_init_segment_dispatched_&&n.a.v(this.TAG,"Generated first AudioSpecificConfig for mimeType: "+t.codec),this.onTrackMetadata("audio",t),this.audio_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var s=this.media_info_;s.hasAudio=!0,s.audioCodec=t.originalCodec,s.audioSampleRate=t.audioSampleRate,s.audioChannelCount=t.channelCount,s.hasVideo&&s.videoCodec?s.mimeType='video/mp2t; codecs="'+s.videoCodec+","+s.audioCodec+'"':s.mimeType='video/mp2t; codecs="'+s.audioCodec+'"',s.isComplete()&&this.onMediaInfo(s)},t.prototype.dispatchPESPrivateDataDescriptor=function(e,t,i){var r=new $;r.pid=e,r.stream_type=t,r.descriptor=i,this.onPESPrivateDataDescriptor&&this.onPESPrivateDataDescriptor(r)},t.prototype.parsePESPrivateDataPayload=function(e,t,i,r,s){var n=new V;if(n.pid=r,n.stream_id=s,n.len=e.byteLength,n.data=e,null!=t){var a=Math.floor(t/this.timescale_);n.pts=a}else n.nearest_pts=this.aac_last_sample_pts_;if(null!=i){var o=Math.floor(i/this.timescale_);n.dts=o}this.onPESPrivateData&&this.onPESPrivateData(n)},t.prototype.parseTimedID3MetadataPayload=function(e,t,i,r,s){var n=new V;if(n.pid=r,n.stream_id=s,n.len=e.byteLength,n.data=e,null!=t){var a=Math.floor(t/this.timescale_);n.pts=a}if(null!=i){var o=Math.floor(i/this.timescale_);n.dts=o}this.onTimedID3Metadata&&this.onTimedID3Metadata(n)},t.prototype.parseSMPTE2038MetadataPayload=function(e,t,i,r,s){var n=new ce;if(n.pid=r,n.stream_id=s,n.len=e.byteLength,n.data=e,null!=t){var a=Math.floor(t/this.timescale_);n.pts=a}if(n.nearest_pts=this.aac_last_sample_pts_,null!=i){var o=Math.floor(i/this.timescale_);n.dts=o}n.ancillaries=function(e){for(var t=new p(e),i=0,r=[];i+=6,0===t.readBits(6);){var s=t.readBool();i+=1;var n=t.readBits(11);i+=11;var a=t.readBits(12);i+=12;var o=255&t.readBits(10);i+=10;var l=255&t.readBits(10);i+=10;var d=255&t.readBits(10);i+=10;for(var c=new Uint8Array(d),h=0;h<d;h++){var u=255&t.readBits(10);i+=10,c[h]=u}t.readBits(10),i+=10;var f="User Defined";65===o?7===l&&(f="SCTE-104"):95===o?220===l?f="ARIB STD-B37 (1SEG)":221===l?f="ARIB STD-B37 (ANALOG)":222===l?f="ARIB STD-B37 (SD)":223===l&&(f="ARIB STD-B37 (HD)"):97===o&&(1===l?f="EIA-708":2===l&&(f="EIA-608")),r.push({yc_indicator:s,line_number:n,horizontal_offset:a,did:o,sdid:l,user_data:c,description:f,information:{}}),t.readBits(8-(i-Math.floor(i/8))%8),i+=(8-(i-Math.floor(i/8)))%8}return t.destroy(),t=null,r}(e),this.onSMPTE2038Metadata&&this.onSMPTE2038Metadata(n)},t}(w),me=function(){function e(){}return e.init=function(){for(var t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],hvc1:[],hvcC:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var i=e.constants={};i.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),i.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),i.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),i.STSC=i.STCO=i.STTS,i.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),i.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),i.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),i.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},e.box=function(e){for(var t=8,i=null,r=Array.prototype.slice.call(arguments,1),s=r.length,n=0;n<s;n++)t+=r[n].byteLength;(i=new Uint8Array(t))[0]=t>>>24&255,i[1]=t>>>16&255,i[2]=t>>>8&255,i[3]=255&t,i.set(e,4);var a=8;for(n=0;n<s;n++)i.set(r[n],a),a+=r[n].byteLength;return i},e.generateInitSegment=function(t){var i=e.box(e.types.ftyp,e.constants.FTYP),r=e.moov(t),s=new Uint8Array(i.byteLength+r.byteLength);return s.set(i,0),s.set(r,i.byteLength),s},e.moov=function(t){var i=e.mvhd(t.timescale,t.duration),r=e.trak(t),s=e.mvex(t);return e.box(e.types.moov,i,r,s)},e.mvhd=function(t,i){return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},e.trak=function(t){return e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.tkhd=function(t){var i=t.id,r=t.duration,s=t.presentWidth,n=t.presentHeight;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>>8&255,255&s,0,0,n>>>8&255,255&n,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t),e.hdlr(t),e.minf(t))},e.mdhd=function(t){var i=t.timescale,r=t.duration;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,r>>>24&255,r>>>16&255,r>>>8&255,255&r,85,196,0,0]))},e.hdlr=function(t){var i=null;return i="audio"===t.type?e.constants.HDLR_AUDIO:e.constants.HDLR_VIDEO,e.box(e.types.hdlr,i)},e.minf=function(t){var i=null;return i="audio"===t.type?e.box(e.types.smhd,e.constants.SMHD):e.box(e.types.vmhd,e.constants.VMHD),e.box(e.types.minf,i,e.dinf(),e.stbl(t))},e.dinf=function(){return e.box(e.types.dinf,e.box(e.types.dref,e.constants.DREF))},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.constants.STTS),e.box(e.types.stsc,e.constants.STSC),e.box(e.types.stsz,e.constants.STSZ),e.box(e.types.stco,e.constants.STCO))},e.stsd=function(t){return"audio"===t.type?"mp3"===t.codec?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp3(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp4a(t)):"video"===t.type&&t.codec.startsWith("hvc1")?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.hvc1(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.avc1(t))},e.mp3=function(t){var i=t.channelCount,r=t.audioSampleRate,s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i,0,16,0,0,0,0,r>>>8&255,255&r,0,0]);return e.box(e.types[".mp3"],s)},e.mp4a=function(t){var i=t.channelCount,r=t.audioSampleRate,s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i,0,16,0,0,0,0,r>>>8&255,255&r,0,0]);return e.box(e.types.mp4a,s,e.esds(t))},e.esds=function(t){var i=t.config||[],r=i.length,s=new Uint8Array([0,0,0,0,3,23+r,0,1,0,4,15+r,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([r]).concat(i).concat([6,1,2]));return e.box(e.types.esds,s)},e.avc1=function(t){var i=t.avcc,r=t.codecWidth,s=t.codecHeight,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,r>>>8&255,255&r,s>>>8&255,255&s,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return e.box(e.types.avc1,n,e.box(e.types.avcC,i))},e.hvc1=function(t){var i=t.hvcc,r=t.codecWidth,s=t.codecHeight,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,r>>>8&255,255&r,s>>>8&255,255&s,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return e.box(e.types.hvc1,n,e.box(e.types.hvcC,i))},e.mvex=function(t){return e.box(e.types.mvex,e.trex(t))},e.trex=function(t){var i=t.id,r=new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.box(e.types.trex,r)},e.moof=function(t,i){return e.box(e.types.moof,e.mfhd(t.sequenceNumber),e.traf(t,i))},e.mfhd=function(t){var i=new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t]);return e.box(e.types.mfhd,i)},e.traf=function(t,i){var r=t.id,s=e.box(e.types.tfhd,new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r])),n=e.box(e.types.tfdt,new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i])),a=e.sdtp(t),o=e.trun(t,a.byteLength+16+16+8+16+8+8);return e.box(e.types.traf,s,n,o,a)},e.sdtp=function(t){for(var i=t.samples||[],r=i.length,s=new Uint8Array(4+r),n=0;n<r;n++){var a=i[n].flags;s[n+4]=a.isLeading<<6|a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy}return e.box(e.types.sdtp,s)},e.trun=function(t,i){var r=t.samples||[],s=r.length,n=12+16*s,a=new Uint8Array(n);i+=8+n,a.set([0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,255&s,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0);for(var o=0;o<s;o++){var l=r[o].duration,d=r[o].size,c=r[o].flags,h=r[o].cts;a.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,d>>>24&255,d>>>16&255,d>>>8&255,255&d,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.isNonSync,0,0,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*o)}return e.box(e.types.trun,a)},e.mdat=function(t){return e.box(e.types.mdat,t)},e}();me.init();var ge=me,ye=function(){function e(){}return e.getSilentFrame=function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}(),ve=i(7),_e=function(){function e(e){this.TAG="MP4Remuxer",this._config=e,this._isLive=!0===e.isLive,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new ve.c("audio"),this._videoSegmentInfoList=new ve.c("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!a.a.chrome||!(a.a.version.major<50||50===a.a.version.major&&a.a.version.build<2661)),this._fillSilentAfterSeek=a.a.msedge||a.a.msie,this._mp3UseMpegAudio=!a.a.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return e.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},e.prototype.bindDataSource=function(e){return e.onDataAvailable=this.remux.bind(this),e.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(e.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(e){this._onInitSegment=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(e){this._onMediaSegment=e},enumerable:!1,configurable:!0}),e.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},e.prototype.seek=function(e){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},e.prototype.remux=function(e,t){if(!this._onMediaSegment)throw new h.a("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(e,t),t&&this._remuxVideo(t),e&&this._remuxAudio(e)},e.prototype._onTrackMetadataReceived=function(e,t){var i=null,r="mp4",s=t.codec;if("audio"===e)this._audioMeta=t,"mp3"===t.codec&&this._mp3UseMpegAudio?(r="mpeg",s="",i=new Uint8Array):i=ge.generateInitSegment(t);else{if("video"!==e)return;this._videoMeta=t,i=ge.generateInitSegment(t)}if(!this._onInitSegment)throw new h.a("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(e,{type:e,data:i.buffer,codec:s,container:e+"/"+r,mediaDuration:t.duration})},e.prototype._calculateDtsBase=function(e,t){this._dtsBaseInited||(e&&e.samples&&e.samples.length&&(this._audioDtsBase=e.samples[0].dts),t&&t.samples&&t.samples.length&&(this._videoDtsBase=t.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},e.prototype.getTimestampBase=function(){if(this._dtsBaseInited)return this._dtsBase},e.prototype.flushStashedSamples=function(){var e=this._videoStashedLastSample,t=this._audioStashedLastSample,i={type:"video",id:1,sequenceNumber:0,samples:[],length:0};null!=e&&(i.samples.push(e),i.length=e.length);var r={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};null!=t&&(r.samples.push(t),r.length=t.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(i,!0),this._remuxAudio(r,!0)},e.prototype._remuxAudio=function(e,t){if(null!=this._audioMeta){var i,r=e,s=r.samples,o=void 0,l=-1,d=this._audioMeta.refSampleDuration,c="mp3"===this._audioMeta.codec&&this._mp3UseMpegAudio,h=this._dtsBaseInited&&void 0===this._audioNextDts,u=!1;if(s&&0!==s.length&&(1!==s.length||t)){var f=0,p=null,m=0;c?(f=0,m=r.length):(f=8,m=8+r.length);var g=null;if(s.length>1&&(m-=(g=s.pop()).length),null!=this._audioStashedLastSample){var y=this._audioStashedLastSample;this._audioStashedLastSample=null,s.unshift(y),m+=y.length}null!=g&&(this._audioStashedLastSample=g);var v=s[0].dts-this._dtsBase;if(this._audioNextDts)o=v-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())o=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&"mp3"!==this._audioMeta.originalCodec&&(u=!0);else{var _=this._audioSegmentInfoList.getLastSampleBefore(v);if(null!=_){var E=v-(_.originalDts+_.duration);E<=3&&(E=0),o=v-(_.dts+_.duration+E)}else o=0}if(u){var b=v-o,S=this._videoSegmentInfoList.getLastSegmentBefore(v);if(null!=S&&S.beginDts<b){if(M=ye.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount)){var T=S.beginDts,A=b-S.beginDts;n.a.v(this.TAG,"InsertPrefixSilentAudio: dts: "+T+", duration: "+A),s.unshift({unit:M,dts:T,pts:T}),m+=M.byteLength}}else u=!1}for(var w=[],L=0;L<s.length;L++){var I=(y=s[L]).unit,R=y.dts-this._dtsBase,D=(T=R,!1),k=null,x=0;if(!(R<-.001)){if("mp3"!==this._audioMeta.codec){var C=R;if(this._audioNextDts&&(C=this._audioNextDts),(o=R-C)<=-3*d){n.a.w(this.TAG,"Dropping 1 audio frame (originalDts: "+R+" ms ,curRefDts: "+C+" ms)  due to dtsCorrection: "+o+" ms overlap.");continue}if(o>=3*d&&this._fillAudioTimestampGap&&!a.a.safari){D=!0;var M,P=Math.floor(o/d);n.a.w(this.TAG,"Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.\noriginalDts: "+R+" ms, curRefDts: "+C+" ms, dtsCorrection: "+Math.round(o)+" ms, generate: "+P+" frames"),T=Math.floor(C),x=Math.floor(C+d)-T,null==(M=ye.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount))&&(n.a.w(this.TAG,"Unable to generate silent frame for "+this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame"),M=I),k=[];for(var O=0;O<P;O++){C+=d;var N=Math.floor(C),F=Math.floor(C+d)-N,B={dts:N,pts:N,cts:0,unit:M,size:M.byteLength,duration:F,originalDts:R,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};k.push(B),m+=B.size}this._audioNextDts=C+d}else T=Math.floor(C),x=Math.floor(C+d)-T,this._audioNextDts=C+d}else T=R-o,x=L!==s.length-1?s[L+1].dts-this._dtsBase-o-T:null!=g?g.dts-this._dtsBase-o-T:w.length>=1?w[w.length-1].duration:Math.floor(d),this._audioNextDts=T+x;-1===l&&(l=T),w.push({dts:T,pts:T,cts:0,unit:y.unit,size:y.unit.byteLength,duration:x,originalDts:R,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),D&&w.push.apply(w,k)}}if(0===w.length)return r.samples=[],void(r.length=0);for(c?p=new Uint8Array(m):((p=new Uint8Array(m))[0]=m>>>24&255,p[1]=m>>>16&255,p[2]=m>>>8&255,p[3]=255&m,p.set(ge.types.mdat,4)),L=0;L<w.length;L++)I=w[L].unit,p.set(I,f),f+=I.byteLength;var U=w[w.length-1];i=U.dts+U.duration;var j=new ve.b;j.beginDts=l,j.endDts=i,j.beginPts=l,j.endPts=i,j.originalBeginDts=w[0].originalDts,j.originalEndDts=U.originalDts+U.duration,j.firstSample=new ve.d(w[0].dts,w[0].pts,w[0].duration,w[0].originalDts,!1),j.lastSample=new ve.d(U.dts,U.pts,U.duration,U.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(j),r.samples=w,r.sequenceNumber++;var G=null;G=c?new Uint8Array:ge.moof(r,l),r.samples=[],r.length=0;var z={type:"audio",data:this._mergeBoxes(G,p).buffer,sampleCount:w.length,info:j};c&&h&&(z.timestampOffset=l),this._onMediaSegment("audio",z)}}},e.prototype._remuxVideo=function(e,t){if(null!=this._videoMeta){var i,r,s=e,n=s.samples,a=void 0,o=-1,l=-1;if(n&&0!==n.length&&(1!==n.length||t)){var d=8,c=null,h=8+e.length,u=null;if(n.length>1&&(h-=(u=n.pop()).length),null!=this._videoStashedLastSample){var f=this._videoStashedLastSample;this._videoStashedLastSample=null,n.unshift(f),h+=f.length}null!=u&&(this._videoStashedLastSample=u);var p=n[0].dts-this._dtsBase;if(this._videoNextDts)a=p-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())a=0;else{var m=this._videoSegmentInfoList.getLastSampleBefore(p);if(null!=m){var g=p-(m.originalDts+m.duration);g<=3&&(g=0),a=p-(m.dts+m.duration+g)}else a=0}for(var y=new ve.b,v=[],_=0;_<n.length;_++){var E=(f=n[_]).dts-this._dtsBase,b=f.isKeyframe,S=E-a,T=f.cts,A=S+T;-1===o&&(o=S,l=A);var w=0;if(w=_!==n.length-1?n[_+1].dts-this._dtsBase-a-S:null!=u?u.dts-this._dtsBase-a-S:v.length>=1?v[v.length-1].duration:Math.floor(this._videoMeta.refSampleDuration),b){var L=new ve.d(S,A,w,f.dts,!0);L.fileposition=f.fileposition,y.appendSyncPoint(L)}v.push({dts:S,pts:A,cts:T,units:f.units,size:f.length,isKeyframe:b,duration:w,originalDts:E,flags:{isLeading:0,dependsOn:b?2:1,isDependedOn:b?1:0,hasRedundancy:0,isNonSync:b?0:1}})}for((c=new Uint8Array(h))[0]=h>>>24&255,c[1]=h>>>16&255,c[2]=h>>>8&255,c[3]=255&h,c.set(ge.types.mdat,4),_=0;_<v.length;_++)for(var I=v[_].units;I.length;){var R=I.shift().data;c.set(R,d),d+=R.byteLength}var D=v[v.length-1];if(i=D.dts+D.duration,r=D.pts+D.duration,this._videoNextDts=i,y.beginDts=o,y.endDts=i,y.beginPts=l,y.endPts=r,y.originalBeginDts=v[0].originalDts,y.originalEndDts=D.originalDts+D.duration,y.firstSample=new ve.d(v[0].dts,v[0].pts,v[0].duration,v[0].originalDts,v[0].isKeyframe),y.lastSample=new ve.d(D.dts,D.pts,D.duration,D.originalDts,D.isKeyframe),this._isLive||this._videoSegmentInfoList.append(y),s.samples=v,s.sequenceNumber++,this._forceFirstIDR){var k=v[0].flags;k.dependsOn=2,k.isNonSync=0}var x=ge.moof(s,o);s.samples=[],s.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(x,c).buffer,sampleCount:v.length,info:y})}}},e.prototype._mergeBoxes=function(e,t){var i=new Uint8Array(e.byteLength+t.byteLength);return i.set(e,0),i.set(t,e.byteLength),i},e}(),Ee=i(11),be=i(1),Se=function(){function e(e,t){this.TAG="TransmuxingController",this._emitter=new s.a,this._config=t,e.segments||(e.segments=[{duration:e.duration,filesize:e.filesize,url:e.url}]),"boolean"!=typeof e.cors&&(e.cors=!0),"boolean"!=typeof e.withCredentials&&(e.withCredentials=!1),this._mediaDataSource=e,this._currentSegmentIndex=0;var i=0;this._mediaDataSource.segments.forEach((function(r){r.timestampBase=i,i+=r.duration,r.cors=e.cors,r.withCredentials=e.withCredentials,t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy)})),isNaN(i)||this._mediaDataSource.duration===i||(this._mediaDataSource.duration=i),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return e.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},e.prototype._loadSegment=function(e,t){this._currentSegmentIndex=e;var i=this._mediaDataSource.segments[e],r=this._ioctl=new Ee.a(i,this._config,e);r.onError=this._onIOException.bind(this),r.onSeeked=this._onIOSeeked.bind(this),r.onComplete=this._onIOComplete.bind(this),r.onRedirect=this._onIORedirect.bind(this),r.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),t?this._demuxer.bindDataSource(this._ioctl):r.onDataArrival=this._onInitChunkArrival.bind(this),r.open(t)},e.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},e.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},e.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},e.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},e.prototype.seek=function(e){if(null!=this._mediaInfo&&this._mediaInfo.isSeekable()){var t=this._searchSegmentIndexContains(e);if(t===this._currentSegmentIndex){var i=this._mediaInfo.segments[t];if(null==i)this._pendingSeekTime=e;else{var r=i.getNearestKeyframe(e);this._remuxer.seek(r.milliseconds),this._ioctl.seek(r.fileposition),this._pendingResolveSeekPoint=r.milliseconds}}else{var s=this._mediaInfo.segments[t];null==s?(this._pendingSeekTime=e,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(t)):(r=s.getNearestKeyframe(e),this._internalAbort(),this._remuxer.seek(e),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[t].timestampBase,this._loadSegment(t,r.fileposition),this._pendingResolveSeekPoint=r.milliseconds,this._reportSegmentMediaInfo(t))}this._enableStatisticsReporter()}},e.prototype._searchSegmentIndexContains=function(e){for(var t=this._mediaDataSource.segments,i=t.length-1,r=0;r<t.length;r++)if(e<t[r].timestampBase){i=r-1;break}return i},e.prototype._onInitChunkArrival=function(e,t){var i=this,r=0;if(t>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,r=this._demuxer.parseChunks(e,t);else{var s=null;(s=A.probe(e)).match&&(this._setupFLVDemuxerRemuxer(s),r=this._demuxer.parseChunks(e,t)),s.match||s.needMoreData||(s=pe.probe(e)).match&&(this._setupTSDemuxerRemuxer(s),r=this._demuxer.parseChunks(e,t)),s.match||s.needMoreData||(s=null,n.a.e(this.TAG,"Non MPEG-TS/FLV, Unsupported media type!"),Promise.resolve().then((function(){i._internalAbort()})),this._emitter.emit(be.a.DEMUX_ERROR,g.a.FORMAT_UNSUPPORTED,"Non MPEG-TS/FLV, Unsupported media type!"))}return r},e.prototype._setupFLVDemuxerRemuxer=function(e){this._demuxer=new A(e,this._config),this._remuxer||(this._remuxer=new _e(this._config));var t=this._mediaDataSource;null==t.duration||isNaN(t.duration)||(this._demuxer.overridedDuration=t.duration),"boolean"==typeof t.hasAudio&&(this._demuxer.overridedHasAudio=t.hasAudio),"boolean"==typeof t.hasVideo&&(this._demuxer.overridedHasVideo=t.hasVideo),this._demuxer.timestampBase=t.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},e.prototype._setupTSDemuxerRemuxer=function(e){var t=this._demuxer=new pe(e,this._config);this._remuxer||(this._remuxer=new _e(this._config)),t.onError=this._onDemuxException.bind(this),t.onMediaInfo=this._onMediaInfo.bind(this),t.onMetaDataArrived=this._onMetaDataArrived.bind(this),t.onTimedID3Metadata=this._onTimedID3Metadata.bind(this),t.onSMPTE2038Metadata=this._onSMPTE2038Metadata.bind(this),t.onSCTE35Metadata=this._onSCTE35Metadata.bind(this),t.onPESPrivateDataDescriptor=this._onPESPrivateDataDescriptor.bind(this),t.onPESPrivateData=this._onPESPrivateData.bind(this),this._remuxer.bindDataSource(this._demuxer),this._demuxer.bindDataSource(this._ioctl),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},e.prototype._onMediaInfo=function(e){var t=this;null==this._mediaInfo&&(this._mediaInfo=Object.assign({},e),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,o.a.prototype));var i=Object.assign({},e);Object.setPrototypeOf(i,o.a.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=i,this._reportSegmentMediaInfo(this._currentSegmentIndex),null!=this._pendingSeekTime&&Promise.resolve().then((function(){var e=t._pendingSeekTime;t._pendingSeekTime=null,t.seek(e)}))},e.prototype._onMetaDataArrived=function(e){this._emitter.emit(be.a.METADATA_ARRIVED,e)},e.prototype._onScriptDataArrived=function(e){this._emitter.emit(be.a.SCRIPTDATA_ARRIVED,e)},e.prototype._onTimedID3Metadata=function(e){var t=this._remuxer.getTimestampBase();null!=t&&(null!=e.pts&&(e.pts-=t),null!=e.dts&&(e.dts-=t),this._emitter.emit(be.a.TIMED_ID3_METADATA_ARRIVED,e))},e.prototype._onSMPTE2038Metadata=function(e){var t=this._remuxer.getTimestampBase();null!=t&&(null!=e.pts&&(e.pts-=t),null!=e.dts&&(e.dts-=t),null!=e.nearest_pts&&(e.nearest_pts-=t),this._emitter.emit(be.a.SMPTE2038_METADATA_ARRIVED,e))},e.prototype._onSCTE35Metadata=function(e){var t=this._remuxer.getTimestampBase();null!=t&&(null!=e.pts&&(e.pts-=t),null!=e.nearest_pts&&(e.nearest_pts-=t),this._emitter.emit(be.a.SCTE35_METADATA_ARRIVED,e))},e.prototype._onPESPrivateDataDescriptor=function(e){this._emitter.emit(be.a.PES_PRIVATE_DATA_DESCRIPTOR,e)},e.prototype._onPESPrivateData=function(e){var t=this._remuxer.getTimestampBase();null!=t&&(null!=e.pts&&(e.pts-=t),null!=e.nearest_pts&&(e.nearest_pts-=t),null!=e.dts&&(e.dts-=t),this._emitter.emit(be.a.PES_PRIVATE_DATA_ARRIVED,e))},e.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},e.prototype._onIOComplete=function(e){var t=e+1;t<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer&&this._remuxer.flushStashedSamples(),this._loadSegment(t)):(this._remuxer&&this._remuxer.flushStashedSamples(),this._emitter.emit(be.a.LOADING_COMPLETE),this._disableStatisticsReporter())},e.prototype._onIORedirect=function(e){var t=this._ioctl.extraData;this._mediaDataSource.segments[t].redirectedURL=e},e.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(be.a.RECOVERED_EARLY_EOF)},e.prototype._onIOException=function(e,t){n.a.e(this.TAG,"IOException: type = "+e+", code = "+t.code+", msg = "+t.msg),this._emitter.emit(be.a.IO_ERROR,e,t),this._disableStatisticsReporter()},e.prototype._onDemuxException=function(e,t){n.a.e(this.TAG,"DemuxException: type = "+e+", info = "+t),this._emitter.emit(be.a.DEMUX_ERROR,e,t)},e.prototype._onRemuxerInitSegmentArrival=function(e,t){this._emitter.emit(be.a.INIT_SEGMENT,e,t)},e.prototype._onRemuxerMediaSegmentArrival=function(e,t){if(null==this._pendingSeekTime&&(this._emitter.emit(be.a.MEDIA_SEGMENT,e,t),null!=this._pendingResolveSeekPoint&&"video"===e)){var i=t.info.syncPoints,r=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,a.a.safari&&i.length>0&&i[0].originalDts===r&&(r=i[0].pts),this._emitter.emit(be.a.RECOMMEND_SEEKPOINT,r)}},e.prototype._enableStatisticsReporter=function(){null==this._statisticsReporter&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},e.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},e.prototype._reportSegmentMediaInfo=function(e){var t=this._mediaInfo.segments[e],i=Object.assign({},t);i.duration=this._mediaInfo.duration,i.segmentCount=this._mediaInfo.segmentCount,delete i.segments,delete i.keyframesIndex,this._emitter.emit(be.a.MEDIA_INFO,i)},e.prototype._reportStatisticsInfo=function(){var e={};e.url=this._ioctl.currentURL,e.hasRedirect=this._ioctl.hasRedirect,e.hasRedirect&&(e.redirectedURL=this._ioctl.currentRedirectedURL),e.speed=this._ioctl.currentSpeed,e.loaderType=this._ioctl.loaderType,e.currentSegmentIndex=this._currentSegmentIndex,e.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(be.a.STATISTICS_INFO,e)},e}();t.a=Se},function(e,t,i){var r,s=i(0),n=function(){function e(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return e.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},e.prototype.addBytes=function(e){0===this._firstCheckpoint?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=e,this._totalBytes+=e):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=e,this._totalBytes+=e):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=e,this._totalBytes+=e,this._lastCheckpoint=this._now())},Object.defineProperty(e.prototype,"currentKBps",{get:function(){this.addBytes(0);var e=(this._now()-this._lastCheckpoint)/1e3;return 0==e&&(e=1),this._intervalBytes/e/1024},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),0!==this._lastSecondBytes?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"averageKBps",{get:function(){var e=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/e/1024},enumerable:!1,configurable:!0}),e}(),a=i(2),o=i(4),l=i(3),d=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),c=function(e){function t(t,i){var r=e.call(this,"fetch-stream-loader")||this;return r.TAG="FetchStreamLoader",r._seekHandler=t,r._config=i,r._needStash=!0,r._requestAbort=!1,r._abortController=null,r._contentLength=null,r._receivedLength=0,r}return d(t,e),t.isSupported=function(){try{var e=o.a.msedge&&o.a.version.minor>=15048,t=!o.a.msedge||e;return self.fetch&&self.ReadableStream&&t}catch(i){return!1}},t.prototype.destroy=function(){this.isWorking()&&this.abort(),e.prototype.destroy.call(this)},t.prototype.open=function(e,t){var i=this;this._dataSource=e,this._range=t;var r=e.url;this._config.reuseRedirectedURL&&null!=e.redirectedURL&&(r=e.redirectedURL);var s=this._seekHandler.getConfig(r,t),n=new self.Headers;if("object"==typeof s.headers){var o=s.headers;for(var d in o)o.hasOwnProperty(d)&&n.append(d,o[d])}var c={method:"GET",headers:n,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if("object"==typeof this._config.headers)for(var d in this._config.headers)n.append(d,this._config.headers[d]);!1===e.cors&&(c.mode="same-origin"),e.withCredentials&&(c.credentials="include"),e.referrerPolicy&&(c.referrerPolicy=e.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,c.signal=this._abortController.signal),this._status=a.c.kConnecting,self.fetch(s.url,c).then((function(e){if(i._requestAbort)return i._status=a.c.kIdle,void e.body.cancel();if(e.ok&&e.status>=200&&e.status<=299){if(e.url!==s.url&&i._onURLRedirect){var t=i._seekHandler.removeURLParameters(e.url);i._onURLRedirect(t)}var r=e.headers.get("Content-Length");return null!=r&&(i._contentLength=parseInt(r),0!==i._contentLength&&i._onContentLengthKnown&&i._onContentLengthKnown(i._contentLength)),i._pump.call(i,e.body.getReader())}if(i._status=a.c.kError,!i._onError)throw new l.d("FetchStreamLoader: Http code invalid, "+e.status+" "+e.statusText);i._onError(a.b.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText})})).catch((function(e){if(!i._abortController||!i._abortController.signal.aborted){if(i._status=a.c.kError,!i._onError)throw e;i._onError(a.b.EXCEPTION,{code:-1,msg:e.message})}}))},t.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==a.c.kBuffering||!o.a.chrome)&&this._abortController)try{this._abortController.abort()}catch(e){}},t.prototype._pump=function(e){var t=this;return e.read().then((function(i){if(i.done)if(null!==t._contentLength&&t._receivedLength<t._contentLength){t._status=a.c.kError;var r=a.b.EARLY_EOF,s={code:-1,msg:"Fetch stream meet Early-EOF"};if(!t._onError)throw new l.d(s.msg);t._onError(r,s)}else t._status=a.c.kComplete,t._onComplete&&t._onComplete(t._range.from,t._range.from+t._receivedLength-1);else{if(t._abortController&&t._abortController.signal.aborted)return void(t._status=a.c.kComplete);if(!0===t._requestAbort)return t._status=a.c.kComplete,e.cancel();t._status=a.c.kBuffering;var n=i.value.buffer,o=t._range.from+t._receivedLength;t._receivedLength+=n.byteLength,t._onDataArrival&&t._onDataArrival(n,o,t._receivedLength),t._pump(e)}})).catch((function(e){if(t._abortController&&t._abortController.signal.aborted)t._status=a.c.kComplete;else if(11!==e.code||!o.a.msedge){t._status=a.c.kError;var i=0,r=null;if(19!==e.code&&"network error"!==e.message||!(null===t._contentLength||null!==t._contentLength&&t._receivedLength<t._contentLength)?(i=a.b.EXCEPTION,r={code:e.code,msg:e.message}):(i=a.b.EARLY_EOF,r={code:e.code,msg:"Fetch stream meet Early-EOF"}),!t._onError)throw new l.d(r.msg);t._onError(i,r)}}))},t}(a.a),h=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),u=function(e){function t(t,i){var r=e.call(this,"xhr-moz-chunked-loader")||this;return r.TAG="MozChunkedLoader",r._seekHandler=t,r._config=i,r._needStash=!0,r._xhr=null,r._requestAbort=!1,r._contentLength=null,r._receivedLength=0,r}return h(t,e),t.isSupported=function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===e.responseType}catch(t){return s.a.w("MozChunkedLoader",t.message),!1}},t.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),e.prototype.destroy.call(this)},t.prototype.open=function(e,t){this._dataSource=e,this._range=t;var i=e.url;this._config.reuseRedirectedURL&&null!=e.redirectedURL&&(i=e.redirectedURL);var r=this._seekHandler.getConfig(i,t);this._requestURL=r.url;var s=this._xhr=new XMLHttpRequest;if(s.open("GET",r.url,!0),s.responseType="moz-chunked-arraybuffer",s.onreadystatechange=this._onReadyStateChange.bind(this),s.onprogress=this._onProgress.bind(this),s.onloadend=this._onLoadEnd.bind(this),s.onerror=this._onXhrError.bind(this),e.withCredentials&&(s.withCredentials=!0),"object"==typeof r.headers){var n=r.headers;for(var o in n)n.hasOwnProperty(o)&&s.setRequestHeader(o,n[o])}if("object"==typeof this._config.headers)for(var o in n=this._config.headers)n.hasOwnProperty(o)&&s.setRequestHeader(o,n[o]);this._status=a.c.kConnecting,s.send()},t.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=a.c.kComplete},t.prototype._onReadyStateChange=function(e){var t=e.target;if(2===t.readyState){if(null!=t.responseURL&&t.responseURL!==this._requestURL&&this._onURLRedirect){var i=this._seekHandler.removeURLParameters(t.responseURL);this._onURLRedirect(i)}if(0!==t.status&&(t.status<200||t.status>299)){if(this._status=a.c.kError,!this._onError)throw new l.d("MozChunkedLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(a.b.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}else this._status=a.c.kBuffering}},t.prototype._onProgress=function(e){if(this._status!==a.c.kError){null===this._contentLength&&null!==e.total&&0!==e.total&&(this._contentLength=e.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var t=e.target.response,i=this._range.from+this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,i,this._receivedLength)}},t.prototype._onLoadEnd=function(e){!0!==this._requestAbort?this._status!==a.c.kError&&(this._status=a.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)):this._requestAbort=!1},t.prototype._onXhrError=function(e){this._status=a.c.kError;var t=0,i=null;if(this._contentLength&&e.loaded<this._contentLength?(t=a.b.EARLY_EOF,i={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(t=a.b.EXCEPTION,i={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new l.d(i.msg);this._onError(t,i)},t}(a.a),f=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),p=function(e){function t(t,i){var r=e.call(this,"xhr-range-loader")||this;return r.TAG="RangeLoader",r._seekHandler=t,r._config=i,r._needStash=!1,r._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],r._currentChunkSizeKB=384,r._currentSpeedNormalized=0,r._zeroSpeedChunkCount=0,r._xhr=null,r._speedSampler=new n,r._requestAbort=!1,r._waitForTotalLength=!1,r._totalLengthReceived=!1,r._currentRequestURL=null,r._currentRedirectedURL=null,r._currentRequestRange=null,r._totalLength=null,r._contentLength=null,r._receivedLength=0,r._lastTimeLoaded=0,r}return f(t,e),t.isSupported=function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="arraybuffer","arraybuffer"===e.responseType}catch(t){return s.a.w("RangeLoader",t.message),!1}},t.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),e.prototype.destroy.call(this)},Object.defineProperty(t.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),t.prototype.open=function(e,t){this._dataSource=e,this._range=t,this._status=a.c.kConnecting;var i=!1;null!=this._dataSource.filesize&&0!==this._dataSource.filesize&&(i=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||i?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))},t.prototype._openSubRange=function(){var e=1024*this._currentChunkSizeKB,t=this._range.from+this._receivedLength,i=t+e;null!=this._contentLength&&i-this._range.from>=this._contentLength&&(i=this._range.from+this._contentLength-1),this._currentRequestRange={from:t,to:i},this._internalOpen(this._dataSource,this._currentRequestRange)},t.prototype._internalOpen=function(e,t){this._lastTimeLoaded=0;var i=e.url;this._config.reuseRedirectedURL&&(null!=this._currentRedirectedURL?i=this._currentRedirectedURL:null!=e.redirectedURL&&(i=e.redirectedURL));var r=this._seekHandler.getConfig(i,t);this._currentRequestURL=r.url;var s=this._xhr=new XMLHttpRequest;if(s.open("GET",r.url,!0),s.responseType="arraybuffer",s.onreadystatechange=this._onReadyStateChange.bind(this),s.onprogress=this._onProgress.bind(this),s.onload=this._onLoad.bind(this),s.onerror=this._onXhrError.bind(this),e.withCredentials&&(s.withCredentials=!0),"object"==typeof r.headers){var n=r.headers;for(var a in n)n.hasOwnProperty(a)&&s.setRequestHeader(a,n[a])}if("object"==typeof this._config.headers)for(var a in n=this._config.headers)n.hasOwnProperty(a)&&s.setRequestHeader(a,n[a]);s.send()},t.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=a.c.kComplete},t.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},t.prototype._onReadyStateChange=function(e){var t=e.target;if(2===t.readyState){if(null!=t.responseURL){var i=this._seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&i!==this._currentRedirectedURL&&(this._currentRedirectedURL=i,this._onURLRedirect&&this._onURLRedirect(i))}if(t.status>=200&&t.status<=299){if(this._waitForTotalLength)return;this._status=a.c.kBuffering}else{if(this._status=a.c.kError,!this._onError)throw new l.d("RangeLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(a.b.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}}},t.prototype._onProgress=function(e){if(this._status!==a.c.kError){if(null===this._contentLength){var t=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,t=!0;var i=e.total;this._internalAbort(),null!=i&0!==i&&(this._totalLength=i)}if(-1===this._range.to?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,t)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var r=e.loaded-this._lastTimeLoaded;this._lastTimeLoaded=e.loaded,this._speedSampler.addBytes(r)}},t.prototype._normalizeSpeed=function(e){var t=this._chunkSizeKBList,i=t.length-1,r=0,s=0,n=i;if(e<t[0])return t[0];for(;s<=n;){if((r=s+Math.floor((n-s)/2))===i||e>=t[r]&&e<t[r+1])return t[r];t[r]<e?s=r+1:n=r-1}},t.prototype._onLoad=function(e){if(this._status!==a.c.kError)if(this._waitForTotalLength)this._waitForTotalLength=!1;else{this._lastTimeLoaded=0;var t=this._speedSampler.lastSecondKBps;if(0===t&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(t=this._speedSampler.currentKBps)),0!==t){var i=this._normalizeSpeed(t);this._currentSpeedNormalized!==i&&(this._currentSpeedNormalized=i,this._currentChunkSizeKB=i)}var r=e.target.response,s=this._range.from+this._receivedLength;this._receivedLength+=r.byteLength;var n=!1;null!=this._contentLength&&this._receivedLength<this._contentLength?this._openSubRange():n=!0,this._onDataArrival&&this._onDataArrival(r,s,this._receivedLength),n&&(this._status=a.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},t.prototype._onXhrError=function(e){this._status=a.c.kError;var t=0,i=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(t=a.b.EARLY_EOF,i={code:-1,msg:"RangeLoader meet Early-Eof"}):(t=a.b.EXCEPTION,i={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new l.d(i.msg);this._onError(t,i)},t}(a.a),m=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),g=function(e){function t(){var t=e.call(this,"websocket-loader")||this;return t.TAG="WebSocketLoader",t._needStash=!0,t._ws=null,t._requestAbort=!1,t._receivedLength=0,t}return m(t,e),t.isSupported=function(){try{return void 0!==self.WebSocket}catch(e){return!1}},t.prototype.destroy=function(){this._ws&&this.abort(),e.prototype.destroy.call(this)},t.prototype.open=function(e){try{var t=this._ws=new self.WebSocket(e.url);t.binaryType="arraybuffer",t.onopen=this._onWebSocketOpen.bind(this),t.onclose=this._onWebSocketClose.bind(this),t.onmessage=this._onWebSocketMessage.bind(this),t.onerror=this._onWebSocketError.bind(this),this._status=a.c.kConnecting}catch(r){this._status=a.c.kError;var i={code:r.code,msg:r.message};if(!this._onError)throw new l.d(i.msg);this._onError(a.b.EXCEPTION,i)}},t.prototype.abort=function(){var e=this._ws;!e||0!==e.readyState&&1!==e.readyState||(this._requestAbort=!0,e.close()),this._ws=null,this._status=a.c.kComplete},t.prototype._onWebSocketOpen=function(e){this._status=a.c.kBuffering},t.prototype._onWebSocketClose=function(e){!0!==this._requestAbort?(this._status=a.c.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)):this._requestAbort=!1},t.prototype._onWebSocketMessage=function(e){var t=this;if(e.data instanceof ArrayBuffer)this._dispatchArrayBuffer(e.data);else if(e.data instanceof Blob){var i=new FileReader;i.onload=function(){t._dispatchArrayBuffer(i.result)},i.readAsArrayBuffer(e.data)}else{this._status=a.c.kError;var r={code:-1,msg:"Unsupported WebSocket message type: "+e.data.constructor.name};if(!this._onError)throw new l.d(r.msg);this._onError(a.b.EXCEPTION,r)}},t.prototype._dispatchArrayBuffer=function(e){var t=e,i=this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,i,this._receivedLength)},t.prototype._onWebSocketError=function(e){this._status=a.c.kError;var t={code:e.code,msg:e.message};if(!this._onError)throw new l.d(t.msg);this._onError(a.b.EXCEPTION,t)},t}(a.a),y=function(){function e(e){this._zeroStart=e||!1}return e.prototype.getConfig=function(e,t){var i={};if(0!==t.from||-1!==t.to){var r=void 0;r=-1!==t.to?"bytes="+t.from.toString()+"-"+t.to.toString():"bytes="+t.from.toString()+"-",i.Range=r}else this._zeroStart&&(i.Range="bytes=0-");return{url:e,headers:i}},e.prototype.removeURLParameters=function(e){return e},e}(),v=function(){function e(e,t){this._startName=e,this._endName=t}return e.prototype.getConfig=function(e,t){var i=e;if(0!==t.from||-1!==t.to){var r=!0;-1===i.indexOf("?")&&(i+="?",r=!1),r&&(i+="&"),i+=this._startName+"="+t.from.toString(),-1!==t.to&&(i+="&"+this._endName+"="+t.to.toString())}return{url:i,headers:{}}},e.prototype.removeURLParameters=function(e){var t=e.split("?")[0],i=void 0,r=e.indexOf("?");-1!==r&&(i=e.substring(r+1));var s="";if(null!=i&&i.length>0)for(var n=i.split("&"),a=0;a<n.length;a++){var o=n[a].split("="),l=a>0;o[0]!==this._startName&&o[0]!==this._endName&&(l&&(s+="&"),s+=n[a])}return 0===s.length?t:t+"?"+s},e}(),_=function(){function e(e,t,i){this.TAG="IOController",this._config=t,this._extraData=i,this._stashInitialSize=65536,null!=t.stashInitialSize&&t.stashInitialSize>0&&(this._stashInitialSize=t.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=3145728,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,!1===t.enableStashBuffer&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=e,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(e.url),this._refTotalLength=e.filesize?e.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new n,this._speedNormalizeList=[32,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return e.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},e.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},e.prototype.isPaused=function(){return this._paused},Object.defineProperty(e.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extraData",{get:function(){return this._extraData},set:function(e){this._extraData=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(e){this._onSeeked=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onComplete",{get:function(){return this._onComplete},set:function(e){this._onComplete=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(e){this._onRedirect=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(e){this._onRecoveredEarlyEof=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasRedirect",{get:function(){return null!=this._redirectedURL||null!=this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentSpeed",{get:function(){return this._loaderClass===p?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),e.prototype._selectSeekHandler=function(){var e=this._config;if("range"===e.seekType)this._seekHandler=new y(this._config.rangeLoadZeroStart);else if("param"===e.seekType){var t=e.seekParamStart||"bstart",i=e.seekParamEnd||"bend";this._seekHandler=new v(t,i)}else{if("custom"!==e.seekType)throw new l.b("Invalid seekType in config: "+e.seekType);if("function"!=typeof e.customSeekHandler)throw new l.b("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new e.customSeekHandler}},e.prototype._selectLoader=function(){if(null!=this._config.customLoader)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=g;else if(c.isSupported())this._loaderClass=c;else if(u.isSupported())this._loaderClass=u;else{if(!p.isSupported())throw new l.d("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=p}},e.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),!1===this._loader.needStashBuffer&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},e.prototype.open=function(e){this._currentRange={from:0,to:-1},e&&(this._currentRange.from=e),this._speedSampler.reset(),e||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},e.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},e.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),0!==this._stashUsed?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},e.prototype.resume=function(){if(this._paused){this._paused=!1;var e=this._resumeFrom;this._resumeFrom=0,this._internalSeek(e,!0)}},e.prototype.seek=function(e){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(e,!0)},e.prototype._internalSeek=function(e,t){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(t),this._loader.destroy(),this._loader=null;var i={from:e,to:-1};this._currentRange={from:i.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,i),this._onSeeked&&this._onSeeked()},e.prototype.updateUrl=function(e){if(!e||"string"!=typeof e||0===e.length)throw new l.b("Url must be a non-empty string!");this._dataSource.url=e},e.prototype._expandBuffer=function(e){for(var t=this._stashSize;t+1048576<e;)t*=2;if((t+=1048576)!==this._bufferSize){var i=new ArrayBuffer(t);if(this._stashUsed>0){var r=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(i,0,t).set(r,0)}this._stashBuffer=i,this._bufferSize=t}},e.prototype._normalizeSpeed=function(e){var t=this._speedNormalizeList,i=t.length-1,r=0,s=0,n=i;if(e<t[0])return t[0];for(;s<=n;){if((r=s+Math.floor((n-s)/2))===i||e>=t[r]&&e<t[r+1])return t[r];t[r]<e?s=r+1:n=r-1}},e.prototype._adjustStashSize=function(e){var t=0;(t=this._config.isLive?e/8:e<512?e:e>=512&&e<=1024?Math.floor(1.5*e):2*e)>8192&&(t=8192);var i=1024*t+1048576;this._bufferSize<i&&this._expandBuffer(i),this._stashSize=1024*t},e.prototype._dispatchChunks=function(e,t){return this._currentRange.to=t+e.byteLength-1,this._onDataArrival(e,t)},e.prototype._onURLRedirect=function(e){this._redirectedURL=e,this._onRedirect&&this._onRedirect(e)},e.prototype._onContentLengthKnown=function(e){e&&this._fullRequestFlag&&(this._totalLength=e,this._fullRequestFlag=!1)},e.prototype._onLoaderChunkArrival=function(e,t,i){if(!this._onDataArrival)throw new l.a("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(e.byteLength);var r=this._speedSampler.lastSecondKBps;if(0!==r){var s=this._normalizeSpeed(r);this._speedNormalized!==s&&(this._speedNormalized=s,this._adjustStashSize(s))}if(this._enableStash)if(0===this._stashUsed&&0===this._stashByteStart&&(this._stashByteStart=t),this._stashUsed+e.byteLength<=this._stashSize)(o=new Uint8Array(this._stashBuffer,0,this._stashSize)).set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength;else if(o=new Uint8Array(this._stashBuffer,0,this._bufferSize),this._stashUsed>0){var n=this._stashBuffer.slice(0,this._stashUsed);(d=this._dispatchChunks(n,this._stashByteStart))<n.byteLength?d>0&&(c=new Uint8Array(n,d),o.set(c,0),this._stashUsed=c.byteLength,this._stashByteStart+=d):(this._stashUsed=0,this._stashByteStart+=d),this._stashUsed+e.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+e.byteLength),o=new Uint8Array(this._stashBuffer,0,this._bufferSize)),o.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else(d=this._dispatchChunks(e,t))<e.byteLength&&((a=e.byteLength-d)>this._bufferSize&&(this._expandBuffer(a),o=new Uint8Array(this._stashBuffer,0,this._bufferSize)),o.set(new Uint8Array(e,d),0),this._stashUsed+=a,this._stashByteStart=t+d);else if(0===this._stashUsed){var a;(d=this._dispatchChunks(e,t))<e.byteLength&&((a=e.byteLength-d)>this._bufferSize&&this._expandBuffer(a),(o=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(e,d),0),this._stashUsed+=a,this._stashByteStart=t+d)}else{var o,d;if(this._stashUsed+e.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+e.byteLength),(o=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength,(d=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart))<this._stashUsed&&d>0){var c=new Uint8Array(this._stashBuffer,d);o.set(c,0)}this._stashUsed-=d,this._stashByteStart+=d}}},e.prototype._flushStashBuffer=function(e){if(this._stashUsed>0){var t=this._stashBuffer.slice(0,this._stashUsed),i=this._dispatchChunks(t,this._stashByteStart),r=t.byteLength-i;if(i<t.byteLength){if(!e){if(i>0){var n=new Uint8Array(this._stashBuffer,0,this._bufferSize),a=new Uint8Array(t,i);n.set(a,0),this._stashUsed=a.byteLength,this._stashByteStart+=i}return 0}s.a.w(this.TAG,r+" bytes unconsumed data remain when flush buffer, dropped")}return this._stashUsed=0,this._stashByteStart=0,r}return 0},e.prototype._onLoaderComplete=function(e,t){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},e.prototype._onLoaderError=function(e,t){switch(s.a.e(this.TAG,"Loader error, code = "+t.code+", msg = "+t.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,e=a.b.UNRECOVERABLE_EARLY_EOF),e){case a.b.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var i=this._currentRange.to+1;return void(i<this._totalLength&&(s.a.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(i,!1)))}e=a.b.UNRECOVERABLE_EARLY_EOF;case a.b.UNRECOVERABLE_EARLY_EOF:case a.b.CONNECTING_TIMEOUT:case a.b.HTTP_STATUS_CODE_INVALID:case a.b.EXCEPTION:}if(!this._onError)throw new l.d("IOException: "+t.msg);this._onError(e,t)},e}();t.a=_},function(e,t,i){var r=function(){function e(){}return e.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Object.assign=Object.assign||function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var s in r)r.hasOwnProperty(s)&&(t[s]=r[s])}return t},"function"!=typeof self.Promise&&i(15).polyfill()},e}();r.install(),t.a=r},function(e,t,i){function r(e){var t={};function i(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.i=function(e){return e},i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw e};var r=i(i.s=ENTRY_MODULE);return r.default||r}function s(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function n(e,t,r){var n={};n[r]=[];var a=t.toString(),o=a.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!o)return n;for(var l,d=o[1],c=new RegExp("(\\\\n|\\W)"+s(d)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");l=c.exec(a);)"dll-reference"!==l[3]&&n[r].push(l[3]);for(c=new RegExp("\\("+s(d)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");l=c.exec(a);)e[l[2]]||(n[r].push(l[1]),e[l[2]]=i(l[1]).m),n[l[2]]=n[l[2]]||[],n[l[2]].push(l[4]);for(var h,u=Object.keys(n),f=0;f<u.length;f++)for(var p=0;p<n[u[f]].length;p++)h=n[u[f]][p],isNaN(1*h)||(n[u[f]][p]=1*n[u[f]][p]);return n}function a(e){return Object.keys(e).reduce((function(t,i){return t||e[i].length>0}),!1)}e.exports=function(e,t){t=t||{};var s={main:i.m},o=t.all?{main:Object.keys(s.main)}:function(e,t){for(var i={main:[t]},r={main:[]},s={main:{}};a(i);)for(var o=Object.keys(i),l=0;l<o.length;l++){var d=o[l],c=i[d].pop();if(s[d]=s[d]||{},!s[d][c]&&e[d][c]){s[d][c]=!0,r[d]=r[d]||[],r[d].push(c);for(var h=n(e,e[d][c],d),u=Object.keys(h),f=0;f<u.length;f++)i[u[f]]=i[u[f]]||[],i[u[f]]=i[u[f]].concat(h[u[f]])}}return r}(s,e),l="";Object.keys(o).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;o[e][t];)t++;o[e].push(t),s[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",l=l+"var "+e+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+o[e].map((function(t){return JSON.stringify(t)+": "+s[e][t].toString()})).join(",")+"});\n"})),l=l+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+o.main.map((function(e){return JSON.stringify(e)+": "+s.main[e].toString()})).join(",")+"}))(self);";var d=new window.Blob([l],{type:"text/javascript"});if(t.bare)return d;var c=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(d),h=new window.Worker(c);return h.objectURL=c,h}},function(e,t,i){e.exports=i(19).default},function(e,t,i){(function(t,i){
/*!
           * @overview es6-promise - a tiny implementation of Promises/A+.
           * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
           * @license   Licensed under MIT license
           *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
           * @version   v4.2.8+1e68dce6
           */
var r;r=function(){function e(e){return"function"==typeof e}var r=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},s=0,n=void 0,a=void 0,o=function(e,t){p[s]=e,p[s+1]=t,2===(s+=2)&&(a?a(m):E())},l="undefined"!=typeof window?window:void 0,d=l||{},c=d.MutationObserver||d.WebKitMutationObserver,h="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),u="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function f(){var e=setTimeout;return function(){return e(m,1)}}var p=new Array(1e3);function m(){for(var e=0;e<s;e+=2)(0,p[e])(p[e+1]),p[e]=void 0,p[e+1]=void 0;s=0}var g,y,v,_,E=void 0;function b(e,t){var i=this,r=new this.constructor(A);void 0===r[T]&&P(r);var s=i._state;if(s){var n=arguments[s-1];o((function(){return C(s,r,n,i._result)}))}else k(i,r,e,t);return r}function S(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(A);return L(t,e),t}h?E=function(){return t.nextTick(m)}:c?(y=0,v=new c(m),_=document.createTextNode(""),v.observe(_,{characterData:!0}),E=function(){_.data=y=++y%2}):u?((g=new MessageChannel).port1.onmessage=m,E=function(){return g.port2.postMessage(0)}):E=void 0===l?function(){try{var e=Function("return this")().require("vertx");return void 0!==(n=e.runOnLoop||e.runOnContext)?function(){n(m)}:f()}catch(t){return f()}}():f();var T=Math.random().toString(36).substring(2);function A(){}function w(t,i,r){var s,n;i.constructor===t.constructor&&r===b&&i.constructor.resolve===S?(s=t,1===(n=i)._state?R(s,n._result):2===n._state?D(s,n._result):k(n,void 0,(function(e){return L(s,e)}),(function(e){return D(s,e)}))):void 0===r?R(t,i):e(r)?function(e,t,i){o((function(e){var r=!1,s=function(e,t,i,r){try{e.call(t,i,r)}catch(s){return s}}(i,t,(function(i){r||(r=!0,t!==i?L(e,i):R(e,i))}),(function(t){r||(r=!0,D(e,t))}),e._label);!r&&s&&(r=!0,D(e,s))}),e)}(t,i,r):R(t,i)}function L(e,t){if(e===t)D(e,new TypeError("You cannot resolve a promise with itself"));else if(s=typeof(r=t),null===r||"object"!==s&&"function"!==s)R(e,t);else{var i=void 0;try{i=t.then}catch(n){return void D(e,n)}w(e,t,i)}var r,s}function I(e){e._onerror&&e._onerror(e._result),x(e)}function R(e,t){void 0===e._state&&(e._result=t,e._state=1,0!==e._subscribers.length&&o(x,e))}function D(e,t){void 0===e._state&&(e._state=2,e._result=t,o(I,e))}function k(e,t,i,r){var s=e._subscribers,n=s.length;e._onerror=null,s[n]=t,s[n+1]=i,s[n+2]=r,0===n&&e._state&&o(x,e)}function x(e){var t=e._subscribers,i=e._state;if(0!==t.length){for(var r=void 0,s=void 0,n=e._result,a=0;a<t.length;a+=3)r=t[a],s=t[a+i],r?C(i,r,s,n):s(n);e._subscribers.length=0}}function C(t,i,r,s){var n=e(r),a=void 0,o=void 0,l=!0;if(n){try{a=r(s)}catch(d){l=!1,o=d}if(i===a)return void D(i,new TypeError("A promises callback cannot return that same promise."))}else a=s;void 0!==i._state||(n&&l?L(i,a):!1===l?D(i,o):1===t?R(i,a):2===t&&D(i,a))}var M=0;function P(e){e[T]=M++,e._state=void 0,e._result=void 0,e._subscribers=[]}var O=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(A),this.promise[T]||P(this.promise),r(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?R(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&R(this.promise,this._result))):D(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;void 0===this._state&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var i=this._instanceConstructor,r=i.resolve;if(r===S){var s=void 0,n=void 0,a=!1;try{s=e.then}catch(l){a=!0,n=l}if(s===b&&void 0!==e._state)this._settledAt(e._state,t,e._result);else if("function"!=typeof s)this._remaining--,this._result[t]=e;else if(i===N){var o=new i(A);a?D(o,n):w(o,e,s),this._willSettleAt(o,t)}else this._willSettleAt(new i((function(t){return t(e)})),t)}else this._willSettleAt(r(e),t)},e.prototype._settledAt=function(e,t,i){var r=this.promise;void 0===r._state&&(this._remaining--,2===e?D(r,i):this._result[t]=i),0===this._remaining&&R(r,this._result)},e.prototype._willSettleAt=function(e,t){var i=this;k(e,void 0,(function(e){return i._settledAt(1,t,e)}),(function(e){return i._settledAt(2,t,e)}))},e}(),N=function(){function t(e){this[T]=M++,this._result=this._state=void 0,this._subscribers=[],A!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t((function(t){L(e,t)}),(function(t){D(e,t)}))}catch(i){D(e,i)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var i=this.constructor;return e(t)?this.then((function(e){return i.resolve(t()).then((function(){return e}))}),(function(e){return i.resolve(t()).then((function(){throw e}))})):this.then(t,t)},t}();return N.prototype.then=b,N.all=function(e){return new O(this,e).promise},N.race=function(e){var t=this;return r(e)?new t((function(i,r){for(var s=e.length,n=0;n<s;n++)t.resolve(e[n]).then(i,r)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))},N.resolve=S,N.reject=function(e){var t=new this(A);return D(t,e),t},N._setScheduler=function(e){a=e},N._setAsap=function(e){o=e},N._asap=o,N.polyfill=function(){var e=void 0;if(void 0!==i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(s){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(s){}if("[object Promise]"===r&&!t.cast)return}e.Promise=N},N.Promise=N,N},e.exports=r()}).call(this,i(16),i(17))},function(e,t){var i,r,s=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(i===setTimeout)return setTimeout(e,0);if((i===n||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(r){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:n}catch(e){i=n}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var l,d=[],c=!1,h=-1;function u(){c&&l&&(c=!1,l.length?d=l.concat(d):h=-1,d.length&&f())}function f(){if(!c){var e=o(u);c=!0;for(var t=d.length;t;){for(l=d,d=[];++h<t;)l&&l[h].run();h=-1,t=d.length}l=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(i){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];d.push(new p(e,t)),1!==d.length||c||o(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(r){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){i.r(t);var r=i(9),s=i(12),n=i(10),a=i(1);t.default=function(e){var t=null,i=function(t,i){e.postMessage({msg:"logcat_callback",data:{type:t,logcat:i}})}.bind(this);function o(t,i){var r={msg:a.a.INIT_SEGMENT,data:{type:t,data:i}};e.postMessage(r,[i.data])}function l(t,i){var r={msg:a.a.MEDIA_SEGMENT,data:{type:t,data:i}};e.postMessage(r,[i.data])}function d(){var t={msg:a.a.LOADING_COMPLETE};e.postMessage(t)}function c(){var t={msg:a.a.RECOVERED_EARLY_EOF};e.postMessage(t)}function h(t){var i={msg:a.a.MEDIA_INFO,data:t};e.postMessage(i)}function u(t){var i={msg:a.a.METADATA_ARRIVED,data:t};e.postMessage(i)}function f(t){var i={msg:a.a.SCRIPTDATA_ARRIVED,data:t};e.postMessage(i)}function p(t){var i={msg:a.a.TIMED_ID3_METADATA_ARRIVED,data:t};e.postMessage(i)}function m(t){var i={msg:a.a.SMPTE2038_METADATA_ARRIVED,data:t};e.postMessage(i)}function g(t){var i={msg:a.a.SCTE35_METADATA_ARRIVED,data:t};e.postMessage(i)}function y(t){var i={msg:a.a.PES_PRIVATE_DATA_DESCRIPTOR,data:t};e.postMessage(i)}function v(t){var i={msg:a.a.PES_PRIVATE_DATA_ARRIVED,data:t};e.postMessage(i)}function _(t){var i={msg:a.a.STATISTICS_INFO,data:t};e.postMessage(i)}function E(t,i){e.postMessage({msg:a.a.IO_ERROR,data:{type:t,info:i}})}function b(t,i){e.postMessage({msg:a.a.DEMUX_ERROR,data:{type:t,info:i}})}function S(t){e.postMessage({msg:a.a.RECOMMEND_SEEKPOINT,data:t})}s.a.install(),e.addEventListener("message",(function(s){switch(s.data.cmd){case"init":(t=new n.a(s.data.param[0],s.data.param[1])).on(a.a.IO_ERROR,E.bind(this)),t.on(a.a.DEMUX_ERROR,b.bind(this)),t.on(a.a.INIT_SEGMENT,o.bind(this)),t.on(a.a.MEDIA_SEGMENT,l.bind(this)),t.on(a.a.LOADING_COMPLETE,d.bind(this)),t.on(a.a.RECOVERED_EARLY_EOF,c.bind(this)),t.on(a.a.MEDIA_INFO,h.bind(this)),t.on(a.a.METADATA_ARRIVED,u.bind(this)),t.on(a.a.SCRIPTDATA_ARRIVED,f.bind(this)),t.on(a.a.TIMED_ID3_METADATA_ARRIVED,p.bind(this)),t.on(a.a.SMPTE2038_METADATA_ARRIVED,m.bind(this)),t.on(a.a.SCTE35_METADATA_ARRIVED,g.bind(this)),t.on(a.a.PES_PRIVATE_DATA_DESCRIPTOR,y.bind(this)),t.on(a.a.PES_PRIVATE_DATA_ARRIVED,v.bind(this)),t.on(a.a.STATISTICS_INFO,_.bind(this)),t.on(a.a.RECOMMEND_SEEKPOINT,S.bind(this));break;case"destroy":t&&(t.destroy(),t=null),e.postMessage({msg:"destroyed"});break;case"start":t.start();break;case"stop":t.stop();break;case"seek":t.seek(s.data.param);break;case"pause":t.pause();break;case"resume":t.resume();break;case"logging_config":var T=s.data.param;r.a.applyConfig(T),!0===T.enableCallback?r.a.addLogListener(i):r.a.removeLogListener(i)}}))}},function(e,t,i){i.r(t);var r=i(12),s=i(11),n={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,liveBufferLatencyChasing:!1,liveBufferLatencyMaxLatency:1.5,liveBufferLatencyMinRemain:.5,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function a(){return Object.assign({},n)}var o=function(){function e(){}return e.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},e.supportMSEH265Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="hvc1.1.6.L93.B0"')},e.supportNetworkStreamIO=function(){var e=new s.a({},a()),t=e.loaderType;return e.destroy(),"fetch-stream-loader"==t||"xhr-moz-chunked-loader"==t},e.getNetworkLoaderTypeName=function(){var e=new s.a({},a()),t=e.loaderType;return e.destroy(),t},e.supportNativeMediaPlayback=function(t){null==e.videoElement&&(e.videoElement=window.document.createElement("video"));var i=e.videoElement.canPlayType(t);return"probably"===i||"maybe"==i},e.getFeatureList=function(){var t={msePlayback:!1,mseLivePlayback:!1,mseH265Playback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeMP4H265Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return t.msePlayback=e.supportMSEH264Playback(),t.networkStreamIO=e.supportNetworkStreamIO(),t.networkLoaderName=e.getNetworkLoaderTypeName(),t.mseLivePlayback=t.msePlayback&&t.networkStreamIO,t.mseH265Playback=e.supportMSEH265Playback(),t.nativeMP4H264Playback=e.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),t.nativeMP4H265Playback=e.supportNativeMediaPlayback('video/mp4; codecs="hvc1.1.6.L93.B0"'),t.nativeWebmVP8Playback=e.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),t.nativeWebmVP9Playback=e.supportNativeMediaPlayback('video/webm; codecs="vp9"'),t},e}(),l=i(2),d=i(6),c=i.n(d),h=i(0),u=i(4),f={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",TIMED_ID3_METADATA_ARRIVED:"timed_id3_metadata_arrived",SMPTE2038_METADATA_ARRIVED:"smpte2038_metadata_arrived",SCTE35_METADATA_ARRIVED:"scte35_metadata_arrived",PES_PRIVATE_DATA_DESCRIPTOR:"pes_private_data_descriptor",PES_PRIVATE_DATA_ARRIVED:"pes_private_data_arrived",STATISTICS_INFO:"statistics_info"},p=i(13),m=i.n(p),g=i(9),y=i(10),v=i(1),_=i(8),E=function(){function e(e,t){if(this.TAG="Transmuxer",this._emitter=new c.a,t.enableWorker&&"undefined"!=typeof Worker)try{this._worker=m()(18),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[e,t]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},g.a.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:g.a.getConfig()})}catch(r){h.a.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new y.a(e,t)}else this._controller=new y.a(e,t);if(this._controller){var i=this._controller;i.on(v.a.IO_ERROR,this._onIOError.bind(this)),i.on(v.a.DEMUX_ERROR,this._onDemuxError.bind(this)),i.on(v.a.INIT_SEGMENT,this._onInitSegment.bind(this)),i.on(v.a.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),i.on(v.a.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),i.on(v.a.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),i.on(v.a.MEDIA_INFO,this._onMediaInfo.bind(this)),i.on(v.a.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),i.on(v.a.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),i.on(v.a.TIMED_ID3_METADATA_ARRIVED,this._onTimedID3MetadataArrived.bind(this)),i.on(v.a.SMPTE2038_METADATA_ARRIVED,this._onSMPTE2038MetadataArrived.bind(this)),i.on(v.a.SCTE35_METADATA_ARRIVED,this._onSCTE35MetadataArrived.bind(this)),i.on(v.a.PES_PRIVATE_DATA_DESCRIPTOR,this._onPESPrivateDataDescriptor.bind(this)),i.on(v.a.PES_PRIVATE_DATA_ARRIVED,this._onPESPrivateDataArrived.bind(this)),i.on(v.a.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),i.on(v.a.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return e.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),g.a.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.hasWorker=function(){return null!=this._worker},e.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},e.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},e.prototype.seek=function(e){this._worker?this._worker.postMessage({cmd:"seek",param:e}):this._controller.seek(e)},e.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},e.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},e.prototype._onInitSegment=function(e,t){var i=this;Promise.resolve().then((function(){i._emitter.emit(v.a.INIT_SEGMENT,e,t)}))},e.prototype._onMediaSegment=function(e,t){var i=this;Promise.resolve().then((function(){i._emitter.emit(v.a.MEDIA_SEGMENT,e,t)}))},e.prototype._onLoadingComplete=function(){var e=this;Promise.resolve().then((function(){e._emitter.emit(v.a.LOADING_COMPLETE)}))},e.prototype._onRecoveredEarlyEof=function(){var e=this;Promise.resolve().then((function(){e._emitter.emit(v.a.RECOVERED_EARLY_EOF)}))},e.prototype._onMediaInfo=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(v.a.MEDIA_INFO,e)}))},e.prototype._onMetaDataArrived=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(v.a.METADATA_ARRIVED,e)}))},e.prototype._onScriptDataArrived=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(v.a.SCRIPTDATA_ARRIVED,e)}))},e.prototype._onTimedID3MetadataArrived=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(v.a.TIMED_ID3_METADATA_ARRIVED,e)}))},e.prototype._onSMPTE2038MetadataArrived=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(v.a.SMPTE2038_METADATA_ARRIVED,e)}))},e.prototype._onSCTE35MetadataArrived=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(v.a.SCTE35_METADATA_ARRIVED,e)}))},e.prototype._onPESPrivateDataDescriptor=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(v.a.PES_PRIVATE_DATA_DESCRIPTOR,e)}))},e.prototype._onPESPrivateDataArrived=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(v.a.PES_PRIVATE_DATA_ARRIVED,e)}))},e.prototype._onStatisticsInfo=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(v.a.STATISTICS_INFO,e)}))},e.prototype._onIOError=function(e,t){var i=this;Promise.resolve().then((function(){i._emitter.emit(v.a.IO_ERROR,e,t)}))},e.prototype._onDemuxError=function(e,t){var i=this;Promise.resolve().then((function(){i._emitter.emit(v.a.DEMUX_ERROR,e,t)}))},e.prototype._onRecommendSeekpoint=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(v.a.RECOMMEND_SEEKPOINT,e)}))},e.prototype._onLoggingConfigChanged=function(e){this._worker&&this._worker.postMessage({cmd:"logging_config",param:e})},e.prototype._onWorkerMessage=function(e){var t=e.data,i=t.data;if("destroyed"===t.msg||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(t.msg){case v.a.INIT_SEGMENT:case v.a.MEDIA_SEGMENT:this._emitter.emit(t.msg,i.type,i.data);break;case v.a.LOADING_COMPLETE:case v.a.RECOVERED_EARLY_EOF:this._emitter.emit(t.msg);break;case v.a.MEDIA_INFO:Object.setPrototypeOf(i,_.a.prototype),this._emitter.emit(t.msg,i);break;case v.a.METADATA_ARRIVED:case v.a.SCRIPTDATA_ARRIVED:case v.a.TIMED_ID3_METADATA_ARRIVED:case v.a.SMPTE2038_METADATA_ARRIVED:case v.a.SCTE35_METADATA_ARRIVED:case v.a.PES_PRIVATE_DATA_DESCRIPTOR:case v.a.PES_PRIVATE_DATA_ARRIVED:case v.a.STATISTICS_INFO:this._emitter.emit(t.msg,i);break;case v.a.IO_ERROR:case v.a.DEMUX_ERROR:this._emitter.emit(t.msg,i.type,i.info);break;case v.a.RECOMMEND_SEEKPOINT:this._emitter.emit(t.msg,i);break;case"logcat_callback":h.a.emitter.emit("log",i.type,i.logcat)}},e}(),b={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"},S=i(7),T=i(3),A=function(){function e(e){this.TAG="MSEController",this._config=e,this._emitter=new c.a,this._config.isLive&&null==this._config.autoCleanupSourceBuffer&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new S.a}return e.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.attachMediaElement=function(e){if(this._mediaSource)throw new T.a("MediaSource has been attached to an HTMLMediaElement!");var t=this._mediaSource=new window.MediaSource;t.addEventListener("sourceopen",this.e.onSourceOpen),t.addEventListener("sourceended",this.e.onSourceEnded),t.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=e,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),e.src=this._mediaSourceObjectURL},e.prototype.detachMediaElement=function(){if(this._mediaSource){var e=this._mediaSource;for(var t in this._sourceBuffers){var i=this._pendingSegments[t];i.splice(0,i.length),this._pendingSegments[t]=null,this._pendingRemoveRanges[t]=null,this._lastInitSegments[t]=null;var r=this._sourceBuffers[t];if(r){if("closed"!==e.readyState){try{e.removeSourceBuffer(r)}catch(s){h.a.e(this.TAG,s.message)}r.removeEventListener("error",this.e.onSourceBufferError),r.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[t]=null,this._sourceBuffers[t]=null}}if("open"===e.readyState)try{e.endOfStream()}catch(s){h.a.e(this.TAG,s.message)}e.removeEventListener("sourceopen",this.e.onSourceOpen),e.removeEventListener("sourceended",this.e.onSourceEnded),e.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},e.prototype.appendInitSegment=function(e,t){if(!this._mediaSource||"open"!==this._mediaSource.readyState)return this._pendingSourceBufferInit.push(e),void this._pendingSegments[e.type].push(e);var i=e,r=""+i.container;i.codec&&i.codec.length>0&&(r+=";codecs="+i.codec);var s=!1;if(h.a.v(this.TAG,"Received Initialization Segment, mimeType: "+r),this._lastInitSegments[i.type]=i,r!==this._mimeTypes[i.type]){if(this._mimeTypes[i.type])h.a.v(this.TAG,"Notice: "+i.type+" mimeType changed, origin: "+this._mimeTypes[i.type]+", target: "+r);else{s=!0;try{var n=this._sourceBuffers[i.type]=this._mediaSource.addSourceBuffer(r);n.addEventListener("error",this.e.onSourceBufferError),n.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(a){return h.a.e(this.TAG,a.message),void this._emitter.emit(b.ERROR,{code:a.code,msg:a.message})}}this._mimeTypes[i.type]=r}t||this._pendingSegments[i.type].push(i),s||this._sourceBuffers[i.type]&&!this._sourceBuffers[i.type].updating&&this._doAppendSegments(),u.a.safari&&"audio/mpeg"===i.container&&i.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=i.mediaDuration/1e3,this._updateMediaSourceDuration())},e.prototype.appendMediaSegment=function(e){var t=e;this._pendingSegments[t.type].push(t),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var i=this._sourceBuffers[t.type];!i||i.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()},e.prototype.seek=function(e){for(var t in this._sourceBuffers)if(this._sourceBuffers[t]){var i=this._sourceBuffers[t];if("open"===this._mediaSource.readyState)try{i.abort()}catch(l){h.a.e(this.TAG,l.message)}this._idrList.clear();var r=this._pendingSegments[t];if(r.splice(0,r.length),"closed"!==this._mediaSource.readyState){for(var s=0;s<i.buffered.length;s++){var n=i.buffered.start(s),a=i.buffered.end(s);this._pendingRemoveRanges[t].push({start:n,end:a})}if(i.updating||this._doRemoveRanges(),u.a.safari){var o=this._lastInitSegments[t];o&&(this._pendingSegments[t].push(o),i.updating||this._doAppendSegments())}}}},e.prototype.endOfStream=function(){var e=this._mediaSource,t=this._sourceBuffers;e&&"open"===e.readyState?t.video&&t.video.updating||t.audio&&t.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,e.endOfStream()):e&&"closed"===e.readyState&&this._hasPendingSegments()&&(this._hasPendingEos=!0)},e.prototype.getNearestKeyframe=function(e){return this._idrList.getLastSyncPointBeforeDts(e)},e.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var i=this._sourceBuffers[t];if(i){var r=i.buffered;if(r.length>=1&&e-r.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},e.prototype._doCleanupSourceBuffer=function(){var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var i=this._sourceBuffers[t];if(i){for(var r=i.buffered,s=!1,n=0;n<r.length;n++){var a=r.start(n),o=r.end(n);if(a<=e&&e<o+3){if(e-a>=this._config.autoCleanupMaxBackwardDuration){s=!0;var l=e-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[t].push({start:a,end:l})}}else o<e&&(s=!0,this._pendingRemoveRanges[t].push({start:a,end:o}))}s&&!i.updating&&this._doRemoveRanges()}}},e.prototype._updateMediaSourceDuration=function(){var e=this._sourceBuffers;if(0!==this._mediaElement.readyState&&"open"===this._mediaSource.readyState&&!(e.video&&e.video.updating||e.audio&&e.audio.updating)){var t=this._mediaSource.duration,i=this._pendingMediaDuration;i>0&&(isNaN(t)||i>t)&&(h.a.v(this.TAG,"Update MediaSource duration from "+t+" to "+i),this._mediaSource.duration=i),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},e.prototype._doRemoveRanges=function(){for(var e in this._pendingRemoveRanges)if(this._sourceBuffers[e]&&!this._sourceBuffers[e].updating)for(var t=this._sourceBuffers[e],i=this._pendingRemoveRanges[e];i.length&&!t.updating;){var r=i.shift();t.remove(r.start,r.end)}},e.prototype._doAppendSegments=function(){var e=this._pendingSegments;for(var t in e)if(this._sourceBuffers[t]&&!this._sourceBuffers[t].updating&&e[t].length>0){var i=e[t].shift();if(i.timestampOffset){var r=this._sourceBuffers[t].timestampOffset,s=i.timestampOffset/1e3;Math.abs(r-s)>.1&&(h.a.v(this.TAG,"Update MPEG audio timestampOffset from "+r+" to "+s),this._sourceBuffers[t].timestampOffset=s),delete i.timestampOffset}if(!i.data||0===i.data.byteLength)continue;try{this._sourceBuffers[t].appendBuffer(i.data),this._isBufferFull=!1,"video"===t&&i.hasOwnProperty("info")&&this._idrList.appendArray(i.info.syncPoints)}catch(n){this._pendingSegments[t].unshift(i),22===n.code?(this._isBufferFull||this._emitter.emit(b.BUFFER_FULL),this._isBufferFull=!0):(h.a.e(this.TAG,n.message),this._emitter.emit(b.ERROR,{code:n.code,msg:n.message}))}}},e.prototype._onSourceOpen=function(){if(h.a.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var e=this._pendingSourceBufferInit;e.length;){var t=e.shift();this.appendInitSegment(t,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(b.SOURCE_OPEN)},e.prototype._onSourceEnded=function(){h.a.v(this.TAG,"MediaSource onSourceEnded")},e.prototype._onSourceClose=function(){h.a.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&null!=this.e&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},e.prototype._hasPendingSegments=function(){var e=this._pendingSegments;return e.video.length>0||e.audio.length>0},e.prototype._hasPendingRemoveRanges=function(){var e=this._pendingRemoveRanges;return e.video.length>0||e.audio.length>0},e.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(b.UPDATE_END)},e.prototype._onSourceBufferError=function(e){h.a.e(this.TAG,"SourceBuffer Error: "+e)},e}(),w=i(5),L={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},I={NETWORK_EXCEPTION:l.b.EXCEPTION,NETWORK_STATUS_CODE_INVALID:l.b.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:l.b.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:l.b.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:w.a.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:w.a.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:w.a.CODEC_UNSUPPORTED},R=function(){function e(e,t){this.TAG="MSEPlayer",this._type="MSEPlayer",this._emitter=new c.a,this._config=a(),"object"==typeof t&&Object.assign(this._config,t);var i=e.type.toLowerCase();if("mse"!==i&&"mpegts"!==i&&"m2ts"!==i&&"flv"!==i)throw new T.b("MSEPlayer requires an mpegts/m2ts/flv MediaDataSource input!");!0===e.isLive&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=e,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var r=u.a.chrome&&(u.a.version.major<50||50===u.a.version.major&&u.a.version.build<2661);this._alwaysSeekKeyframe=!!(r||u.a.msedge||u.a.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return e.prototype.destroy=function(){null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){var i=this;e===f.MEDIA_INFO?null!=this._mediaInfo&&Promise.resolve().then((function(){i._emitter.emit(f.MEDIA_INFO,i.mediaInfo)})):e===f.STATISTICS_INFO&&null!=this._statisticsInfo&&Promise.resolve().then((function(){i._emitter.emit(f.STATISTICS_INFO,i.statisticsInfo)})),this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.attachMediaElement=function(e){var t=this;if(this._mediaElement=e,e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),e.addEventListener("seeking",this.e.onvSeeking),e.addEventListener("canplay",this.e.onvCanPlay),e.addEventListener("stalled",this.e.onvStalled),e.addEventListener("progress",this.e.onvProgress),this._msectl=new A(this._config),this._msectl.on(b.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(b.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(b.SOURCE_OPEN,(function(){t._mseSourceOpened=!0,t._hasPendingLoad&&(t._hasPendingLoad=!1,t.load())})),this._msectl.on(b.ERROR,(function(e){t._emitter.emit(f.ERROR,L.MEDIA_ERROR,I.MEDIA_MSE_ERROR,e)})),this._msectl.attachMediaElement(e),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(i){}},e.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},e.prototype.load=function(){var e=this;if(!this._mediaElement)throw new T.a("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new T.a("MSEPlayer.load() has been called, please call unload() first!");this._hasPendingLoad||(this._config.deferLoadAfterSourceOpen&&!1===this._mseSourceOpened?this._hasPendingLoad=!0:(this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new E(this._mediaDataSource,this._config),this._transmuxer.on(v.a.INIT_SEGMENT,(function(t,i){e._msectl.appendInitSegment(i)})),this._transmuxer.on(v.a.MEDIA_SEGMENT,(function(t,i){if(e._msectl.appendMediaSegment(i),e._config.lazyLoad&&!e._config.isLive){var r=e._mediaElement.currentTime;i.info.endDts>=1e3*(r+e._config.lazyLoadMaxDuration)&&null==e._progressChecker&&(h.a.v(e.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),e._suspendTransmuxer())}})),this._transmuxer.on(v.a.LOADING_COMPLETE,(function(){e._msectl.endOfStream(),e._emitter.emit(f.LOADING_COMPLETE)})),this._transmuxer.on(v.a.RECOVERED_EARLY_EOF,(function(){e._emitter.emit(f.RECOVERED_EARLY_EOF)})),this._transmuxer.on(v.a.IO_ERROR,(function(t,i){e._emitter.emit(f.ERROR,L.NETWORK_ERROR,t,i)})),this._transmuxer.on(v.a.DEMUX_ERROR,(function(t,i){e._emitter.emit(f.ERROR,L.MEDIA_ERROR,t,{code:-1,msg:i})})),this._transmuxer.on(v.a.MEDIA_INFO,(function(t){e._mediaInfo=t,e._emitter.emit(f.MEDIA_INFO,Object.assign({},t))})),this._transmuxer.on(v.a.METADATA_ARRIVED,(function(t){e._emitter.emit(f.METADATA_ARRIVED,t)})),this._transmuxer.on(v.a.SCRIPTDATA_ARRIVED,(function(t){e._emitter.emit(f.SCRIPTDATA_ARRIVED,t)})),this._transmuxer.on(v.a.TIMED_ID3_METADATA_ARRIVED,(function(t){e._emitter.emit(f.TIMED_ID3_METADATA_ARRIVED,t)})),this._transmuxer.on(v.a.SMPTE2038_METADATA_ARRIVED,(function(t){e._emitter.emit(f.SMPTE2038_METADATA_ARRIVED,t)})),this._transmuxer.on(v.a.SCTE35_METADATA_ARRIVED,(function(t){e._emitter.emit(f.SCTE35_METADATA_ARRIVED,t)})),this._transmuxer.on(v.a.PES_PRIVATE_DATA_DESCRIPTOR,(function(t){e._emitter.emit(f.PES_PRIVATE_DATA_DESCRIPTOR,t)})),this._transmuxer.on(v.a.PES_PRIVATE_DATA_ARRIVED,(function(t){e._emitter.emit(f.PES_PRIVATE_DATA_ARRIVED,t)})),this._transmuxer.on(v.a.STATISTICS_INFO,(function(t){e._statisticsInfo=e._fillStatisticsInfo(t),e._emitter.emit(f.STATISTICS_INFO,Object.assign({},e._statisticsInfo))})),this._transmuxer.on(v.a.RECOMMEND_SEEKPOINT,(function(t){e._mediaElement&&!e._config.accurateSeek&&(e._requestSetTime=!0,e._mediaElement.currentTime=t/1e3)})),this._transmuxer.open()))},e.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},e.prototype.play=function(){return this._mediaElement.play()},e.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){this._mediaElement?this._internalSeek(e):this._pendingSeekTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"statisticsInfo",{get:function(){return null==this._statisticsInfo&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),e.prototype._fillStatisticsInfo=function(e){if(e.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,i=0,r=0;if(this._mediaElement.getVideoPlaybackQuality){var s=this._mediaElement.getVideoPlaybackQuality();i=s.totalVideoFrames,r=s.droppedVideoFrames}else null!=this._mediaElement.webkitDecodedFrameCount?(i=this._mediaElement.webkitDecodedFrameCount,r=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=i,e.droppedFrames=r),e},e.prototype._onmseUpdateEnd=function(){var e=this._mediaElement.buffered,t=this._mediaElement.currentTime;if(this._config.isLive&&this._config.liveBufferLatencyChasing&&e.length>0&&!this._mediaElement.paused){var i=e.end(e.length-1);if(i>this._config.liveBufferLatencyMaxLatency&&i-t>this._config.liveBufferLatencyMaxLatency){var r=i-this._config.liveBufferLatencyMinRemain;this.currentTime=r}}if(this._config.lazyLoad&&!this._config.isLive){for(var s=0,n=0;n<e.length;n++){var a=e.start(n),o=e.end(n);if(a<=t&&t<o){s=o;break}}s>=t+this._config.lazyLoadMaxDuration&&null==this._progressChecker&&(h.a.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},e.prototype._onmseBufferFull=function(){h.a.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),null==this._progressChecker&&this._suspendTransmuxer()},e.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),null==this._progressChecker&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},e.prototype._checkProgressAndResume=function(){for(var e=this._mediaElement.currentTime,t=this._mediaElement.buffered,i=!1,r=0;r<t.length;r++){var s=t.start(r),n=t.end(r);if(e>=s&&e<n){e>=n-this._config.lazyLoadRecoverDuration&&(i=!0);break}}i&&(window.clearInterval(this._progressChecker),this._progressChecker=null,i&&(h.a.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},e.prototype._isTimepointBuffered=function(e){for(var t=this._mediaElement.buffered,i=0;i<t.length;i++){var r=t.start(i),s=t.end(i);if(e>=r&&e<s)return!0}return!1},e.prototype._internalSeek=function(e){var t=this._isTimepointBuffered(e),i=!1,r=0;if(e<1&&this._mediaElement.buffered.length>0){var s=this._mediaElement.buffered.start(0);(s<1&&e<s||u.a.safari)&&(i=!0,r=u.a.safari?.1:s)}if(i)this._requestSetTime=!0,this._mediaElement.currentTime=r;else if(t){if(this._alwaysSeekKeyframe){var n=this._msectl.getNearestKeyframe(Math.floor(1e3*e));this._requestSetTime=!0,this._mediaElement.currentTime=null!=n?n.dts/1e3:e}else this._requestSetTime=!0,this._mediaElement.currentTime=e;null!=this._progressChecker&&this._checkProgressAndResume()}else null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(e),this._transmuxer.seek(Math.floor(1e3*e)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e)},e.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var e=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(e)||(null!=this._progressChecker&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(e),this._transmuxer.seek(Math.floor(1e3*e)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},e.prototype._checkAndResumeStuckPlayback=function(e){var t=this._mediaElement;if(e||!this._receivedCanPlay||t.readyState<2){var i=t.buffered;i.length>0&&t.currentTime<i.start(0)&&(h.a.w(this.TAG,"Playback seems stuck at "+t.currentTime+", seek to "+i.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=i.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},e.prototype._onvLoadedMetadata=function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},e.prototype._onvSeeking=function(e){var t=this._mediaElement.currentTime,i=this._mediaElement.buffered;if(this._requestSetTime)this._requestSetTime=!1;else{if(t<1&&i.length>0){var r=i.start(0);if(r<1&&t<r||u.a.safari)return this._requestSetTime=!0,void(this._mediaElement.currentTime=u.a.safari?.1:r)}if(this._isTimepointBuffered(t)){if(this._alwaysSeekKeyframe){var s=this._msectl.getNearestKeyframe(Math.floor(1e3*t));null!=s&&(this._requestSetTime=!0,this._mediaElement.currentTime=s.dts/1e3)}null!=this._progressChecker&&this._checkProgressAndResume()}else this._seekpointRecord={seekPoint:t,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},e.prototype._onvCanPlay=function(e){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},e.prototype._onvStalled=function(e){this._checkAndResumeStuckPlayback(!0)},e.prototype._onvProgress=function(e){this._checkAndResumeStuckPlayback()},e}(),D=function(){function e(e,t){this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new c.a,this._config=a(),"object"==typeof t&&Object.assign(this._config,t);var i=e.type.toLowerCase();if("mse"===i||"mpegts"===i||"m2ts"===i||"flv"===i)throw new T.b("NativePlayer does't support mse/mpegts/m2ts/flv MediaDataSource input!");if(e.hasOwnProperty("segments"))throw new T.b("NativePlayer("+e.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=e,this._mediaElement=null}return e.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){var i=this;e===f.MEDIA_INFO?null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then((function(){i._emitter.emit(f.MEDIA_INFO,i.mediaInfo)})):e===f.STATISTICS_INFO&&null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then((function(){i._emitter.emit(f.STATISTICS_INFO,i.statisticsInfo)})),this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.attachMediaElement=function(e){if(this._mediaElement=e,e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(t){}},e.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},e.prototype.load=function(){if(!this._mediaElement)throw new T.a("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},e.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},e.prototype.play=function(){return this._mediaElement.play()},e.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){this._mediaElement?this._mediaElement.currentTime=e:this._pendingSeekTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mediaInfo",{get:function(){var e={mimeType:(this._mediaElement instanceof HTMLAudioElement?"audio/":"video/")+this._mediaDataSource.type};return this._mediaElement&&(e.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(e.width=this._mediaElement.videoWidth,e.height=this._mediaElement.videoHeight)),e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"statisticsInfo",{get:function(){var e={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,i=0,r=0;if(this._mediaElement.getVideoPlaybackQuality){var s=this._mediaElement.getVideoPlaybackQuality();i=s.totalVideoFrames,r=s.droppedVideoFrames}else null!=this._mediaElement.webkitDecodedFrameCount?(i=this._mediaElement.webkitDecodedFrameCount,r=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=i,e.droppedFrames=r),e},enumerable:!1,configurable:!0}),e.prototype._onvLoadedMetadata=function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(f.MEDIA_INFO,this.mediaInfo)},e.prototype._reportStatisticsInfo=function(){this._emitter.emit(f.STATISTICS_INFO,this.statisticsInfo)},e}();r.a.install();var k={createPlayer:function(e,t){var i=e;if(null==i||"object"!=typeof i)throw new T.b("MediaDataSource must be an javascript object!");if(!i.hasOwnProperty("type"))throw new T.b("MediaDataSource must has type field to indicate video file type!");switch(i.type){case"mse":case"mpegts":case"m2ts":case"flv":return new R(i,t);default:return new D(i,t)}},isSupported:function(){return o.supportMSEH264Playback()},getFeatureList:function(){return o.getFeatureList()}};k.BaseLoader=l.a,k.LoaderStatus=l.c,k.LoaderErrors=l.b,k.Events=f,k.ErrorTypes=L,k.ErrorDetails=I,k.MSEPlayer=R,k.NativePlayer=D,k.LoggingControl=g.a,Object.defineProperty(k,"version",{enumerable:!0,get:function(){return"1.7.2"}}),t.default=k}])),j.exports));function z(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var V,$,H,Y,K,W={exports:{}};V=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,$=/^(?=([^\/?#]*))\1([^]*)$/,H=/(?:\/|^)\.(?=\/)/g,Y=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g;var q=W.exports=K={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),!(t=t.trim())){if(!i.alwaysNormalize)return e;var r=K.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=K.normalizePath(r.path),K.buildURLFromParts(r)}var s=K.parseURL(t);if(!s)throw new Error("Error trying to parse relative URL.");if(s.scheme)return i.alwaysNormalize?(s.path=K.normalizePath(s.path),K.buildURLFromParts(s)):t;var n=K.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");if(!n.netLoc&&n.path&&"/"!==n.path[0]){var a=$.exec(n.path);n.netLoc=a[1],n.path=a[2]}n.netLoc&&!n.path&&(n.path="/");var o={scheme:n.scheme,netLoc:s.netLoc,path:null,params:s.params,query:s.query,fragment:s.fragment};if(!s.netLoc&&(o.netLoc=n.netLoc,"/"!==s.path[0]))if(s.path){var l=n.path,d=l.substring(0,l.lastIndexOf("/")+1)+s.path;o.path=K.normalizePath(d)}else o.path=n.path,s.params||(o.params=n.params,s.query||(o.query=n.query));return null===o.path&&(o.path=i.alwaysNormalize?K.normalizePath(s.path):s.path),K.buildURLFromParts(o)},parseURL:function(e){var t=V.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(H,"");e.length!==(e=e.replace(Y,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};function Q(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function Z(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(i),!0).forEach((function(t){X(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Q(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function X(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function J(){return J=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},J.apply(this,arguments)}const ee=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)};let te=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e}({}),ie=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),re=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.UNKNOWN="unknown",e}({});const se=function(){},ne={trace:se,debug:se,log:se,warn:se,info:se,error:se};let ae=ne;function oe(e,...t){t.forEach((function(t){ae[t]=e[t]?e[t].bind(e):function(e){const t=self.console[e];return t?t.bind(self.console,`[${e}] >`):se}(t)}))}const le=ae,de=/^(\d+)x(\d+)$/,ce=/(.+?)=(".*?"|.*?)(?:,|$)/g;class he{constructor(e){"string"==typeof e&&(e=he.parseAttrList(e));for(const t in e)e.hasOwnProperty(t)&&("X-"===t.substring(0,2)&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(t)),this[t]=e[t])}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const i=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)i[e]=parseInt(t.slice(2*e,2*e+2),16);return i}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}bool(e){return"YES"===this[e]}decimalResolution(e){const t=de.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;const i={};for(ce.lastIndex=0;null!==(t=ce.exec(e));){let e=t[2];0===e.indexOf('"')&&e.lastIndexOf('"')===e.length-1&&(e=e.slice(1,-1));i[t[1].trim()]=e}return i}}function ue(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e}class fe{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){const i=t.attr;for(const t in i)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==i[t]){le.warn(`DATERANGE tag attribute: "${t}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=t;break}e=J(new he({}),i,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const e=new Date(this.attr["END-DATE"]);ee(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return null!==e?new Date(this._startDate.getTime()+1e3*e):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(ee(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&ee(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class pe{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var me="audio",ge="video",ye="audiovideo";class ve{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[me]:null,[ge]:null,[ye]:null},this.baseurl=e}setByteRange(e,t){const i=e.split("@",2),r=[];1===i.length?r[0]=t?t.byteRangeEndOffset:0:r[0]=parseInt(i[1]),r[1]=parseInt(i[0])+r[0],this._byteRange=r}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=q.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class _e extends ve{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new pe,this.urlId=0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{const e=Object.keys(this.levelkeys);if(1===e.length)return this._decryptdata=this.levelkeys[e[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;if(!ee(this.programDateTime))return null;const e=ee(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){const e=Object.keys(this.levelkeys),t=e.length;if(t>1||1===t&&this.levelkeys[e[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,i,r,s,n=!1){const{elementaryStreams:a}=this,o=a[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,i),o.startDTS=Math.min(o.startDTS,r),o.endDTS=Math.max(o.endDTS,s)):a[e]={startPTS:t,endPTS:i,startDTS:r,endDTS:s,partial:n}}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[me]=null,e[ge]=null,e[ye]=null}}class Ee extends ve{constructor(e,t,i,r,s){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new pe,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const n=e.enumeratedString("BYTERANGE");n&&this.setByteRange(n,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}class be{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t,this.advanced=this.endSN>e.endSN||t>0||0===t&&i>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return!!this.fragments.length&&ee(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const e=this.driftEndTime-this.driftStartTime;if(e>0){return 1e3*(this.driftEnd-this.driftStart)/e}return 1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function Se(e){return Uint8Array.from(atob(e),(e=>e.charCodeAt(0)))}function Te(e){const t=e.split(":");let i=null;if("data"===t[0]&&2===t.length){const e=t[1].split(";"),r=e[e.length-1].split(",");if(2===r.length){const t="base64"===r[0],s=r[1];t?(e.splice(-1,1),i=Se(s)):i=function(e){const t=Ae(e).subarray(0,16),i=new Uint8Array(16);return i.set(t,16-t.length),i}(s)}}return i}function Ae(e){return Uint8Array.from(unescape(encodeURIComponent(e)),(e=>e.charCodeAt(0)))}var we={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Le="org.w3.clearkey",Ie="com.apple.streamingkeydelivery",Re="com.microsoft.playready",De="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function ke(e){switch(e){case Ie:return we.FAIRPLAY;case Re:return we.PLAYREADY;case De:return we.WIDEVINE;case Le:return we.CLEARKEY}}var xe="edef8ba979d64acea3c827dcd51d21ed";function Ce(e){switch(e){case we.FAIRPLAY:return Ie;case we.PLAYREADY:return Re;case we.WIDEVINE:return De;case we.CLEARKEY:return Le}}function Me(e){const{drmSystems:t,widevineLicenseUrl:i}=e,r=t?[we.FAIRPLAY,we.WIDEVINE,we.PLAYREADY,we.CLEARKEY].filter((e=>!!t[e])):[];return!r[we.WIDEVINE]&&i&&r.push(we.WIDEVINE),r}const Pe="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function Oe(e,t,i){return Uint8Array.prototype.slice?e.slice(t,i):new Uint8Array(Array.prototype.slice.call(e,t,i))}const Ne=(e,t)=>t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128,Fe=(e,t)=>t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128,Be=(e,t)=>{const i=t;let r=0;for(;Ne(e,t);){r+=10;r+=Ue(e,t+6),Fe(e,t+10)&&(r+=10),t+=r}if(r>0)return e.subarray(i,i+r)},Ue=(e,t)=>{let i=0;return i=(127&e[t])<<21,i|=(127&e[t+1])<<14,i|=(127&e[t+2])<<7,i|=127&e[t+3],i},je=(e,t)=>Ne(e,t)&&Ue(e,t+6)+10<=e.length-t,Ge=e=>e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info,ze=e=>{const t=String.fromCharCode(e[0],e[1],e[2],e[3]),i=Ue(e,4);return{type:t,size:i,data:e.subarray(10,10+i)}},Ve=e=>{let t=0;const i=[];for(;Ne(e,t);){const r=Ue(e,t+6);t+=10;const s=t+r;for(;t+8<s;){const r=ze(e.subarray(t)),s=$e(r);s&&i.push(s),t+=r.size+10}Fe(e,t)&&(t+=10)}return i},$e=e=>"PRIV"===e.type?He(e):"W"===e.type[0]?Ke(e):Ye(e),He=e=>{if(e.size<2)return;const t=qe(e.data,!0),i=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:i.buffer}},Ye=e=>{if(e.size<2)return;if("TXXX"===e.type){let t=1;const i=qe(e.data.subarray(t),!0);t+=i.length+1;const r=qe(e.data.subarray(t));return{key:e.type,info:i,data:r}}const t=qe(e.data.subarray(1));return{key:e.type,data:t}},Ke=e=>{if("WXXX"===e.type){if(e.size<2)return;let t=1;const i=qe(e.data.subarray(t),!0);t+=i.length+1;const r=qe(e.data.subarray(t));return{key:e.type,info:i,data:r}}const t=qe(e.data);return{key:e.type,data:t}},We=e=>{if(8===e.data.byteLength){const t=new Uint8Array(e.data),i=1&t[3];let r=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return r/=45,i&&(r+=47721858.84),Math.round(r)}},qe=(e,t=!1)=>{const i=function(){Qe||void 0===self.TextDecoder||(Qe=new self.TextDecoder("utf-8"));return Qe}();if(i){const r=i.decode(e);if(t){const e=r.indexOf("\0");return-1!==e?r.substring(0,e):r}return r.replace(/\0/g,"")}const r=e.length;let s,n,a,o="",l=0;for(;l<r;){if(s=e[l++],0===s&&t)return o;if(0!==s&&3!==s)switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(s);break;case 12:case 13:n=e[l++],o+=String.fromCharCode((31&s)<<6|63&n);break;case 14:n=e[l++],a=e[l++],o+=String.fromCharCode((15&s)<<12|(63&n)<<6|63&a)}}return o};let Qe;const Ze=function(e){let t="";for(let i=0;i<e.length;i++){let r=e[i].toString(16);r.length<2&&(r="0"+r),t+=r}return t},Xe=Math.pow(2,32)-1,Je=[].push,et={video:1,audio:2,id3:3,text:4};function tt(e){return String.fromCharCode.apply(null,e)}function it(e,t){const i=e[t]<<8|e[t+1];return i<0?65536+i:i}function rt(e,t){const i=st(e,t);return i<0?4294967296+i:i}function st(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function nt(e,t,i){e[t]=i>>24,e[t+1]=i>>16&255,e[t+2]=i>>8&255,e[t+3]=255&i}function at(e,t){const i=[];if(!t.length)return i;const r=e.byteLength;for(let s=0;s<r;){const n=rt(e,s),a=n>1?s+n:r;if(tt(e.subarray(s+4,s+8))===t[0])if(1===t.length)i.push(e.subarray(s+8,a));else{const r=at(e.subarray(s+8,a),t.slice(1));r.length&&Je.apply(i,r)}s=a}return i}function ot(e){const t=[],i=e[0];let r=8;const s=rt(e,r);r+=4;r+=0===i?8:16,r+=2;let n=e.length+0;const a=it(e,r);r+=2;for(let o=0;o<a;o++){let i=r;const a=rt(e,i);i+=4;const o=2147483647&a;if(1===(2147483648&a)>>>31)return le.warn("SIDX has hierarchical references (not supported)"),null;const l=rt(e,i);i+=4,t.push({referenceSize:o,subsegmentDuration:l,info:{duration:l/s,start:n,end:n+o-1}}),n+=o,i+=4,r=i}return{earliestPresentationTime:0,timescale:s,version:i,referencesCount:a,references:t}}function lt(e){const t=[],i=at(e,["moov","trak"]);for(let r=0;r<i.length;r++){const e=i[r],s=at(e,["tkhd"])[0];if(s){let i=s[0],r=0===i?12:20;const n=rt(s,r),a=at(e,["mdia","mdhd"])[0];if(a){i=a[0],r=0===i?12:20;const s=rt(a,r),o=at(e,["mdia","hdlr"])[0];if(o){const i=tt(o.subarray(8,12)),r={soun:me,vide:ge}[i];if(r){const i=at(e,["mdia","minf","stbl","stsd"])[0];let a;i&&(a=tt(i.subarray(12,16))),t[n]={timescale:s,type:r},t[r]={timescale:s,id:n,codec:a}}}}}}return at(e,["moov","mvex","trex"]).forEach((e=>{const i=rt(e,4),r=t[i];r&&(r.default={duration:rt(e,12),flags:rt(e,20)})})),t}function dt(e){const t=at(e,["schm"])[0];if(t){const i=tt(t.subarray(4,8));if("cbcs"===i||"cenc"===i)return at(e,["schi","tenc"])[0]}return le.error("[eme] missing 'schm' box"),null}function ct(e){const t=rt(e,0);let i=8;1&t&&(i+=4),4&t&&(i+=4);let r=0;const s=rt(e,4);for(let n=0;n<s;n++){if(256&t){r+=rt(e,i),i+=4}512&t&&(i+=4),1024&t&&(i+=4),2048&t&&(i+=4)}return r}function ht(e,t){const i=new Uint8Array(e.length+t.length);return i.set(e),i.set(t,e.length),i}function ut(e,t){const i=[],r=t.samples,s=t.timescale,n=t.id;let a=!1;return at(r,["moof"]).map((o=>{const l=o.byteOffset-8;at(o,["traf"]).map((o=>{const d=at(o,["tfdt"]).map((e=>{const t=e[0];let i=rt(e,4);return 1===t&&(i*=Math.pow(2,32),i+=rt(e,8)),i/s}))[0];return void 0!==d&&(e=d),at(o,["tfhd"]).map((d=>{const c=rt(d,4),h=16777215&rt(d,0);let u=0;const f=!!(16&h);let p=0;const m=!!(32&h);let g=8;c===n&&(!!(1&h)&&(g+=8),!!(2&h)&&(g+=4),!!(8&h)&&(u=rt(d,g),g+=4),f&&(p=rt(d,g),g+=4),m&&(g+=4),"video"===t.type&&(a=function(e){if(!e)return!1;const t=e.indexOf("."),i=t<0?e:e.substring(0,t);return"hvc1"===i||"hev1"===i||"dvh1"===i||"dvhe"===i}(t.codec)),at(o,["trun"]).map((n=>{const o=n[0],d=16777215&rt(n,0),c=!!(1&d);let h=0;const f=!!(4&d),m=!!(256&d);let g=0;const y=!!(512&d);let v=0;const _=!!(1024&d),E=!!(2048&d);let b=0;const S=rt(n,4);let T=8;c&&(h=rt(n,T),T+=4),f&&(T+=4);let A=h+l;for(let l=0;l<S;l++){if(m?(g=rt(n,T),T+=4):g=u,y?(v=rt(n,T),T+=4):v=p,_&&(T+=4),E&&(b=0===o?rt(n,T):st(n,T),T+=4),t.type===ge){let t=0;for(;t<v;){const n=rt(r,A);if(A+=4,ft(a,r[A])){pt(r.subarray(A,A+n),a?2:1,e+b/s,i)}A+=n,t+=n+4}}e+=g/s}})))}))}))})),i}function ft(e,t){if(e){const e=t>>1&63;return 39===e||40===e}return 6===(31&t)}function pt(e,t,i,r){const s=mt(e);let n=0;n+=t;let a=0,o=0,l=!1,d=0;for(;n<s.length;){a=0;do{if(n>=s.length)break;d=s[n++],a+=d}while(255===d);o=0;do{if(n>=s.length)break;d=s[n++],o+=d}while(255===d);const e=s.length-n;if(!l&&4===a&&n<s.length){l=!0;if(181===s[n++]){const e=it(s,n);if(n+=2,49===e){const e=rt(s,n);if(n+=4,1195456820===e){const e=s[n++];if(3===e){const t=s[n++],o=64&t,l=o?2+3*(31&t):0,d=new Uint8Array(l);if(o){d[0]=t;for(let e=1;e<l;e++)d[e]=s[n++]}r.push({type:e,payloadType:a,pts:i,bytes:d})}}}}}else if(5===a&&o<e){if(l=!0,o>16){const e=[];for(let i=0;i<16;i++){const t=s[n++].toString(16);e.push(1==t.length?"0"+t:t),3!==i&&5!==i&&7!==i&&9!==i||e.push("-")}const t=o-16,l=new Uint8Array(t);for(let i=0;i<t;i++)l[i]=s[n++];r.push({payloadType:a,pts:i,uuid:e.join(""),userData:qe(l),userDataBytes:l})}}else if(o<e)n+=o;else if(o>e)break}}function mt(e){const t=e.byteLength,i=[];let r=1;for(;r<t-2;)0===e[r]&&0===e[r+1]&&3===e[r+2]?(i.push(r+2),r+=2):r++;if(0===i.length)return e;const s=t-i.length,n=new Uint8Array(s);let a=0;for(r=0;r<s;a++,r++)a===i[0]&&(a++,i.shift()),n[r]=e[a];return n}function gt(e,t,i){if(16!==e.byteLength)throw new RangeError("Invalid system id");let r,s,n;r=0,s=new Uint8Array,n=new Uint8Array;const a=new Uint8Array(4);return i&&i.byteLength>0&&new DataView(a.buffer).setUint32(0,i.byteLength,!1),function(e,...t){const i=t.length;let r=8,s=i;for(;s--;)r+=t[s].byteLength;const n=new Uint8Array(r);for(n[0]=r>>24&255,n[1]=r>>16&255,n[2]=r>>8&255,n[3]=255&r,n.set(e,4),s=0,r=8;s<i;s++)n.set(t[s],r),r+=t[s].byteLength;return n}([112,115,115,104],new Uint8Array([0,0,0,0]),e,n,s,a,i||new Uint8Array)}let yt={};class vt{static clearKeyUriToKeyIdMap(){yt={}}constructor(e,t,i,r=[1],s=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=r,this.iv=s,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&"AES-128"!==e}isSupported(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case Ie:case De:case Re:case Le:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof e&&("AES-128"!==this.method||this.iv||le.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const t=function(e){const t=new Uint8Array(16);for(let i=12;i<16;i++)t[i]=e>>8*(15-i)&255;return t}(e);return new vt(this.method,this.uri,"identity",this.keyFormatVersions,t)}const t=Te(this.uri);if(t)switch(this.keyFormat){case De:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case Re:{const e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=gt(e,0,t);const i=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),r=String.fromCharCode.apply(null,Array.from(i)),s=r.substring(r.indexOf("<"),r.length),n=(new DOMParser).parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(n){const e=n.childNodes[0]?n.childNodes[0].nodeValue:n.getAttribute("VALUE");if(e){const t=Se(e).subarray(0,16);!function(e){const t=function(e,t,i){const r=e[t];e[t]=e[i],e[i]=r};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}(t),this.keyId=t}}break}default:{let e=t.subarray(0,16);if(16!==e.length){const t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e;break}}if(!this.keyId||16!==this.keyId.byteLength){let e=yt[this.uri];if(!e){const t=Object.keys(yt).length%Number.MAX_SAFE_INTEGER;e=new Uint8Array(16);new DataView(e.buffer,12,4).setUint32(0,t),yt[this.uri]=e}this.keyId=e}return this}}const _t=/\{\$([a-zA-Z0-9-_]+)\}/g;function Et(e){return _t.test(e)}function bt(e,t,i){if(null!==e.variableList||e.hasVariableRefs)for(let r=i.length;r--;){const s=i[r],n=t[s];n&&(t[s]=St(e,n))}}function St(e,t){if(null!==e.variableList||e.hasVariableRefs){const i=e.variableList;return t.replace(_t,(t=>{const r=t.substring(2,t.length-1),s=null==i?void 0:i[r];return void 0===s?(e.playlistParsingError||(e.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),t):s}))}return t}function Tt(e,t,i){let r,s,n=e.variableList;if(n||(e.variableList=n={}),"QUERYPARAM"in t){r=t.QUERYPARAM;try{const e=new self.URL(i).searchParams;if(!e.has(r))throw new Error(`"${r}" does not match any query parameter in URI: "${i}"`);s=e.get(r)}catch(a){e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else r=t.NAME,s=t.VALUE;r in n?e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):n[r]=s||""}function At(e,t,i){const r=t.IMPORT;if(i&&r in i){let t=e.variableList;t||(e.variableList=t={}),t[r]=i[r]}else e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}function wt(){if("undefined"!=typeof self)return self.MediaSource||self.WebKitMediaSource}const Lt={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},It=wt();function Rt(e,t){var i;return null!=(i=null==It?void 0:It.isTypeSupported(`${t||"video"}/mp4;codecs="${e}"`))&&i}const Dt=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,kt=/#EXT-X-MEDIA:(.*)/g,xt=/^#EXT(?:INF|-X-TARGETDURATION):/m,Ct=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),Mt=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Pt{static findGroup(e,t){for(let i=0;i<e.length;i++){const r=e[i];if(r.id===t)return r}}static convertAVC1ToAVCOTI(e){const t=e.split(".");if(t.length>2){let e=t.shift()+".";return e+=parseInt(t.shift()).toString(16),e+=("000"+parseInt(t.shift()).toString(16)).slice(-4),e}return e}static resolve(e,t){return q.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return xt.test(e)}static parseMasterPlaylist(e,t){const i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:Et(e)},r=[];let s;for(Dt.lastIndex=0;null!=(s=Dt.exec(e));)if(s[1]){var n;const e=new he(s[1]);bt(i,e,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const a=St(i,s[2]),o={attrs:e,bitrate:e.decimalInteger("AVERAGE-BANDWIDTH")||e.decimalInteger("BANDWIDTH"),name:e.NAME,url:Pt.resolve(a,t)},l=e.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),Ft((e.CODECS||"").split(/[ ,]+/).filter((e=>e)),o),o.videoCodec&&-1!==o.videoCodec.indexOf("avc1")&&(o.videoCodec=Pt.convertAVC1ToAVCOTI(o.videoCodec)),null!=(n=o.unknownCodecs)&&n.length||r.push(o),i.levels.push(o)}else if(s[3]){const e=s[3],r=s[4];switch(e){case"SESSION-DATA":{const e=new he(r);bt(i,e,["DATA-ID","LANGUAGE","VALUE","URI"]);const t=e["DATA-ID"];t&&(null===i.sessionData&&(i.sessionData={}),i.sessionData[t]=e);break}case"SESSION-KEY":{const e=Ot(r,t,i);e.encrypted&&e.isSupported()?(null===i.sessionKeys&&(i.sessionKeys=[]),i.sessionKeys.push(e)):le.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${r}"`);break}case"DEFINE":{const e=new he(r);bt(i,e,["NAME","VALUE","QUERYPARAM"]),Tt(i,e,t)}break;case"CONTENT-STEERING":{const e=new he(r);bt(i,e,["SERVER-URI","PATHWAY-ID"]),i.contentSteering={uri:Pt.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":i.startTimeOffset=Nt(r)}}const a=r.length>0&&r.length<i.levels.length;return i.levels=a?r:i.levels,0===i.levels.length&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,i){let r;const s={},n=i.levels,a={AUDIO:n.map((e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec}))),SUBTITLES:n.map((e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec}))),"CLOSED-CAPTIONS":[]};let o=0;for(kt.lastIndex=0;null!==(r=kt.exec(e));){const e=new he(r[1]),n=e.TYPE;if(n){const r=a[n],l=s[n]||[];s[n]=l,bt(i,e,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const d={attrs:e,bitrate:0,id:o++,groupId:e["GROUP-ID"]||"",instreamId:e["INSTREAM-ID"],name:e.NAME||e.LANGUAGE||"",type:n,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:e.LANGUAGE,url:e.URI?Pt.resolve(e.URI,t):""};if(null!=r&&r.length){const e=Pt.findGroup(r,d.groupId)||r[0];Bt(d,e,"audioCodec"),Bt(d,e,"textCodec")}l.push(d)}}return s}static parseLevelPlaylist(e,t,i,r,s,n){const a=new be(t),o=a.fragments;let l,d,c,h=null,u=0,f=0,p=0,m=0,g=null,y=new _e(r,t),v=-1,_=!1;for(Ct.lastIndex=0,a.m3u8=e,a.hasVariableRefs=Et(e);null!==(l=Ct.exec(e));){_&&(_=!1,y=new _e(r,t),y.start=p,y.sn=u,y.cc=m,y.level=i,h&&(y.initSegment=h,y.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null));const e=l[1];if(e){y.duration=parseFloat(e);const t=(" "+l[2]).slice(1);y.title=t||null,y.tagList.push(t?["INF",e,t]:["INF",e])}else if(l[3]){if(ee(y.duration)){y.start=p,c&&Gt(y,c,a),y.sn=u,y.level=i,y.cc=m,y.urlId=s,o.push(y);const e=(" "+l[3]).slice(1);y.relurl=St(a,e),Ut(y,g),g=y,p+=y.duration,u++,f=0,_=!0}}else if(l[4]){const e=(" "+l[4]).slice(1);g?y.setByteRange(e,g):y.setByteRange(e)}else if(l[5])y.rawProgramDateTime=(" "+l[5]).slice(1),y.tagList.push(["PROGRAM-DATE-TIME",y.rawProgramDateTime]),-1===v&&(v=o.length);else{if(l=l[0].match(Mt),!l){le.warn("No matches on slow regex match for level playlist!");continue}for(d=1;d<l.length&&void 0===l[d];d++);const e=(" "+l[d]).slice(1),s=(" "+l[d+1]).slice(1),p=l[d+2]?(" "+l[d+2]).slice(1):"";switch(e){case"PLAYLIST-TYPE":a.type=s.toUpperCase();break;case"MEDIA-SEQUENCE":u=a.startSN=parseInt(s);break;case"SKIP":{const e=new he(s);bt(a,e,["RECENTLY-REMOVED-DATERANGES"]);const t=e.decimalInteger("SKIPPED-SEGMENTS");if(ee(t)){a.skippedSegments=t;for(let e=t;e--;)o.unshift(null);u+=t}const i=e.enumeratedString("RECENTLY-REMOVED-DATERANGES");i&&(a.recentlyRemovedDateranges=i.split("\t"));break}case"TARGETDURATION":a.targetduration=Math.max(parseInt(s),1);break;case"VERSION":a.version=parseInt(s);break;case"EXTM3U":break;case"ENDLIST":a.live=!1;break;case"#":(s||p)&&y.tagList.push(p?[s,p]:[s]);break;case"DISCONTINUITY":m++,y.tagList.push(["DIS"]);break;case"GAP":y.gap=!0,y.tagList.push([e]);break;case"BITRATE":y.tagList.push([e,s]);break;case"DATERANGE":{const e=new he(s);bt(a,e,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),bt(a,e,e.clientAttrs);const t=new fe(e,a.dateRanges[e.ID]);t.isValid||a.skippedSegments?a.dateRanges[t.id]=t:le.warn(`Ignoring invalid DATERANGE tag: "${s}"`),y.tagList.push(["EXT-X-DATERANGE",s]);break}case"DEFINE":{const e=new he(s);bt(a,e,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in e?At(a,e,n):Tt(a,e,t)}break;case"DISCONTINUITY-SEQUENCE":m=parseInt(s);break;case"KEY":{const e=Ot(s,t,a);if(e.isSupported()){if("NONE"===e.method){c=void 0;break}c||(c={}),c[e.keyFormat]&&(c=J({},c)),c[e.keyFormat]=e}else le.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${s}"`);break}case"START":a.startTimeOffset=Nt(s);break;case"MAP":{const e=new he(s);if(bt(a,e,["BYTERANGE","URI"]),y.duration){const s=new _e(r,t);jt(s,e,i,c),h=s,y.initSegment=h,h.rawProgramDateTime&&!y.rawProgramDateTime&&(y.rawProgramDateTime=h.rawProgramDateTime)}else jt(y,e,i,c),h=y,_=!0;break}case"SERVER-CONTROL":{const e=new he(s);a.canBlockReload=e.bool("CAN-BLOCK-RELOAD"),a.canSkipUntil=e.optionalFloat("CAN-SKIP-UNTIL",0),a.canSkipDateRanges=a.canSkipUntil>0&&e.bool("CAN-SKIP-DATERANGES"),a.partHoldBack=e.optionalFloat("PART-HOLD-BACK",0),a.holdBack=e.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const e=new he(s);a.partTarget=e.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=a.partList;e||(e=a.partList=[]);const i=f>0?e[e.length-1]:void 0,r=f++,n=new he(s);bt(a,n,["BYTERANGE","URI"]);const o=new Ee(n,y,t,r,i);e.push(o),y.duration+=o.duration;break}case"PRELOAD-HINT":{const e=new he(s);bt(a,e,["URI"]),a.preloadHint=e;break}case"RENDITION-REPORT":{const e=new he(s);bt(a,e,["URI"]),a.renditionReports=a.renditionReports||[],a.renditionReports.push(e);break}default:le.warn(`line parsed but not handled: ${l}`)}}}g&&!g.relurl?(o.pop(),p-=g.duration,a.partList&&(a.fragmentHint=g)):a.partList&&(Ut(y,g),y.cc=m,a.fragmentHint=y,c&&Gt(y,c,a));const E=o.length,b=o[0],S=o[E-1];if(p+=a.skippedSegments*a.targetduration,p>0&&E&&S){a.averagetargetduration=p/E;const e=S.sn;a.endSN="initSegment"!==e?e:0,a.live||(S.endList=!0),b&&(a.startCC=b.cc)}else a.endSN=0,a.startCC=0;return a.fragmentHint&&(p+=a.fragmentHint.duration),a.totalduration=p,a.endCC=m,v>0&&function(e,t){let i=e[t];for(let r=t;r--;){const t=e[r];if(!t)return;t.programDateTime=i.programDateTime-1e3*t.duration,i=t}}(o,v),a}}function Ot(e,t,i){var r,s;const n=new he(e);bt(i,n,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const a=null!=(r=n.METHOD)?r:"",o=n.URI,l=n.hexadecimalInteger("IV"),d=n.KEYFORMATVERSIONS,c=null!=(s=n.KEYFORMAT)?s:"identity";o&&n.IV&&!l&&le.error(`Invalid IV: ${n.IV}`);const h=o?Pt.resolve(o,t):"",u=(d||"1").split("/").map(Number).filter(Number.isFinite);return new vt(a,h,c,u,l)}function Nt(e){const t=new he(e).decimalFloatingPoint("TIME-OFFSET");return ee(t)?t:null}function Ft(e,t){["video","audio","text"].forEach((i=>{const r=e.filter((e=>function(e,t){const i=Lt[t];return!!i&&!0===i[e.slice(0,4)]}(e,i)));if(r.length){const s=r.filter((e=>0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)));t[`${i}Codec`]=s.length>0?s[0]:r[0],e=e.filter((e=>-1===r.indexOf(e)))}})),t.unknownCodecs=e}function Bt(e,t,i){const r=t[i];r&&(e[i]=r)}function Ut(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),ee(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function jt(e,t,i,r){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=i,e.sn="initSegment",r&&(e.levelkeys=r),e.initSegment=null}function Gt(e,t,i){e.levelkeys=t;const{encryptedFragments:r}=i;r.length&&r[r.length-1].levelkeys===t||!Object.keys(t).some((e=>t[e].isCommonEncryption))||r.push(e)}var zt="manifest",Vt="level",$t="audioTrack",Ht="subtitleTrack",Yt="main",Kt="audio",Wt="subtitle";function qt(e){const{type:t}=e;switch(t){case $t:return Kt;case Ht:return Wt;default:return Yt}}function Qt(e,t){let i=e.url;return void 0!==i&&0!==i.indexOf("data:")||(i=t.url),i}class Zt{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(te.MANIFEST_LOADING,this.onManifestLoading,this),e.on(te.LEVEL_LOADING,this.onLevelLoading,this),e.on(te.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(te.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off(te.MANIFEST_LOADING,this.onManifestLoading,this),e.off(te.LEVEL_LOADING,this.onLevelLoading,this),e.off(te.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(te.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const t=this.hls.config,i=t.pLoader,r=t.loader,s=new(i||r)(t);return this.loaders[e.type]=s,s}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:zt,url:i,deliveryDirectives:null})}onLevelLoading(e,t){const{id:i,level:r,url:s,deliveryDirectives:n}=t;this.load({id:i,level:r,responseType:"text",type:Vt,url:s,deliveryDirectives:n})}onAudioTrackLoading(e,t){const{id:i,groupId:r,url:s,deliveryDirectives:n}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:$t,url:s,deliveryDirectives:n})}onSubtitleTrackLoading(e,t){const{id:i,groupId:r,url:s,deliveryDirectives:n}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:Ht,url:s,deliveryDirectives:n})}load(e){var t;const i=this.hls.config;let r,s=this.getInternalLoader(e);if(s){const t=s.context;if(t&&t.url===e.url)return void le.trace("[playlist-loader]: playlist request ongoing");le.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}if(r=e.type===zt?i.manifestLoadPolicy.default:J({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),null!=(t=e.deliveryDirectives)&&t.part){let t;if(e.type===Vt&&null!==e.level?t=this.hls.levels[e.level].details:e.type===$t&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===Ht&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){const e=t.partTarget,i=t.targetduration;if(e&&i){const t=1e3*Math.max(3*e,.8*i);r=J({},r,{maxTimeToFirstByteMs:Math.min(t,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,r.maxTimeToFirstByteMs)})}}}const n=r.errorRetry||r.timeoutRetry||{},a={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:n.maxNumRetry||0,retryDelay:n.retryDelayMs||0,maxRetryDelay:n.maxRetryDelayMs||0},o={onSuccess:(e,t,i,r)=>{const s=this.getInternalLoader(i);this.resetInternalLoader(i.type);const n=e.data;0===n.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),Pt.isMediaPlaylist(n)?this.handleTrackOrLevelPlaylist(e,t,i,r||null,s):this.handleMasterPlaylist(e,t,i,r)):this.handleManifestParsingError(e,i,new Error("no EXTM3U delimiter"),r||null,t)},onError:(e,t,i,r)=>{this.handleNetworkError(t,i,!1,e,r)},onTimeout:(e,t,i)=>{this.handleNetworkError(t,i,!0,void 0,e)}};s.load(e,a,o)}handleMasterPlaylist(e,t,i,r){const s=this.hls,n=e.data,a=Qt(e,i),o=Pt.parseMasterPlaylist(n,a);if(o.playlistParsingError)return void this.handleManifestParsingError(e,i,o.playlistParsingError,r,t);const{contentSteering:l,levels:d,sessionData:c,sessionKeys:h,startTimeOffset:u,variableList:f}=o;this.variableList=f;const{AUDIO:p=[],SUBTITLES:m,"CLOSED-CAPTIONS":g}=Pt.parseMasterPlaylistMedia(n,a,o);if(p.length){p.some((e=>!e.url))||!d[0].audioCodec||d[0].attrs.AUDIO||(le.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new he({}),bitrate:0,url:""}))}s.trigger(te.MANIFEST_LOADED,{levels:d,audioTracks:p,subtitles:m,captions:g,contentSteering:l,url:a,stats:t,networkDetails:r,sessionData:c,sessionKeys:h,startTimeOffset:u,variableList:f})}handleTrackOrLevelPlaylist(e,t,i,r,s){const n=this.hls,{id:a,level:o,type:l}=i,d=Qt(e,i),c=ee(a)?a:0,h=ee(o)?o:c,u=qt(i),f=Pt.parseLevelPlaylist(e.data,d,h,u,c,this.variableList);if(l===zt){const e={attrs:new he({}),bitrate:0,details:f,name:"",url:d};n.trigger(te.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:d,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=f,this.handlePlaylistLoaded(f,e,t,i,r,s)}handleManifestParsingError(e,t,i,r,s){this.hls.trigger(te.ERROR,{type:ie.NETWORK_ERROR,details:re.MANIFEST_PARSING_ERROR,fatal:t.type===zt,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:r,stats:s})}handleNetworkError(e,t,i=!1,r,s){let n=`A network ${i?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===Vt?n+=`: ${e.level} id: ${e.id}`:e.type!==$t&&e.type!==Ht||(n+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(n);le.warn(`[playlist-loader]: ${n}`);let o=re.UNKNOWN,l=!1;const d=this.getInternalLoader(e);switch(e.type){case zt:o=i?re.MANIFEST_LOAD_TIMEOUT:re.MANIFEST_LOAD_ERROR,l=!0;break;case Vt:o=i?re.LEVEL_LOAD_TIMEOUT:re.LEVEL_LOAD_ERROR,l=!1;break;case $t:o=i?re.AUDIO_TRACK_LOAD_TIMEOUT:re.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case Ht:o=i?re.SUBTITLE_TRACK_LOAD_TIMEOUT:re.SUBTITLE_LOAD_ERROR,l=!1}d&&this.resetInternalLoader(e.type);const c={type:ie.NETWORK_ERROR,details:o,fatal:l,url:e.url,loader:d,context:e,error:a,networkDetails:t,stats:s};if(r){const i=(null==t?void 0:t.url)||e.url;c.response=Z({url:i,data:void 0},r)}this.hls.trigger(te.ERROR,c)}handlePlaylistLoaded(e,t,i,r,s,n){const a=this.hls,{type:o,level:l,id:d,groupId:c,deliveryDirectives:h}=r,u=Qt(t,r),f=qt(r),p="number"==typeof r.level&&f===Yt?l:void 0;if(!e.fragments.length){const e=new Error("No Segments found in Playlist");return void a.trigger(te.ERROR,{type:ie.NETWORK_ERROR,details:re.LEVEL_EMPTY_ERROR,fatal:!1,url:u,error:e,reason:e.message,response:t,context:r,level:p,parent:f,networkDetails:s,stats:i})}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const m=e.playlistParsingError;if(m)a.trigger(te.ERROR,{type:ie.NETWORK_ERROR,details:re.LEVEL_PARSING_ERROR,fatal:!1,url:u,error:m,reason:m.message,response:t,context:r,level:p,parent:f,networkDetails:s,stats:i});else switch(e.live&&n&&(n.getCacheAge&&(e.ageHeader=n.getCacheAge()||0),n.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),o){case zt:case Vt:a.trigger(te.LEVEL_LOADED,{details:e,level:p||0,id:d||0,stats:i,networkDetails:s,deliveryDirectives:h});break;case $t:a.trigger(te.AUDIO_TRACK_LOADED,{details:e,id:d||0,groupId:c||"",stats:i,networkDetails:s,deliveryDirectives:h});break;case Ht:a.trigger(te.SUBTITLE_TRACK_LOADED,{details:e,id:d||0,groupId:c||"",stats:i,networkDetails:s,deliveryDirectives:h})}}}function Xt(e,t){let i;try{i=new Event("addtrack")}catch(r){i=document.createEvent("Event"),i.initEvent("addtrack",!1,!1)}i.track=e,t.dispatchEvent(i)}function Jt(e,t){const i=e.mode;if("disabled"===i&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(r){le.debug(`[texttrack-utils]: ${r}`);const i=new self.TextTrackCue(t.startTime,t.endTime,t.text);i.id=t.id,e.addCue(i)}"disabled"===i&&(e.mode=i)}function ei(e){const t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(let i=e.cues.length;i--;)e.removeCue(e.cues[i]);"disabled"===t&&(e.mode=t)}function ti(e,t,i,r){const s=e.mode;if("disabled"===s&&(e.mode="hidden"),e.cues&&e.cues.length>0){const s=function(e,t,i){const r=[],s=function(e,t){if(t<e[0].startTime)return 0;const i=e.length-1;if(t>e[i].endTime)return-1;let r=0,s=i;for(;r<=s;){const n=Math.floor((s+r)/2);if(t<e[n].startTime)s=n-1;else{if(!(t>e[n].startTime&&r<i))return n;r=n+1}}return e[r].startTime-t<t-e[s].startTime?r:s}(e,t);if(s>-1)for(let n=s,a=e.length;n<a;n++){const s=e[n];if(s.startTime>=t&&s.endTime<=i)r.push(s);else if(s.startTime>i)return r}return r}(e.cues,t,i);for(let t=0;t<s.length;t++)r&&!r(s[t])||e.removeCue(s[t])}"disabled"===s&&(e.mode=s)}var ii="org.id3",ri="com.apple.quicktime.HLS",si="https://aomedia.org/emsg/ID3";function ni(){if("undefined"!=typeof self)return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}const ai=(()=>{const e=ni();try{new e(0,Number.POSITIVE_INFINITY,"")}catch(t){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function oi(e,t){return e.getTime()/1e3-t}class li{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on(te.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(te.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(te.MANIFEST_LOADING,this.onManifestLoading,this),e.on(te.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(te.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(te.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(te.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(te.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(te.MANIFEST_LOADING,this.onManifestLoading,this),e.off(te.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(te.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(te.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(ei(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const i=e[t];if("metadata"===i.kind&&"id3"===i.label)return Xt(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:i,enableID3MetadataCues:r}}}=this;if(!i&&!r)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const n=ni();for(let a=0;a<s.length;a++){const e=s[a].type;if(e===si&&!i||!r)continue;const t=Ve(s[a].data);if(t){const i=s[a].pts;let r=i+s[a].duration;r>ai&&(r=ai);r-i<=0&&(r=i+.25);for(let s=0;s<t.length;s++){const a=t[s];if(!Ge(a)){this.updateId3CueEnds(i);const t=new n(i,r,"");t.value=a,e&&(t.type=e),this.id3Track.addCue(t)}}}}}updateId3CueEnds(e){var t;const i=null==(t=this.id3Track)?void 0:t.cues;if(i)for(let r=i.length;r--;){const t=i[r];t.startTime<e&&t.endTime===ai&&(t.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:r}){const{id3Track:s,hls:n}=this;if(!n)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:o}}=n;if(s&&(a||o)){let e;e="audio"===r?e=>e.type===ii&&o:"video"===r?e=>e.type===si&&a:e=>e.type===ii&&o||e.type===si&&a,ti(s,t,i,e)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:i,id3Track:r}=this,{dateRanges:s}=t,n=Object.keys(s);if(r){const e=Object.keys(i).filter((e=>!n.includes(e)));for(let t=e.length;t--;){const s=e[t];Object.keys(i[s].cues).forEach((e=>{r.removeCue(i[s].cues[e])})),delete i[s]}}const a=t.fragments[t.fragments.length-1];if(0===n.length||!ee(null==a?void 0:a.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=a.programDateTime/1e3-a.start,l=ni();for(let h=0;h<n.length;h++){const e=n[h],t=s[e],r=i[e],a=(null==r?void 0:r.cues)||{};let u=(null==r?void 0:r.durationKnown)||!1;const f=oi(t.startDate,o);let p=ai;const m=t.endDate;if(m)p=oi(m,o),u=!0;else if(t.endOnNext&&!u){const e=n.reduce(((e,i)=>{const r=s[i];return r.class===t.class&&r.id!==i&&r.startDate>t.startDate&&e.push(r),e}),[]).sort(((e,t)=>e.startDate.getTime()-t.startDate.getTime()))[0];e&&(p=oi(e.startDate,o),u=!0)}const g=Object.keys(t.attr);for(let i=0;i<g.length;i++){const s=g[i];if("ID"===(c=s)||"CLASS"===c||"START-DATE"===c||"DURATION"===c||"END-DATE"===c||"END-ON-NEXT"===c)continue;let n=a[s];if(n)u&&!r.durationKnown&&(n.endTime=p);else{let i=t.attr[s];n=new l(f,p,""),ue(s)&&(d=i,i=Uint8Array.from(d.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),n.value={key:s,data:i},n.type=ri,n.id=e,this.id3Track.addCue(n),a[s]=n}}i[e]={cues:a,dateRange:t,durationKnown:u}}var d,c}}class di{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:t}=this;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(null===e)return null;const{holdBack:t,partHoldBack:i,targetduration:r}=e,{liveSyncDuration:s,liveSyncDurationCount:n,lowLatencyMode:a}=this.config,o=this.hls.userConfig;let l=a&&i||t;(o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==s?s:n*r);const d=r;return l+Math.min(1*this.stallCount,d)}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency,i=this.levelDetails;if(null===e||null===t||null===i)return null;const r=i.edge,s=e-t-this.edgeStalled,n=r-i.totalduration,a=r-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(n,s),a)}get drift(){const{levelDetails:e}=this;return null===e?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;if(null===e)return 0;const t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e,levelDetails:t}=this;if(!e||!t)return 0;const i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(te.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(te.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(te.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(te.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(te.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(te.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(te.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(te.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(te.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(te.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var i;t.details===re.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(i=this.levelDetails)&&i.live&&le.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;const i=this.computeLatency();if(null===i)return;this._latency=i;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:s}=this.config;if(!r||1===s)return;const n=this.targetLatency;if(null===n)return;const a=i-n,o=a<Math.min(this.maxLatency,n+t.targetduration);if(t.live&&o&&a>.05&&this.forwardBufferLength>1){const t=Math.min(2,Math.max(1,s)),i=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20;e.playbackRate=Math.min(t,Math.max(1,i))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}const ci=["NONE","TYPE-0","TYPE-1",null];var hi="",ui="YES",fi="v2";class pi{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class mi{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter((e=>e)).join(",").replace(/\.[^.,]+/g,"")}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get attrs(){return this._attrs[this._urlId]}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get uri(){return this.url[this._urlId]||""}get urlId(){return this._urlId}set urlId(e){const t=e%this.url.length;this._urlId!==t&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=t)}get audioGroupId(){var e;return null==(e=this.audioGroupIds)?void 0:e[this.urlId]}get textGroupId(){var e;return null==(e=this.textGroupIds)?void 0:e[this.urlId]}addFallback(e){this.url.push(e.url),this._attrs.push(e.attrs)}}function gi(e,t){const i=t.startPTS;if(ee(i)){let r,s=0;t.sn>e.sn?(s=i-e.start,r=e):(s=e.start-i,r=t),r.duration!==s&&(r.duration=s)}else if(t.sn>e.sn){e.cc===t.cc&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration}else t.start=Math.max(e.start-t.duration,0)}function yi(e,t,i,r,s,n){r-i<=0&&(le.warn("Fragment should have a positive duration",t),r=i+t.duration,n=s+t.duration);let a=i,o=r;const l=t.startPTS,d=t.endPTS;if(ee(l)){const e=Math.abs(l-i);ee(t.deltaPTS)?t.deltaPTS=Math.max(e,t.deltaPTS):t.deltaPTS=e,a=Math.max(i,l),i=Math.min(i,l),s=Math.min(s,t.startDTS),o=Math.min(r,d),r=Math.max(r,d),n=Math.max(n,t.endDTS)}const c=i-t.start;0!==t.start&&(t.start=i),t.duration=r-t.start,t.startPTS=i,t.maxStartPTS=a,t.startDTS=s,t.endPTS=r,t.minEndPTS=o,t.endDTS=n;const h=t.sn;if(!e||h<e.startSN||h>e.endSN)return 0;let u;const f=h-e.startSN,p=e.fragments;for(p[f]=t,u=f;u>0;u--)gi(p[u],p[u-1]);for(u=f;u<p.length-1;u++)gi(p[u],p[u+1]);return e.fragmentHint&&gi(p[p.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,c}function vi(e,t){let i=null;const r=e.fragments;for(let l=r.length-1;l>=0;l--){const e=r[l].initSegment;if(e){i=e;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;let s,n=0;if(function(e,t,i){const r=t.skippedSegments,s=Math.max(e.startSN,t.startSN)-t.startSN,n=(e.fragmentHint?1:0)+(r?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,a=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let d=s;d<=n;d++){const e=l[a+d];let s=o[d];r&&!s&&d<r&&(s=t.fragments[d]=e),e&&s&&i(e,s)}}(e,t,((e,r)=>{e.relurl&&(n=e.cc-r.cc),ee(e.startPTS)&&ee(e.endPTS)&&(r.start=r.startPTS=e.startPTS,r.startDTS=e.startDTS,r.maxStartPTS=e.maxStartPTS,r.endPTS=e.endPTS,r.endDTS=e.endDTS,r.minEndPTS=e.minEndPTS,r.duration=e.endPTS-e.startPTS,r.duration&&(s=r),t.PTSKnown=t.alignedSliding=!0),r.elementaryStreams=e.elementaryStreams,r.loader=e.loader,r.stats=e.stats,r.urlId=e.urlId,e.initSegment&&(r.initSegment=e.initSegment,i=e.initSegment)})),i){(t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments).forEach((e=>{var t;e.initSegment&&e.initSegment.relurl!==(null==(t=i)?void 0:t.relurl)||(e.initSegment=i)}))}if(t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some((e=>!e)),t.deltaUpdateFailed){le.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=function(e,t,i){const r=J({},e);i&&i.forEach((e=>{delete r[e]}));return Object.keys(t).forEach((e=>{const i=new fe(t[e].attr,r[e]);i.isValid?r[e]=i:le.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(t[e].attr)}"`)})),r}(e.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));const a=t.fragments;if(n){le.warn("discontinuity sliding from playlist, take drift into account");for(let e=0;e<a.length;e++)a[e].cc+=n}t.skippedSegments&&(t.startCC=t.fragments[0].cc),function(e,t,i){if(e&&t){let r=0;for(let s=0,n=e.length;s<=n;s++){const n=e[s],a=t[s+r];n&&a&&n.index===a.index&&n.fragment.sn===a.fragment.sn?i(n,a):r--}}}(e.partList,t.partList,((e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats})),s?yi(t,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):_i(e,t),a.length&&(t.totalduration=t.edge-a[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;const o=t.advancedDateTime;if(t.advanced&&o){const e=t.edge;t.driftStart||(t.driftStartTime=o,t.driftStart=e),t.driftEndTime=o,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}function _i(e,t){const i=t.startSN+t.skippedSegments-e.startSN,r=e.fragments;i<0||i>=r.length||Ei(t,r[i].start)}function Ei(e,t){if(t){const i=e.fragments;for(let r=e.skippedSegments;r<i.length;r++)i[r].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function bi(e,t,i){var r;return null!=e&&e.details?Si(null==(r=e.details)?void 0:r.partList,t,i):null}function Si(e,t,i){if(e)for(let r=e.length;r--;){const s=e[r];if(s.index===i&&s.fragment.sn===t)return s}return null}function Ti(e){switch(e.details){case re.FRAG_LOAD_TIMEOUT:case re.KEY_LOAD_TIMEOUT:case re.LEVEL_LOAD_TIMEOUT:case re.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Ai(e,t){const i=Ti(t);return e.default[(i?"timeout":"error")+"Retry"]}function wi(e,t){const i="linear"===e.backoff?1:Math.pow(2,t);return Math.min(i*e.retryDelayMs,e.maxRetryDelayMs)}function Li(e){return Z(Z({},e),{errorRetry:null,timeoutRetry:null})}function Ii(e,t,i,r){return!!e&&t<e.maxNumRetry&&(function(e){return 0===e&&!1===navigator.onLine||!!e&&(e<400||e>499)}(r)||!!i)}const Ri=function(e,t){let i=0,r=e.length-1,s=null,n=null;for(;i<=r;){s=(i+r)/2|0,n=e[s];const a=t(n);if(a>0)i=s+1;else{if(!(a<0))return n;r=s-1}}return null};function Di(e,t,i=0,r=0){let s=null;if(e?s=t[e.sn-t[0].sn+1]||null:0===i&&0===t[0].start&&(s=t[0]),s&&0===ki(i,r,s))return s;const n=Ri(t,ki.bind(null,i,r));return!n||n===e&&s?s:n}function ki(e=0,t=0,i){if(i.start<=e&&i.start+i.duration>e)return 0;const r=Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-r<=e?1:i.start-r>e&&i.start?-1:0}function xi(e,t,i){const r=1e3*Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0));return(i.endProgramDateTime||0)-r>e}var Ci=0,Mi=2,Pi=5,Oi=0,Ni=1,Fi=2;function Bi(e,t,i){if(performance.now()-e.lastErrorPerfMs>3e5)return!0;const r=e.details;if(t.details===re.FRAG_GAP&&r&&t.frag){const e=t.frag.start,i=Di(null,r.fragments,e);if(i&&!i.gap)return!0}if(i&&e.errors.length<i.errors.length){const i=e.errors[e.errors.length-1];if(r&&i.frag&&t.frag&&Math.abs(i.frag.start-t.frag.start)>3*r.targetduration)return!0}return!1}class Ui{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=le.log.bind(le,`${t}:`),this.warn=le.warn.bind(le,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){clearTimeout(this.timer),this.timer=-1}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t){const i=null==t?void 0:t.renditionReports;if(i){let s=-1;for(let n=0;n<i.length;n++){const a=i[n];let o;try{o=new self.URL(a.URI,t.url).href}catch(r){le.warn(`Could not construct new URL for Rendition Report: ${r}`),o=a.URI||""}if(o===e){s=n;break}o===e.substring(0,o.length)&&(s=n)}if(-1!==s){const e=i[s],r=parseInt(e["LAST-MSN"])||(null==t?void 0:t.lastPartSn);let n=parseInt(e["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const e=Math.min(t.age-t.partTarget,t.targetduration);n>=0&&e>t.partTarget&&(n+=1)}return new pi(r,n>=0?n:void 0,hi)}}}loadPlaylist(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,i){const{details:r,stats:s}=t,n=self.performance.now(),a=s.loading.first?Math.max(0,n-s.loading.first):0;if(r.advancedDateTime=Date.now()-a,r.live||null!=i&&i.live){if(r.reloaded(i),i&&this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:"MISSED"}`),i&&r.fragments.length>0&&vi(i,r),!this.canLoad||!r.live)return;let a,o,l;if(r.canBlockReload&&r.endSN&&r.advanced){const e=this.hls.config.lowLatencyMode,s=r.lastPartSn,n=r.endSN,d=r.lastPartIndex,c=s===n;-1!==d?(o=c?n+1:s,l=c?e?0:d:d+1):o=n+1;const h=r.age,u=h+r.ageHeader;let f=Math.min(u-r.partTarget,1.5*r.targetduration);if(f>0){if(i&&f>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${f} with playlist age: ${r.age}`),f=0;else{const e=Math.floor(f/r.targetduration);if(o+=e,void 0!==l){l+=Math.round(f%r.targetduration/r.partTarget)}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${h.toFixed(2)}s goal: ${f} skip sn ${e} to part ${l}`)}r.tuneInGoal=f}if(a=this.getDeliveryDirectives(r,t.deliveryDirectives,o,l),e||!c)return void this.loadPlaylist(a)}else r.canBlockReload&&(a=this.getDeliveryDirectives(r,t.deliveryDirectives,o,l));const d=this.hls.mainForwardBufferInfo,c=d?d.end-d.len:0,h=function(e,t=1/0){let i=1e3*e.targetduration;if(e.updated){const r=e.fragments,s=4;if(r.length&&i*s>t){const e=1e3*r[r.length-1].duration;e<i&&(i=e)}}else i/=2;return Math.round(i)}(r,1e3*(r.edge-c));r.updated&&n>this.requestScheduled+h&&(this.requestScheduled=s.loading.start),void 0!==o&&r.canBlockReload?this.requestScheduled=s.loading.first+h-(1e3*r.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+h<n?this.requestScheduled=n:this.requestScheduled-n<=0&&(this.requestScheduled+=h);let u=this.requestScheduled-n;u=Math.max(0,u),this.log(`reload live playlist ${e} in ${Math.round(u)} ms`),this.timer=self.setTimeout((()=>this.loadPlaylist(a)),u)}else this.clearTimer()}getDeliveryDirectives(e,t,i,r){let s=function(e,t){const{canSkipUntil:i,canSkipDateRanges:r,endSN:s}=e;return i&&(void 0!==t?t-s:0)<i?r?fi:ui:hi}(e,i);return null!=t&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,r=t.part,s=hi),new pi(i,r,s)}checkRetry(e){const t=e.details,i=Ti(e),r=e.errorAction,{action:s,retryCount:n=0,retryConfig:a}=r||{},o=!!r&&!!a&&(s===Pi||!r.resolved&&s===Mi);if(o){var l;if(this.requestScheduled=-1,n>=a.maxNumRetry)return!1;if(i&&null!=(l=e.context)&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${n+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const e=wi(a,n);this.timer=self.setTimeout((()=>this.loadPlaylist()),e),this.warn(`Retrying playlist loading ${n+1}/${a.maxNumRetry} after "${t}" in ${e}ms`)}e.levelRetry=!0,r.resolved=!0}return o}}let ji;class Gi extends Ui{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(te.MANIFEST_LOADING,this.onManifestLoading,this),e.on(te.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(te.LEVEL_LOADED,this.onLevelLoaded,this),e.on(te.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(te.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(te.FRAG_LOADED,this.onFragLoaded,this),e.on(te.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(te.MANIFEST_LOADING,this.onManifestLoading,this),e.off(te.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(te.LEVEL_LOADED,this.onLevelLoaded,this),e.off(te.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(te.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(te.FRAG_LOADED,this.onFragLoaded,this),e.off(te.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}startLoad(){this._levels.forEach((e=>{e.loadError=0,e.fragmentError=0})),super.startLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const i=[],r={};let s;t.levels.forEach((e=>{var t;const n=e.attrs;-1!==(null==(t=e.audioCodec)?void 0:t.indexOf("mp4a.40.34"))&&(ji||(ji=/chrome|firefox/i.test(navigator.userAgent)),ji&&(e.audioCodec=void 0));const{AUDIO:a,CODECS:o,"FRAME-RATE":l,"PATHWAY-ID":d,RESOLUTION:c,SUBTITLES:h}=n,u=`${`${d||"."}-`}${e.bitrate}-${c}-${l}-${o}`;s=r[u],s?s.addFallback(e):(s=new mi(e),r[u]=s,i.push(s)),zi(s,"audio",a),zi(s,"text",h)})),this.filterAndSortMediaOptions(i,t)}filterAndSortMediaOptions(e,t){let i=[],r=[],s=!1,n=!1,a=!1,o=e.filter((({audioCodec:e,videoCodec:t,width:i,height:r,unknownCodecs:o})=>(s||(s=!(!i||!r)),n||(n=!!t),a||(a=!!e),!(null!=o&&o.length)&&(!e||Rt(e,"audio"))&&(!t||Rt(t,"video")))));if((s||n)&&a&&(o=o.filter((({videoCodec:e,width:t,height:i})=>!!e||!(!t||!i)))),0===o.length)return void Promise.resolve().then((()=>{if(this.hls){const e=new Error("no level with compatible codecs found in manifest");this.hls.trigger(te.ERROR,{type:ie.MEDIA_ERROR,details:re.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:e,reason:e.message})}}));t.audioTracks&&(i=t.audioTracks.filter((e=>!e.audioCodec||Rt(e.audioCodec,"audio"))),Vi(i)),t.subtitles&&(r=t.subtitles,Vi(r));const l=o.slice(0);o.sort(((e,t)=>e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"]?(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1:e.bitrate!==t.bitrate?e.bitrate-t.bitrate:e.attrs["FRAME-RATE"]!==t.attrs["FRAME-RATE"]?e.attrs.decimalFloatingPoint("FRAME-RATE")-t.attrs.decimalFloatingPoint("FRAME-RATE"):e.attrs.SCORE!==t.attrs.SCORE?e.attrs.decimalFloatingPoint("SCORE")-t.attrs.decimalFloatingPoint("SCORE"):s&&e.height!==t.height?e.height-t.height:0));let d=l[0];if(this.steering&&(o=this.steering.filterParsedLevels(o),o.length!==l.length))for(let u=0;u<l.length;u++)if(l[u].pathwayId===o[0].pathwayId){d=l[u];break}this._levels=o;for(let u=0;u<o.length;u++)if(o[u]===d){this._firstLevel=u,this.log(`manifest loaded, ${o.length} level(s) found, first bitrate: ${d.bitrate}`);break}const c=a&&!n,h={levels:o,audioTracks:i,subtitleTracks:r,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:a,video:n,altAudio:!c&&i.some((e=>!!e.url))};this.hls.trigger(te.MANIFEST_PARSED,h),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return 0===this._levels.length?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const i=new Error("invalid level idx"),r=e<0;if(this.hls.trigger(te.ERROR,{type:ie.OTHER_ERROR,details:re.LEVEL_SWITCH_ERROR,level:e,fatal:r,error:i,reason:i.message}),r)return;e=Math.min(e,t.length-1)}const i=this.currentLevelIndex,r=this.currentLevel,s=r?r.attrs["PATHWAY-ID"]:void 0,n=t[e],a=n.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=n,i===e&&n.details&&r&&s===a)return;this.log(`Switching to level ${e}${a?" with Pathway "+a:""} from level ${i}${s?" with Pathway "+s:""}`);const o=J({},n,{level:e,maxBitrate:n.maxBitrate,attrs:n.attrs,uri:n.uri,urlId:n.urlId});delete o._attrs,delete o._urlId,this.hls.trigger(te.LEVEL_SWITCHING,o);const l=n.details;if(!l||l.live){const e=this.switchParams(n.uri,null==r?void 0:r.details);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){!t.fatal&&t.context&&t.context.type===Vt&&t.context.level===this.level&&this.checkRetry(t)}onFragLoaded(e,{frag:t}){if(void 0!==t&&t.type===Yt){const e=this._levels[t.level];void 0!==e&&(e.loadError=0)}}onLevelLoaded(e,t){var i;const{level:r,details:s}=t,n=this._levels[r];var a;if(!n)return this.warn(`Invalid level index ${r}`),void(null!=(a=t.deliveryDirectives)&&a.skip&&(s.deltaUpdateFailed=!0));r===this.currentLevelIndex?(0===n.fragmentError&&(n.loadError=0),this.playlistLoaded(r,t,n.details)):null!=(i=t.deliveryDirectives)&&i.skip&&(s.deltaUpdateFailed=!0)}onAudioTrackSwitched(e,t){const i=this.currentLevel;if(!i)return;const r=this.hls.audioTracks[t.id].groupId;if(i.audioGroupIds&&i.audioGroupId!==r){let e=-1;for(let t=0;t<i.audioGroupIds.length;t++)if(i.audioGroupIds[t]===r){e=t;break}-1!==e&&e!==i.urlId&&(i.urlId=e,this.canLoad&&this.startLoad())}}loadPlaylist(e){super.loadPlaylist();const t=this.currentLevelIndex,i=this.currentLevel;if(i&&this.shouldLoadPlaylist(i)){const s=i.urlId;let n=i.uri;if(e)try{n=e.addDirectives(n)}catch(r){this.warn(`Could not construct new URL with HLS Delivery Directives: ${r}`)}const a=i.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${void 0!==(null==e?void 0:e.msn)?" at sn "+e.msn+" part "+e.part:""} with${a?" Pathway "+a:""} URI ${s+1}/${i.url.length} ${n}`),this.clearTimer(),this.hls.trigger(te.LEVEL_LOADING,{url:n,level:t,id:s,deliveryDirectives:e||null})}}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e,t){const i=(e,i)=>i!==t,r=this._levels.filter(((r,s)=>s!==e||(r.url.length>1&&void 0!==t?(r.url=r.url.filter(i),r.audioGroupIds&&(r.audioGroupIds=r.audioGroupIds.filter(i)),r.textGroupIds&&(r.textGroupIds=r.textGroupIds.filter(i)),r.urlId=0,!0):(this.steering&&this.steering.removeLevel(r),!1))));this.hls.trigger(te.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){t.forEach(((e,t)=>{const{details:i}=e;null!=i&&i.fragments&&i.fragments.forEach((e=>{e.level=t}))})),this._levels=t}}function zi(e,t,i){i&&("audio"===t?(e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds[e.url.length-1]=i):"text"===t&&(e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds[e.url.length-1]=i))}function Vi(e){const t={};e.forEach((e=>{const i=e.groupId||"";e.id=t[i]=t[i]||0,t[i]++}))}var $i="NOT_LOADED",Hi="APPENDING",Yi="PARTIAL",Ki="OK";class Wi{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(te.BUFFER_APPENDED,this.onBufferAppended,this),e.on(te.FRAG_BUFFERED,this.onFragBuffered,this),e.on(te.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(te.BUFFER_APPENDED,this.onBufferAppended,this),e.off(te.FRAG_BUFFERED,this.onFragBuffered,this),e.off(te.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const i=this.activePartLists[t];if(i)for(let r=i.length;r--;){const t=i[r];if(!t)break;const s=t.end;if(t.start<=e&&null!==s&&e<=s)return t}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){const{fragments:i}=this,r=Object.keys(i);for(let s=r.length;s--;){const n=i[r[s]];if((null==n?void 0:n.body.type)===t&&n.buffered){const t=n.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,i,r){this.timeRanges&&(this.timeRanges[e]=t);const s=(null==r?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach((r=>{const n=this.fragments[r];if(!n)return;if(s>=n.body.sn)return;if(!n.buffered&&!n.loaded)return void(n.body.type===i&&this.removeFragment(n.body));const a=n.range[e];a&&a.time.some((e=>{const i=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return i&&this.removeFragment(n.body),i}))}))}detectPartialFragments(e){const t=this.timeRanges,{frag:i,part:r}=e;if(!t||"initSegment"===i.sn)return;const s=Qi(i),n=this.fragments[s];if(!n)return;const a=!i.relurl;Object.keys(t).forEach((e=>{const s=i.elementaryStreams[e];if(!s)return;const o=t[e],l=a||!0===s.partial;n.range[e]=this.getBufferedTimes(i,r,l,o)})),n.loaded=null,Object.keys(n.range).length?(n.buffered=!0,n.body.endList&&(this.endListFragments[n.body.type]=n),qi(n)||this.removeParts(i.sn-1,i.type)):this.removeFragment(n.body)}removeParts(e,t){const i=this.activePartLists[t];i&&(this.activePartLists[t]=i.filter((t=>t.fragment.sn>=e)))}fragBuffered(e,t){const i=Qi(e);let r=this.fragments[i];!r&&t&&(r=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,r.buffered=!0)}getBufferedTimes(e,t,i,r){const s={time:[],partial:i},n=e.start,a=e.end,o=e.minEndPTS||a,l=e.maxStartPTS||n;for(let d=0;d<r.length;d++){const e=r.start(d)-this.bufferPadding,t=r.end(d)+this.bufferPadding;if(l>=e&&o<=t){s.time.push({startPTS:Math.max(n,r.start(d)),endPTS:Math.min(a,r.end(d))});break}if(n<t&&a>e)s.partial=!0,s.time.push({startPTS:Math.max(n,r.start(d)),endPTS:Math.min(a,r.end(d))});else if(a<=e)break}return s}getPartialFragment(e){let t,i,r,s=null,n=0;const{bufferPadding:a,fragments:o}=this;return Object.keys(o).forEach((l=>{const d=o[l];d&&qi(d)&&(i=d.body.start-a,r=d.body.end+a,e>=i&&e<=r&&(t=Math.min(e-i,r-e),n<=t&&(s=d.body,n=t)))})),s}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||qi(t))}getState(e){const t=Qi(e),i=this.fragments[t];return i?i.buffered?qi(i)?Yi:Ki:Hi:$i}isTimeBuffered(e,t,i){let r,s;for(let n=0;n<i.length;n++){if(r=i.start(n)-this.bufferPadding,s=i.end(n)+this.bufferPadding,e>=r&&t<=s)return!0;if(t<=r)return!1}return!1}onFragLoaded(e,t){const{frag:i,part:r}=t;if("initSegment"===i.sn||i.bitrateTest)return;const s=r?null:t,n=Qi(i);this.fragments[n]={body:i,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:i,part:r,timeRanges:s}=t;if("initSegment"===i.sn)return;const n=i.type;if(r){let e=this.activePartLists[n];e||(this.activePartLists[n]=e=[]),e.push(r)}this.timeRanges=s,Object.keys(s).forEach((e=>{const t=s[e];this.detectEvictedFragments(e,t,n,r)}))}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Qi(e);return!!this.fragments[t]}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,i,r,s){r&&!this.hasGaps||Object.keys(this.fragments).forEach((n=>{const a=this.fragments[n];if(!a)return;const o=a.body;o.type!==i||r&&!o.gap||o.start<t&&o.end>e&&(a.buffered||s)&&this.removeFragment(o)}))}removeFragment(e){const t=Qi(e);e.stats.loaded=0,e.clearElementaryStreamInfo();const i=this.activePartLists[e.type];if(i){const t=e.sn;this.activePartLists[e.type]=i.filter((e=>e.fragment.sn!==t))}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function qi(e){var t,i,r;return e.buffered&&(e.body.gap||(null==(t=e.range.video)?void 0:t.partial)||(null==(i=e.range.audio)?void 0:i.partial)||(null==(r=e.range.audiovideo)?void 0:r.partial))}function Qi(e){return`${e.type}_${e.level}_${e.urlId}_${e.sn}`}const Zi=Math.pow(2,17);class Xi{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const i=e.url;if(!i)return Promise.reject(new tr({type:ie.NETWORK_ERROR,details:re.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(i?"part list":"url")),networkDetails:null}));this.abort();const r=this.config,s=r.fLoader,n=r.loader;return new Promise(((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap)return void o(er(e));const l=this.loader=e.loader=s?new s(r):new n(r),d=Ji(e),c=Li(r.fragLoadPolicy.default),h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:Zi};e.stats=l.stats,l.load(d,h,{onSuccess:(t,i,r,s)=>{this.resetLoader(e,l);let n=t.data;r.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(n.slice(0,16)),n=n.slice(16)),a({frag:e,part:null,payload:n,networkDetails:s})},onError:(t,r,s,n)=>{this.resetLoader(e,l),o(new tr({type:ie.NETWORK_ERROR,details:re.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Z({url:i,data:void 0},t),error:new Error(`HTTP Error ${t.code} ${t.text}`),networkDetails:s,stats:n}))},onAbort:(t,i,r)=>{this.resetLoader(e,l),o(new tr({type:ie.NETWORK_ERROR,details:re.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:r,stats:t}))},onTimeout:(t,i,r)=>{this.resetLoader(e,l),o(new tr({type:ie.NETWORK_ERROR,details:re.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:r,stats:t}))},onProgress:(i,r,s,n)=>{t&&t({frag:e,part:null,payload:s,networkDetails:n})}})}))}loadPart(e,t,i){this.abort();const r=this.config,s=r.fLoader,n=r.loader;return new Promise(((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void o(er(e,t));const l=this.loader=e.loader=s?new s(r):new n(r),d=Ji(e,t),c=Li(r.fragLoadPolicy.default),h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Zi};t.stats=l.stats,l.load(d,h,{onSuccess:(r,s,n,o)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);const d={frag:e,part:t,payload:r.data,networkDetails:o};i(d),a(d)},onError:(i,r,s,n)=>{this.resetLoader(e,l),o(new tr({type:ie.NETWORK_ERROR,details:re.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Z({url:d.url,data:void 0},i),error:new Error(`HTTP Error ${i.code} ${i.text}`),networkDetails:s,stats:n}))},onAbort:(i,r,s)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),o(new tr({type:ie.NETWORK_ERROR,details:re.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:s,stats:i}))},onTimeout:(i,r,s)=>{this.resetLoader(e,l),o(new tr({type:ie.NETWORK_ERROR,details:re.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:s,stats:i}))}})}))}updateStatsFromPart(e,t){const i=e.stats,r=t.stats,s=r.total;if(i.loaded+=r.loaded,s){const r=Math.round(e.duration/t.duration),n=Math.min(Math.round(i.loaded/s),r),a=(r-n)*Math.round(i.loaded/n);i.total=i.loaded+a}else i.total=Math.max(i.loaded,i.total);const n=i.loading,a=r.loading;n.start?n.first+=a.first-a.start:(n.start=a.start,n.first=a.first),n.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Ji(e,t=null){const i=t||e,r={frag:e,part:t,responseType:"arraybuffer",url:i.url,headers:{},rangeStart:0,rangeEnd:0},s=i.byteRangeStartOffset,n=i.byteRangeEndOffset;if(ee(s)&&ee(n)){var a;let t=s,i=n;if("initSegment"===e.sn&&"AES-128"===(null==(a=e.decryptdata)?void 0:a.method)){const e=n-s;e%16&&(i=n+(16-e%16)),0!==s&&(r.resetIV=!0,t=s-16)}r.rangeStart=t,r.rangeEnd=i}return r}function er(e,t){const i=new Error(`GAP ${e.gap?"tag":"attribute"} found`),r={type:ie.MEDIA_ERROR,details:re.FRAG_GAP,fatal:!1,frag:e,error:i,networkDetails:null};return t&&(r.part=t),(t||e).stats.aborted=!0,new tr(r)}class tr extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class ir{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const t in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[t].loader;if(i){if(e&&e!==i.context.frag.type)return;i.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=re.KEY_LOAD_ERROR,i,r,s){return new tr({type:ie.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:i,networkDetails:r})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:i,cc:r}=e;for(let e=0;e<t.length;e++){const s=t[e];if(r<=s.cc&&("initSegment"===i||"initSegment"===s.sn||i<s.sn)){this.emeController.selectKeySystemFormat(s).then((e=>{s.setKeyFormat(e)}));break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then((t=>this.loadInternal(e,t))):this.loadInternal(e)}loadInternal(e,t){var i,r;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const i=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,re.KEY_LOAD_ERROR,i))}const n=s.uri;if(!n)return Promise.reject(this.createKeyLoadError(e,re.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${n}"`)));let a=this.keyUriToKeyInfo[n];if(null!=(i=a)&&i.decryptdata.key)return s.key=a.decryptdata.key,Promise.resolve({frag:e,keyInfo:a});var o;if(null!=(r=a)&&r.keyLoadPromise)switch(null==(o=a.mediaKeySessionContext)?void 0:o.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return a.keyLoadPromise.then((t=>(s.key=t.keyInfo.decryptdata.key,{frag:e,keyInfo:a})))}switch(a=this.keyUriToKeyInfo[n]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===s.keyFormat?this.loadKeyHTTP(a,e):this.loadKeyEME(a,e);case"AES-128":return this.loadKeyHTTP(a,e);default:return Promise.reject(this.createKeyLoadError(e,re.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const t=this.emeController.loadKey(i);if(t)return(e.keyLoadPromise=t.then((t=>(e.mediaKeySessionContext=t,i)))).catch((t=>{throw e.keyLoadPromise=null,t}))}return Promise.resolve(i)}loadKeyHTTP(e,t){const i=this.config,r=new(0,i.loader)(i);return t.keyLoader=e.loader=r,e.keyLoadPromise=new Promise(((s,n)=>{const a={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},o=i.keyLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(e,t,i,r)=>{const{frag:a,keyInfo:o,url:l}=i;if(!a.decryptdata||o!==this.keyUriToKeyInfo[l])return n(this.createKeyLoadError(a,re.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),r));o.decryptdata.key=a.decryptdata.key=new Uint8Array(e.data),a.keyLoader=null,o.loader=null,s({frag:a,keyInfo:o})},onError:(e,i,r,s)=>{this.resetLoader(i),n(this.createKeyLoadError(t,re.KEY_LOAD_ERROR,new Error(`HTTP Error ${e.code} loading key ${e.text}`),r,Z({url:a.url,data:void 0},e)))},onTimeout:(e,i,r)=>{this.resetLoader(i),n(this.createKeyLoadError(t,re.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),r))},onAbort:(e,i,r)=>{this.resetLoader(i),n(this.createKeyLoadError(t,re.INTERNAL_ABORTED,new Error("key loading aborted"),r))}};r.load(a,l,d)}))}resetLoader(e){const{frag:t,keyInfo:i,url:r}=e,s=i.loader;t.keyLoader===s&&(t.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[r],s&&s.destroy()}}class rr{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}const sr={length:0,start:()=>0,end:()=>0};class nr{static isBuffered(e,t){try{if(e){const i=nr.getBuffered(e);for(let e=0;e<i.length;e++)if(t>=i.start(e)&&t<=i.end(e))return!0}}catch(i){}return!1}static bufferInfo(e,t,i){try{if(e){const r=nr.getBuffered(e),s=[];let n;for(n=0;n<r.length;n++)s.push({start:r.start(n),end:r.end(n)});return this.bufferedInfo(s,t,i)}}catch(r){}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,i){t=Math.max(0,t),e.sort((function(e,t){const i=e.start-t.start;return i||t.end-e.end}));let r=[];if(i)for(let l=0;l<e.length;l++){const t=r.length;if(t){const s=r[t-1].end;e[l].start-s<i?e[l].end>s&&(r[t-1].end=e[l].end):r.push(e[l])}else r.push(e[l])}else r=e;let s,n=0,a=t,o=t;for(let l=0;l<r.length;l++){const e=r[l].start,d=r[l].end;if(t+i>=e&&t<d)a=e,o=d,n=o-t;else if(t+i<e){s=e;break}}return{len:n,start:a||0,end:o||0,nextStart:s}}static getBuffered(e){try{return e.buffered}catch(t){return le.log("failed to get media.buffered",t),sr}}}class ar{constructor(e,t,i,r=0,s=-1,n=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=i,this.size=r,this.part=s,this.partial=n}}function or(e,t){let i=null;for(let r=0,s=e.length;r<s;r++){const s=e[r];if(s&&s.cc===t){i=s;break}}return i}function lr(e,t){if(e){const i=e.start+t;e.start=e.startPTS=i,e.endPTS=i+e.duration}}function dr(e,t){const i=t.fragments;for(let r=0,s=i.length;r<s;r++)lr(i[r],e);t.fragmentHint&&lr(t.fragmentHint,e),t.alignedSliding=!0}function cr(e,t,i){t&&(!function(e,t,i){if(function(e,t,i){return!(!t.details||!(i.endCC>i.startCC||e&&e.cc<i.startCC))}(e,i,t)){const e=function(e,t){const i=e.fragments,r=t.fragments;if(!r.length||!i.length)return void le.log("No fragments to align");const s=or(i,r[0].cc);if(s&&(!s||s.startPTS))return s;le.log("No frag in previous level to align on")}(i.details,t);e&&ee(e.start)&&(le.log(`Adjusting PTS using last level due to CC increase within current level ${t.url}`),dr(e.start,t))}}(e,i,t),!i.alignedSliding&&t.details&&function(e,t){if(!t.fragments.length||!e.hasProgramDateTime||!t.hasProgramDateTime)return;const i=t.fragments[0].programDateTime,r=e.fragments[0].programDateTime,s=(r-i)/1e3+t.fragments[0].start;s&&ee(s)&&(le.log(`Adjusting PTS using programDateTime delta ${r-i}ms, sliding:${s.toFixed(3)} ${e.url} `),dr(s,e))}(i,t.details),i.alignedSliding||!t.details||i.skippedSegments||_i(t.details,i))}function hr(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;const i=e.fragments,r=t.fragments;if(!i.length||!r.length)return;const s=r[Math.round(r.length/2)-1],n=or(i,s.cc)||i[Math.round(i.length/2)-1],a=s.programDateTime,o=n.programDateTime;if(null===a||null===o)return;dr((o-a)/1e3-(n.start-s.start),e)}class ur{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class fr{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}class pr{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),i=new Uint32Array(4);for(let r=0;r<4;r++)i[r]=t.getUint32(4*r);return i}initTable(){const e=this.sBox,t=this.invSBox,i=this.subMix,r=i[0],s=i[1],n=i[2],a=i[3],o=this.invSubMix,l=o[0],d=o[1],c=o[2],h=o[3],u=new Uint32Array(256);let f=0,p=0,m=0;for(m=0;m<256;m++)u[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){let i=p^p<<1^p<<2^p<<3^p<<4;i=i>>>8^255&i^99,e[f]=i,t[i]=f;const o=u[f],m=u[o],g=u[m];let y=257*u[i]^16843008*i;r[f]=y<<24|y>>>8,s[f]=y<<16|y>>>16,n[f]=y<<8|y>>>24,a[f]=y,y=16843009*g^65537*m^257*o^16843008*f,l[i]=y<<24|y>>>8,d[i]=y<<16|y>>>16,c[i]=y<<8|y>>>24,h[i]=y,f?(f=o^u[u[u[g^o]]],p^=u[u[p]]):f=p=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let i=!0,r=0;for(;r<t.length&&i;)i=t[r]===this.key[r],r++;if(i)return;this.key=t;const s=this.keySize=t.length;if(4!==s&&6!==s&&8!==s)throw new Error("Invalid aes key size="+s);const n=this.ksRows=4*(s+6+1);let a,o;const l=this.keySchedule=new Uint32Array(n),d=this.invKeySchedule=new Uint32Array(n),c=this.sBox,h=this.rcon,u=this.invSubMix,f=u[0],p=u[1],m=u[2],g=u[3];let y,v;for(a=0;a<n;a++)a<s?y=l[a]=t[a]:(v=y,a%s==0?(v=v<<8|v>>>24,v=c[v>>>24]<<24|c[v>>>16&255]<<16|c[v>>>8&255]<<8|c[255&v],v^=h[a/s|0]<<24):s>6&&a%s==4&&(v=c[v>>>24]<<24|c[v>>>16&255]<<16|c[v>>>8&255]<<8|c[255&v]),l[a]=y=(l[a-s]^v)>>>0);for(o=0;o<n;o++)a=n-o,v=3&o?l[a]:l[a-4],d[o]=o<4||a<=4?v:f[c[v>>>24]]^p[c[v>>>16&255]]^m[c[v>>>8&255]]^g[c[255&v]],d[o]=d[o]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,i){const r=this.keySize+6,s=this.invKeySchedule,n=this.invSBox,a=this.invSubMix,o=a[0],l=a[1],d=a[2],c=a[3],h=this.uint8ArrayToUint32Array_(i);let u=h[0],f=h[1],p=h[2],m=h[3];const g=new Int32Array(e),y=new Int32Array(g.length);let v,_,E,b,S,T,A,w,L,I,R,D,k,x;const C=this.networkToHostOrderSwap;for(;t<g.length;){for(L=C(g[t]),I=C(g[t+1]),R=C(g[t+2]),D=C(g[t+3]),S=L^s[0],T=D^s[1],A=R^s[2],w=I^s[3],k=4,x=1;x<r;x++)v=o[S>>>24]^l[T>>16&255]^d[A>>8&255]^c[255&w]^s[k],_=o[T>>>24]^l[A>>16&255]^d[w>>8&255]^c[255&S]^s[k+1],E=o[A>>>24]^l[w>>16&255]^d[S>>8&255]^c[255&T]^s[k+2],b=o[w>>>24]^l[S>>16&255]^d[T>>8&255]^c[255&A]^s[k+3],S=v,T=_,A=E,w=b,k+=4;v=n[S>>>24]<<24^n[T>>16&255]<<16^n[A>>8&255]<<8^n[255&w]^s[k],_=n[T>>>24]<<24^n[A>>16&255]<<16^n[w>>8&255]<<8^n[255&S]^s[k+1],E=n[A>>>24]<<24^n[w>>16&255]<<16^n[S>>8&255]<<8^n[255&T]^s[k+2],b=n[w>>>24]<<24^n[S>>16&255]<<16^n[T>>8&255]<<8^n[255&A]^s[k+3],y[t]=C(v^u),y[t+1]=C(b^f),y[t+2]=C(E^p),y[t+3]=C(_^m),u=L,f=I,p=R,m=D,t+=4}return y.buffer}}class mr{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(i){}null===this.subtle&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function(e){const t=e.byteLength,i=t&&new DataView(e.buffer).getUint8(t-1);return i?Oe(e,0,t-i):e}(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i){return this.useSoftware?new Promise(((r,s)=>{this.softwareDecrypt(new Uint8Array(e),t,i);const n=this.flush();n?r(n.buffer):s(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(e),t,i)}softwareDecrypt(e,t,i){const{currentIV:r,currentResult:s,remainderData:n}=this;this.logOnce("JS AES decrypt"),n&&(e=ht(n,e),this.remainderData=null);const a=this.getValidChunk(e);if(!a.length)return null;r&&(i=r);let o=this.softwareDecrypter;o||(o=this.softwareDecrypter=new pr),o.expandKey(t);const l=s;return this.currentResult=o.decrypt(a.buffer,0,i),this.currentIV=Oe(a,-16).buffer,l||null}webCryptoDecrypt(e,t,i){const r=this.subtle;return this.key===t&&this.fastAesKey||(this.key=t,this.fastAesKey=new fr(r,t)),this.fastAesKey.expandKey().then((t=>{if(!r)return Promise.reject(new Error("web crypto not initialized"));this.logOnce("WebCrypto AES decrypt");return new ur(r,new Uint8Array(i)).decrypt(e.buffer,t)})).catch((r=>(le.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(e,t,i))))}onWebCryptoError(e,t,i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i);const r=this.flush();if(r)return r.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e;const i=e.length-e.length%16;return i!==e.length&&(t=Oe(e,0,i),this.remainderData=Oe(e,i)),t}logOnce(e){this.logEnabled&&(le.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const gr=function(e){let t="";const i=e.length;for(let r=0;r<i;r++)t+=`[${e.start(r).toFixed(3)}-${e.end(r).toFixed(3)}]`;return t},yr="STOPPED",vr="IDLE",_r="KEY_LOADING",Er="FRAG_LOADING",br="FRAG_LOADING_WAITING_RETRY",Sr="WAITING_TRACK",Tr="PARSING",Ar="PARSED",wr="ENDED",Lr="ERROR",Ir="WAITING_INIT_PTS",Rr="WAITING_LEVEL";class Dr extends rr{constructor(e,t,i,r,s){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=yr,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=s,this.logPrefix=r,this.log=le.log.bind(le,`${r}:`),this.warn=le.warn.bind(le,`${r}:`),this.hls=e,this.fragmentLoader=new Xi(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new mr(e.config),e.on(te.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=yr}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;const i=t.partList;if(null!=i&&i.length){const e=i[i.length-1];return nr.isBuffered(this.media,e.start+e.duration/2)}const r=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(r)}getLevelDetails(){var e;if(this.levels&&null!==this.levelLastLoaded)return null==(e=this.levels[this.levelLastLoaded])?void 0:e.details}onMediaAttached(e,t){const i=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),i.addEventListener("seeking",this.onvseeking),i.addEventListener("ended",this.onvended);const r=this.config;this.levels&&r.autoStartLoad&&this.state===yr&&this.startLoad(r.startPosition)}onMediaDetaching(){const e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:t,media:i,mediaBuffer:r,state:s}=this,n=i?i.currentTime:0,a=nr.bufferInfo(r||i,n,e.maxBufferHole);if(this.log(`media seeking to ${ee(n)?n.toFixed(3):n}, state: ${s}`),this.state===wr)this.resetLoadingState();else if(t){const i=e.maxFragLookUpTolerance,r=t.start-i,s=t.start+t.duration+i;if(!a.len||s<a.start||r>a.end){const e=n>s;(n<r||e)&&(e&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}i&&(this.fragmentTracker.removeFragmentsInRange(n,1/0,this.playlistType,!0),this.lastCurrentTime=n),this.loadedmetadata||a.len||(this.nextLoadPosition=this.startPosition=n),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.stopLoad(),super.onHandlerDestroying()}onHandlerDestroyed(){this.state=yr,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){this._doFragLoad(e,t,i,(t=>{if(this.fragContextChanged(e))return this.warn(`Fragment ${e.sn}${t.part?" p: "+t.part.index:""} of level ${e.level} was dropped during download.`),void this.fragmentTracker.removeFragment(e);e.stats.chunkCount++,this._handleFragmentLoadProgress(t)})).then((t=>{if(!t)return;const i=this.state;this.fragContextChanged(e)?(i===Er||!this.fragCurrent&&i===Tr)&&(this.fragmentTracker.removeFragment(e),this.state=vr):("payload"in t&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(te.FRAG_LOADED,t)),this._handleFragmentLoadComplete(t))})).catch((t=>{this.state!==yr&&this.state!==Lr&&(this.warn(t),this.resetFragmentLoading(e))}))}clearTrackerIfNeeded(e){var t;const{fragmentTracker:i}=this;if(i.getState(e)===Hi){const t=e.type,r=this.getFwdBufferInfo(this.mediaBuffer,t),s=Math.max(e.duration,r?r.len:this.config.maxBufferLength);this.reduceMaxBufferLength(s)&&i.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===Yi&&i.removeFragment(e))}flushMainBuffer(e,t,i=null){if(!(e-t))return;const r={startOffset:e,endOffset:t,type:i};this.hls.trigger(te.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then((t=>{if(!t||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return t})).then((t=>{const{hls:i}=this,{payload:r}=t,s=e.decryptdata;if(r&&r.byteLength>0&&s&&s.key&&s.iv&&"AES-128"===s.method){const n=self.performance.now();return this.decrypter.decrypt(new Uint8Array(r),s.key.buffer,s.iv.buffer).catch((t=>{throw i.trigger(te.ERROR,{type:ie.MEDIA_ERROR,details:re.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:e}),t})).then((r=>{const s=self.performance.now();return i.trigger(te.FRAG_DECRYPTED,{frag:e,payload:r,stats:{tstart:n,tdecrypt:s}}),t.payload=r,t}))}return t})).then((i=>{const{fragCurrent:r,hls:s,levels:n}=this;if(!n)throw new Error("init load aborted, missing levels");const a=e.stats;this.state=vr,t.fragmentError=0,e.data=new Uint8Array(i.payload),a.parsing.start=a.buffering.start=self.performance.now(),a.parsing.end=a.buffering.end=self.performance.now(),i.frag===r&&s.trigger(te.FRAG_BUFFERED,{stats:a,frag:r,part:null,id:e.type}),this.tick()})).catch((t=>{this.state!==yr&&this.state!==Lr&&(this.warn(t),this.resetFragmentLoading(e))}))}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.level!==t.level||e.sn!==t.sn||e.urlId!==t.urlId}fragBufferedComplete(e,t){var i,r,s,n;const a=this.mediaBuffer?this.mediaBuffer:this.media;this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===Yt?"level":"track"} ${e.level} (frag:[${(null!=(i=e.startPTS)?i:NaN).toFixed(3)}-${(null!=(r=e.endPTS)?r:NaN).toFixed(3)}] > buffer:${a?gr(nr.getBuffered(a)):"(detached)"})`),this.state=vr,a&&(!this.loadedmetadata&&e.type==Yt&&a.buffered.length&&(null==(s=this.fragCurrent)?void 0:s.sn)===(null==(n=this.fragPrevious)?void 0:n.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:i,part:r,partsLoaded:s}=e,n=!s||0===s.length||s.some((e=>!e)),a=new ar(i.level,i.sn,i.stats.chunkCount+1,0,r?r.index:-1,!n);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,r){var s;const n=null==t?void 0:t.details;if(!this.levels||!n)throw new Error(`frag load aborted, missing level${n?"":" detail"}s`);let a=null;if(!e.encrypted||null!=(s=e.decryptdata)&&s.key?!e.encrypted&&n.encryptedFragments.length&&this.keyLoader.loadClear(e,n.encryptedFragments):(this.log(`Loading key for ${e.sn} of [${n.startSN}-${n.endSN}], ${"[stream-controller]"===this.logPrefix?"level":"track"} ${e.level}`),this.state=_r,this.fragCurrent=e,a=this.keyLoader.load(e).then((e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(te.KEY_LOADED,e),this.state===_r&&(this.state=vr),e})),this.hls.trigger(te.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(a=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),i=Math.max(e.start,i||0),this.config.lowLatencyMode&&"initSegment"!==e.sn){const s=n.partList;if(s&&r){i>e.end&&n.fragmentHint&&(e=n.fragmentHint);const o=this.getNextPart(s,e,i);if(o>-1){const l=s[o];let d;return this.log(`Loading part sn: ${e.sn} p: ${l.index} cc: ${e.cc} of playlist [${n.startSN}-${n.endSN}] parts [0-${o}-${s.length-1}] ${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=l.start+l.duration,this.state=Er,d=a?a.then((i=>!i||this.fragContextChanged(i.frag)?null:this.doFragPartsLoad(e,l,t,r))).catch((e=>this.handleFragLoadError(e))):this.doFragPartsLoad(e,l,t,r).catch((e=>this.handleFragLoadError(e))),this.hls.trigger(te.FRAG_LOADING,{frag:e,part:l,targetBufferTime:i}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):d}if(!e.url||this.loadedEndOfParts(s,i))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${n?"of ["+n.startSN+"-"+n.endSN+"] ":""}${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(i.toFixed(3))}`),ee(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Er;const o=this.config.progressive;let l;return l=o&&a?a.then((t=>!t||this.fragContextChanged(null==t?void 0:t.frag)?null:this.fragmentLoader.load(e,r))).catch((e=>this.handleFragLoadError(e))):Promise.all([this.fragmentLoader.load(e,o?r:void 0),a]).then((([e])=>(!o&&e&&r&&r(e),e))).catch((e=>this.handleFragLoadError(e))),this.hls.trigger(te.FRAG_LOADING,{frag:e,targetBufferTime:i}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):l}doFragPartsLoad(e,t,i,r){return new Promise(((s,n)=>{var a;const o=[],l=null==(a=i.details)?void 0:a.partList,d=t=>{this.fragmentLoader.loadPart(e,t,r).then((r=>{o[t.index]=r;const n=r.part;this.hls.trigger(te.FRAG_LOADED,r);const a=bi(i,e.sn,t.index+1)||Si(l,e.sn,t.index+1);if(!a)return s({frag:e,part:n,partsLoaded:o});d(a)})).catch(n)};d(t)}))}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===re.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(te.ERROR,t)}else this.hls.trigger(te.ERROR,{type:ie.OTHER_ERROR,details:re.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==Tr)return void(this.fragCurrent||this.state===yr||this.state===Lr||(this.state=vr));const{frag:i,part:r,level:s}=t,n=self.performance.now();i.stats.parsing.end=n,r&&(r.stats.parsing.end=n),this.updateLevelTiming(i,r,s,e.partial)}getCurrentContext(e){const{levels:t,fragCurrent:i}=this,{level:r,sn:s,part:n}=e;if(null==t||!t[r])return this.warn(`Levels object was unset while buffering fragment ${s} of level ${r}. The current chunk will not be buffered.`),null;const a=t[r],o=n>-1?bi(a,s,n):null,l=o?o.fragment:function(e,t,i){if(null==e||!e.details)return null;const r=e.details;let s=r.fragments[t-r.startSN];return s||(s=r.fragmentHint,s&&s.sn===t?s:t<r.startSN&&i&&i.sn===t?i:null)}(a,s,i);return l?(i&&i!==l&&(l.stats=i.stats),{frag:l,part:o,level:a}):null}bufferFragmentData(e,t,i,r){var s;if(!e||this.state!==Tr)return;const{data1:n,data2:a}=e;let o=n;if(n&&a&&(o=ht(n,a)),null==(s=o)||!s.length)return;const l={type:e.type,frag:t,part:i,chunkMeta:r,parent:t.type,data:o};this.hls.trigger(te.BUFFER_APPENDING,l),e.dropped&&e.independent&&!i&&this.flushBufferGap(t)}flushBufferGap(e){const t=this.media;if(!t)return;if(!nr.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const i=t.currentTime,r=nr.bufferInfo(t,i,0),s=e.duration,n=Math.min(2*this.config.maxFragLookUpTolerance,.25*s),a=Math.max(Math.min(e.start-n,r.end-n),i+n);e.start-a>n&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){const i=this.getLoadPosition();return ee(i)?this.getFwdBufferInfoAtPos(e,i,t):null}getFwdBufferInfoAtPos(e,t,i){const{config:{maxBufferHole:r}}=this,s=nr.bufferInfo(e,t,r);if(0===s.len&&void 0!==s.nextStart){const n=this.fragmentTracker.getBufferedFrag(t,i);if(n&&s.nextStart<n.end)return nr.bufferInfo(e,t,Math.max(s.nextStart,r))}return s}getMaxBufferLength(e){const{config:t}=this;let i;return i=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)}reduceMaxBufferLength(e){const t=this.config,i=e||t.maxBufferLength;return t.maxMaxBufferLength>=i&&(t.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${t.maxMaxBufferLength}s`),!0)}getAppendedFrag(e,t=Yt){const i=this.fragmentTracker.getAppendedFrag(e,Yt);return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){const i=t.fragments,r=i.length;if(!r)return null;const{config:s}=this,n=i[0].start;let a;if(t.live){const n=s.initialLiveManifestSize;if(r<n)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${n})`),null;t.PTSKnown||this.startFragRequested||-1!==this.startPosition||(a=this.getInitialLiveFragment(t,i),this.startPosition=a?this.hls.liveSyncPosition||a.start:e)}else e<=n&&(a=i[0]);if(!a){const i=s.lowLatencyMode?t.partEnd:t.fragmentEnd;a=this.getFragmentAtPosition(e,i,t)}return this.mapToInitFragWhenRequired(a)}isLoopLoading(e,t){const i=this.fragmentTracker.getState(e);return(i===Ki||i===Yi&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,r,s){const n=e.gap,a=this.getNextFragment(this.nextLoadPosition,t);if(null===a)return a;if(e=a,n&&e&&!e.gap&&i.nextStart){const t=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,r);if(null!==t&&i.len+t.len>=s)return this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,i){let r=-1,s=!1,n=!0;for(let a=0,o=e.length;a<o;a++){const o=e[a];if(n=n&&!o.independent,r>-1&&i<o.start)break;const l=o.loaded;l?r=-1:(s||o.independent||n)&&o.fragment===t&&(r=a),s=l}return r}loadedEndOfParts(e,t){const i=e[e.length-1];return i&&t>i.start&&i.loaded}getInitialLiveFragment(e,t){const i=this.fragPrevious;let r=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),r=function(e,t,i){if(null===t||!Array.isArray(e)||!e.length||!ee(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;i=i||0;for(let r=0;r<e.length;++r){const s=e[r];if(xi(t,i,s))return s}return null}(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const s=i.sn+1;if(s>=e.startSN&&s<=e.endSN){const n=t[s-e.startSN];i.cc===n.cc&&(r=n,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=function(e,t){return Ri(e,(e=>e.cc<t?1:e.cc>t?-1:0))}(t,i.cc),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const t=this.hls.liveSyncPosition;null!==t&&(r=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,i){const{config:r}=this;let{fragPrevious:s}=this,{fragments:n,endSN:a}=i;const{fragmentHint:o}=i,l=r.maxFragLookUpTolerance,d=i.partList,c=!!(r.lowLatencyMode&&null!=d&&d.length&&o);let h;if(c&&o&&!this.bitrateTest&&(n=n.concat(o),a=o.sn),e<t){h=Di(s,n,e,e>t-l?0:l)}else h=n[n.length-1];if(h){const e=h.sn-i.startSN,t=this.fragmentTracker.getState(h);if((t===Ki||t===Yi&&h.gap)&&(s=h),s&&h.sn===s.sn&&(!c||d[0].fragment.sn>h.sn)){if(s&&h.level===s.level){const t=n[e+1];h=h.sn<a&&this.fragmentTracker.getState(t)!==Ki?t:null}}}return h}synchronizeToLiveEdge(e){const{config:t,media:i}=this;if(!i)return;const r=this.hls.liveSyncPosition,s=i.currentTime,n=e.fragments[0].start,a=e.edge,o=s>=n-t.maxFragLookUpTolerance&&s<=a;if(null!==r&&i.duration>r&&(s<r||!o)){const n=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!o&&i.readyState<4||s<a-n)&&(this.loadedmetadata||(this.nextLoadPosition=r),i.readyState&&(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${r.toFixed(3)}`),i.currentTime=r))}}alignPlaylists(e,t){const{levels:i,levelLastLoaded:r,fragPrevious:s}=this,n=null!==r?i[r]:null,a=e.fragments.length;if(!a)return this.warn("No fragments in live playlist"),0;const o=e.fragments[0].start,l=!t,d=e.alignedSliding&&ee(o);if(l||!d&&!o){cr(s,n,e);const i=e.fragments[0].start;return this.log(`Live playlist sliding: ${i.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${s?s.sn:"na"} fragments: ${a}`),i}return o}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let i=this.startPosition;if(i<t&&(i=-1),-1===i||-1===this.lastCurrentTime){const r=null!==this.startTimeOffset,s=r?this.startTimeOffset:e.startTimeOffset;null!==s&&ee(s)?(i=t+s,s<0&&(i+=e.totalduration),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Start time offset ${s} found in ${r?"multivariant":"media"} playlist, adjust startPosition to ${i}`),this.startPosition=i):e.live?i=this.hls.liveSyncPosition||t:this.startPosition=i=0,this.lastCurrentTime=i}this.nextLoadPosition=i}getLoadPosition(){const{media:e}=this;let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===br)||(this.state=vr)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;var r;if(this.fragContextChanged(i))return void this.warn(`Frag load error must match current frag to retry ${i.url} > ${null==(r=this.fragCurrent)?void 0:r.url}`);const s=t.details===re.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(i,!0);const n=t.errorAction,{action:a,retryCount:o=0,retryConfig:l}=n||{};if(n&&a===Pi&&l){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);const r=wi(l,o);this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${o+1}/${l.maxNumRetry} in ${r}ms`),n.resolved=!0,this.retryDate=self.performance.now()+r,this.state=br}else l&&n?(this.resetFragmentErrors(e),o<l.maxNumRetry?s||(n.resolved=!0):le.warn(`${t.details} reached or exceeded max retry (${o})`)):this.state=Lr;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===Tr||this.state===Ar){const t=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,t),r=i&&i.len>.5;r&&this.reduceMaxBufferLength(i.len);const s=!r;return s&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${t} buffer`),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),s}return!1}resetFragmentErrors(e){e===Kt&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==yr&&(this.state=vr)}afterBufferFlushed(e,t,i){if(!e)return;const r=nr.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,i),this.state===wr&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=vr}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const t=this.levels?this.levels[e].details:null;null!=t&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(e.level),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,r){var s;const n=i.details;if(!n)return void this.warn("level.details undefined");if(Object.keys(e.elementaryStreams).reduce(((t,s)=>{const a=e.elementaryStreams[s];if(a){const o=a.endPTS-a.startPTS;if(o<=0)return this.warn(`Could not parse fragment ${e.sn} ${s} duration reliably (${o})`),t||!1;const l=r?0:yi(n,e,a.startPTS,a.endPTS,a.startDTS,a.endDTS);return this.hls.trigger(te.LEVEL_PTS_UPDATED,{details:n,level:i,drift:l,type:s,frag:e,start:a.startPTS,end:a.endPTS}),!0}return t}),!1))i.fragmentError=0;else if(null===(null==(s=this.transmuxer)?void 0:s.error)){const t=new Error(`Found no media in fragment ${e.sn} of level ${i.id} resetting transmuxer to fallback to playlist timing`);if(this.warn(t.message),this.hls.trigger(te.ERROR,{type:ie.MEDIA_ERROR,details:re.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:`Found no media in msn ${e.sn} of level "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=Ar,this.hls.trigger(te.FRAG_PARSED,{frag:e,part:t})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){"demuxerWorker"===e.event&&(this.resetTransmuxer(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function kr(){return self.SourceBuffer||self.WebKitSourceBuffer}function xr(e="",t=9e4){return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class Cr{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){this.cachedData&&(e=ht(this.cachedData,e),this.cachedData=null);let i,r=Be(e,0),s=r?r.length:0;const n=this._audioTrack,a=this._id3Track,o=r?(e=>{const t=Ve(e);for(let i=0;i<t.length;i++){const e=t[i];if(Ge(e))return We(e)}})(r):void 0,l=e.length;for((null===this.basePTS||0===this.frameIndex&&ee(o))&&(this.basePTS=Mr(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),r&&r.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:ii,duration:Number.POSITIVE_INFINITY});s<l;){if(this.canParse(e,s)){const t=this.appendFrame(n,e,s);t?(this.frameIndex++,this.lastPTS=t.sample.pts,s+=t.length,i=s):s=l}else je(e,s)?(r=Be(e,s),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:ii,duration:Number.POSITIVE_INFINITY}),s+=r.length,i=s):s++;if(s===l&&i!==l){const t=Oe(e,i);this.cachedData?this.cachedData=ht(this.cachedData,t):this.cachedData=t}}return{audioTrack:n,videoTrack:xr(),id3Track:a,textTrack:xr()}}demuxSampleAes(e,t,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:xr(),id3Track:this._id3Track,textTrack:xr()}}destroy(){}}const Mr=(e,t,i)=>{if(ee(e))return 90*e;return 9e4*t+(i?9e4*i.baseTime/i.timescale:0)};function Pr(e,t){return 255===e[t]&&240==(246&e[t+1])}function Or(e,t){return 1&e[t+1]?7:9}function Nr(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function Fr(e,t){return t+1<e.length&&Pr(e,t)}function Br(e,t){if(Fr(e,t)){const i=Or(e,t);if(t+i>=e.length)return!1;const r=Nr(e,t);if(r<=i)return!1;const s=t+r;return s===e.length||Fr(e,s)}return!1}function Ur(e,t,i,r,s){if(!e.samplerate){const n=function(e,t,i,r){let s,n,a,o;const l=navigator.userAgent.toLowerCase(),d=r,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];s=1+((192&t[i+2])>>>6);const h=(60&t[i+2])>>>2;if(!(h>c.length-1))return a=(1&t[i+2])<<2,a|=(192&t[i+3])>>>6,le.log(`manifest codec:${r}, ADTS type:${s}, samplingIndex:${h}`),/firefox/i.test(l)?h>=6?(s=5,o=new Array(4),n=h-3):(s=2,o=new Array(2),n=h):-1!==l.indexOf("android")?(s=2,o=new Array(2),n=h):(s=5,o=new Array(4),r&&(-1!==r.indexOf("mp4a.40.29")||-1!==r.indexOf("mp4a.40.5"))||!r&&h>=6?n=h-3:((r&&-1!==r.indexOf("mp4a.40.2")&&(h>=6&&1===a||/vivaldi/i.test(l))||!r&&1===a)&&(s=2,o=new Array(2)),n=h)),o[0]=s<<3,o[0]|=(14&h)>>1,o[1]|=(1&h)<<7,o[1]|=a<<3,5===s&&(o[1]|=(14&n)>>1,o[2]=(1&n)<<7,o[2]|=8,o[3]=0),{config:o,samplerate:c[h],channelCount:a,codec:"mp4a.40."+s,manifestCodec:d};e.trigger(te.ERROR,{type:ie.MEDIA_ERROR,details:re.FRAG_PARSING_ERROR,fatal:!0,reason:`invalid ADTS sampling index:${h}`})}(t,i,r,s);if(!n)return;e.config=n.config,e.samplerate=n.samplerate,e.channelCount=n.channelCount,e.codec=n.codec,e.manifestCodec=n.manifestCodec,le.log(`parsed codec:${e.codec}, rate:${n.samplerate}, channels:${n.channelCount}`)}}function jr(e){return 9216e4/e}function Gr(e,t,i,r,s){const n=r+s*jr(e.samplerate),a=function(e,t){const i=Or(e,t);if(t+i<=e.length){const r=Nr(e,t)-i;if(r>0)return{headerLength:i,frameLength:r}}}(t,i);let o;if(a){const{frameLength:r,headerLength:s}=a,l=s+r,d=Math.max(0,i+l-t.length);d?(o=new Uint8Array(l-s),o.set(t.subarray(i+s,t.length),0)):o=t.subarray(i+s,i+l);const c={unit:o,pts:n};return d||e.samples.push(c),{sample:c,length:l,missing:d}}const l=t.length-i;o=new Uint8Array(l),o.set(t.subarray(i,t.length),0);return{sample:{unit:o,pts:n},length:l,missing:-1}}const zr=/\/emsg[-/]ID3/i;let Vr=null;const $r=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Hr=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Yr=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Kr=[0,1,1,4];function Wr(e,t,i,r,s){if(i+24>t.length)return;const n=qr(t,i);if(n&&i+n.frameLength<=t.length){const a=r+s*(9e4*n.samplesPerFrame/n.sampleRate),o={unit:t.subarray(i,i+n.frameLength),pts:a,dts:a};return e.config=[],e.channelCount=n.channelCount,e.samplerate=n.sampleRate,e.samples.push(o),{sample:o,length:n.frameLength,missing:0}}}function qr(e,t){const i=e[t+1]>>3&3,r=e[t+1]>>1&3,s=e[t+2]>>4&15,n=e[t+2]>>2&3;if(1!==i&&0!==s&&15!==s&&3!==n){const a=e[t+2]>>1&1,o=e[t+3]>>6,l=1e3*$r[14*(3===i?3-r:3===r?3:4)+s-1],d=Hr[3*(3===i?0:2===i?1:2)+n],c=3===o?1:2,h=Yr[i][r],u=Kr[r],f=8*h*u,p=Math.floor(h*l/d+a)*u;if(null===Vr){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Vr=e?parseInt(e[1]):0}return!!Vr&&Vr<=87&&2===r&&l>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:d,channelCount:c,frameLength:p,samplesPerFrame:f}}}function Qr(e,t){return!(255!==e[t]||224&~e[t+1]||!(6&e[t+1]))}function Zr(e,t){return t+1<e.length&&Qr(e,t)}function Xr(e,t){if(t+1<e.length&&Qr(e,t)){const i=4,r=qr(e,t);let s=i;null!=r&&r.frameLength&&(s=r.frameLength);const n=t+s;return n===e.length||Zr(e,n)}return!1}class Jr{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,i=e.byteLength-t,r=new Uint8Array(4),s=Math.min(4,t);if(0===s)throw new Error("no bytes available");r.set(e.subarray(i,i+s)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*s,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const i=this.word>>>32-t;if(e>32&&le.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t,i=8,r=8;for(let s=0;s<e;s++)0!==r&&(t=this.readEG(),r=(i+t+256)%256),i=0===r?i:r}readSPS(){let e,t,i,r=0,s=0,n=0,a=0;const o=this.readUByte.bind(this),l=this.readBits.bind(this),d=this.readUEG.bind(this),c=this.readBoolean.bind(this),h=this.skipBits.bind(this),u=this.skipEG.bind(this),f=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);o();const m=o();if(l(5),h(3),o(),f(),100===m||110===m||122===m||244===m||44===m||83===m||86===m||118===m||128===m){const e=d();if(3===e&&h(1),f(),f(),h(1),c())for(t=3!==e?8:12,i=0;i<t;i++)c()&&p(i<6?16:64)}f();const g=d();if(0===g)d();else if(1===g)for(h(1),u(),u(),e=d(),i=0;i<e;i++)u();f(),h(1);const y=d(),v=d(),_=l(1);0===_&&h(1),h(1),c()&&(r=d(),s=d(),n=d(),a=d());let E=[1,1];if(c()&&c()){switch(o()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:E=[o()<<8|o(),o()<<8|o()]}}return{width:Math.ceil(16*(y+1)-2*r-2*s),height:(2-_)*(v+1)*16-(_?2:4)*(n+a),pixelRatio:E}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class es{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new mr(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,i){const r=e[t].unit;if(r.length<=16)return;const s=r.subarray(16,r.length-r.length%16),n=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(n).then((s=>{const n=new Uint8Array(s);r.set(n,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)}))}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length)return void i();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,i=new Int8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)i.set(e.subarray(s,s+16),r);return i}getAvcDecryptedUnit(e,t){const i=new Uint8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)e.set(i.subarray(r,r+16),s);return e}decryptAvcSample(e,t,i,r,s){const n=mt(s.data),a=this.getAvcEncryptedData(n);this.decryptBuffer(a.buffer).then((a=>{s.data=this.getAvcDecryptedUnit(n,a),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,r)}))}decryptAvcSamples(e,t,i,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length)return void r();const s=e[t].units;for(;!(i>=s.length);i++){const n=s[i];if(!(n.data.length<=48||1!==n.type&&5!==n.type||(this.decryptAvcSample(e,t,i,r,n),this.decrypter.isSync())))return}}}}const ts=188;class is{constructor(e,t,i){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=i}static probe(e){const t=is.syncOffset(e);return t>0&&le.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),-1!==t}static syncOffset(e){const t=e.length;let i=Math.min(940,e.length-ts)+1,r=0;for(;r<i;){let s=!1,n=-1,a=0;for(let o=r;o<t;o+=ts){if(71!==e[o]){if(a)return-1;break}if(a++,-1===n&&(n=o,0!==n&&(i=Math.min(n+18612,e.length-ts)+1)),s||(s=0===ss(e,o)),s&&a>1&&(0===n&&a>2||o+ts>i))return n}r++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:et[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,i,r){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=is.createTrack("video"),this._audioTrack=is.createTrack("audio",r),this._id3Track=is.createTrack("id3"),this._txtTrack=is.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i,this._duration=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_avcTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null}demux(e,t,i=!1,r=!1){let s;i||(this.sampleAes=null);const n=this._avcTrack,a=this._audioTrack,o=this._id3Track,l=this._txtTrack;let d=n.pid,c=n.pesData,h=a.pid,u=o.pid,f=a.pesData,p=o.pesData,m=null,g=this.pmtParsed,y=this._pmtId,v=e.length;if(this.remainderData&&(v=(e=ht(this.remainderData,e)).length,this.remainderData=null),v<ts&&!r)return this.remainderData=e,{audioTrack:a,videoTrack:n,id3Track:o,textTrack:l};const _=Math.max(0,is.syncOffset(e));v-=(v-_)%ts,v<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,v,e.buffer.byteLength-v));let E=0;for(let S=_;S<v;S+=ts)if(71===e[S]){const t=!!(64&e[S+1]),r=ss(e,S);let v;if((48&e[S+3])>>4>1){if(v=S+5+e[S+4],v===S+ts)continue}else v=S+4;switch(r){case d:t&&(c&&(s=os(c))&&this.parseAVCPES(n,l,s,!1),c={data:[],size:0}),c&&(c.data.push(e.subarray(v,S+ts)),c.size+=S+ts-v);break;case h:if(t){if(f&&(s=os(f)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,s);break;case"mp3":this.parseMPEGPES(a,s)}f={data:[],size:0}}f&&(f.data.push(e.subarray(v,S+ts)),f.size+=S+ts-v);break;case u:t&&(p&&(s=os(p))&&this.parseID3PES(o,s),p={data:[],size:0}),p&&(p.data.push(e.subarray(v,S+ts)),p.size+=S+ts-v);break;case 0:t&&(v+=e[v]+1),y=this._pmtId=ns(e,v);break;case y:{t&&(v+=e[v]+1);const r=as(e,v,this.typeSupported,i);d=r.avc,d>0&&(n.pid=d),h=r.audio,h>0&&(a.pid=h,a.segmentCodec=r.segmentCodec),u=r.id3,u>0&&(o.pid=u),null===m||g||(le.warn(`MPEG-TS PMT found at ${S} after unknown PID '${m}'. Backtracking to sync byte @${_} to parse all TS packets.`),m=null,S=_-188),g=this.pmtParsed=!0;break}case 17:case 8191:break;default:m=r}}else E++;if(E>0){const e=new Error(`Found ${E} TS packet/s that do not start with 0x47`);this.observer.emit(te.ERROR,te.ERROR,{type:ie.MEDIA_ERROR,details:re.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message})}n.pesData=c,a.pesData=f,o.pesData=p;const b={audioTrack:a,videoTrack:n,id3Track:o,textTrack:l};return r&&this.extractRemainingSamples(b),b}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:i,id3Track:r,textTrack:s}=e,n=i.pesData,a=t.pesData,o=r.pesData;let l;if(n&&(l=os(n))?(this.parseAVCPES(i,s,l,!0),i.pesData=null):i.pesData=n,a&&(l=os(a))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l)}t.pesData=null}else null!=a&&a.size&&le.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;o&&(l=os(o))?(this.parseID3PES(r,l),r.pesData=null):r.pesData=o}demuxSampleAes(e,t,i){const r=this.demux(e,i,!0,!this.config.progressive),s=this.sampleAes=new es(this.observer,this.config,t);return this.decrypt(r,s)}decrypt(e,t){return new Promise((i=>{const{audioTrack:r,videoTrack:s}=e;r.samples&&"aac"===r.segmentCodec?t.decryptAacSamples(r.samples,0,(()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,(()=>{i(e)})):i(e)})):s.samples&&t.decryptAvcSamples(s.samples,0,0,(()=>{i(e)}))}))}destroy(){this._duration=0}parseAVCPES(e,t,i,r){const s=this.parseAVCNALu(e,i.data);let n,a=this.avcSample,o=!1;i.data=null,a&&s.length&&!e.audFound&&(ls(a,e),a=this.avcSample=rs(!1,i.pts,i.dts,"")),s.forEach((r=>{switch(r.type){case 1:{n=!0,a||(a=this.avcSample=rs(!0,i.pts,i.dts,"")),a.frame=!0;const e=r.data;if(o&&e.length>4){const t=new Jr(e).readSliceType();2!==t&&4!==t&&7!==t&&9!==t||(a.key=!0)}break}case 5:n=!0,a||(a=this.avcSample=rs(!0,i.pts,i.dts,"")),a.key=!0,a.frame=!0;break;case 6:n=!0,pt(r.data,1,i.pts,t.samples);break;case 7:if(n=!0,o=!0,!e.sps){const t=r.data,i=new Jr(t).readSPS();e.width=i.width,e.height=i.height,e.pixelRatio=i.pixelRatio,e.sps=[t],e.duration=this._duration;const s=t.subarray(1,4);let n="avc1.";for(let e=0;e<3;e++){let t=s[e].toString(16);t.length<2&&(t="0"+t),n+=t}e.codec=n}break;case 8:n=!0,e.pps||(e.pps=[r.data]);break;case 9:n=!1,e.audFound=!0,a&&ls(a,e),a=this.avcSample=rs(!1,i.pts,i.dts,"");break;case 12:n=!0;break;default:n=!1,a&&(a.debug+="unknown NAL "+r.type+" ")}if(a&&n){a.units.push(r)}})),r&&a&&(ls(a,e),this.avcSample=null)}getLastNalUnit(e){var t;let i,r=this.avcSample;if(r&&0!==r.units.length||(r=e[e.length-1]),null!=(t=r)&&t.units){const e=r.units;i=e[e.length-1]}return i}parseAVCNALu(e,t){const i=t.byteLength;let r=e.naluState||0;const s=r,n=[];let a,o,l,d=0,c=-1,h=0;for(-1===r&&(c=0,h=31&t[0],r=0,d=1);d<i;)if(a=t[d++],r)if(1!==r)if(a)if(1===a){if(c>=0){const e={data:t.subarray(c,d-r-1),type:h};n.push(e)}else{const i=this.getLastNalUnit(e.samples);if(i&&(s&&d<=4-s&&i.state&&(i.data=i.data.subarray(0,i.data.byteLength-s)),o=d-r-1,o>0)){const e=new Uint8Array(i.data.byteLength+o);e.set(i.data,0),e.set(t.subarray(0,o),i.data.byteLength),i.data=e,i.state=0}}d<i?(l=31&t[d],c=d,h=l,r=0):r=-1}else r=0;else r=3;else r=a?0:2;else r=a?0:1;if(c>=0&&r>=0){const e={data:t.subarray(c,i),type:h,state:r};n.push(e)}if(0===n.length){const i=this.getLastNalUnit(e.samples);if(i){const e=new Uint8Array(i.data.byteLength+t.byteLength);e.set(i.data,0),e.set(t,i.data.byteLength),i.data=e}}return e.naluState=r,n}parseAACPES(e,t){let i=0;const r=this.aacOverFlow;let s,n,a,o=t.data;if(r){this.aacOverFlow=null;const t=r.missing,s=r.sample.unit.byteLength;if(-1===t){const e=new Uint8Array(s+o.byteLength);e.set(r.sample.unit,0),e.set(o,s),o=e}else{const n=s-t;r.sample.unit.set(o.subarray(0,t),n),e.samples.push(r.sample),i=r.missing}}for(s=i,n=o.length;s<n-1&&!Fr(o,s);s++);if(s!==i){let e;const t=s<n-1;e=t?`AAC PES did not start with ADTS header,offset:${s}`:"No ADTS header found in AAC PES";const i=new Error(e);if(le.warn(`parsing error: ${e}`),this.observer.emit(te.ERROR,te.ERROR,{type:ie.MEDIA_ERROR,details:re.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:i,reason:e}),!t)return}if(Ur(e,this.observer,o,s,this.audioCodec),void 0!==t.pts)a=t.pts;else{if(!r)return void le.warn("[tsdemuxer]: AAC PES unknown PTS");{const t=jr(e.samplerate);a=r.sample.pts+t}}let l,d=0;for(;s<n;){if(l=Gr(e,o,s,a,d),s+=l.length,l.missing){this.aacOverFlow=l;break}for(d++;s<n-1&&!Fr(o,s);s++);}}parseMPEGPES(e,t){const i=t.data,r=i.length;let s=0,n=0;const a=t.pts;if(void 0!==a)for(;n<r;)if(Zr(i,n)){const t=Wr(e,i,n,a,s);if(!t)break;n+=t.length,s++}else n++;else le.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseID3PES(e,t){if(void 0===t.pts)return void le.warn("[tsdemuxer]: ID3 PES unknown PTS");const i=J({},t,{type:this._avcTrack?si:ii,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function rs(e,t,i,r){return{key:e,frame:!1,pts:t,dts:i,units:[],debug:r,length:0}}function ss(e,t){return((31&e[t+1])<<8)+e[t+2]}function ns(e,t){return(31&e[t+10])<<8|e[t+11]}function as(e,t,i,r){const s={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},n=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<n;){const n=ss(e,t);switch(e[t]){case 207:if(!r){le.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===s.audio&&(s.audio=n);break;case 21:-1===s.id3&&(s.id3=n);break;case 219:if(!r){le.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===s.avc&&(s.avc=n);break;case 3:case 4:!0!==i.mpeg&&!0!==i.mp3?le.log("MPEG audio found, not supported in this browser"):-1===s.audio&&(s.audio=n,s.segmentCodec="mp3");break;case 36:le.warn("Unsupported HEVC stream type found")}t+=5+((15&e[t+3])<<8|e[t+4])}return s}function os(e){let t,i,r,s,n,a=0;const o=e.data;if(!e||0===e.size)return null;for(;o[0].length<19&&o.length>1;){const e=new Uint8Array(o[0].length+o[1].length);e.set(o[0]),e.set(o[1],o[0].length),o[0]=e,o.splice(1,1)}t=o[0];if(1===(t[0]<<16)+(t[1]<<8)+t[2]){if(i=(t[4]<<8)+t[5],i&&i>e.size-6)return null;const l=t[7];192&l&&(s=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&l?(n=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,s-n>54e5&&(le.warn(`${Math.round((s-n)/9e4)}s delta between PTS and DTS, align them`),s=n)):n=s),r=t[8];let d=r+9;if(e.size<=d)return null;e.size-=d;const c=new Uint8Array(e.size);for(let e=0,i=o.length;e<i;e++){t=o[e];let i=t.byteLength;if(d){if(d>i){d-=i;continue}t=t.subarray(d),i-=d,d=0}c.set(t,a),a+=i}return i&&(i-=r+3),{data:c,pts:s,dts:n,len:i}}return null}function ls(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){const i=t.samples,r=i.length;if(!r)return void t.dropped++;{const t=i[r-1];e.pts=t.pts,e.dts=t.dts}}t.samples.push(e)}e.debug.length&&le.log(e.pts+"/"+e.dts+":"+e.debug)}class ds{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const cs=Math.pow(2,32)-1;class hs{static init(){let e;for(e in hs.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},hs.types)hs.types.hasOwnProperty(e)&&(hs.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);hs.HDLR_TYPES={video:t,audio:i};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);hs.STTS=hs.STSC=hs.STCO=s,hs.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),hs.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),hs.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),hs.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const n=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);hs.FTYP=hs.box(hs.types.ftyp,n,o,n,a),hs.DINF=hs.box(hs.types.dinf,hs.box(hs.types.dref,r))}static box(e,...t){let i=8,r=t.length;const s=r;for(;r--;)i+=t[r].byteLength;const n=new Uint8Array(i);for(n[0]=i>>24&255,n[1]=i>>16&255,n[2]=i>>8&255,n[3]=255&i,n.set(e,4),r=0,i=8;r<s;r++)n.set(t[r],i),i+=t[r].byteLength;return n}static hdlr(e){return hs.box(hs.types.hdlr,hs.HDLR_TYPES[e])}static mdat(e){return hs.box(hs.types.mdat,e)}static mdhd(e,t){t*=e;const i=Math.floor(t/(cs+1)),r=Math.floor(t%(cs+1));return hs.box(hs.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))}static mdia(e){return hs.box(hs.types.mdia,hs.mdhd(e.timescale,e.duration),hs.hdlr(e.type),hs.minf(e))}static mfhd(e){return hs.box(hs.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?hs.box(hs.types.minf,hs.box(hs.types.smhd,hs.SMHD),hs.DINF,hs.stbl(e)):hs.box(hs.types.minf,hs.box(hs.types.vmhd,hs.VMHD),hs.DINF,hs.stbl(e))}static moof(e,t,i){return hs.box(hs.types.moof,hs.mfhd(e),hs.traf(i,t))}static moov(e){let t=e.length;const i=[];for(;t--;)i[t]=hs.trak(e[t]);return hs.box.apply(null,[hs.types.moov,hs.mvhd(e[0].timescale,e[0].duration)].concat(i).concat(hs.mvex(e)))}static mvex(e){let t=e.length;const i=[];for(;t--;)i[t]=hs.trex(e[t]);return hs.box.apply(null,[hs.types.mvex,...i])}static mvhd(e,t){t*=e;const i=Math.floor(t/(cs+1)),r=Math.floor(t%(cs+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return hs.box(hs.types.mvhd,s)}static sdtp(e){const t=e.samples||[],i=new Uint8Array(4+t.length);let r,s;for(r=0;r<t.length;r++)s=t[r].flags,i[r+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return hs.box(hs.types.sdtp,i)}static stbl(e){return hs.box(hs.types.stbl,hs.stsd(e),hs.box(hs.types.stts,hs.STTS),hs.box(hs.types.stsc,hs.STSC),hs.box(hs.types.stsz,hs.STSZ),hs.box(hs.types.stco,hs.STCO))}static avc1(e){let t,i,r,s=[],n=[];for(t=0;t<e.sps.length;t++)i=e.sps[t],r=i.byteLength,s.push(r>>>8&255),s.push(255&r),s=s.concat(Array.prototype.slice.call(i));for(t=0;t<e.pps.length;t++)i=e.pps[t],r=i.byteLength,n.push(r>>>8&255),n.push(255&r),n=n.concat(Array.prototype.slice.call(i));const a=hs.box(hs.types.avcC,new Uint8Array([1,s[3],s[4],s[5],255,224|e.sps.length].concat(s).concat([e.pps.length]).concat(n))),o=e.width,l=e.height,d=e.pixelRatio[0],c=e.pixelRatio[1];return hs.box(hs.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,hs.box(hs.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),hs.box(hs.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,c>>24,c>>16&255,c>>8&255,255&c])))}static esds(e){const t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static mp4a(e){const t=e.samplerate;return hs.box(hs.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]),hs.box(hs.types.esds,hs.esds(e)))}static mp3(e){const t=e.samplerate;return hs.box(hs.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]))}static stsd(e){return"audio"===e.type?"mp3"===e.segmentCodec&&"mp3"===e.codec?hs.box(hs.types.stsd,hs.STSD,hs.mp3(e)):hs.box(hs.types.stsd,hs.STSD,hs.mp4a(e)):hs.box(hs.types.stsd,hs.STSD,hs.avc1(e))}static tkhd(e){const t=e.id,i=e.duration*e.timescale,r=e.width,s=e.height,n=Math.floor(i/(cs+1)),a=Math.floor(i%(cs+1));return hs.box(hs.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,s>>8&255,255&s,0,0]))}static traf(e,t){const i=hs.sdtp(e),r=e.id,s=Math.floor(t/(cs+1)),n=Math.floor(t%(cs+1));return hs.box(hs.types.traf,hs.box(hs.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),hs.box(hs.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,n>>24,n>>16&255,n>>8&255,255&n])),hs.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||4294967295,hs.box(hs.types.trak,hs.tkhd(e),hs.mdia(e))}static trex(e){const t=e.id;return hs.box(hs.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const i=e.samples||[],r=i.length,s=12+16*r,n=new Uint8Array(s);let a,o,l,d,c,h;for(t+=8+s,n.set(["video"===e.type?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,255&r,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),a=0;a<r;a++)o=i[a],l=o.duration,d=o.size,c=o.flags,h=o.cts,n.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,d>>>24&255,d>>>16&255,d>>>8&255,255&d,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.paddingValue<<1|c.isNonSync,61440&c.degradPrio,15&c.degradPrio,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*a);return hs.box(hs.types.trun,n)}static initSegment(e){hs.types||hs.init();const t=hs.moov(e),i=new Uint8Array(hs.FTYP.byteLength+t.byteLength);return i.set(hs.FTYP),i.set(t,hs.FTYP.byteLength),i}}hs.types=void 0,hs.HDLR_TYPES=void 0,hs.STTS=void 0,hs.STSC=void 0,hs.STCO=void 0,hs.STSZ=void 0,hs.VMHD=void 0,hs.SMHD=void 0,hs.STSD=void 0,hs.FTYP=void 0,hs.DINF=void 0;function us(e,t,i=1,r=!1){const s=e*t*i;return r?Math.round(s):s}function fs(e,t=!1){return us(e,1e3,1/9e4,t)}let ps,ms=null,gs=null;class ys{constructor(e,t,i,r=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,null===ms){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ms=e?parseInt(e[1]):0}if(null===gs){const e=navigator.userAgent.match(/Safari\/(\d+)/i);gs=e?parseInt(e[1]):0}}destroy(){}resetTimeStamp(e){le.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){le.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){le.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1}getVideoStartPts(e){let t=!1;const i=e.reduce(((e,i)=>{const r=i.pts-e;return r<-4294967296?(t=!0,vs(e,i.pts)):r>0?e:i.pts}),e[0].pts);return t&&le.debug("PTS rollover detected"),i}remux(e,t,i,r,s,n,a,o){let l,d,c,h,u,f,p=s,m=s;const g=e.pid>-1,y=t.pid>-1,v=t.samples.length,_=e.samples.length>0,E=a&&v>0||v>1;if((!g||_)&&(!y||E)||this.ISGenerated||a){this.ISGenerated||(c=this.generateIS(e,t,s,n));const i=this.isVideoContiguous;let r,a=-1;if(E&&(a=function(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!i&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,a>0){le.warn(`[mp4-remuxer]: Dropped ${a} out of ${v} video samples due to a missing keyframe`);const e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(a),t.dropped+=a,m+=(t.samples[0].pts-e)/t.inputTimeScale,r=m}else-1===a&&(le.warn(`[mp4-remuxer]: No keyframe found out of ${v} video samples`),f=!1);if(this.ISGenerated){if(_&&E){const i=this.getVideoStartPts(t.samples),r=(vs(e.samples[0].pts,i)-i)/t.inputTimeScale;p+=Math.max(0,r),m+=Math.max(0,-r)}if(_){if(e.samplerate||(le.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),c=this.generateIS(e,t,s,n)),d=this.remuxAudio(e,p,this.isAudioContiguous,n,y||E||o===Kt?m:void 0),E){const r=d?d.endPTS-d.startPTS:0;t.inputTimeScale||(le.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),c=this.generateIS(e,t,s,n)),l=this.remuxVideo(t,m,i,r)}}else E&&(l=this.remuxVideo(t,m,i,0));l&&(l.firstKeyFrame=a,l.independent=-1!==a,l.firstKeyFramePTS=r)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(u=_s(i,s,this._initPTS,this._initDTS)),r.samples.length&&(h=Es(r,s,this._initPTS))),{audio:d,video:l,initSegment:c,independent:f,text:h,id3:u}}generateIS(e,t,i,r){const s=e.samples,n=t.samples,a=this.typeSupported,o={},l=this._initPTS;let d,c,h,u=!l||r,f="audio/mp4";if(u&&(d=c=1/0),e.config&&s.length){if(e.timescale=e.samplerate,"mp3"===e.segmentCodec)a.mpeg?(f="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");o.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&a.mpeg?new Uint8Array(0):hs.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(h=e.inputTimeScale,l&&h===l.timescale?u=!1:d=c=s[0].pts-Math.round(h*i))}if(t.sps&&t.pps&&n.length&&(t.timescale=t.inputTimeScale,o.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:hs.initSegment([t]),metadata:{width:t.width,height:t.height}},u))if(h=t.inputTimeScale,l&&h===l.timescale)u=!1;else{const e=this.getVideoStartPts(n),t=Math.round(h*i);c=Math.min(c,vs(n[0].dts,e)-t),d=Math.min(d,e-t)}if(Object.keys(o).length)return this.ISGenerated=!0,u?(this._initPTS={baseTime:d,timescale:h},this._initDTS={baseTime:c,timescale:h}):d=h=void 0,{tracks:o,initPTS:d,timescale:h}}remuxVideo(e,t,i,r){const s=e.inputTimeScale,n=e.samples,a=[],o=n.length,l=this._initPTS;let d,c,h=this.nextAvcDts,u=8,f=this.videoSampleDuration,p=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,g=!1;if(!i||null===h){h=t*s-(n[0].pts-vs(n[0].dts,n[0].pts))}const y=l.baseTime*s/l.timescale;for(let C=0;C<o;C++){const e=n[C];e.pts=vs(e.pts-y,h),e.dts=vs(e.dts-y,h),e.dts<n[C>0?C-1:C].dts&&(g=!0)}g&&n.sort((function(e,t){const i=e.dts-t.dts,r=e.pts-t.pts;return i||r})),d=n[0].dts,c=n[n.length-1].dts;const v=c-d,_=v?Math.round(v/(o-1)):f||e.inputTimeScale/30;if(i){const e=d-h,t=e>_,i=e<-1;if((t||i)&&(t?le.warn(`AVC: ${fs(e,!0)} ms (${e}dts) hole between fragments detected, filling it`):le.warn(`AVC: ${fs(-e,!0)} ms (${e}dts) overlapping between fragments detected`),!i||h>=n[0].pts)){d=h;const t=n[0].pts-e;n[0].dts=d,n[0].pts=t,le.log(`Video: First PTS/DTS adjusted: ${fs(t,!0)}/${fs(d,!0)}, delta: ${fs(e,!0)} ms`)}}d=Math.max(0,d);let E=0,b=0;for(let C=0;C<o;C++){const e=n[C],t=e.units,i=t.length;let r=0;for(let s=0;s<i;s++)r+=t[s].data.length;b+=r,E+=i,e.length=r,e.dts=Math.max(e.dts,d),p=Math.min(e.pts,p),m=Math.max(e.pts,m)}c=n[o-1].dts;const S=b+4*E+8;let T;try{T=new Uint8Array(S)}catch(x){return void this.observer.emit(te.ERROR,te.ERROR,{type:ie.MUX_ERROR,details:re.REMUX_ALLOC_ERROR,fatal:!1,error:x,bytes:S,reason:`fail allocating video mdat ${S}`})}const A=new DataView(T.buffer);A.setUint32(0,S),T.set(hs.types.mdat,4);let w=!1,L=Number.POSITIVE_INFINITY,I=Number.POSITIVE_INFINITY,R=Number.NEGATIVE_INFINITY,D=Number.NEGATIVE_INFINITY;for(let C=0;C<o;C++){const e=n[C],t=e.units;let i,l=0;for(let r=0,s=t.length;r<s;r++){const e=t[r],i=e.data,s=e.data.byteLength;A.setUint32(u,s),u+=4,T.set(i,u),u+=s,l+=4+s}if(C<o-1)f=n[C+1].dts-e.dts,i=n[C+1].pts-e.pts;else{const t=this.config,a=C>0?e.dts-n[C-1].dts:_;if(i=C>0?e.pts-n[C-1].pts:_,t.stretchShortVideoTrack&&null!==this.nextAudioPts){const i=Math.floor(t.maxBufferHole*s),n=(r?p+r*s:this.nextAudioPts)-e.pts;n>i?(f=n-a,f<0?f=a:w=!0,le.log(`[mp4-remuxer]: It is approximately ${n/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=a}else f=a}const d=Math.round(e.pts-e.dts);L=Math.min(L,f),R=Math.max(R,f),I=Math.min(I,i),D=Math.max(D,i),a.push(new bs(e.key,f,l,d))}if(a.length)if(ms){if(ms<70){const e=a[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(gs&&D-I<R-L&&_/R<.025&&0===a[0].cts){le.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=d;for(let t=0,i=a.length;t<i;t++){const r=e+a[t].duration,s=e+a[t].cts;if(t<i-1){const e=r+a[t+1].cts;a[t].duration=e-s}else a[t].duration=t?a[t-1].duration:_;a[t].cts=0,e=r}}f=w||!f?_:f,this.nextAvcDts=h=c+f,this.videoSampleDuration=f,this.isVideoContiguous=!0;const k={data1:hs.moof(e.sequenceNumber++,d,J({},e,{samples:a})),data2:T,startPTS:p/s,endPTS:(m+f)/s,startDTS:d/s,endDTS:h/s,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,k}remuxAudio(e,t,i,r,s){const n=e.inputTimeScale,a=n/(e.samplerate?e.samplerate:n),o="aac"===e.segmentCodec?1024:1152,l=o*a,d=this._initPTS,c="mp3"===e.segmentCodec&&this.typeSupported.mpeg,h=[],u=void 0!==s;let f=e.samples,p=c?0:8,m=this.nextAudioPts||-1;const g=t*n,y=d.baseTime*n/d.timescale;if(this.isAudioContiguous=i=i||f.length&&m>0&&(r&&Math.abs(g-m)<9e3||Math.abs(vs(f[0].pts-y,g)-m)<20*l),f.forEach((function(e){e.pts=vs(e.pts-y,g)})),!i||m<0){if(f=f.filter((e=>e.pts>=0)),!f.length)return;m=0===s?0:r&&!u?Math.max(0,g):f[0].pts}if("aac"===e.segmentCodec){const t=this.config.maxAudioFramesDrift;for(let i=0,r=m;i<f.length;i++){const s=f[i],a=s.pts,o=a-r,d=Math.abs(1e3*o/n);if(o<=-t*l&&u)0===i&&(le.warn(`Audio frame @ ${(a/n).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*o/n)} ms.`),this.nextAudioPts=m=r=a);else if(o>=t*l&&d<1e4&&u){let t=Math.round(o/l);r=a-t*l,r<0&&(t--,r+=l),0===i&&(this.nextAudioPts=m=r),le.warn(`[mp4-remuxer]: Injecting ${t} audio frame @ ${(r/n).toFixed(3)}s due to ${Math.round(1e3*o/n)} ms gap.`);for(let n=0;n<t;n++){const t=Math.max(r,0);let n=ds.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);n||(le.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),n=s.unit.subarray()),f.splice(i,0,{unit:n,pts:t}),r+=l,i++}}s.pts=r,r+=l}}let v,_=null,E=null,b=0,S=f.length;for(;S--;)b+=f[S].unit.byteLength;for(let k=0,x=f.length;k<x;k++){const t=f[k],r=t.unit;let s=t.pts;if(null!==E){h[k-1].duration=Math.round((s-E)/a)}else{if(i&&"aac"===e.segmentCodec&&(s=m),_=s,!(b>0))return;b+=p;try{v=new Uint8Array(b)}catch(D){return void this.observer.emit(te.ERROR,te.ERROR,{type:ie.MUX_ERROR,details:re.REMUX_ALLOC_ERROR,fatal:!1,error:D,bytes:b,reason:`fail allocating audio mdat ${b}`})}if(!c){new DataView(v.buffer).setUint32(0,b),v.set(hs.types.mdat,4)}}v.set(r,p);const n=r.byteLength;p+=n,h.push(new bs(!0,o,n,0)),E=s}const T=h.length;if(!T)return;const A=h[h.length-1];this.nextAudioPts=m=E+a*A.duration;const w=c?new Uint8Array(0):hs.moof(e.sequenceNumber++,_/a,J({},e,{samples:h}));e.samples=[];const L=_/n,I=m/n,R={data1:w,data2:v,startPTS:L,endPTS:I,startDTS:L,endDTS:I,type:"audio",hasAudio:!0,hasVideo:!1,nb:T};return this.isAudioContiguous=!0,R}remuxEmptyAudio(e,t,i,r){const s=e.inputTimeScale,n=s/(e.samplerate?e.samplerate:s),a=this.nextAudioPts,o=this._initDTS,l=9e4*o.baseTime/o.timescale,d=(null!==a?a:r.startDTS*s)+l,c=r.endDTS*s+l,h=1024*n,u=Math.ceil((c-d)/h),f=ds.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(le.warn("[mp4-remuxer]: remux empty Audio"),!f)return void le.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");const p=[];for(let m=0;m<u;m++){const e=d+m*h;p.push({unit:f,pts:e,dts:e})}return e.samples=p,this.remuxAudio(e,t,i,!1)}}function vs(e,t){let i;if(null===t)return e;for(i=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=i;return e}function _s(e,t,i,r){const s=e.samples.length;if(!s)return;const n=e.inputTimeScale;for(let o=0;o<s;o++){const s=e.samples[o];s.pts=vs(s.pts-i.baseTime*n/i.timescale,t*n)/n,s.dts=vs(s.dts-r.baseTime*n/r.timescale,t*n)/n}const a=e.samples;return e.samples=[],{samples:a}}function Es(e,t,i){const r=e.samples.length;if(!r)return;const s=e.inputTimeScale;for(let a=0;a<r;a++){const r=e.samples[a];r.pts=vs(r.pts-9e4*i.baseTime/i.timescale,t*s)/s}e.samples.sort(((e,t)=>e.pts-t.pts));const n=e.samples;return e.samples=[],{samples:n}}class bs{constructor(e,t,i,r){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=i,this.cts=r,this.flags=new Ss(e)}}class Ss{constructor(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1}}function Ts(e,t){const i=null==e?void 0:e.codec;return i&&i.length>4?i:"hvc1"===i||"hev1"===i?"hvc1.1.6.L120.90":"av01"===i?"av01.0.04M.08":"avc1"===i||t===ge?"avc1.42e01e":"mp4a.40.5"}try{ps=self.performance.now.bind(self.performance)}catch(Aa){le.debug("Unable to use Performance API on this environment"),ps="undefined"!=typeof self&&self.Date.now}const As=[{demux:class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,r){const s=this.videoTrack=xr("video",1),n=this.audioTrack=xr("audio",1),a=this.txtTrack=xr("text",1);if(this.id3Track=xr("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const o=lt(e);if(o.video){const{id:e,timescale:t,codec:i}=o.video;s.id=e,s.timescale=a.timescale=t,s.codec=i}if(o.audio){const{id:e,timescale:t,codec:i}=o.audio;n.id=e,n.timescale=t,n.codec=i}a.id=et.text,s.sampleDuration=0,s.duration=n.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return at(e=e.length>16384?e.subarray(0,16384):e,["moof"]).length>0}demux(e,t){this.timeOffset=t;let i=e;const r=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=ht(this.remainderData,e));const t=function(e){const t={valid:null,remainder:null},i=at(e,["moof"]);if(!i)return t;if(i.length<2)return t.remainder=e,t;const r=i[i.length-1];return t.valid=Oe(e,0,r.byteOffset-8),t.remainder=Oe(e,r.byteOffset-8),t}(i);this.remainderData=t.remainder,r.samples=t.valid||new Uint8Array}else r.samples=i;const n=this.extractID3Track(r,t);return s.samples=ut(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:n,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return i.samples=ut(e,t),{videoTrack:t,audioTrack:xr(),id3Track:r,textTrack:xr()}}extractID3Track(e,t){const i=this.id3Track;if(e.samples.length){const r=at(e.samples,["emsg"]);r&&r.forEach((e=>{const r=function(e){const t=e[0];let i="",r="",s=0,n=0,a=0,o=0,l=0,d=0;if(0===t){for(;"\0"!==tt(e.subarray(d,d+1));)i+=tt(e.subarray(d,d+1)),d+=1;for(i+=tt(e.subarray(d,d+1)),d+=1;"\0"!==tt(e.subarray(d,d+1));)r+=tt(e.subarray(d,d+1)),d+=1;r+=tt(e.subarray(d,d+1)),d+=1,s=rt(e,12),n=rt(e,16),o=rt(e,20),l=rt(e,24),d=28}else if(1===t){d+=4,s=rt(e,d),d+=4;const t=rt(e,d);d+=4;const n=rt(e,d);for(d+=4,a=2**32*t+n,Number.isSafeInteger(a)||(a=Number.MAX_SAFE_INTEGER,le.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=rt(e,d),d+=4,l=rt(e,d),d+=4;"\0"!==tt(e.subarray(d,d+1));)i+=tt(e.subarray(d,d+1)),d+=1;for(i+=tt(e.subarray(d,d+1)),d+=1;"\0"!==tt(e.subarray(d,d+1));)r+=tt(e.subarray(d,d+1)),d+=1;r+=tt(e.subarray(d,d+1)),d+=1}return{schemeIdUri:i,value:r,timeScale:s,presentationTime:a,presentationTimeDelta:n,eventDuration:o,id:l,payload:e.subarray(d,e.byteLength)}}(e);if(zr.test(r.schemeIdUri)){const e=ee(r.presentationTime)?r.presentationTime/r.timeScale:t+r.presentationTimeDelta/r.timeScale;let s=4294967295===r.eventDuration?Number.POSITIVE_INFINITY:r.eventDuration/r.timeScale;s<=.001&&(s=Number.POSITIVE_INFINITY);const n=r.payload;i.samples.push({data:n,len:n.byteLength,dts:e,pts:e,type:si,duration:s})}}))}return i}demuxSampleAes(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}},remux:class{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,i,r){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(function(e,t){if(!e||!t)return e;const i=t.keyId;i&&t.isCommonEncryption&&at(e,["moov","trak"]).forEach((e=>{const t=at(e,["mdia","minf","stbl","stsd"])[0].subarray(8);let r=at(t,["enca"]);const s=r.length>0;s||(r=at(t,["encv"])),r.forEach((e=>{at(s?e.subarray(28):e.subarray(78),["sinf"]).forEach((e=>{const t=dt(e);if(t){const e=t.subarray(8,24);e.some((e=>0!==e))||(le.log(`[eme] Patching keyId in 'enc${s?"a":"v"}>sinf>>tenc' box: ${Ze(e)} -> ${Ze(i)}`),t.set(i,8))}}))}))}));return e}(e,r)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:i}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const r=this.initData=lt(e);t||(t=Ts(r.audio,me)),i||(i=Ts(r.video,ge));const s={};r.audio&&r.video?s.audiovideo={container:"video/mp4",codec:t+","+i,initSegment:e,id:"main"}:r.audio?s.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:r.video?s.video={container:"video/mp4",codec:i,initSegment:e,id:"main"}:le.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s}remux(e,t,i,r,s,n){var a,o;let{initPTS:l,lastEndTime:d}=this;const c={audio:void 0,video:void 0,text:r,id3:i,initSegment:void 0};ee(d)||(d=this.lastEndTime=s||0);const h=t.samples;if(null==h||!h.length)return c;const u={initPTS:void 0,timescale:1};let f=this.initData;if(null!=(a=f)&&a.length||(this.generateInitSegment(h),f=this.initData),null==(o=f)||!o.length)return le.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),c;this.emitInitSegment&&(u.tracks=this.initTracks,this.emitInitSegment=!1);const p=function(e,t){let i=0,r=0,s=0;const n=at(e,["moof","traf"]);for(let a=0;a<n.length;a++){const e=n[a],o=at(e,["tfhd"])[0],l=t[rt(o,4)];if(!l)continue;const d=l.default,c=rt(o,0)|(null==d?void 0:d.flags);let h=null==d?void 0:d.duration;8&c&&(h=rt(o,2&c?12:8));const u=l.timescale||9e4,f=at(e,["trun"]);for(let t=0;t<f.length;t++)i=ct(f[t]),!i&&h&&(i=h*rt(f[t],4)),l.type===ge?r+=i/u:l.type===me&&(s+=i/u)}if(0===r&&0===s){let t=0;const i=at(e,["sidx"]);for(let e=0;e<i.length;e++){const r=ot(i[e]);null!=r&&r.references&&(t+=r.references.reduce(((e,t)=>e+t.info.duration||0),0))}return t}return r||s}(h,f),m=function(e,t){return at(t,["moof","traf"]).reduce(((t,i)=>{const r=at(i,["tfdt"])[0],s=r[0],n=at(i,["tfhd"]).reduce(((t,i)=>{const n=rt(i,4),a=e[n];if(a){let e=rt(r,4);if(1===s){if(e===Xe)return le.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),t;e*=Xe+1,e+=rt(r,8)}const i=e/(a.timescale||9e4);if(isFinite(i)&&(null===t||i<t))return i}return t}),null);return null!==n&&isFinite(n)&&(null===t||n<t)?n:t}),null)}(f,h),g=null===m?s:m;(function(e,t,i,r){if(null===e)return!0;const s=Math.max(r,1),n=t-e.baseTime/e.timescale;return Math.abs(n-i)>s}(l,g,s,p)||u.timescale!==l.timescale&&n)&&(u.initPTS=g-s,l&&1===l.timescale&&le.warn("Adjusting initPTS by "+(u.initPTS-l.baseTime)),this.initPTS=l={baseTime:u.initPTS,timescale:1});const y=e?g-l.baseTime/l.timescale:d,v=y+p;!function(e,t,i){at(t,["moof","traf"]).forEach((t=>{at(t,["tfhd"]).forEach((r=>{const s=rt(r,4),n=e[s];if(!n)return;const a=n.timescale||9e4;at(t,["tfdt"]).forEach((e=>{const t=e[0];let r=rt(e,4);if(0===t)r-=i*a,r=Math.max(r,0),nt(e,4,r);else{r*=Math.pow(2,32),r+=rt(e,8),r-=i*a,r=Math.max(r,0);const t=Math.floor(r/(Xe+1)),s=Math.floor(r%(Xe+1));nt(e,4,t),nt(e,8,s)}}))}))}))}(f,h,l.baseTime/l.timescale),p>0?this.lastEndTime=v:(le.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const _=!!f.audio,E=!!f.video;let b="";_&&(b+="audio"),E&&(b+="video");const S={data1:h,startPTS:y,startDTS:y,endPTS:v,endDTS:v,type:b,hasAudio:_,hasVideo:E,nb:1,dropped:0};return c.audio="audio"===S.type?S:void 0,c.video="audio"!==S.type?S:void 0,c.initSegment=u,c.id3=_s(i,s,l,l),r.samples.length&&(c.text=Es(r,s,l)),c}}},{demux:is,remux:ys},{demux:class extends Cr{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let t=(Be(e,0)||[]).length;for(let i=e.length;t<i;t++)if(Br(e,t))return le.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return function(e,t){return t+5<e.length}(e,t)&&Pr(e,t)&&Nr(e,t)<=e.length-t}(e,t)}appendFrame(e,t,i){Ur(e,this.observer,t,i,e.manifestCodec);const r=Gr(e,t,i,this.basePTS,this.frameIndex);if(r&&0===r.missing)return r}},remux:ys},{demux:class extends Cr{resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let t=(Be(e,0)||[]).length;for(let i=e.length;t<i;t++)if(Xr(e,t))return le.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return Qr(e,t)&&4<=e.length-t}(e,t)}appendFrame(e,t,i){if(null!==this.basePTS)return Wr(e,t,i,this.basePTS,this.frameIndex)}},remux:ys}];class ws{constructor(e,t,i,r,s){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.vendor=r,this.id=s}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,r){const s=i.transmuxing;s.executeStart=ps();let n=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:o}=this;r&&(this.currentTransmuxState=r);const{contiguous:l,discontinuity:d,trackSwitch:c,accurateTimeOffset:h,timeOffset:u,initSegmentChange:f}=r||a,{audioCodec:p,videoCodec:m,defaultInitPts:g,duration:y,initSegmentData:v}=o,_=function(e,t){let i=null;e.byteLength>0&&null!=t&&null!=t.key&&null!==t.iv&&null!=t.method&&(i=t);return i}(n,t);if(_&&"AES-128"===_.method){const e=this.getDecrypter();if(!e.isSync())return this.decryptionPromise=e.webCryptoDecrypt(n,_.key.buffer,_.iv.buffer).then((e=>{const t=this.push(e,null,i);return this.decryptionPromise=null,t})),this.decryptionPromise;{let t=e.softwareDecrypt(n,_.key.buffer,_.iv.buffer);if(i.part>-1&&(t=e.flush()),!t)return s.executeEnd=ps(),Ls(i);n=new Uint8Array(t)}}const E=this.needsProbing(d,c);if(E){const e=this.configureTransmuxer(n);if(e)return le.warn(`[transmuxer] ${e.message}`),this.observer.emit(te.ERROR,te.ERROR,{type:ie.MEDIA_ERROR,details:re.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),s.executeEnd=ps(),Ls(i)}(d||c||f||E)&&this.resetInitSegment(v,p,m,y,t),(d||f||E)&&this.resetInitialTimestamp(g),l||this.resetContiguity();const b=this.transmux(n,_,u,h,i),S=this.currentTransmuxState;return S.contiguous=!0,S.discontinuity=!1,S.trackSwitch=!1,s.executeEnd=ps(),b}flush(e){const t=e.transmuxing;t.executeStart=ps();const{decrypter:i,currentTransmuxState:r,decryptionPromise:s}=this;if(s)return s.then((()=>this.flush(e)));const n=[],{timeOffset:a}=r;if(i){const t=i.flush();t&&n.push(this.push(t,null,e))}const{demuxer:o,remuxer:l}=this;if(!o||!l)return t.executeEnd=ps(),[Ls(e)];const d=o.flush(a);return Is(d)?d.then((t=>(this.flushRemux(n,t,e),n))):(this.flushRemux(n,d,e),n)}flushRemux(e,t,i){const{audioTrack:r,videoTrack:s,id3Track:n,textTrack:a}=t,{accurateTimeOffset:o,timeOffset:l}=this.currentTransmuxState;le.log(`[transmuxer.ts]: Flushed fragment ${i.sn}${i.part>-1?" p: "+i.part:""} of level ${i.level}`);const d=this.remuxer.remux(r,s,n,a,l,o,!0,this.id);e.push({remuxResult:d,chunkMeta:i}),i.transmuxing.executeEnd=ps()}resetInitialTimestamp(e){const{demuxer:t,remuxer:i}=this;t&&i&&(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,r,s){const{demuxer:n,remuxer:a}=this;n&&a&&(n.resetInitSegment(e,t,i,r),a.resetInitSegment(e,t,i,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,r,s){let n;return n=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,i,r,s):this.transmuxUnencrypted(e,i,r,s),n}transmuxUnencrypted(e,t,i,r){const{audioTrack:s,videoTrack:n,id3Track:a,textTrack:o}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,n,a,o,t,i,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,i,r,s){return this.demuxer.demuxSampleAes(e,t,i).then((e=>({remuxResult:this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,i,r,!1,this.id),chunkMeta:s})))}configureTransmuxer(e){const{config:t,observer:i,typeSupported:r,vendor:s}=this;let n;for(let c=0,h=As.length;c<h;c++)if(As[c].demux.probe(e)){n=As[c];break}if(!n)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,o=this.remuxer,l=n.remux,d=n.demux;o&&o instanceof l||(this.remuxer=new l(i,t,r,s)),a&&a instanceof d||(this.demuxer=new d(i,t,r),this.probe=d.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new mr(this.config)),e}}const Ls=e=>({remuxResult:{},chunkMeta:e});function Is(e){return"then"in e&&e.then instanceof Function}class Rs{constructor(e,t,i,r,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=r,this.defaultInitPts=s||null}}class Ds{constructor(e,t,i,r,s,n){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=r,this.timeOffset=s,this.initSegmentChange=n}}var ks={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,i="~";function r(){}function s(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function n(e,t,r,n,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var o=new s(r,n||e,a),l=i?i+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(i=!1)),o.prototype.eventNames=function(){var e,r,s=[];if(0===this._eventsCount)return s;for(r in e=this._events)t.call(e,r)&&s.push(i?r.slice(1):r);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(e)):s},o.prototype.listeners=function(e){var t=i?i+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,n=r.length,a=new Array(n);s<n;s++)a[s]=r[s].fn;return a},o.prototype.listenerCount=function(e){var t=i?i+e:e,r=this._events[t];return r?r.fn?1:r.length:0},o.prototype.emit=function(e,t,r,s,n,a){var o=i?i+e:e;if(!this._events[o])return!1;var l,d,c=this._events[o],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,s),!0;case 5:return c.fn.call(c.context,t,r,s,n),!0;case 6:return c.fn.call(c.context,t,r,s,n,a),!0}for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];c.fn.apply(c.context,l)}else{var u,f=c.length;for(d=0;d<f;d++)switch(c[d].once&&this.removeListener(e,c[d].fn,void 0,!0),h){case 1:c[d].fn.call(c[d].context);break;case 2:c[d].fn.call(c[d].context,t);break;case 3:c[d].fn.call(c[d].context,t,r);break;case 4:c[d].fn.call(c[d].context,t,r,s);break;default:if(!l)for(u=1,l=new Array(h-1);u<h;u++)l[u-1]=arguments[u];c[d].fn.apply(c[d].context,l)}}return!0},o.prototype.on=function(e,t,i){return n(this,e,t,i,!1)},o.prototype.once=function(e,t,i){return n(this,e,t,i,!0)},o.prototype.removeListener=function(e,t,r,s){var n=i?i+e:e;if(!this._events[n])return this;if(!t)return a(this,n),this;var o=this._events[n];if(o.fn)o.fn!==t||s&&!o.once||r&&o.context!==r||a(this,n);else{for(var l=0,d=[],c=o.length;l<c;l++)(o[l].fn!==t||s&&!o[l].once||r&&o[l].context!==r)&&d.push(o[l]);d.length?this._events[n]=1===d.length?d[0]:d:a(this,n)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,e.exports=o}(ks);var xs=z(ks.exports);const Cs=wt()||{isTypeSupported:()=>!1};class Ms{constructor(e,t,i,r){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=i,this.onFlush=r;const n=(e,t)=>{(t=t||{}).frag=this.frag,t.id=this.id,e===te.ERROR&&(this.error=t.error),this.hls.trigger(e,t)};this.observer=new xs,this.observer.on(te.FRAG_DECRYPTED,n),this.observer.on(te.ERROR,n);const a={mp4:Cs.isTypeSupported("video/mp4"),mpeg:Cs.isTypeSupported("audio/mpeg"),mp3:Cs.isTypeSupported('audio/mp4; codecs="mp3"')},o=navigator.vendor;if(this.useWorker&&"undefined"!=typeof Worker){if(s.workerPath||"function"==typeof __HLS_WORKER_BUNDLE__){try{s.workerPath?(le.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=function(e){const t=new self.URL(e,self.location.href).href;return{worker:new self.Worker(t),scriptURL:t}}(s.workerPath)):(le.log(`injecting Web Worker for "${t}"`),this.workerContext=function(){const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e);return{worker:new self.Worker(t),objectURL:t}}()),this.onwmsg=e=>this.onWorkerMessage(e);const{worker:e}=this.workerContext;e.addEventListener("message",this.onwmsg),e.onerror=e=>{const i=new Error(`${e.message}  (${e.filename}:${e.lineno})`);s.enableWorker=!1,le.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(te.ERROR,{type:ie.OTHER_ERROR,details:re.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:i})},e.postMessage({cmd:"init",typeSupported:a,vendor:o,id:t,config:JSON.stringify(s)})}catch(Aa){le.warn(`Error setting up "${t}" Web Worker, fallback to inline`,Aa),this.resetWorker(),this.error=null,this.transmuxer=new ws(this.observer,a,s,o,t)}return}}this.transmuxer=new ws(this.observer,a,s,o,t)}resetWorker(){if(this.workerContext){const{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,i,r,s,n,a,o,l,d){var c,h;l.transmuxing.start=self.performance.now();const{transmuxer:u}=this,f=n?n.start:s.start,p=s.decryptdata,m=this.frag,g=!(m&&s.cc===m.cc),y=!(m&&l.level===m.level),v=m?l.sn-m.sn:-1,_=this.part?l.part-this.part.index:-1,E=0===v&&l.id>1&&l.id===(null==m?void 0:m.stats.chunkCount),b=!y&&(1===v||0===v&&(1===_||E&&_<=0)),S=self.performance.now();(y||v||0===s.stats.parsing.start)&&(s.stats.parsing.start=S),!n||!_&&b||(n.stats.parsing.start=S);const T=!(m&&(null==(c=s.initSegment)?void 0:c.url)===(null==(h=m.initSegment)?void 0:h.url)),A=new Ds(g,b,o,y,f,T);if(!b||g||T){le.log(`[transmuxer-interface, ${s.type}]: Starting new transmux session for sn: ${l.sn} p: ${l.part} level: ${l.level} id: ${l.id}\n        discontinuity: ${g}\n        trackSwitch: ${y}\n        contiguous: ${b}\n        accurateTimeOffset: ${o}\n        timeOffset: ${f}\n        initSegmentChange: ${T}`);const e=new Rs(i,r,t,a,d);this.configureTransmuxer(e)}if(this.frag=s,this.part=n,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:p,chunkMeta:l,state:A},e instanceof ArrayBuffer?[e]:[]);else if(u){const t=u.push(e,p,l,A);Is(t)?(u.async=!0,t.then((e=>{this.handleTransmuxComplete(e)})).catch((e=>{this.transmuxerError(e,l,"transmuxer-interface push error")}))):(u.async=!1,this.handleTransmuxComplete(t))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let i=t.flush(e);Is(i)||t.async?(Is(i)||(i=Promise.resolve(i)),i.then((t=>{this.handleFlushResult(t,e)})).catch((t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")}))):this.handleFlushResult(i,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(te.ERROR,{type:ie.MEDIA_ERROR,details:re.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach((e=>{this.handleTransmuxComplete(e)})),this.onFlush(t)}onWorkerMessage(e){const t=e.data,i=this.hls;switch(t.event){case"init":{var r;const e=null==(r=this.workerContext)?void 0:r.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":le[t.data.logType]&&le[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,i.trigger(t.event,t.data)}}configureTransmuxer(e){const{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}class Ps{constructor(e,t,i,r){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=i,this.hls=r}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){const{config:i,media:r,stalled:s}=this;if(null===r)return;const{currentTime:n,seeking:a}=r,o=this.seeking&&!a,l=!this.seeking&&a;if(this.seeking=a,n!==e){if(this.moved=!0,null!==s){if(this.stallReported){const e=self.performance.now()-s;le.warn(`playback not stuck anymore @${n}, after ${Math.round(e)}ms`),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if(l||o)return void(this.stalled=null);if(r.paused&&!a||r.ended||0===r.playbackRate||!nr.getBuffered(r).length)return;const d=nr.bufferInfo(r,n,0),c=d.len>0,h=d.nextStart||0;if(!c&&!h)return;if(a){const e=d.len>2,i=!h||t&&t.start<=n||h-n>2&&!this.fragmentTracker.getPartialFragment(n);if(e||i)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var u;const e=Math.max(h,d.start||0)-n,t=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,i=(null==t||null==(u=t.details)?void 0:u.live)?2*t.details.targetduration:2,r=this.fragmentTracker.getPartialFragment(n);if(e>0&&(e<=i||r))return void this._trySkipBufferHole(r)}const f=self.performance.now();if(null===s)return void(this.stalled=f);const p=f-s;if(!a&&p>=250&&(this._reportStall(d),!this.media))return;const m=nr.bufferInfo(r,n,i.maxBufferHole);this._tryFixBufferStall(m,p)}_tryFixBufferStall(e,t){const{config:i,fragmentTracker:r,media:s}=this;if(null===s)return;const n=s.currentTime,a=r.getPartialFragment(n);if(a){if(this._trySkipBufferHole(a)||!this.media)return}(e.len>i.maxBufferHole||e.nextStart&&e.nextStart-n<i.maxBufferHole)&&t>1e3*i.highBufferWatchdogPeriod&&(le.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:t,media:i,stallReported:r}=this;if(!r&&i){this.stallReported=!0;const r=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${JSON.stringify(e)})`);le.warn(r.message),t.trigger(te.ERROR,{type:ie.MEDIA_ERROR,details:re.BUFFER_STALLED_ERROR,fatal:!1,error:r,buffer:e.len})}}_trySkipBufferHole(e){const{config:t,hls:i,media:r}=this;if(null===r)return 0;const s=r.currentTime,n=nr.bufferInfo(r,s,0),a=s<n.start?n.start:n.nextStart;if(a){const o=n.len<=t.maxBufferHole,l=n.len>0&&n.len<1&&r.readyState<3,d=a-s;if(d>0&&(o||l)){if(d>t.maxBufferHole){const{fragmentTracker:t}=this;let i=!1;if(0===s){const e=t.getAppendedFrag(0,Yt);e&&a<e.end&&(i=!0)}if(!i){const i=e||t.getAppendedFrag(s,Yt);if(i){let e=!1,r=i.end;for(;r<a;){const i=t.getPartialFragment(r);if(!i){e=!0;break}r+=i.duration}if(e)return 0}}}const n=Math.max(a+.05,s+.1);if(le.warn(`skipping hole, adjusting currentTime from ${s} to ${n}`),this.moved=!0,this.stalled=null,r.currentTime=n,e&&!e.gap){const t=new Error(`fragment loaded with buffer holes, seeking from ${s} to ${n}`);i.trigger(te.ERROR,{type:ie.MEDIA_ERROR,details:re.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:t,reason:t.message,frag:e})}return n}}return 0}_tryNudgeBuffer(){const{config:e,hls:t,media:i,nudgeRetry:r}=this;if(null===i)return;const s=i.currentTime;if(this.nudgeRetry++,r<e.nudgeMaxRetry){const n=s+(r+1)*e.nudgeOffset,a=new Error(`Nudging 'currentTime' from ${s} to ${n}`);le.warn(a.message),i.currentTime=n,t.trigger(te.ERROR,{type:ie.MEDIA_ERROR,details:re.BUFFER_NUDGE_ON_STALL,error:a,fatal:!1})}else{const i=new Error(`Playhead still not moving while enough data buffered @${s} after ${e.nudgeMaxRetry} nudges`);le.error(i.message),t.trigger(te.ERROR,{type:ie.MEDIA_ERROR,details:re.BUFFER_STALLED_ERROR,error:i,fatal:!0})}}}class Os extends Dr{constructor(e,t,i){super(e,t,i,"[stream-controller]",Yt),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(te.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(te.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(te.MANIFEST_LOADING,this.onManifestLoading,this),e.on(te.MANIFEST_PARSED,this.onManifestParsed,this),e.on(te.LEVEL_LOADING,this.onLevelLoading,this),e.on(te.LEVEL_LOADED,this.onLevelLoaded,this),e.on(te.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(te.ERROR,this.onError,this),e.on(te.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(te.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(te.BUFFER_CREATED,this.onBufferCreated,this),e.on(te.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(te.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(te.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(te.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(te.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(te.MANIFEST_LOADING,this.onManifestLoading,this),e.off(te.MANIFEST_PARSED,this.onManifestParsed,this),e.off(te.LEVEL_LOADED,this.onLevelLoaded,this),e.off(te.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(te.ERROR,this.onError,this),e.off(te.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(te.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(te.BUFFER_CREATED,this.onBufferCreated,this),e.off(te.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(te.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(te.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),this.onMediaDetaching()}startLoad(e){if(this.levels){const{lastCurrentTime:t,hls:i}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=i.startLevel;-1===e&&(i.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=i.nextAutoLevel),this.level=i.nextLoadLevel=e,this.loadedmetadata=!1}t>0&&-1===e&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=vr,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=yr}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case Rr:{var e;const{levels:t,level:i}=this,r=null==t||null==(e=t[i])?void 0:e.details;if(r&&(!r.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(r))break;this.state=vr;break}break}case br:{var t;const e=self.performance.now(),i=this.retryDate;(!i||e>=i||null!=(t=this.media)&&t.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=vr)}}this.state===vr&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:i,media:r}=this,{config:s,nextLoadLevel:n}=e;if(null===t||!r&&(this.startFragRequested||!s.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;if(null==i||!i[n])return;const a=i[n],o=this.getMainFwdBufferInfo();if(null===o)return;const l=this.getLevelDetails();if(l&&this._streamEnded(o,l)){const e={};return this.altAudio&&(e.type="video"),this.hls.trigger(te.BUFFER_EOS,e),void(this.state=wr)}e.loadLevel!==n&&-1===e.manualLevel&&this.log(`Adapting to level ${n} from level ${this.level}`),this.level=e.nextLoadLevel=n;const d=a.details;if(!d||this.state===Rr||d.live&&this.levelLastLoaded!==n)return this.level=n,void(this.state=Rr);const c=o.len,h=this.getMaxBufferLength(a.maxBitrate);if(c>=h)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const u=this.backtrackFragment?this.backtrackFragment.start:o.end;let f=this.getNextFragment(u,d);if(this.couldBacktrack&&!this.fragPrevious&&f&&"initSegment"!==f.sn&&this.fragmentTracker.getState(f)!==Ki){var p;const e=(null!=(p=this.backtrackFragment)?p:f).sn-d.startSN,t=d.fragments[e-1];t&&f.cc===t.cc&&(f=t,this.fragmentTracker.removeFragment(t))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(f&&this.isLoopLoading(f,u)){if(!f.gap){const e=this.audioOnly&&!this.altAudio?me:ge,t=(e===ge?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,Yt)}f=this.getNextFragmentLoopLoading(f,d,o,Yt,h)}f&&(!f.initSegment||f.initSegment.data||this.bitrateTest||(f=f.initSegment),this.loadFragment(f,a,u))}loadFragment(e,t,i){const r=this.fragmentTracker.getState(e);this.fragCurrent=e,r===$i||r===Yi?"initSegment"===e.sn?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,i)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Yt)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let i;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const s=this.getLevelDetails();if(null!=s&&s.live){const e=this.getMainFwdBufferInfo();if(!e||e.len<2*s.targetduration)return}if(!t.paused&&e){const t=e[this.hls.nextLoadLevel],r=this.fragLastKbps;i=r&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*r)+1:0}else i=0;const n=this.getBufferedFrag(t.currentTime+i);if(n){const e=this.followingBufferedFrag(n);if(e){this.abortCurrentFrag();const t=e.maxStartPTS?e.maxStartPTS:e.start,i=e.duration,r=Math.max(n.end,t+Math.min(Math.max(i-this.config.maxFragLookUpTolerance,.5*i),.75*i));this.flushMainBuffer(r,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case _r:case Er:case br:case Tr:case Ar:this.state=vr}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const i=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new Ps(this.config,i,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,t=e?e.currentTime:null;ee(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);const i=this.getMainFwdBufferInfo();null!==i&&0!==i.len?this.tick():this.warn(`Main forward buffer length on "seeked" event ${i?i.len:"empty"})`)}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(te.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1}onManifestParsed(e,t){let i,r=!1,s=!1;t.levels.forEach((e=>{i=e.audioCodec,i&&(-1!==i.indexOf("mp4a.40.2")&&(r=!0),-1!==i.indexOf("mp4a.40.5")&&(s=!0))})),this.audioCodecSwitch=r&&s&&!function(){var e;const t=kr();return"function"==typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:i}=this;if(!i||this.state!==vr)return;const r=i[t.level];(!r.details||r.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(r.details))&&(this.state=Rr)}onLevelLoaded(e,t){var i;const{levels:r}=this,s=t.level,n=t.details,a=n.totalduration;if(!r)return void this.warn(`Levels were reset while loading level ${s}`);this.log(`Level ${s} loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""}, cc [${n.startCC}, ${n.endCC}] duration:${a}`);const o=r[s],l=this.fragCurrent;!l||this.state!==Er&&this.state!==br||l.level===t.level&&l.urlId===o.urlId||!l.loader||this.abortCurrentFrag();let d=0;if(n.live||null!=(i=o.details)&&i.live){if(n.fragments[0]||(n.deltaUpdateFailed=!0),n.deltaUpdateFailed)return;d=this.alignPlaylists(n,o.details)}if(o.details=n,this.levelLastLoaded=s,this.hls.trigger(te.LEVEL_UPDATED,{details:n,level:s}),this.state===Rr){if(this.waitForCdnTuneIn(n))return;this.state=vr}this.startFragRequested?n.live&&this.synchronizeToLiveEdge(n):this.setStartPosition(n,d),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:i,part:r,payload:s}=e,{levels:n}=this;if(!n)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);const a=n[i.level],o=a.details;if(!o)return this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),void this.fragmentTracker.removeFragment(i);const l=a.videoCodec,d=o.PTSKnown||!o.live,c=null==(t=i.initSegment)?void 0:t.data,h=this._getAudioCodec(a),u=this.transmuxer=this.transmuxer||new Ms(this.hls,Yt,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=r?r.index:-1,p=-1!==f,m=new ar(i.level,i.sn,i.stats.chunkCount,s.byteLength,f,p),g=this.initPTS[i.cc];u.push(s,c,h,l,i,r,o.totalduration,d,m,g)}onAudioTrackSwitching(e,t){const i=this.altAudio;if(!!!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const e=this.hls;i&&(e.trigger(te.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),e.trigger(te.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const i=t.id,r=!!this.hls.audioTracks[i].url;if(r){const e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=r,this.tick()}onBufferCreated(e,t){const i=t.tracks;let r,s,n=!1;for(const a in i){const e=i[a];if("main"===e.id){if(s=a,r=e,"video"===a){const e=i[a];e&&(this.videoBuffer=e.buffer)}}else n=!0}n&&r?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:i,part:r}=t;if(i&&i.type!==Yt)return;if(this.fragContextChanged(i))return this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),void(this.state===Ar&&(this.state=vr));const s=r?r.stats:i.stats;this.fragLastKbps=Math.round(8*s.total/(s.buffering.end-s.loading.first)),"initSegment"!==i.sn&&(this.fragPrevious=i),this.fragBufferedComplete(i,r)}onError(e,t){var i;if(t.fatal)this.state=Lr;else switch(t.details){case re.FRAG_GAP:case re.FRAG_PARSING_ERROR:case re.FRAG_DECRYPT_ERROR:case re.FRAG_LOAD_ERROR:case re.FRAG_LOAD_TIMEOUT:case re.KEY_LOAD_ERROR:case re.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Yt,t);break;case re.LEVEL_LOAD_ERROR:case re.LEVEL_LOAD_TIMEOUT:case re.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Rr||(null==(i=t.context)?void 0:i.type)!==Vt||(this.state=vr);break;case re.BUFFER_FULL_ERROR:if(!t.parent||"main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case re.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}checkBuffer(){const{media:e,gapController:t}=this;if(e&&t&&e.readyState){if(this.loadedmetadata||!nr.getBuffered(e).length){const e=this.state!==vr?this.fragCurrent:null;t.poll(this.lastCurrentTime,e)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=vr,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==me||this.audioOnly&&!this.altAudio){const e=(t===ge?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(e,t,Yt)}}onLevelsUpdated(e,t){this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let i=this.startPosition;if(i>=0&&t<i){if(e.seeking)return void this.log(`could not seek to ${i}, already seeking at ${t}`);const r=nr.getBuffered(e),s=(r.length?r.start(0):0)-i;s>0&&(s<this.config.maxBufferHole||s<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${s} to match buffer start`),i+=s,this.startPosition=i),this.log(`seek to target start position ${i} from current time ${t}`),e.currentTime=i}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then((i=>{const{hls:r}=this;if(!i||this.fragContextChanged(e))return;t.fragmentError=0,this.state=vr,this.startFragRequested=!1,this.bitrateTest=!1;const s=e.stats;s.parsing.start=s.parsing.end=s.buffering.start=s.buffering.end=self.performance.now(),r.trigger(te.FRAG_LOADED,i),e.bitrateTest=!1}))}_handleTransmuxComplete(e){var t;const i="main",{hls:r}=this,{remuxResult:s,chunkMeta:n}=e,a=this.getCurrentContext(n);if(!a)return void this.resetWhenMissingContext(n);const{frag:o,part:l,level:d}=a,{video:c,text:h,id3:u,initSegment:f}=s,{details:p}=d,m=this.altAudio?void 0:s.audio;if(this.fragContextChanged(o))this.fragmentTracker.removeFragment(o);else{if(this.state=Tr,f){if(null!=f&&f.tracks){const e=o.initSegment||o;this._bufferInitSegment(d,f.tracks,e,n),r.trigger(te.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:i,tracks:f.tracks})}const e=f.initPTS,t=f.timescale;ee(e)&&(this.initPTS[o.cc]={baseTime:e,timescale:t},r.trigger(te.INIT_PTS_FOUND,{frag:o,id:i,initPTS:e,timescale:t}))}if(c&&!1!==s.independent){if(p){const{startPTS:e,endPTS:t,startDTS:i,endDTS:r}=c;if(l)l.elementaryStreams[c.type]={startPTS:e,endPTS:t,startDTS:i,endDTS:r};else if(c.firstKeyFrame&&c.independent&&1===n.id&&(this.couldBacktrack=!0),c.dropped&&c.independent){const i=this.getMainFwdBufferInfo();if((i?i.end:this.getLoadPosition())+this.config.maxBufferHole<(c.firstKeyFramePTS?c.firstKeyFramePTS:e)-this.config.maxBufferHole)return void this.backtrack(o);o.setElementaryStreamInfo(c.type,o.start,t,o.start,r,!0)}o.setElementaryStreamInfo(c.type,e,t,i,r),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(c,o,l,n)}}else if(!1===s.independent)return void this.backtrack(o);if(m){const{startPTS:e,endPTS:t,startDTS:i,endDTS:r}=m;l&&(l.elementaryStreams[me]={startPTS:e,endPTS:t,startDTS:i,endDTS:r}),o.setElementaryStreamInfo(me,e,t,i,r),this.bufferFragmentData(m,o,l,n)}if(p&&null!=u&&null!=(t=u.samples)&&t.length){const e={id:i,frag:o,details:p,samples:u.samples};r.trigger(te.FRAG_PARSING_METADATA,e)}if(p&&h){const e={id:i,frag:o,details:p,samples:h.samples};r.trigger(te.FRAG_PARSING_USERDATA,e)}}}_bufferInitSegment(e,t,i,r){if(this.state!==Tr)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:s,video:n,audiovideo:a}=t;if(s){let t=e.audioCodec;const i=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(t&&(t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==s.metadata.channelCount&&-1===i.indexOf("firefox")&&(t="mp4a.40.5")),-1!==i.indexOf("android")&&"audio/mpeg"!==s.container&&(t="mp4a.40.2",this.log(`Android: force audio codec to ${t}`)),e.audioCodec&&e.audioCodec!==t&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${t}"`),s.levelCodec=t,s.id="main",this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${t||""}/${e.audioCodec||""}/${s.codec}]`)}n&&(n.levelCodec=e.videoCodec,n.id="main",this.log(`Init video buffer, container:${n.container}, codecs[level/parsed]=[${e.videoCodec||""}/${n.codec}]`)),a&&this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.attrs.CODECS||""}/${a.codec}]`),this.hls.trigger(te.BUFFER_CODECS,t),Object.keys(t).forEach((e=>{const s=t[e].initSegment;null!=s&&s.byteLength&&this.hls.trigger(te.BUFFER_APPENDING,{type:e,data:s,frag:i,part:null,chunkMeta:r,parent:i.type})})),this.tick()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,Yt)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=vr}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const i=e.currentTime;if(nr.isBuffered(e,i)?t=this.getAppendedFrag(i):nr.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;const e=this.fragPlaying,i=t.level;e&&t.sn===e.sn&&e.level===i&&t.urlId===e.urlId||(this.fragPlaying=t,this.hls.trigger(te.FRAG_CHANGED,{frag:t}),e&&e.level===i||this.hls.trigger(te.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const t=e.currentTime,i=this.currentFrag;if(i&&ee(t)&&ee(i.programDateTime)){const e=i.programDateTime+1e3*(t-i.start);return new Date(e)}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class Ns{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){const i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class Fs{constructor(e,t,i,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ns(e),this.fast_=new Ns(t),this.defaultTTFB_=r,this.ttfb_=new Ns(e)}update(e,t){const{slow_:i,fast_:r,ttfb_:s}=this;i.halfLife!==e&&(this.slow_=new Ns(e,i.getEstimate(),i.getTotalWeight())),r.halfLife!==t&&(this.fast_=new Ns(t,r.getEstimate(),r.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new Ns(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){const i=(e=Math.max(e,this.minDelayMs_))/1e3,r=8*t/i;this.fast_.sample(i,r),this.slow_.sample(i,r)}sampleTTFB(e){const t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}class Bs{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let i;return e.length?(i=1===e.length?e[0]:function(e,t){const i=new Uint8Array(t);let r=0;for(let s=0;s<e.length;s++){const t=e[s];i.set(t,r),r+=t.length}return i}(e,t),this.reset(),i):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}function Us(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!js(e[i].attrs,t[i].attrs))return!1;return!0}function js(e,t){const i=e["STABLE-RENDITION-ID"];return i?i===t["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some((i=>e[i]!==t[i]))}class Gs{constructor(e){this.buffered=void 0;const t=(t,i,r)=>{if((i>>>=0)>r-1)throw new DOMException(`Failed to execute '${t}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${r})`);return e[i][t]};this.buffered={get length(){return e.length},end:i=>t("end",i,e.length),start:i=>t("start",i,e.length)}}}function zs(e){const t=[];for(let i=0;i<e.length;i++){const r=e[i];"subtitles"!==r.kind&&"captions"!==r.kind||!r.label||t.push(e[i])}return t}class Vs{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t){const i=this.queues[t];i.push(e),1===i.length&&this.buffers[t]&&this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t;const i=new Promise((e=>{t=e})),r={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(r,e),i}executeNext(e){const{buffers:t,queues:i}=this,r=t[e],s=i[e];if(s.length){const t=s[0];try{t.execute()}catch(n){le.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),t.onError(n),null!=r&&r.updating||(s.shift(),this.executeNext(e))}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const $s=wt(),Hs=/([ha]vc.)(?:\.[^.,]+)+/;const Ys={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Ks=function(e){let t=e;return Ys.hasOwnProperty(e)&&(t=Ys[e]),String.fromCharCode(t)},Ws=15,qs=100,Qs={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Zs={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Xs={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Js={25:2,26:4,29:6,30:8,31:10,27:13,28:15},en=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class tn{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const i="function"==typeof t?t():t;le.log(`${this.time} [${e}] ${i}`)}}}const rn=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class sn{constructor(e,t,i,r,s){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=i||!1,this.background=r||"black",this.flash=s||!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){const r=t[i];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class nn{constructor(e,t,i,r,s,n){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new sn(t,i,r,s,n)}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class an{constructor(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(let t=0;t<qs;t++)this.chars.push(new nn);this.logger=e,this.pos=0,this.currPenState=new sn}equals(e){let t=!0;for(let i=0;i<qs;i++)if(!this.chars[i].equals(e.chars[i])){t=!1;break}return t}copy(e){for(let t=0;t<qs;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<qs;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>qs&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=qs)}moveCursor(e){const t=this.pos+e;if(e>1)for(let i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Ks(e);this.pos>=qs?this.logger.log(0,(()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!")):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<qs;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let i=0;i<qs;i++){const r=this.chars[i].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e);this.chars[this.pos].setPenState(this.currPenState)}}class on{constructor(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(let t=0;t<Ws;t++)this.rows.push(new an(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}reset(){for(let e=0;e<Ws;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let i=0;i<Ws;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<Ws;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Ws;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e);this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,(()=>"pacData = "+JSON.stringify(e)));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let t=0;t<Ws;t++)this.rows[t].clear();const e=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){const r=i.rows[e].cueStartTime,s=this.logger.time;if(r&&null!==s&&r<s)for(let n=0;n<this.nrRollUpRows;n++)this.rows[t-this.nrRollUpRows+n+1].copy(i.rows[e+n])}}this.currRow=t;const i=this.rows[this.currRow];if(null!==e.indent){const t=e.indent,r=Math.max(t-1,0);i.setCursor(e.indent),e.color=i.chars[r].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,(()=>"bkgData = "+JSON.stringify(e))),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,(()=>this.getDisplayText()));const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let i="",r=-1;for(let s=0;s<Ws;s++){const i=this.rows[s].getTextString();i&&(r=s+1,e?t.push("Row "+r+": '"+i+"'"):t.push(i.trim()))}return t.length>0&&(i=e?"["+t.join(" | ")+"]":t.join("\n")),i}getTextAndFormat(){return this.rows}}class ln{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new on(i),this.nonDisplayedMemory=new on(i),this.lastOutputScreen=new on(i),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,(()=>"MODE="+e)),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,(()=>t+": "+this.writeScreen.getDisplayText(!0))),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,(()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0))),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,(()=>"DISP: "+this.displayedMemory.getDisplayText()))}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{const i=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[i]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class dn{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;const r=new tn;this.channels=[null,new ln(e,t,r),new ln(e+1,i,r)],this.cmdHistory={a:null,b:null},this.logger=r}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){let i,r,s,n=!1;this.logger.time=e;for(let a=0;a<t.length;a+=2)if(r=127&t[a],s=127&t[a+1],0!==r||0!==s){if(this.logger.log(3,"["+rn([t[a],t[a+1]])+"] -> ("+rn([r,s])+")"),i=this.parseCmd(r,s),i||(i=this.parseMidrow(r,s)),i||(i=this.parsePAC(r,s)),i||(i=this.parseBackgroundAttributes(r,s)),!i&&(n=this.parseChars(r,s),n)){const e=this.currentChannel;if(e&&e>0){this.channels[e].insertChars(n)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}i||n||this.logger.log(2,"Couldn't parse cleaned data "+rn([r,s])+" orig: "+rn([t[a],t[a+1]]))}}parseCmd(e,t){const{cmdHistory:i}=this;if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;if(hn(e,t,i))return cn(null,null,i),this.logger.log(3,"Repeated command ("+rn([e,t])+") is dropped"),!0;const r=20===e||21===e||23===e?1:2,s=this.channels[r];return 20===e||21===e||28===e||29===e?32===t?s.ccRCL():33===t?s.ccBS():34===t?s.ccAOF():35===t?s.ccAON():36===t?s.ccDER():37===t?s.ccRU(2):38===t?s.ccRU(3):39===t?s.ccRU(4):40===t?s.ccFON():41===t?s.ccRDC():42===t?s.ccTR():43===t?s.ccRTD():44===t?s.ccEDM():45===t?s.ccCR():46===t?s.ccENM():47===t&&s.ccEOC():s.ccTO(t-32),cn(e,t,i),this.currentChannel=r,!0}parseMidrow(e,t){let i=0;if((17===e||25===e)&&t>=32&&t<=47){if(i=17===e?1:2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[i];return!!r&&(r.ccMIDROW(t),this.logger.log(3,"MIDROW ("+rn([e,t])+")"),!0)}return!1}parsePAC(e,t){let i;const r=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;if(hn(e,t,r))return cn(null,null,r),!0;const s=e<=23?1:2;i=t>=64&&t<=95?1===s?Qs[e]:Xs[e]:1===s?Zs[e]:Js[e];const n=this.channels[s];return!!n&&(n.setPAC(this.interpretPAC(i,t)),cn(e,t,r),this.currentChannel=s,!0)}interpretPAC(e,t){let i;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return i=t>95?t-96:t-64,r.underline=!(1&~i),i<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((i-16)/2),r}parseChars(e,t){let i,r=null,s=null;if(e>=25?(i=2,s=e-8):(i=1,s=e),s>=17&&s<=19){let e;e=17===s?t+80:18===s?t+112:t+144,this.logger.log(2,"Special char '"+Ks(e)+"' in channel "+i),r=[e]}else e>=32&&e<=127&&(r=0===t?[e]:[e,t]);if(r){const i=rn(r);this.logger.log(3,"Char codes =  "+i.join(",")),cn(e,t,this.cmdHistory)}return r}parseBackgroundAttributes(e,t){if(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47))return!1;let i;const r={};16===e||24===e?(i=Math.floor((t-32)/2),r.background=en[i],t%2==1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0));const s=e<=23?1:2;return this.channels[s].setBkgData(r),cn(e,t,this.cmdHistory),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const i=this.channels[t];i&&i.cueSplitAtTime(e)}}}function cn(e,t,i){i.a=e,i.b=t}function hn(e,t,i){return i.a===e&&i.b===t}class un{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var fn=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;const e=["","lr","rl"],t=["start","middle","end","left","right"];function i(e,t){if("string"!=typeof t)return!1;if(!Array.isArray(e))return!1;const i=t.toLowerCase();return!!~e.indexOf(i)&&i}function r(e){return i(t,e)}function s(e,...t){let i=1;for(;i<arguments.length;i++){const t=arguments[i];for(const i in t)e[i]=t[i]}return e}function n(t,n,a){const o=this,l={enumerable:!0};o.hasBeenReset=!1;let d="",c=!1,h=t,u=n,f=a,p=null,m="",g=!0,y="auto",v="start",_=50,E="middle",b=50,S="middle";Object.defineProperty(o,"id",s({},l,{get:function(){return d},set:function(e){d=""+e}})),Object.defineProperty(o,"pauseOnExit",s({},l,{get:function(){return c},set:function(e){c=!!e}})),Object.defineProperty(o,"startTime",s({},l,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",s({},l,{get:function(){return u},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");u=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",s({},l,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",s({},l,{get:function(){return p},set:function(e){p=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",s({},l,{get:function(){return m},set:function(t){const r=function(t){return i(e,t)}(t);if(!1===r)throw new SyntaxError("An invalid or illegal string was specified.");m=r,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",s({},l,{get:function(){return g},set:function(e){g=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",s({},l,{get:function(){return y},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",s({},l,{get:function(){return v},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",s({},l,{get:function(){return _},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",s({},l,{get:function(){return E},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",s({},l,{get:function(){return b},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",s({},l,{get:function(){return S},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");S=t,this.hasBeenReset=!0}})),o.displayState=void 0}return n.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},n}();class pn{decode(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function mn(e){function t(e,t,i,r){return 3600*(0|e)+60*(0|t)+(0|i)+parseFloat(r||0)}const i=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return i?parseFloat(i[2])>59?t(i[2],i[3],0,i[4]):t(i[1],i[2],i[3],i[4]):null}class gn{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let r=0;r<i.length;++r)if(t===i[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function yn(e,t,i,r){const s=r?e.split(r):[e];for(const n in s){if("string"!=typeof s[n])continue;const e=s[n].split(i);if(2!==e.length)continue;t(e[0],e[1])}}const vn=new fn(0,0,""),_n="middle"===vn.align?"middle":"center";function En(e,t,i){const r=e;function s(){const t=mn(e);if(null===t)throw new Error("Malformed timestamp: "+r);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function n(){e=e.replace(/^\s+/,"")}if(n(),t.startTime=s(),n(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);e=e.slice(3),n(),t.endTime=s(),n(),function(e,t){const r=new gn;yn(e,(function(e,t){let s;switch(e){case"region":for(let s=i.length-1;s>=0;s--)if(i[s].id===t){r.set(e,i[s].region);break}break;case"vertical":r.alt(e,t,["rl","lr"]);break;case"line":s=t.split(","),r.integer(e,s[0]),r.percent(e,s[0])&&r.set("snapToLines",!1),r.alt(e,s[0],["auto"]),2===s.length&&r.alt("lineAlign",s[1],["start",_n,"end"]);break;case"position":s=t.split(","),r.percent(e,s[0]),2===s.length&&r.alt("positionAlign",s[1],["start",_n,"end","line-left","line-right","auto"]);break;case"size":r.percent(e,t);break;case"align":r.alt(e,t,["start",_n,"end","left","right"])}}),/:/,/\s/),t.region=r.get("region",null),t.vertical=r.get("vertical","");let s=r.get("line","auto");"auto"===s&&-1===vn.line&&(s=-1),t.line=s,t.lineAlign=r.get("lineAlign","start"),t.snapToLines=r.get("snapToLines",!0),t.size=r.get("size",100),t.align=r.get("align",_n);let n=r.get("position","auto");"auto"===n&&50===vn.position&&(n="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=n}(e,t)}function bn(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class Sn{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new pn,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function i(){let e=t.buffer,i=0;for(e=bn(e);i<e.length&&"\r"!==e[i]&&"\n"!==e[i];)++i;const r=e.slice(0,i);return"\r"===e[i]&&++i,"\n"===e[i]&&++i,t.buffer=e.slice(i),r}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;e=i();const r=e.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(null==r||!r[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let s=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(s?s=!1:e=i(),t.state){case"HEADER":/:/.test(e)?yn(e,(function(e,t){}),/:/):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new fn(0,0,""),t.state="CUE",-1===e.indexOf("--\x3e")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{En(e,t.cue,t.regionList)}catch(r){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const i=-1!==e.indexOf("--\x3e");if(!e||i&&(s=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}}catch(r){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const Tn=/\r\n|\n\r|\n|\r/g,An=function(e,t,i=0){return e.slice(i,i+t.length)===t},wn=function(e){let t=5381,i=e.length;for(;i;)t=33*t^e.charCodeAt(--i);return(t>>>0).toString()};function Ln(e,t,i){return wn(e.toString())+wn(t.toString())+wn(i)}function In(e,t,i,r,s,n,a){const o=new Sn,l=qe(new Uint8Array(e)).trim().replace(Tn,"\n").split("\n"),d=[],c=function(e,t=1){return us(e,9e4,1/t)}(t.baseTime,t.timescale);let h,u="00:00.000",f=0,p=0,m=!0;o.oncue=function(e){const t=i[r];let n=i.ccOffset;const a=(f-c)/9e4;null!=t&&t.new&&(void 0!==p?n=i.ccOffset=t.start:function(e,t,i){let r=e[t],s=e[r.prevCC];if(!s||!s.new&&r.new)return e.ccOffset=e.presentationOffset=r.start,void(r.new=!1);for(;null!=(n=s)&&n.new;){var n;e.ccOffset+=r.start-s.start,r.new=!1,r=s,s=e[r.prevCC]}e.presentationOffset=i}(i,r,a)),a&&(n=a-i.presentationOffset);const o=e.endTime-e.startTime,l=vs(9e4*(e.startTime+n-p),9e4*s)/9e4;e.startTime=Math.max(l,0),e.endTime=Math.max(l+o,0);const h=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(h)),e.id||(e.id=Ln(e.startTime,e.endTime,h)),e.endTime>0&&d.push(e)},o.onparsingerror=function(e){h=e},o.onflush=function(){h?a(h):n(d)},l.forEach((e=>{if(m){if(An(e,"X-TIMESTAMP-MAP=")){m=!1,e.slice(16).split(",").forEach((e=>{An(e,"LOCAL:")?u=e.slice(6):An(e,"MPEGTS:")&&(f=parseInt(e.slice(7)))}));try{p=function(e){let t=parseInt(e.slice(-3));const i=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!(ee(t)&&ee(i)&&ee(r)&&ee(s)))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=6e4*r,t+=36e5*s,t}(u)/1e3}catch(t){h=t}return}""===e&&(m=!1)}o.parse(e+"\n")})),o.flush()}const Rn="stpp.ttml.im1t",Dn=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,kn=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,xn={left:"start",center:"center",right:"end",start:"start",end:"end"};function Cn(e,t,i,r){const s=at(new Uint8Array(e),["mdat"]);if(0===s.length)return void r(new Error("Could not parse IMSC1 mdat"));const n=s.map((e=>qe(e))),a=function(e,t,i=1,r=!1){return us(e,t,1/i,r)}(t.baseTime,1,t.timescale);try{n.forEach((e=>i(function(e,t){const i=(new DOMParser).parseFromString(e,"text/xml"),r=i.getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},n=Object.keys(s).reduce(((e,t)=>(e[t]=r.getAttribute(`ttp:${t}`)||s[t],e)),{}),a="preserve"!==r.getAttribute("xml:space"),o=Pn(Mn(r,"styling","style")),l=Pn(Mn(r,"layout","region")),d=Mn(r,"body","[begin]");return[].map.call(d,(e=>{const i=On(e,a);if(!i||!e.hasAttribute("begin"))return null;const r=Bn(e.getAttribute("begin"),n),s=Bn(e.getAttribute("dur"),n);let d=Bn(e.getAttribute("end"),n);if(null===r)throw Fn(e);if(null===d){if(null===s)throw Fn(e);d=r+s}const c=new fn(r-t,d-t,i);c.id=Ln(c.startTime,c.endTime,c.text);const h=function(e,t,i){const r="http://www.w3.org/ns/ttml#styling";let s=null;const n=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;a&&i.hasOwnProperty(a)&&(s=i[a]);return n.reduce(((i,n)=>{const a=Nn(t,r,n)||Nn(e,r,n)||Nn(s,r,n);return a&&(i[n]=a),i}),{})}(l[e.getAttribute("region")],o[e.getAttribute("style")],o),{textAlign:u}=h;if(u){const e=xn[u];e&&(c.lineAlign=e),c.align=u}return J(c,h),c})).filter((e=>null!==e))}(e,a))))}catch(o){r(o)}}function Mn(e,t,i){const r=e.getElementsByTagName(t)[0];return r?[].slice.call(r.querySelectorAll(i)):[]}function Pn(e){return e.reduce(((e,t)=>{const i=t.getAttribute("xml:id");return i&&(e[i]=t),e}),{})}function On(e,t){return[].slice.call(e.childNodes).reduce(((e,i,r)=>{var s;return"br"===i.nodeName&&r?e+"\n":null!=(s=i.childNodes)&&s.length?On(i,t):t?e+i.textContent.trim().replace(/\s+/g," "):e+i.textContent}),"")}function Nn(e,t,i){return e&&e.hasAttributeNS(t,i)?e.getAttributeNS(t,i):null}function Fn(e){return new Error(`Could not parse ttml timestamp ${e}`)}function Bn(e,t){if(!e)return null;let i=mn(e);return null===i&&(Dn.test(e)?i=function(e,t){const i=Dn.exec(e),r=(0|i[4])+(0|i[5])/t.subFrameRate;return 3600*(0|i[1])+60*(0|i[2])+(0|i[3])+r/t.frameRate}(e,t):kn.test(e)&&(i=function(e,t){const i=kn.exec(e),r=Number(i[1]);switch(i[2]){case"h":return 3600*r;case"m":return 60*r;case"ms":return 1e3*r;case"f":return r/t.frameRate;case"t":return r/t.tickRate}return r}(e,t))),i}function Un(e,t){return!!e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}class jn{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(te.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(te.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(te.MANIFEST_PARSED,this.onManifestParsed,this),e.on(te.BUFFER_CODECS,this.onBufferCodecs,this),e.on(te.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(te.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(te.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(te.MANIFEST_PARSED,this.onManifestParsed,this),e.off(te.BUFFER_CODECS,this.onBufferCodecs,this),e.off(te.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null}onManifestParsed(e,t){const i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){const e=this.hls.levels;if(e.length){const t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const i=t.filter(((t,i)=>this.isLevelAllowed(t)&&i<=e));return this.clientRect=null,jn.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,t.width||t.height||(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(t){}return e}isLevelAllowed(e){return!this.restrictedLevels.some((t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height))}static getMaxLevelByMediaSize(e,t,i){if(null==e||!e.length)return-1;let r=e.length-1;for(let a=0;a<e.length;a+=1){const o=e[a];if((o.width>=t||o.height>=i)&&(s=o,!(n=e[a+1])||s.width!==n.width||s.height!==n.height)){r=a;break}}var s,n;return r}}const Gn="[eme]";class zn{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=zn.CDMCleanupPromise?[zn.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=le.debug.bind(le,Gn),this.log=le.log.bind(le,Gn),this.warn=le.warn.bind(le,Gn),this.error=le.error.bind(le,Gn),this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(te.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(te.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(te.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(te.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(te.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(te.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(te.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(te.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:i}=this.config,r=t[e];if(r)return r.licenseUrl;if(e===we.WIDEVINE&&i)return i;throw new Error(`no license server URL configured for key-system "${e}"`)}getServerCertificateUrl(e){const{drmSystems:t}=this.config,i=t[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,i=(e,t,i)=>!!e&&i.indexOf(e)===t,r=t.map((e=>e.audioCodec)).filter(i),s=t.map((e=>e.videoCodec)).filter(i);return r.length+s.length===0&&s.push("avc1.42e01e"),new Promise(((t,i)=>{const n=e=>{const a=e.shift();this.getMediaKeysPromise(a,r,s).then((e=>t({keySystem:a,mediaKeys:e}))).catch((t=>{e.length?n(e):i(t instanceof Vn?t:new Vn({type:ie.KEY_SYSTEM_ERROR,details:re.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))}))};n(e)}))}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:i}=this.config;if("function"!=typeof i){let e=`Configured requestMediaKeySystemAccess is not a function ${i}`;return null===Pe&&"http:"===self.location.protocol&&(e=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(e))}return i(e,t)}getMediaKeysPromise(e,t,i){const r=function(e,t,i,r){let s;switch(e){case we.FAIRPLAY:s=["cenc","sinf"];break;case we.WIDEVINE:case we.PLAYREADY:s=["cenc"];break;case we.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${e}`)}return function(e,t,i,r){return[{initDataTypes:e,persistentState:r.persistentState||"not-allowed",distinctiveIdentifier:r.distinctiveIdentifier||"not-allowed",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:t.map((e=>({contentType:`audio/mp4; codecs="${e}"`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null}))),videoCapabilities:i.map((e=>({contentType:`video/mp4; codecs="${e}"`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null})))}]}(s,t,i,r)}(e,t,i,this.config.drmSystemOptions),s=this.keySystemAccessPromises[e];let n=null==s?void 0:s.keySystemAccess;if(!n){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(r)}`),n=this.requestMediaKeySystemAccess(e,r);const t=this.keySystemAccessPromises[e]={keySystemAccess:n};return n.catch((t=>{this.log(`Failed to obtain access to key-system "${e}": ${t}`)})),n.then((i=>{this.log(`Access for key-system "${i.keySystem}" obtained`);const r=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),t.mediaKeys=i.createMediaKeys().then((t=>(this.log(`Media-keys created for "${e}"`),r.then((i=>i?this.setMediaKeysServerCertificate(t,e,i):t))))),t.mediaKeys.catch((t=>{this.error(`Failed to create media-keys for "${e}"}: ${t}`)})),t.mediaKeys}))}return n.then((()=>s.mediaKeys))}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:i}){this.log(`Creating key-system session "${t}" keyId: ${Ze(e.keyId||[])}`);const r=i.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:i,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const i=this.createMediaKeySessionContext(e),r=this.getKeyIdString(t),s="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(i,s,t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return Ze(e.keyId)}updateKeySession(e,t){var i;const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyID ${Ze((null==(i=e.decryptdata)?void 0:i.keyId)||[])}\n      } (data length: ${t?t.byteLength:t})`),r.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise(((t,i)=>{const r=Me(this.config),s=e.map(ke).filter((e=>!!e&&-1!==r.indexOf(e)));return this.getKeySystemSelectionPromise(s).then((({keySystem:e})=>{const r=Ce(e);r?t(r):i(new Error(`Unable to find format for key-system "${e}"`))})).catch(i)}))}loadKey(e){const t=e.keyInfo.decryptdata,i=this.getKeyIdString(t),r=`(keyId: ${i} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${r}`);let s=this.keyIdToKeySessionPromise[i];return s||(s=this.keyIdToKeySessionPromise[i]=this.getKeySystemForKeyPromise(t).then((({keySystem:i,mediaKeys:s})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${r}`),this.attemptSetMediaKeys(i,s).then((()=>{this.throwIfDestroyed();const e=this.createMediaKeySessionContext({keySystem:i,mediaKeys:s,decryptdata:t});return this.generateRequestWithPreferredKeySession(e,"cenc",t.pssh,"playlist-key")}))))),s.catch((e=>this.handleError(e)))),s}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof Vn?this.hls.trigger(te.ERROR,e.data):this.hls.trigger(te.ERROR,{type:ie.KEY_SYSTEM_ERROR,details:re.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),i=this.keyIdToKeySessionPromise[t];if(!i){const t=ke(e.keyFormat),i=t?[t]:Me(this.config);return this.attemptKeySystemAccess(i)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=Me(this.config)),0===e.length)throw new Vn({type:ie.KEY_SYSTEM_ERROR,details:re.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}_onMediaEncrypted(e){const{initDataType:t,initData:i}=e;if(this.debug(`"${e.type}" event: init data type: "${t}"`),null===i)return;let r,s;if("sinf"===t&&this.config.drmSystems[we.FAIRPLAY]){const e=tt(new Uint8Array(i));try{const t=Se(JSON.parse(e).sinf),i=dt(new Uint8Array(t));if(!i)return;r=i.subarray(8,24),s=we.FAIRPLAY}catch(d){return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{const e=function(e){if(!(e instanceof ArrayBuffer)||e.byteLength<32)return null;const t={version:0,systemId:"",kids:null,data:null},i=new DataView(e),r=i.getUint32(0);if(e.byteLength!==r&&r>44)return null;if(1886614376!==i.getUint32(4))return null;if(t.version=i.getUint32(8)>>>24,t.version>1)return null;t.systemId=Ze(new Uint8Array(e,12,16));const s=i.getUint32(28);if(0===t.version){if(r-32<s)return null;t.data=new Uint8Array(e,32,s)}else if(1===t.version){t.kids=[];for(let i=0;i<s;i++)t.kids.push(new Uint8Array(e,32+16*i,16))}return t}(i);if(null===e)return;0===e.version&&e.systemId===xe&&e.data&&(r=e.data.subarray(8,24)),s=function(e){if(e===xe)return we.WIDEVINE}(e.systemId)}if(!s||!r)return;const n=Ze(r),{keyIdToKeySessionPromise:a,mediaKeySessions:o}=this;let l=a[n];for(let c=0;c<o.length;c++){const e=o[c],s=e.decryptdata;if(s.pssh||!s.keyId)continue;const d=Ze(s.keyId);if(n===d||-1!==s.uri.replace(/-/g,"").indexOf(n)){l=a[d],delete a[d],s.pssh=new Uint8Array(i),s.keyId=r,l=a[n]=l.then((()=>this.generateRequestWithPreferredKeySession(e,t,i,"encrypted-event-key-match")));break}}l||(l=a[n]=this.getKeySystemSelectionPromise([s]).then((({keySystem:e,mediaKeys:s})=>{var a;this.throwIfDestroyed();const o=new vt("ISO-23001-7",n,null!=(a=Ce(e))?a:"");return o.pssh=new Uint8Array(i),o.keyId=r,this.attemptSetMediaKeys(e,s).then((()=>{this.throwIfDestroyed();const r=this.createMediaKeySessionContext({decryptdata:o,keySystem:e,mediaKeys:s});return this.generateRequestWithPreferredKeySession(r,t,i,"encrypted-event-no-match")}))}))),l.catch((e=>this.handleError(e)))}_onWaitingForKey(e){this.log(`"${e.type}" event`)}attemptSetMediaKeys(e,t){const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(i).then((()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)}));return this.setMediaKeysQueue.push(r),r.then((()=>{this.log(`Media-keys set for "${e}"`),i.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter((e=>-1===i.indexOf(e)))}))}generateRequestWithPreferredKeySession(e,t,i,r){var s,n;const a=null==(s=this.config.drmSystems)||null==(n=s[e.keySystem])?void 0:n.generateRequest;if(a)try{const r=a.call(this.hls,t,i,e);if(!r)throw new Error("Invalid response from configured generateRequest filter");t=r.initDataType,i=e.decryptdata.pssh=r.initData?new Uint8Array(r.initData):null}catch(h){var o;if(this.warn(h.message),null!=(o=this.hls)&&o.config.debug)throw h}if(null===i)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const l=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${r}": ${l} (init data type: ${t} length: ${i?i.byteLength:null})`);const d=new xs;e.mediaKeysSession.onmessage=t=>{const i=e.mediaKeysSession;if(!i)return void d.emit("error",new Error("invalid state"));const{messageType:r,message:s}=t;this.log(`"${r}" message event for session "${i.sessionId}" message size: ${s.byteLength}`),"license-request"===r||"license-renewal"===r?this.renewLicense(e,s).catch((e=>{this.handleError(e),d.emit("error",e)})):"license-release"===r?e.keySystem===we.FAIRPLAY&&(this.updateKeySession(e,Ae("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${r}"`)},e.mediaKeysSession.onkeystatuseschange=t=>{if(!e.mediaKeysSession)return void d.emit("error",new Error("invalid state"));this.onKeyStatusChange(e);const i=e.keyStatus;d.emit("keyStatus",i),"expired"===i&&(this.warn(`${e.keySystem} expired for key ${l}`),this.renewKeySession(e))};const c=new Promise(((e,t)=>{d.on("error",t),d.on("keyStatus",(i=>{i.startsWith("usable")?e():"output-restricted"===i?t(new Vn({type:ie.KEY_SYSTEM_ERROR,details:re.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===i?t(new Vn({type:ie.KEY_SYSTEM_ERROR,details:re.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${i}"`)):"expired"===i?t(new Error("key expired while generating request")):this.warn(`unhandled key status change "${i}"`)}))}));return e.mediaKeysSession.generateRequest(t,i).then((()=>{var t;this.log(`Request generated for key-session "${null==(t=e.mediaKeysSession)?void 0:t.sessionId}" keyId: ${l}`)})).catch((e=>{throw new Vn({type:ie.KEY_SYSTEM_ERROR,details:re.KEY_SYSTEM_NO_SESSION,error:e,fatal:!1},`Error generating key-session request: ${e}`)})).then((()=>c)).catch((t=>{throw d.removeAllListeners(),this.removeSession(e),t})).then((()=>(d.removeAllListeners(),e)))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach(((t,i)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${Ze("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))} session keyId: ${Ze(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t}))}fetchServerCertificate(e){const t=this.config,i=new(0,t.loader)(t),r=this.getServerCertificateUrl(e);return r?(this.log(`Fetching serverCertificate for "${e}"`),new Promise(((s,n)=>{const a={responseType:"arraybuffer",url:r},o=t.certLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(e,t,i,r)=>{s(e.data)},onError:(t,i,s,o)=>{n(new Vn({type:ie.KEY_SYSTEM_ERROR,details:re.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:s,response:Z({url:a.url,data:void 0},t)},`"${e}" certificate request failed (${r}). Status: ${t.code} (${t.text})`))},onTimeout:(t,i,s)=>{n(new Vn({type:ie.KEY_SYSTEM_ERROR,details:re.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:s,response:{url:a.url,data:void 0}},`"${e}" certificate request timed out (${r})`))},onAbort:(e,t,i)=>{n(new Error("aborted"))}};i.load(a,l,d)}))):Promise.resolve()}setMediaKeysServerCertificate(e,t,i){return new Promise(((r,s)=>{e.setServerCertificate(i).then((s=>{this.log(`setServerCertificate ${s?"success":"not supported by CDM"} (${null==i?void 0:i.byteLength}) on "${t}"`),r(e)})).catch((e=>{s(new Vn({type:ie.KEY_SYSTEM_ERROR,details:re.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))}))}))}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then((t=>this.updateKeySession(e,new Uint8Array(t)).catch((e=>{throw new Vn({type:ie.KEY_SYSTEM_ERROR,details:re.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:e,fatal:!0},e.message)}))))}setupLicenseXHR(e,t,i,r){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then((()=>{if(!i.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,i,r)})).catch((n=>{if(!i.decryptdata)throw n;return e.open("POST",t,!0),s.call(this.hls,e,t,i,r)})).then((i=>{e.readyState||e.open("POST",t,!0);return{xhr:e,licenseChallenge:i||r}})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const i=this.config.keyLoadPolicy.default;return new Promise(((r,s)=>{const n=this.getLicenseServerUrl(e.keySystem);this.log(`Sending license request to URL: ${n}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(4===a.readyState)if(200===a.status){this._requestLicenseFailureCount=0;let t=a.response;this.log(`License received ${t instanceof ArrayBuffer?t.byteLength:t}`);const i=this.config.licenseResponseCallback;if(i)try{t=i.call(this.hls,a,n,e)}catch(o){this.error(o)}r(t)}else{const o=i.errorRetry,l=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||a.status>=400&&a.status<500)s(new Vn({type:ie.KEY_SYSTEM_ERROR,details:re.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:a,response:{url:n,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${n}). Status: ${a.status} (${a.statusText})`));else{const i=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${i} attempts left`),this.requestLicense(e,t).then(r,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,n,e,t).then((({xhr:e,licenseChallenge:t})=>{e.send(t)}))}))}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const i=t.media;this.media=i,i.addEventListener("encrypted",this.onMediaEncrypted),i.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media,t=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},vt.clearKeyUriToKeyIdMap();const i=t.length;zn.CDMCleanupPromise=Promise.all(t.map((e=>this.removeSession(e))).concat(null==e?void 0:e.setMediaKeys(null).catch((t=>{this.log(`Could not clear media keys: ${t}. media.src: ${null==e?void 0:e.src}`)})))).then((()=>{i&&(this.log("finished closing key sessions and clearing media keys"),t.length=0)})).catch((t=>{this.log(`Could not close sessions and clear media keys: ${t}. media.src: ${null==e?void 0:e.src}`)}))}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(t&&this.config.emeEnabled&&!this.keyFormatPromise){const e=t.reduce(((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e)),[]);this.log(`Selecting key-system from session-keys ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:i}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),t.onmessage=null,t.onkeystatuseschange=null,i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(e);return r>-1&&this.mediaKeySessions.splice(r,1),t.remove().catch((e=>{this.log(`Could not remove session: ${e}`)})).then((()=>t.close())).catch((e=>{this.log(`Could not close session: ${e}`)}))}}}zn.CDMCleanupPromise=void 0;class Vn extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}var $n="m",Hn="a",Yn="v",Kn="av",Wn="i",qn="tt";class Qn{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:$n,su:!this.initialized})}catch(t){le.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=e=>{try{const t=e.frag,i=this.hls.levels[t.level],r=this.getObjectType(t),s={d:1e3*t.duration,ot:r};r!==Yn&&r!==Hn&&r!=Kn||(s.br=i.bitrate/1e3,s.tb=this.getTopBandwidth(r)/1e3,s.bl=this.getBufferLength(r)),this.apply(e,s)}catch(t){le.warn("Could not generate segment CMCD data.",t)}},this.hls=e;const t=this.config=e.config,{cmcd:i}=t;null!=i&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||Qn.uuid(),this.cid=i.contentId,this.useHeaders=!0===i.useHeaders,this.registerListeners())}registerListeners(){const e=this.hls;e.on(te.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(te.MEDIA_DETACHED,this.onMediaDetached,this),e.on(te.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(te.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(te.MEDIA_DETACHED,this.onMediaDetached,this),e.off(te.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,r;this.audioBuffer=null==(i=t.tracks.audio)?void 0:i.buffer,this.videoBuffer=null==(r=t.tracks.video)?void 0:r.buffer}createData(){var e;return{v:1,sf:"h",sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){J(t,this.createData());const i=t.ot===Wn||t.ot===Yn||t.ot===Kn;if(this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering),this.useHeaders){const i=Qn.toHeaders(t);if(!Object.keys(i).length)return;e.headers||(e.headers={}),J(e.headers,i)}else{const i=Qn.toQuery(t);if(!i)return;e.url=Qn.appendQueryToUri(e.url,i)}}getObjectType(e){const{type:t}=e;return"subtitle"===t?qn:"initSegment"===e.sn?Wn:"audio"===t?Hn:"main"===t?this.hls.audioTracks.length?Yn:Kn:void 0}getTopBandwidth(e){let t,i=0;const r=this.hls;if(e===Hn)t=r.audioTracks;else{const e=r.maxAutoLevel,i=e>-1?e+1:r.levels.length;t=r.levels.slice(0,i)}for(const s of t)s.bitrate>i&&(i=s.bitrate);return i>0?i:NaN}getBufferLength(e){const t=this.hls.media,i=e===Hn?this.audioBuffer:this.videoBuffer;if(!i||!t)return NaN;return 1e3*nr.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new i(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,i,r){t(e),this.loader.load(e,i,r)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new i(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,i,r){t(e),this.loader.load(e,i,r)}}}static uuid(){const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}static serialize(e){const t=[],i=e=>!Number.isNaN(e)&&null!=e&&""!==e&&!1!==e,r=e=>Math.round(e),s=e=>100*r(e/100),n={br:r,d:r,bl:s,dl:s,mtp:s,nor:e=>encodeURIComponent(e),rtp:s,tb:r},a=Object.keys(e||{}).sort();for(const o of a){let r=e[o];if(!i(r))continue;if("v"===o&&1===r)continue;if("pr"==o&&1===r)continue;const s=n[o];s&&(r=s(r));const a=typeof r;let l;l="ot"===o||"sf"===o||"st"===o?`${o}=${r}`:"boolean"===a?o:"number"===a?`${o}=${r}`:`${o}=${JSON.stringify(r)}`,t.push(l)}return t.join(",")}static toHeaders(e){const t=Object.keys(e),i={},r=["Object","Request","Session","Status"],s=[{},{},{},{}],n={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};for(const a of t){s[null!=n[a]?n[a]:1][a]=e[a]}for(let a=0;a<s.length;a++){const e=Qn.serialize(s[a]);e&&(i[`CMCD-${r[a]}`]=e)}return i}static toQuery(e){return`CMCD=${encodeURIComponent(Qn.serialize(e))}`}static appendQueryToUri(e,t){if(!t)return e;const i=e.includes("?")?"&":"?";return`${e}${i}${t}`}}function Zn(e,t,i,r){e&&Object.keys(t).forEach((s=>{const n=e.filter((e=>e.groupId===s)).map((e=>{const n=J({},e);return n.details=void 0,n.attrs=new he(n.attrs),n.url=n.attrs.URI=Xn(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",i),n.groupId=n.attrs["GROUP-ID"]=t[s],n.attrs["PATHWAY-ID"]=r,n}));e.push(...n)}))}function Xn(e,t,i,r){const{HOST:s,PARAMS:n,[i]:a}=r;let o;t&&(o=null==a?void 0:a[t],o&&(e=o));const l=new self.URL(e);return s&&!o&&(l.host=s),n&&Object.keys(n).sort().forEach((e=>{e&&l.searchParams.set(e,n[e])})),l.href}const Jn=/^age:\s*[\d.]+\s*$/im;class ea{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new pe,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e)return;const i=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0;const s=this.xhrSetup;s?Promise.resolve().then((()=>{if(!this.stats.aborted)return s(i,t.url)})).catch((e=>(i.open("GET",t.url,!0),s(i,t.url)))).then((()=>{this.stats.aborted||this.openAndSendXhr(i,t,e)})).catch((e=>{this.callbacks.onError({code:i.status,text:e.message},t,i,r)})):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);const r=this.context.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:n}=i.loadPolicy;if(r)for(const a in r)e.setRequestHeader(a,r[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=s&&ee(s)?s:n,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:i}=this;if(!e||!t)return;const r=t.readyState,s=this.config;if(!i.aborted&&r>=2&&(0===i.loading.first&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),4===r)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const r=t.status,n="text"!==t.responseType;if(r>=200&&r<300&&(n&&t.response||null!==t.responseText)){i.loading.end=Math.max(self.performance.now(),i.loading.first);const s=n?t.response:t.responseText,a="arraybuffer"===t.responseType?s.byteLength:s.length;if(i.loaded=i.total=a,i.bwEstimate=8e3*i.total/(i.loading.end-i.loading.first),!this.callbacks)return;const o=this.callbacks.onProgress;if(o&&o(i,e,s,t),!this.callbacks)return;const l={url:t.responseURL,data:s,code:r};this.callbacks.onSuccess(l,i,e,t)}else{const n=s.loadPolicy.errorRetry;Ii(n,i.retry,!1,r)?this.retry(n):(le.error(`${r} while loading ${e.url}`),this.callbacks.onError({code:r,text:t.statusText},e,t,i))}}}loadtimeout(){var e;const t=null==(e=this.config)?void 0:e.loadPolicy.timeoutRetry;if(Ii(t,this.stats.retry,!0))this.retry(t);else{le.warn(`timeout while loading ${this.context.url}`);const e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:i}=this;this.retryDelay=wi(e,i.retry),i.retry++,le.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&Jn.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const ta=/(\d+)-(\d+)\/(\d+)/;class ia{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||ra,this.controller=new self.AbortController,this.stats=new pe}destroy(){this.loader=this.callbacks=null,this.abortInternal()}abortInternal(){const e=this.response;null!=e&&e.ok||(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const s=function(e,t){const i={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(J({},e.headers))};e.rangeEnd&&i.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1));return i}(e,this.controller.signal),n=i.onProgress,a="arraybuffer"===e.responseType,o=a?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:d}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=l&&ee(l)?l:d,this.requestTimeout=self.setTimeout((()=>{this.abortInternal(),i.onTimeout(r,e,this.response)}),t.timeout),self.fetch(this.request).then((s=>{this.response=this.loader=s;const o=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=d,this.requestTimeout=self.setTimeout((()=>{this.abortInternal(),i.onTimeout(r,e,this.response)}),d-(o-r.loading.start)),!s.ok){const{status:e,statusText:t}=s;throw new sa(t||"fetch, bad network response",e,s)}return r.loading.first=o,r.total=function(e){const t=e.get("Content-Range");if(t){const e=function(e){const t=ta.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(ee(e))return e}const i=e.get("Content-Length");if(i)return parseInt(i)}(s.headers)||r.total,n&&ee(t.highWaterMark)?this.loadProgressively(s,r,e,t.highWaterMark,n):a?s.arrayBuffer():"json"===e.responseType?s.json():s.text()})).then((s=>{const{response:a}=this;self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const l=s[o];l&&(r.loaded=r.total=l);const d={url:a.url,data:s,code:a.status};n&&!ee(t.highWaterMark)&&n(r,e,s,a),i.onSuccess(d,r,e,a)})).catch((t=>{if(self.clearTimeout(this.requestTimeout),r.aborted)return;const s=t&&t.code||0,n=t?t.message:null;i.onError({code:s,text:n},e,t?t.details:null,r)}))}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,r=0,s){const n=new Bs,a=e.body.getReader(),o=()=>a.read().then((a=>{if(a.done)return n.dataLength&&s(t,i,n.flush(),e),Promise.resolve(new ArrayBuffer(0));const l=a.value,d=l.length;return t.loaded+=d,d<r||n.dataLength?(n.push(l),n.dataLength>=r&&s(t,i,n.flush(),e)):s(t,i,l,e),o()})).catch((()=>Promise.reject()));return o()}}function ra(e,t){return new self.Request(e.url,t)}class sa extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}}const na=/\s/,aa={newCue(e,t,i,r){const s=[];let n,a,o,l,d;const c=self.VTTCue||self.TextTrackCue;for(let u=0;u<r.rows.length;u++)if(n=r.rows[u],o=!0,l=0,d="",!n.isEmpty()){var h;for(let e=0;e<n.chars.length;e++)na.test(n.chars[e].uchar)&&o?l++:(d+=n.chars[e].uchar,o=!1);n.cueStartTime=t,t===i&&(i+=1e-4),l>=16?l--:l++;const r=bn(d.trim()),f=Ln(t,i,r);null!=e&&null!=(h=e.cues)&&h.getCueById(f)||(a=new c(t,i,r),a.id=f,a.line=u+1,a.align="left",a.position=10+Math.min(80,10*Math.floor(8*l/32)),s.push(a))}return e&&s.length&&(s.sort(((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line)),s.forEach((t=>Jt(e,t)))),s}},oa=Z(Z({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:ea,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;const t=e.config;this.bwEstimator=new Fs(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(te.FRAG_LOADING,this.onFragLoading,this),e.on(te.FRAG_LOADED,this.onFragLoaded,this),e.on(te.FRAG_BUFFERED,this.onFragBuffered,this),e.on(te.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(te.LEVEL_LOADED,this.onLevelLoaded,this)}unregisterListeners(){const{hls:e}=this;e.off(te.FRAG_LOADING,this.onFragLoading,this),e.off(te.FRAG_LOADED,this.onFragLoaded,this),e.off(te.FRAG_BUFFERED,this.onFragBuffered,this),e.off(te.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(te.LEVEL_LOADED,this.onLevelLoaded,this)}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}onFragLoading(e,t){var i;const r=t.frag;this.ignoreFragment(r)||(this.fragCurrent=r,this.partCurrent=null!=(i=t.part)?i:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))}onLevelSwitching(e,t){this.clearTimer()}getTimeToLoadFrag(e,t,i,r){return e+i/t+(r?this.lastLevelLoadSec:0)}onLevelLoaded(e,t){const i=this.hls.config,{total:r,bwEstimate:s}=t.stats;ee(r)&&ee(s)&&(this.lastLevelLoadSec=8*r/s),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD)}_abandonRulesCheck(){const{fragCurrent:e,partCurrent:t,hls:i}=this,{autoLevelEnabled:r,media:s}=i;if(!e||!s)return;const n=performance.now(),a=t?t.stats:e.stats,o=t?t.duration:e.duration,l=n-a.loading.start;if(a.aborted||a.loaded&&a.loaded===a.total||0===e.level)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!r||s.paused||!s.playbackRate||!s.readyState)return;const d=i.mainForwardBufferInfo;if(null===d)return;const c=this.bwEstimator.getEstimateTTFB(),h=Math.abs(s.playbackRate);if(l<=Math.max(c,o/(2*h)*1e3))return;const u=d.len/h;if(u>=2*o/h)return;const f=a.loading.first?a.loading.first-a.loading.start:-1,p=a.loaded&&f>-1,m=this.bwEstimator.getEstimate(),{levels:g,minAutoLevel:y}=i,v=g[e.level],_=a.total||Math.max(a.loaded,Math.round(o*v.maxBitrate/8));let E=l-f;E<1&&p&&(E=Math.min(l,8*a.loaded/m));const b=p?1e3*a.loaded/E:0,S=b?(_-a.loaded)/b:8*_/m+c/1e3;if(S<=u)return;const T=b?8*b:m;let A,w=Number.POSITIVE_INFINITY;for(A=e.level-1;A>y;A--){const e=g[A].maxBitrate;if(w=this.getTimeToLoadFrag(c/1e3,T,o*e,!g[A].details),w<u)break}w>=S||w>10*o||(i.nextLoadLevel=A,p?this.bwEstimator.sample(l-Math.min(c,f),a.loaded):this.bwEstimator.sampleTTFB(l),this.clearTimer(),le.warn(`[abr] Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} is loading too slowly;\n      Time to underbuffer: ${u.toFixed(3)} s\n      Estimated load time for current fragment: ${S.toFixed(3)} s\n      Estimated load time for down switch fragment: ${w.toFixed(3)} s\n      TTFB estimate: ${f}\n      Current BW estimate: ${ee(m)?(m/1024).toFixed(3):"Unknown"} Kb/s\n      New BW estimate: ${(this.bwEstimator.getEstimate()/1024).toFixed(3)} Kb/s\n      Aborting and switching to level ${A}`),e.loader&&(this.fragCurrent=this.partCurrent=null,e.abortRequests()),i.trigger(te.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:a}))}onFragLoaded(e,{frag:t,part:i}){const r=i?i.stats:t.stats;if(t.type===Yt&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){const e=i?i.duration:t.duration,s=this.hls.levels[t.level],n=(s.loaded?s.loaded.bytes:0)+r.loaded,a=(s.loaded?s.loaded.duration:0)+e;s.loaded={bytes:n,duration:a},s.realBitrate=Math.round(8*n/a)}if(t.bitrateTest){const e={stats:r,frag:t,part:i,id:t.type};this.onFragBuffered(te.FRAG_BUFFERED,e),t.bitrateTest=!1}}}onFragBuffered(e,t){const{frag:i,part:r}=t,s=null!=r&&r.stats.loaded?r.stats:i.stats;if(s.aborted)return;if(this.ignoreFragment(i))return;const n=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(n,s.loaded),s.bwEstimate=this.bwEstimator.getEstimate(),i.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Yt||"initSegment"===e.sn}clearTimer(){self.clearInterval(this.timer)}get nextAutoLevel(){const e=this._nextAutoLevel,t=this.bwEstimator;if(-1!==e&&!t.canEstimate())return e;let i=this.getNextABRAutoLevel();if(-1!==e){const t=this.hls.levels;if(t.length>Math.max(e,i)&&t[e].loadError<=t[i].loadError)return e}return-1!==e&&(i=Math.min(e,i)),i}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:i}=this,{maxAutoLevel:r,config:s,minAutoLevel:n,media:a}=i,o=t?t.duration:e?e.duration:0,l=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,d=this.bwEstimator?this.bwEstimator.getEstimate():s.abrEwmaDefaultEstimate,c=i.mainForwardBufferInfo,h=(c?c.len:0)/l;let u=this.findBestLevel(d,n,r,h,s.abrBandWidthFactor,s.abrBandWidthUpFactor);if(u>=0)return u;le.trace(`[abr] ${h?"rebuffering expected":"buffer is empty"}, finding optimal quality level`);let f=o?Math.min(o,s.maxStarvationDelay):s.maxStarvationDelay,p=s.abrBandWidthFactor,m=s.abrBandWidthUpFactor;if(!h){const e=this.bitrateTestDelay;if(e){f=(o?Math.min(o,s.maxLoadingDelay):s.maxLoadingDelay)-e,le.trace(`[abr] bitrate test took ${Math.round(1e3*e)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),p=m=1}}return u=this.findBestLevel(d,n,r,h+f,p,m),Math.max(u,0)}findBestLevel(e,t,i,r,s,n){var a;const{fragCurrent:o,partCurrent:l,lastLoadedFragLevel:d}=this,{levels:c}=this.hls,h=c[d],u=!(null==h||null==(a=h.details)||!a.live),f=null==h?void 0:h.codecSet,p=l?l.duration:o?o.duration:0,m=this.bwEstimator.getEstimateTTFB()/1e3;let g=t,y=-1;for(let v=i;v>=t;v--){const t=c[v];if(!t||f&&t.codecSet!==f){t&&(g=Math.min(v,g),y=Math.max(v,y));continue}-1!==y&&le.trace(`[abr] Skipped level(s) ${g}-${y} with CODECS:"${c[y].attrs.CODECS}"; not compatible with "${h.attrs.CODECS}"`);const i=t.details,a=(l?null==i?void 0:i.partTarget:null==i?void 0:i.averagetargetduration)||p;let o;o=v<=d?s*e:n*e;const _=c[v].maxBitrate,E=this.getTimeToLoadFrag(m,o,_*a,void 0===i);if(le.trace(`[abr] level:${v} adjustedbw-bitrate:${Math.round(o-_)} avgDuration:${a.toFixed(1)} maxFetchDuration:${r.toFixed(1)} fetchDuration:${E.toFixed(1)}`),o>_&&(0===E||!ee(E)||u&&!this.bitrateTestDelay||E<r))return v}return-1}set nextAutoLevel(e){this._nextAutoLevel=e}},bufferController:class{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=()=>{const{media:e,mediaSource:t}=this;le.log("[buffer-controller]: Media source opened"),e&&(e.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(te.MEDIA_ATTACHED,{media:e})),t&&t.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{le.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=()=>{le.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=()=>{const{media:e,_objectUrl:t}=this;e&&e.src!==t&&le.error(`Media element src was set while attaching MediaSource (${t} > ${e.src})`)},this.hls=e,this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null}registerListeners(){const{hls:e}=this;e.on(te.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(te.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(te.MANIFEST_LOADING,this.onManifestLoading,this),e.on(te.MANIFEST_PARSED,this.onManifestParsed,this),e.on(te.BUFFER_RESET,this.onBufferReset,this),e.on(te.BUFFER_APPENDING,this.onBufferAppending,this),e.on(te.BUFFER_CODECS,this.onBufferCodecs,this),e.on(te.BUFFER_EOS,this.onBufferEos,this),e.on(te.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(te.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(te.FRAG_PARSED,this.onFragParsed,this),e.on(te.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off(te.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(te.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(te.MANIFEST_LOADING,this.onManifestLoading,this),e.off(te.MANIFEST_PARSED,this.onManifestParsed,this),e.off(te.BUFFER_RESET,this.onBufferReset,this),e.off(te.BUFFER_APPENDING,this.onBufferAppending,this),e.off(te.BUFFER_CODECS,this.onBufferCodecs,this),e.off(te.BUFFER_EOS,this.onBufferEos,this),e.off(te.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(te.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(te.FRAG_PARSED,this.onFragParsed,this),e.off(te.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new Vs(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,le.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){const i=this.media=t.media;if(i&&$s){const e=this.mediaSource=new $s;e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),i.src=self.URL.createObjectURL(e),this._objectUrl=i.src,i.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:t,_objectUrl:i}=this;if(t){if(le.log("[buffer-controller]: media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(Aa){le.warn(`[buffer-controller]: onMediaDetaching: ${Aa.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),i&&self.URL.revokeObjectURL(i),e.src===i?(e.removeAttribute("src"),e.load()):le.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(te.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach((e=>{const t=this.sourceBuffer[e];try{t&&(this.removeBufferListeners(e),this.mediaSource&&this.mediaSource.removeSourceBuffer(t),this.sourceBuffer[e]=void 0)}catch(Aa){le.warn(`[buffer-controller]: Failed to reset the ${e} buffer`,Aa)}})),this._initSourceBuffer()}onBufferCodecs(e,t){const i=this.getSourceBufferTypes().length;Object.keys(t).forEach((e=>{if(i){const i=this.tracks[e];if(i&&"function"==typeof i.buffer.changeType){const{id:r,codec:s,levelCodec:n,container:a,metadata:o}=t[e],l=(i.levelCodec||i.codec).replace(Hs,"$1"),d=(n||s).replace(Hs,"$1");if(l!==d){const t=`${a};codecs=${n||s}`;this.appendChangeType(e,t),le.log(`[buffer-controller]: switching codec ${l} to ${d}`),this.tracks[e]={buffer:i.buffer,codec:s,container:a,levelCodec:n,metadata:o,id:r}}}}else this.pendingTracks[e]=t[e]})),i||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())}appendChangeType(e,t){const{operationQueue:i}=this,r={execute:()=>{const r=this.sourceBuffer[e];r&&(le.log(`[buffer-controller]: changing ${e} sourceBuffer type to ${t}`),r.changeType(t)),i.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{le.warn(`[buffer-controller]: Failed to change ${e} SourceBuffer type`,t)}};i.append(r,e)}onBufferAppending(e,t){const{hls:i,operationQueue:r,tracks:s}=this,{data:n,type:a,frag:o,part:l,chunkMeta:d}=t,c=d.buffering[a],h=self.performance.now();c.start=h;const u=o.stats.buffering,f=l?l.stats.buffering:null;0===u.start&&(u.start=h),f&&0===f.start&&(f.start=h);const p=s.audio;let m=!1;"audio"===a&&"audio/mpeg"===(null==p?void 0:p.container)&&(m=!this.lastMpegAudioChunk||1===d.id||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);const g=o.start,y={execute:()=>{if(c.executeStart=self.performance.now(),m){const e=this.sourceBuffer[a];if(e){const t=g-e.timestampOffset;Math.abs(t)>=.1&&(le.log(`[buffer-controller]: Updating audio SourceBuffer timestampOffset to ${g} (delta: ${t}) sn: ${o.sn})`),e.timestampOffset=g)}}this.appendExecutor(n,a)},onStart:()=>{},onComplete:()=>{const e=self.performance.now();c.executeEnd=c.end=e,0===u.first&&(u.first=e),f&&0===f.first&&(f.first=e);const{sourceBuffer:t}=this,i={};for(const r in t)i[r]=nr.getBuffered(t[r]);this.appendError=0,this.hls.trigger(te.BUFFER_APPENDED,{type:a,frag:o,part:l,chunkMeta:d,parent:o.type,timeRanges:i})},onError:e=>{le.error(`[buffer-controller]: Error encountered while trying to append to the ${a} SourceBuffer`,e);const t={type:ie.MEDIA_ERROR,parent:o.type,details:re.BUFFER_APPEND_ERROR,frag:o,part:l,chunkMeta:d,error:e,err:e,fatal:!1};e.code===DOMException.QUOTA_EXCEEDED_ERR?t.details=re.BUFFER_FULL_ERROR:(this.appendError++,t.details=re.BUFFER_APPEND_ERROR,this.appendError>i.config.appendErrorMaxRetry&&(le.error(`[buffer-controller]: Failed ${i.config.appendErrorMaxRetry} times to append segment in sourceBuffer`),t.fatal=!0)),i.trigger(te.ERROR,t)}};r.append(y,a)}onBufferFlushing(e,t){const{operationQueue:i}=this,r=e=>({execute:this.removeExecutor.bind(this,e,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(te.BUFFER_FLUSHED,{type:e})},onError:t=>{le.warn(`[buffer-controller]: Failed to remove from ${e} SourceBuffer`,t)}});t.type?i.append(r(t.type),t.type):this.getSourceBufferTypes().forEach((e=>{i.append(r(e),e)}))}onFragParsed(e,t){const{frag:i,part:r}=t,s=[],n=r?r.elementaryStreams:i.elementaryStreams;n[ye]?s.push("audiovideo"):(n[me]&&s.push("audio"),n[ge]&&s.push("video"));0===s.length&&le.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers((()=>{const e=self.performance.now();i.stats.buffering.end=e,r&&(r.stats.buffering.end=e);const t=r?r.stats:i.stats;this.hls.trigger(te.FRAG_BUFFERED,{frag:i,part:r,stats:t,id:i.type})}),s)}onFragChanged(e,t){this.flushBackBuffer()}onBufferEos(e,t){this.getSourceBufferTypes().reduce(((e,i)=>{const r=this.sourceBuffer[i];return!r||t.type&&t.type!==i||(r.ending=!0,r.ended||(r.ended=!0,le.log(`[buffer-controller]: ${i} sourceBuffer now EOS`))),e&&!(r&&!r.ended)}),!0)&&(le.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers((()=>{this.getSourceBufferTypes().forEach((e=>{const t=this.sourceBuffer[e];t&&(t.ending=!1)}));const{mediaSource:e}=this;e&&"open"===e.readyState?(le.log("[buffer-controller]: Calling mediaSource.endOfStream()"),e.endOfStream()):e&&le.info(`[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: ${e.readyState}`)})))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}flushBackBuffer(){const{hls:e,details:t,media:i,sourceBuffer:r}=this;if(!i||null===t)return;const s=this.getSourceBufferTypes();if(!s.length)return;const n=t.live&&null!==e.config.liveBackBufferLength?e.config.liveBackBufferLength:e.config.backBufferLength;if(!ee(n)||n<0)return;const a=i.currentTime,o=t.levelTargetDuration,l=Math.max(n,o),d=Math.floor(a/o)*o-l;s.forEach((i=>{const s=r[i];if(s){const r=nr.getBuffered(s);if(r.length>0&&d>r.start(0)){if(e.trigger(te.BACK_BUFFER_REACHED,{bufferEnd:d}),t.live)e.trigger(te.LIVE_BACK_BUFFER_REACHED,{bufferEnd:d});else if(s.ended&&r.end(r.length-1)-a<2*o)return void le.info(`[buffer-controller]: Cannot flush ${i} back buffer while SourceBuffer is in ended state`);e.trigger(te.BUFFER_FLUSHING,{startOffset:0,endOffset:d,type:i})}}}))}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||"open"!==this.mediaSource.readyState)return;const{details:e,hls:t,media:i,mediaSource:r}=this,s=e.fragments[0].start+e.totalduration,n=i.duration,a=ee(r.duration)?r.duration:0;e.live&&t.config.liveDurationInfinity?(le.log("[buffer-controller]: Media Source duration is set to Infinity"),r.duration=1/0,this.updateSeekableRange(e)):(s>a&&s>n||!ee(n))&&(le.log(`[buffer-controller]: Updating Media Source duration to ${s.toFixed(3)}`),r.duration=s)}updateSeekableRange(e){const t=this.mediaSource,i=e.fragments;if(i.length&&e.live&&null!=t&&t.setLiveSeekableRange){const r=Math.max(0,i[0].start),s=Math.max(r,r+e.totalduration);t.setLiveSeekableRange(r,s)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:i}=this,r=Object.keys(i).length;if(r&&!e||2===r){this.createSourceBuffers(i),this.pendingTracks={};const e=this.getSourceBufferTypes();if(e.length)this.hls.trigger(te.BUFFER_CREATED,{tracks:this.tracks}),e.forEach((e=>{t.executeNext(e)}));else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(te.ERROR,{type:ie.MEDIA_ERROR,details:re.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}}createSourceBuffers(e){const{sourceBuffer:t,mediaSource:i}=this;if(!i)throw Error("createSourceBuffers called when mediaSource was null");for(const r in e)if(!t[r]){const s=e[r];if(!s)throw Error(`source buffer exists for track ${r}, however track does not`);const n=s.levelCodec||s.codec,a=`${s.container};codecs=${n}`;le.log(`[buffer-controller]: creating sourceBuffer(${a})`);try{const e=t[r]=i.addSourceBuffer(a),o=r;this.addBufferListener(o,"updatestart",this._onSBUpdateStart),this.addBufferListener(o,"updateend",this._onSBUpdateEnd),this.addBufferListener(o,"error",this._onSBUpdateError),this.tracks[r]={buffer:e,codec:n,container:s.container,levelCodec:s.levelCodec,metadata:s.metadata,id:s.id}}catch(Aa){le.error(`[buffer-controller]: error while trying to add sourceBuffer: ${Aa.message}`),this.hls.trigger(te.ERROR,{type:ie.MEDIA_ERROR,details:re.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:Aa,mimeType:a})}}}_onSBUpdateStart(e){const{operationQueue:t}=this;t.current(e).onStart()}_onSBUpdateEnd(e){const{operationQueue:t}=this;t.current(e).onComplete(),t.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){const i=new Error(`${e} SourceBuffer error`);le.error(`[buffer-controller]: ${i}`,t),this.hls.trigger(te.ERROR,{type:ie.MEDIA_ERROR,details:re.BUFFER_APPENDING_ERROR,error:i,fatal:!1});const r=this.operationQueue.current(e);r&&r.onError(t)}removeExecutor(e,t,i){const{media:r,mediaSource:s,operationQueue:n,sourceBuffer:a}=this,o=a[e];if(!r||!s||!o)return le.warn(`[buffer-controller]: Attempting to remove from the ${e} SourceBuffer, but it does not exist`),void n.shiftAndExecuteNext(e);const l=ee(r.duration)?r.duration:1/0,d=ee(s.duration)?s.duration:1/0,c=Math.max(0,t),h=Math.min(i,l,d);h>c&&!o.ending?(o.ended=!1,le.log(`[buffer-controller]: Removing [${c},${h}] from the ${e} SourceBuffer`),o.remove(c,h)):n.shiftAndExecuteNext(e)}appendExecutor(e,t){const{operationQueue:i,sourceBuffer:r}=this,s=r[t];if(!s)return le.warn(`[buffer-controller]: Attempting to append to the ${t} SourceBuffer, but it does not exist`),void i.shiftAndExecuteNext(t);s.ended=!1,s.appendBuffer(e)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length)return le.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);const{operationQueue:i}=this,r=t.map((e=>i.appendBlocker(e)));Promise.all(r).then((()=>{e(),t.forEach((e=>{const t=this.sourceBuffer[e];null!=t&&t.updating||i.shiftAndExecuteNext(e)}))}))}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,i){const r=this.sourceBuffer[e];if(!r)return;const s=i.bind(this,e);this.listeners[e].push({event:t,listener:s}),r.addEventListener(t,s)}removeBufferListeners(e){const t=this.sourceBuffer[e];t&&this.listeners[e].forEach((e=>{t.removeEventListener(e.event,e.listener)}))}},capLevelController:jn,errorController:class{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=le.log.bind(le,"[info]:"),this.warn=le.warn.bind(le,"[warning]:"),this.error=le.error.bind(le,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(te.ERROR,this.onError,this),e.on(te.MANIFEST_LOADING,this.onManifestLoading,this),e.on(te.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(te.ERROR,this.onError,this),e.off(te.ERROR,this.onErrorOut,this),e.off(te.MANIFEST_LOADING,this.onManifestLoading,this),e.off(te.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){this.playlistError=0}stopLoad(){}getVariantLevelIndex(e){return(null==e?void 0:e.type)===Yt?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var i;if(t.fatal)return;const r=this.hls,s=t.context;switch(t.details){case re.FRAG_LOAD_ERROR:case re.FRAG_LOAD_TIMEOUT:case re.KEY_LOAD_ERROR:case re.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case re.FRAG_GAP:case re.FRAG_PARSING_ERROR:case re.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=Mi);case re.LEVEL_EMPTY_ERROR:case re.LEVEL_PARSING_ERROR:{var n,a;const e=t.parent===Yt?t.level:r.loadLevel;t.details===re.LEVEL_EMPTY_ERROR&&null!=(n=t.context)&&null!=(a=n.levelDetails)&&a.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case re.LEVEL_LOAD_ERROR:case re.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==s?void 0:s.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level)));case re.AUDIO_TRACK_LOAD_ERROR:case re.AUDIO_TRACK_LOAD_TIMEOUT:case re.SUBTITLE_LOAD_ERROR:case re.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const e=r.levels[r.loadLevel];if(e&&(s.type===$t&&s.groupId===e.audioGroupId||s.type===Ht&&s.groupId===e.textGroupId))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=Mi,void(t.errorAction.flags=Ni)}return;case re.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const e=r.levels[r.loadLevel],i=null==e?void 0:e.attrs["HDCP-LEVEL"];i&&(t.errorAction={action:Mi,flags:Fi,hdcpLevel:i})}return;case re.BUFFER_ADD_CODEC_ERROR:case re.REMUX_ALLOC_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,null!=(i=t.level)?i:r.loadLevel));case re.INTERNAL_EXCEPTION:case re.BUFFER_APPENDING_ERROR:case re.BUFFER_APPEND_ERROR:case re.BUFFER_FULL_ERROR:case re.LEVEL_SWITCH_ERROR:case re.BUFFER_STALLED_ERROR:case re.BUFFER_SEEK_OVER_HOLE:case re.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={action:Ci,flags:Oi})}if(t.type===ie.KEY_SYSTEM_ERROR){const e=this.getVariantLevelIndex(t.frag);return t.levelRetry=!1,void(t.errorAction=this.getLevelSwitchAction(t,e))}}getPlaylistRetryOrSwitchAction(e,t){var i;const r=Ai(this.hls.config.playlistLoadPolicy,e),s=this.playlistError++,n=null==(i=e.response)?void 0:i.code;if(Ii(r,s,Ti(e),n))return{action:Pi,flags:Oi,retryConfig:r,retryCount:s};const a=this.getLevelSwitchAction(e,t);return r&&(a.retryConfig=r,a.retryCount=s),a}getFragRetryOrSwitchAction(e){const t=this.hls,i=this.getVariantLevelIndex(e.frag),r=t.levels[i],{fragLoadPolicy:s,keyLoadPolicy:n}=t.config,a=Ai(e.details.startsWith("key")?n:s,e),o=t.levels.reduce(((e,t)=>e+t.fragmentError),0);if(r){var l;e.details!==re.FRAG_GAP&&r.fragmentError++;const t=null==(l=e.response)?void 0:l.code;if(Ii(a,o,Ti(e),t))return{action:Pi,flags:Oi,retryConfig:a,retryCount:o}}const d=this.getLevelSwitchAction(e,i);return a&&(d.retryConfig=a,d.retryCount=o),d}getLevelSwitchAction(e,t){const i=this.hls;null==t&&(t=i.loadLevel);const r=this.hls.levels[t];if(r&&(r.loadError++,i.autoLevelEnabled)){var s,n;let t=-1;const a=i.levels,o=null==(s=e.frag)?void 0:s.type,{type:l,groupId:d}=null!=(n=e.context)?n:{};for(let s=a.length;s--;){const n=(s+i.loadLevel)%a.length;if(n!==i.loadLevel&&0===a[n].loadError){const i=a[n];if(e.details===re.FRAG_GAP&&e.frag){const t=a[n].details;if(t){const i=Di(e.frag,t.fragments,e.frag.start);if(null!=i&&i.gap)continue}}else{if(l===$t&&d===i.audioGroupId||l===Ht&&d===i.textGroupId)continue;if(o===Kt&&r.audioGroupId===i.audioGroupId||o===Wt&&r.textGroupId===i.textGroupId)continue}t=n;break}}if(t>-1&&i.loadLevel!==t)return e.levelRetry=!0,this.playlistError=0,{action:Mi,flags:Oi,nextAutoLevel:t}}return{action:Mi,flags:Ni}}onErrorOut(e,t){var i;switch(null==(i=t.errorAction)?void 0:i.action){case Ci:break;case Mi:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===re.FRAG_GAP||(t.fatal=!0)}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,i=e.errorAction;if(!i)return;const{flags:r,hdcpLevel:s,nextAutoLevel:n}=i;switch(r){case Oi:this.switchLevel(e,n);break;case Ni:i.resolved||(i.resolved=this.redundantFailover(e));break;case Fi:s&&(t.maxHdcpLevel=ci[ci.indexOf(s)-1],i.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`)}i.resolved||this.switchLevel(e,n)}switchLevel(e,t){void 0!==t&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}redundantFailover(e){const{hls:t,penalizedRenditions:i}=this,r=e.parent===Yt?e.level:t.loadLevel,s=t.levels[r],n=s.url.length,a=e.frag?e.frag.urlId:s.urlId;s.urlId!==a||e.frag&&!s.details||this.penalizeRendition(s,e);for(let o=1;o<n;o++){const l=(a+o)%n,d=i[l];if(!d||Bi(d,e,i[a]))return this.warn(`Switching to Redundant Stream ${l+1}/${n}: "${s.url[l]}" after ${e.details}`),this.playlistError=0,t.levels.forEach((e=>{e.urlId=l})),t.nextLoadLevel=r,!0}return!1}penalizeRendition(e,t){const{penalizedRenditions:i}=this,r=i[e.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};r.lastErrorPerfMs=performance.now(),r.errors.push(t),r.details=e.details,i[e.urlId]=r}},fpsController:class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(te.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(te.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const i=this.hls.config;if(i.capLevelOnFPSDrop){const e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,i){const r=performance.now();if(t){if(this.lastTime){const e=r-this.lastTime,s=i-this.lastDroppedFrames,n=t-this.lastDecodedFrames,a=1e3*s/e,o=this.hls;if(o.trigger(te.FPS_DROP,{currentDropped:s,currentDecoded:n,totalDroppedFrames:i}),a>0&&s>o.config.fpsDroppedMonitoringThreshold*n){let e=o.currentLevel;le.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=e)&&(e-=1,o.trigger(te.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:o.currentLevel}),o.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Pe,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:aa,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends Dr{constructor(e,t,i){super(e,t,i,"[subtitle-stream-controller]",Wt),this.levels=[],this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on(te.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(te.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(te.MANIFEST_LOADING,this.onManifestLoading,this),e.on(te.LEVEL_LOADED,this.onLevelLoaded,this),e.on(te.ERROR,this.onError,this),e.on(te.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(te.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(te.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(te.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(te.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(te.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(te.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(te.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(te.MANIFEST_LOADING,this.onManifestLoading,this),e.off(te.LEVEL_LOADED,this.onLevelLoaded,this),e.off(te.ERROR,this.onError,this),e.off(te.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(te.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(te.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(te.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(te.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(te.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=vr,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:i,success:r}=t;if(this.fragPrevious=i,this.state=vr,!r)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let n;const a=i.start;for(let l=0;l<s.length;l++)if(a>=s[l].start&&a<=s[l].end){n=s[l];break}const o=i.start+i.duration;n?n.end=o:(n={start:a,end:o},s.push(n)),this.fragmentTracker.fragBuffered(i)}onBufferFlushing(e,t){const{startOffset:i,endOffset:r}=t;if(0===i&&r!==Number.POSITIVE_INFINITY){const{currentTrackId:e,levels:s}=this;if(!s.length||!s[e]||!s[e].details)return;const n=r-s[e].details.targetduration;if(n<=0)return;t.endOffsetSubtitles=Math.max(0,n),this.tracksBuffered.forEach((e=>{for(let t=0;t<e.length;)if(e[t].end<=n)e.shift();else{if(!(e[t].start<n))break;e[t].start=n,t++}})),this.fragmentTracker.removeFragmentsInRange(i,n,Wt)}}onFragBuffered(e,t){var i;this.loadedmetadata||t.frag.type!==Yt||null!=(i=this.media)&&i.buffered.length&&(this.loadedmetadata=!0)}onError(e,t){const i=t.frag;(null==i?void 0:i.type)===Wt&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==yr&&(this.state=vr))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){Us(this.levels,t)?this.levels=t.map((e=>new mi(e))):(this.tracksBuffered=[],this.levels=t.map((e=>{const t=new mi(e);return this.tracksBuffered[t.id]=[],t})),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Wt),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){if(this.currentTrackId=t.id,!this.levels.length||-1===this.currentTrackId)return void this.clearInterval();const i=this.levels[this.currentTrackId];null!=i&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var i;const{details:r,id:s}=t,{currentTrackId:n,levels:a}=this;if(!a.length)return;const o=a[n];if(s>=a.length||s!==n||!o)return;this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(r.live||null!=(i=o.details)&&i.live){const e=this.mainDetails;if(r.deltaUpdateFailed||!e)return;const t=e.fragments[0];o.details?(l=this.alignPlaylists(r,o.details),0===l&&t&&(l=t.start,Ei(r,l))):r.hasProgramDateTime&&e.hasProgramDateTime?(hr(r,e),l=r.fragments[0].start):t&&(l=t.start,Ei(r,l))}if(o.details=r,this.levelLastLoaded=s,this.startFragRequested||!this.mainDetails&&r.live||this.setStartPosition(o.details,l),this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===vr){Di(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}_handleFragmentLoadComplete(e){const{frag:t,payload:i}=e,r=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&r&&r.key&&r.iv&&"AES-128"===r.method){const e=performance.now();this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer).catch((e=>{throw s.trigger(te.ERROR,{type:ie.MEDIA_ERROR,details:re.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e})).then((i=>{const r=performance.now();s.trigger(te.FRAG_DECRYPTED,{frag:t,payload:i,stats:{tstart:e,tdecrypt:r}})})).catch((e=>{this.warn(`${e.name}: ${e.message}`),this.state=vr}))}}doTick(){if(this.media){if(this.state===vr){const{currentTrackId:e,levels:t}=this,i=t[e];if(!t.length||!i||!i.details)return;const r=i.details,s=r.targetduration,{config:n}=this,a=this.getLoadPosition(),o=nr.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],a-s,n.maxBufferHole),{end:l,len:d}=o,c=this.getFwdBufferInfo(this.media,Yt);if(d>this.getMaxBufferLength(null==c?void 0:c.len)+s)return;const h=r.fragments,u=h.length,f=r.edge;let p=null;const m=this.fragPrevious;if(l<f){const{maxFragLookUpTolerance:e}=n;p=Di(m,h,Math.max(h[0].start,l),e),!p&&m&&m.start<h[0].start&&(p=h[0])}else p=h[u-1];if(!p)return;p=this.mapToInitFragWhenRequired(p),this.fragmentTracker.getState(p)===$i&&this.loadFragment(p,i,l)}}else this.state=vr}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,i){this.fragCurrent=e,"initSegment"===e.sn?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,i))}get mediaBufferTimeRanges(){return new Gs(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends Ui{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.trackChangeListener=()=>this.onTextTracksChanged(),this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}registerListeners(){const{hls:e}=this;e.on(te.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(te.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(te.MANIFEST_LOADING,this.onManifestLoading,this),e.on(te.MANIFEST_PARSED,this.onManifestParsed,this),e.on(te.LEVEL_LOADING,this.onLevelLoading,this),e.on(te.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(te.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(te.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(te.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(te.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(te.MANIFEST_LOADING,this.onManifestLoading,this),e.off(te.MANIFEST_PARSED,this.onManifestParsed,this),e.off(te.LEVEL_LOADING,this.onLevelLoading,this),e.off(te.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(te.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(te.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);zs(this.media.textTracks).forEach((e=>{ei(e)})),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:i,details:r}=t,{trackId:s}=this,n=this.tracksInGroup[s];if(!n)return void this.warn(`Invalid subtitle track id ${i}`);const a=n.details;n.details=t.details,this.log(`subtitle track ${i} loaded [${r.startSN}-${r.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(null==t||!t.textGroupIds)return;const i=t.textGroupIds[t.urlId],r=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==i){const e=this.tracks.filter((e=>!i||e.groupId===i));this.tracksInGroup=e;const t=this.findTrackId(null==r?void 0:r.name)||this.findTrackId();this.groupId=i||null;const s={subtitleTracks:e};this.log(`Updating subtitle tracks, ${e.length} track(s) found in "${i}" group-id`),this.hls.trigger(te.SUBTITLE_TRACKS_UPDATED,s),-1!==t&&this.setSubtitleTrack(t,r)}else this.shouldReloadPlaylist(r)&&this.setSubtitleTrack(this.trackId,r)}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const r=t[i];if((!this.selectDefaultTrack||r.default)&&(!e||e===r.name))return r.id}return-1}onError(e,t){!t.fatal&&t.context&&t.context.type===Ht&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.checkRetry(t)}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1;const t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,t)}loadPlaylist(e){super.loadPlaylist();const t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){const r=t.id,s=t.groupId;let n=t.url;if(e)try{n=e.addDirectives(n)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}this.log(`Loading subtitle playlist for id ${r}`),this.hls.trigger(te.SUBTITLE_TRACK_LOADING,{url:n,id:r,groupId:s,deliveryDirectives:e||null})}}toggleTrackModes(e){const{media:t,trackId:i}=this;if(!t)return;const r=zs(t.textTracks),s=r.filter((e=>e.groupId===this.groupId));if(-1===e)[].slice.call(r).forEach((e=>{e.mode="disabled"}));else{const e=s[i];e&&(e.mode="disabled")}const n=s[e];n&&(n.mode=this.subtitleDisplay?"showing":"hidden")}setSubtitleTrack(e,t){var i;const r=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(this.trackId!==e&&this.toggleTrackModes(e),this.trackId===e&&(-1===e||null!=(i=r[e])&&i.details)||e<-1||e>=r.length)return;this.clearTimer();const s=r[e];if(this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:"")),this.trackId=e,s){const{id:e,groupId:i="",name:r,type:n,url:a}=s;this.hls.trigger(te.SUBTITLE_TRACK_SWITCH,{id:e,groupId:i,name:r,type:n,url:a});const o=this.switchParams(s.url,null==t?void 0:t.details);this.loadPlaylist(o)}else this.hls.trigger(te.SUBTITLE_TRACK_SWITCH,{id:e})}onTextTracksChanged(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=-1;const t=zs(this.media.textTracks);for(let i=0;i<t.length;i++)if("hidden"===t[i].mode)e=i;else if("showing"===t[i].mode){e=i;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},timelineController:class{constructor(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){const e=new un(this,"textTrack1"),t=new un(this,"textTrack2"),i=new un(this,"textTrack3"),r=new un(this,"textTrack4");this.cea608Parser1=new dn(1,e,t),this.cea608Parser2=new dn(3,i,r)}e.on(te.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(te.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(te.MANIFEST_LOADING,this.onManifestLoading,this),e.on(te.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(te.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(te.FRAG_LOADING,this.onFragLoading,this),e.on(te.FRAG_LOADED,this.onFragLoaded,this),e.on(te.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(te.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(te.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(te.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(te.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(te.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(te.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(te.MANIFEST_LOADING,this.onManifestLoading,this),e.off(te.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(te.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(te.FRAG_LOADING,this.onFragLoading,this),e.off(te.FRAG_LOADED,this.onFragLoaded,this),e.off(te.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(te.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(te.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(te.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(te.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null}addCues(e,t,i,r,s){let n=!1;for(let c=s.length;c--;){const e=s[c],r=(a=e[0],o=e[1],l=t,d=i,Math.min(o,d)-Math.max(a,l));if(r>=0&&(e[0]=Math.min(e[0],t),e[1]=Math.max(e[1],i),n=!0,r/(i-t)>.5))return}var a,o,l,d;if(n||s.push([t,i]),this.config.renderTextTracksNatively){const s=this.captionsTracks[e];this.Cues.newCue(s,t,i,r)}else{const s=this.Cues.newCue(null,t,i,r);this.hls.trigger(te.CUES_PARSED,{type:"captions",cues:s,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:s}){const{unparsedVttFrags:n}=this;"main"===i&&(this.initPTS[t.cc]={baseTime:r,timescale:s}),n.length&&(this.unparsedVttFrags=[],n.forEach((e=>{this.onFragLoaded(te.FRAG_LOADED,e)})))}getExistingTrack(e){const{media:t}=this;if(t)for(let i=0;i<t.textTracks.length;i++){const r=t.textTracks[i];if(r[e])return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:i,media:r}=this,{label:s,languageCode:n}=t[e],a=this.getExistingTrack(e);if(a)i[e]=a,ei(i[e]),Xt(i[e],r);else{const t=this.createTextTrack("captions",s,n);t&&(t[e]=!0,i[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const i={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(te.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,i){const r=this.media;if(r)return r.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach((t=>{ei(e[t]),delete e[t]})),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let i=0;i<t.length;i++)ei(t[i])}onSubtitleTracksUpdated(e,t){const i=t.subtitleTracks||[],r=i.some((e=>e.textCodec===Rn));if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(Us(this.tracks,i))return void(this.tracks=i);if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const e=this.media?this.media.textTracks:null;this.tracks.forEach(((t,i)=>{let r;if(e&&i<e.length){let i=null;for(let r=0;r<e.length;r++)if(Un(e[r],t)){i=e[r];break}i&&(r=i)}if(r)ei(r);else{const e=this._captionsOrSubtitlesFromCharacteristics(t);r=this.createTextTrack(e,t.name,t.lang),r&&(r.mode="disabled")}r&&(r.groupId=t.groupId,this.textTracks.push(r))}))}else if(this.tracks.length){const e=this.tracks.map((e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e})));this.hls.trigger(te.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}_captionsOrSubtitlesFromCharacteristics(e){if(e.attrs.CHARACTERISTICS){const t=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),i=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(t&&i)return"captions"}return"subtitles"}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach((e=>{const t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;const i=`textTrack${t[1]}`,r=this.captionsProperties[i];r&&(r.label=e.name,e.lang&&(r.languageCode=e.lang),r.media=e)}))}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){const{cea608Parser1:i,cea608Parser2:r,lastSn:s,lastPartIndex:n}=this;if(this.enabled&&i&&r&&t.frag.type===Yt){var a,o;const e=t.frag.sn,l=null!=(a=null==t||null==(o=t.part)?void 0:o.index)?a:-1;e===s+1||e===s&&l===n+1||(i.reset(),r.reset()),this.lastSn=e,this.lastPartIndex=l}}onFragLoaded(e,t){const{frag:i,payload:r}=t,{initPTS:s,unparsedVttFrags:n}=this;if(i.type===Wt)if(r.byteLength){if(!s[i.cc])return n.push(t),void(s.length&&this.hls.trigger(te.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Missing initial subtitle PTS")}));const e=i.decryptdata,a="stats"in t;if(null==e||!e.encrypted||a){const e=this.tracks[i.level],t=this.vttCCs;t[i.cc]||(t[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),e&&e.textCodec===Rn?this._parseIMSC1(i,r):this._parseVTTs(i,r,t)}}else this.hls.trigger(te.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const i=this.hls;Cn(t,this.initPTS[e.cc],(t=>{this._appendCues(t,e.level),i.trigger(te.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(t=>{le.log(`Failed to parse IMSC1: ${t}`),i.trigger(te.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})}))}_parseVTTs(e,t,i){var r;const s=this.hls;In(null!=(r=e.initSegment)&&r.data?ht(e.initSegment.data,new Uint8Array(t)):t,this.initPTS[e.cc],i,e.cc,e.start,(t=>{this._appendCues(t,e.level),s.trigger(te.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(i=>{this._fallbackToIMSC1(e,t),le.log(`Failed to parse VTT cue: ${i}`),s.trigger(te.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})}))}_fallbackToIMSC1(e,t){const i=this.tracks[e.level];i.textCodec||Cn(t,this.initPTS[e.cc],(()=>{i.textCodec=Rn,this._parseIMSC1(e,t)}),(()=>{i.textCodec="wvtt"}))}_appendCues(e,t){const i=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[t];if(!i||"disabled"===i.mode)return;e.forEach((e=>Jt(i,e)))}else{const r=this.tracks[t];if(!r)return;const s=r.default?"default":"subtitles"+t;i.trigger(te.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:i}=t;if(i.type===Wt){if(!this.initPTS[i.cc])return void this.unparsedVttFrags.push(t);this.onFragLoaded(te.FRAG_LOADED,t)}}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){const{cea608Parser1:i,cea608Parser2:r}=this;if(!this.enabled||!i||!r)return;const{frag:s,samples:n}=t;if(s.type!==Yt||"NONE"!==this.closedCaptionsForLevel(s))for(let a=0;a<n.length;a++){const e=n[a].bytes;if(e){const t=this.extractCea608Data(e);i.addData(n[a].pts,t[0]),r.addData(n[a].pts,t[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:r,type:s}){const{media:n}=this;if(n&&!(n.currentTime<i)){if(!s||"video"===s){const{captionsTracks:e}=this;Object.keys(e).forEach((r=>ti(e[r],t,i)))}if(this.config.renderTextTracksNatively&&0===t&&void 0!==r){const{textTracks:e}=this;Object.keys(e).forEach((i=>ti(e[i],t,r)))}}}extractCea608Data(e){const t=[[],[]],i=31&e[0];let r=2;for(let s=0;s<i;s++){const i=e[r++],s=127&e[r++],n=127&e[r++];if(0===s&&0===n)continue;if(!!(4&i)){const e=3&i;0!==e&&1!==e||(t[e].push(s),t[e].push(n))}}return t}},audioStreamController:class extends Dr{constructor(e,t,i){super(e,t,i,"[audio-stream-controller]",Kt),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on(te.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(te.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(te.MANIFEST_LOADING,this.onManifestLoading,this),e.on(te.LEVEL_LOADED,this.onLevelLoaded,this),e.on(te.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(te.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(te.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(te.ERROR,this.onError,this),e.on(te.BUFFER_RESET,this.onBufferReset,this),e.on(te.BUFFER_CREATED,this.onBufferCreated,this),e.on(te.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(te.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(te.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(te.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(te.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(te.MANIFEST_LOADING,this.onManifestLoading,this),e.off(te.LEVEL_LOADED,this.onLevelLoaded,this),e.off(te.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(te.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(te.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(te.ERROR,this.onError,this),e.off(te.BUFFER_RESET,this.onBufferReset,this),e.off(te.BUFFER_CREATED,this.onBufferCreated,this),e.off(te.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(te.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(te.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:s}){if("main"===i){const e=t.cc;this.initPTS[t.cc]={baseTime:r,timescale:s},this.log(`InitPTS for cc: ${e} found from main: ${r}`),this.videoTrackCC=e,this.state===Ir&&this.tick()}}startLoad(e){if(!this.levels)return this.startPosition=e,void(this.state=yr);const t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),t>0&&-1===e?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=vr):(this.loadedmetadata=!1,this.state=Sr),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case vr:this.doTickIdle();break;case Sr:{var e;const{levels:t,trackId:i}=this,r=null==t||null==(e=t[i])?void 0:e.details;if(r){if(this.waitForCdnTuneIn(r))break;this.state=Ir}break}case br:{var t;const e=performance.now(),i=this.retryDate;(!i||e>=i||null!=(t=this.media)&&t.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=vr);break}case Ir:{const e=this.waitingData;if(e){const{frag:t,part:i,cache:r,complete:s}=e;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=Er;const e={frag:t,part:i,payload:r.flush(),networkDetails:null};this._handleFragmentLoadProgress(e),s&&super._handleFragmentLoadComplete(e)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${t.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const e=this.getLoadPosition(),i=nr.bufferInfo(this.mediaBuffer,e,this.config.maxBufferHole);ki(i.end,this.config.maxFragLookUpTolerance,t)<0&&(this.log(`Waiting fragment cc (${t.cc}) @ ${t.start} cancelled because another fragment at ${i.end} is needed`),this.clearWaitingFragment())}}else this.state=vr}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=vr)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:t,media:i,trackId:r}=this,s=e.config;if(null==t||!t[r])return;if(!i&&(this.startFragRequested||!s.startFragPrefetch))return;const n=t[r],a=n.details;if(!a||a.live&&this.levelLastLoaded!==r||this.waitForCdnTuneIn(a))return void(this.state=Sr);const o=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&o&&(this.bufferFlushed=!1,this.afterBufferFlushed(o,me,Kt));const l=this.getFwdBufferInfo(o,Kt);if(null===l)return;const{bufferedTrack:d,switchingTrack:c}=this;if(!c&&this._streamEnded(l,a))return e.trigger(te.BUFFER_EOS,{type:"audio"}),void(this.state=wr);const h=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,Yt),u=l.len,f=this.getMaxBufferLength(null==h?void 0:h.len);if(u>=f&&!c)return;const p=a.fragments[0].start;let m=l.end;if(c&&i){const e=this.getLoadPosition();d&&c.attrs!==d.attrs&&(m=e),a.PTSKnown&&e<p&&(l.end>p||l.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=p+.05)}let g=this.getNextFragment(m,a),y=!1;if(g&&this.isLoopLoading(g,m)&&(y=!!g.gap,g=this.getNextFragmentLoopLoading(g,a,l,Yt,f)),!g)return void(this.bufferFlushed=!0);const v=h&&g.start>h.end+a.targetduration;if(v||(null==h||!h.len)&&l.len){const e=this.getAppendedFrag(g.start,Yt);if(null===e)return;if(y||(y=!!e.gap||!!v&&0===h.len),v&&!y||y&&l.nextStart&&l.nextStart<e.end)return}this.loadFragment(g,n,m)}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map((e=>new mi(e)))}onAudioTrackSwitching(e,t){const i=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),i?this.setInterval(100):this.resetTransmuxer(),i?(this.switchingTrack=t,this.state=vr):(this.switchingTrack=null,this.bufferedTrack=t,this.state=yr),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(te.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var i;if(null==this.mainDetails)return void(this.cachedTrackLoadedData=t);const{levels:r}=this,{details:s,id:n}=t;if(!r)return void this.warn(`Audio tracks were reset while loading level ${n}`);this.log(`Track ${n} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const a=r[n];let o=0;if(s.live||null!=(i=a.details)&&i.live){const e=this.mainDetails;if(s.fragments[0]||(s.deltaUpdateFailed=!0),s.deltaUpdateFailed||!e)return;!a.details&&s.hasProgramDateTime&&e.hasProgramDateTime?(hr(s,e),o=s.fragments[0].start):o=this.alignPlaylists(s,a.details)}a.details=s,this.levelLastLoaded=n,this.startFragRequested||!this.mainDetails&&s.live||this.setStartPosition(a.details,o),this.state!==Sr||this.waitForCdnTuneIn(s)||(this.state=vr),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:i,part:r,payload:s}=e,{config:n,trackId:a,levels:o}=this;if(!o)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);const l=o[a];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const d=l.details;if(!d)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(i.start);const c=n.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new Ms(this.hls,Kt,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const u=this.initPTS[i.cc],f=null==(t=i.initSegment)?void 0:t.data;if(void 0!==u){const e=!1,t=r?r.index:-1,n=-1!==t,a=new ar(i.level,i.sn,i.stats.chunkCount,s.byteLength,t,n);h.push(s,f,c,"",i,r,d.totalduration,e,a,u)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${d.startSN} ,${d.endSN}],track ${a}`);const{cache:e}=this.waitingData=this.waitingData||{frag:i,part:r,cache:new Bs,complete:!1};e.push(new Uint8Array(s)),this.waitingVideoCC=this.videoTrackCC,this.state=Ir}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){const i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){const{frag:i,part:r}=t;if(i.type===Kt)if(this.fragContextChanged(i))this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if("initSegment"!==i.sn){this.fragPrevious=i;const e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(te.AUDIO_TRACK_SWITCHED,Z({},e)))}this.fragBufferedComplete(i,r)}else if(!this.loadedmetadata&&i.type===Yt){const e=this.videoBuffer||this.media;if(e){nr.getBuffered(e).length&&(this.loadedmetadata=!0)}}}onError(e,t){var i;if(t.fatal)this.state=Lr;else switch(t.details){case re.FRAG_GAP:case re.FRAG_PARSING_ERROR:case re.FRAG_DECRYPT_ERROR:case re.FRAG_LOAD_ERROR:case re.FRAG_LOAD_TIMEOUT:case re.KEY_LOAD_ERROR:case re.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Kt,t);break;case re.AUDIO_TRACK_LOAD_ERROR:case re.AUDIO_TRACK_LOAD_TIMEOUT:case re.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Sr||(null==(i=t.context)?void 0:i.type)!==$t||(this.state=vr);break;case re.BUFFER_FULL_ERROR:if(!t.parent||"audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case re.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushed(e,{type:t}){t===me&&(this.bufferFlushed=!0,this.state===wr&&(this.state=vr))}_handleTransmuxComplete(e){var t;const i="audio",{hls:r}=this,{remuxResult:s,chunkMeta:n}=e,a=this.getCurrentContext(n);if(!a)return void this.resetWhenMissingContext(n);const{frag:o,part:l,level:d}=a,{details:c}=d,{audio:h,text:u,id3:f,initSegment:p}=s;if(!this.fragContextChanged(o)&&c){if(this.state=Tr,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),null!=p&&p.tracks){const e=o.initSegment||o;this._bufferInitSegment(p.tracks,e,n),r.trigger(te.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:i,tracks:p.tracks})}if(h){const{startPTS:e,endPTS:t,startDTS:i,endDTS:r}=h;l&&(l.elementaryStreams[me]={startPTS:e,endPTS:t,startDTS:i,endDTS:r}),o.setElementaryStreamInfo(me,e,t,i,r),this.bufferFragmentData(h,o,l,n)}if(null!=f&&null!=(t=f.samples)&&t.length){const e=J({id:i,frag:o,details:c},f);r.trigger(te.FRAG_PARSING_METADATA,e)}if(u){const e=J({id:i,frag:o,details:c},u);r.trigger(te.FRAG_PARSING_USERDATA,e)}}else this.fragmentTracker.removeFragment(o)}_bufferInitSegment(e,t,i){if(this.state!==Tr)return;e.video&&delete e.video;const r=e.audio;if(!r)return;r.levelCodec=r.codec,r.id="audio",this.log(`Init audio buffer, container:${r.container}, codecs[parsed]=[${r.codec}]`),this.hls.trigger(te.BUFFER_CODECS,e);const s=r.initSegment;if(null!=s&&s.byteLength){const e={type:"audio",frag:t,part:null,chunkMeta:i,parent:t.type,data:s};this.hls.trigger(te.BUFFER_APPENDING,e)}this.tick()}loadFragment(e,t,i){const r=this.fragmentTracker.getState(e);var s;(this.fragCurrent=e,this.switchingTrack||r===$i||r===Yi)?"initSegment"===e.sn?this._loadInitSegment(e,t):null!=(s=t.details)&&s.live&&!this.initPTS[e.cc]?(this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=Ir):(this.startFragRequested=!0,super.loadFragment(e,t,i)):this.clearTrackerIfNeeded(e)}completeAudioSwitch(e){const{hls:t,media:i,bufferedTrack:r}=this,s=null==r?void 0:r.attrs,n=e.attrs;i&&s&&(s.CHANNELS!==n.CHANNELS||s.NAME!==n.NAME||s.LANGUAGE!==n.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(te.AUDIO_TRACK_SWITCHED,Z({},e))}},audioTrackController:class extends Ui{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(te.MANIFEST_LOADING,this.onManifestLoading,this),e.on(te.MANIFEST_PARSED,this.onManifestParsed,this),e.on(te.LEVEL_LOADING,this.onLevelLoading,this),e.on(te.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(te.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(te.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(te.MANIFEST_LOADING,this.onManifestLoading,this),e.off(te.MANIFEST_PARSED,this.onManifestParsed,this),e.off(te.LEVEL_LOADING,this.onLevelLoading,this),e.off(te.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(te.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(te.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:i,groupId:r,details:s}=t,n=this.tracksInGroup[i];if(!n||n.groupId!==r)return void this.warn(`Track with id:${i} and group:${r} not found in active group ${n.groupId}`);const a=n.details;n.details=t.details,this.log(`audio-track ${i} "${n.name}" lang:${n.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(null==t||!t.audioGroupIds)return;const i=t.audioGroupIds[t.urlId];if(this.groupId!==i){this.groupId=i||null;const e=this.tracks.filter((e=>!i||e.groupId===i));this.selectDefaultTrack&&!e.some((e=>e.default))&&(this.selectDefaultTrack=!1),this.tracksInGroup=e;const t={audioTracks:e};this.log(`Updating audio tracks, ${e.length} track(s) found in group:${i}`),this.hls.trigger(te.AUDIO_TRACKS_UPDATED,t),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}onError(e,t){!t.fatal&&t.context&&t.context.type===$t&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(t))}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn("Invalid id passed to audio-track controller");this.clearTimer();const i=this.currentTrack;t[this.trackId];const r=t[e],{groupId:s,name:n}=r;if(this.log(`Switching to audio-track ${e} "${n}" lang:${r.lang} group:${s}`),this.trackId=e,this.currentTrack=r,this.selectDefaultTrack=!1,this.hls.trigger(te.AUDIO_TRACK_SWITCHING,Z({},r)),r.details&&!r.details.live)return;const a=this.switchParams(r.url,null==i?void 0:i.details);this.loadPlaylist(a)}selectInitialTrack(){const e=this.tracksInGroup,t=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(-1!==t)this.setAudioTrack(t);else{const t=new Error(`No track found for running audio group-ID: ${this.groupId} track count: ${e.length}`);this.warn(t.message),this.hls.trigger(te.ERROR,{type:ie.MEDIA_ERROR,details:re.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const r=t[i];if(!this.selectDefaultTrack||r.default){if(!e||void 0!==e.attrs["STABLE-RENDITION-ID"]&&e.attrs["STABLE-RENDITION-ID"]===r.attrs["STABLE-RENDITION-ID"])return r.id;if(e.name===r.name&&e.lang===r.lang)return r.id}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){const r=t.id,s=t.groupId;let n=t.url;if(e)try{n=e.addDirectives(n)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}this.log(`loading audio-track playlist ${r} "${t.name}" lang:${t.lang} group:${s}`),this.clearTimer(),this.hls.trigger(te.AUDIO_TRACK_LOADING,{url:n,id:r,groupId:s,deliveryDirectives:e||null})}}},emeController:zn,cmcdController:Qn,contentSteeringController:class{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=le.log.bind(le,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(te.MANIFEST_LOADING,this.onManifestLoading,this),e.on(te.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(te.MANIFEST_PARSED,this.onManifestParsed,this),e.on(te.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(te.MANIFEST_LOADING,this.onManifestLoading,this),e.off(te.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(te.MANIFEST_PARSED,this.onManifestParsed,this),e.off(te.ERROR,this.onError,this))}startLoad(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){const e=Math.max(1e3*this.timeToLoad-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,e)}else this.loadSteeringManifest(this.uri)}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter((t=>t!==e)))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:i}=t;null!==i&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:i}=t;if((null==i?void 0:i.action)===Mi&&i.flags===Ni){let e=this.pathwayPriority;const t=this.pathwayId;this.penalizedPathways[t]||(this.penalizedPathways[t]=performance.now()),!e&&this.levels&&(e=this.levels.reduce(((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e)),[])),e&&e.length>1&&(this.updatePathwayPriority(e),i.resolved=this.pathwayId!==t)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length?(this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t):e}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter((t=>e===t.pathwayId))}updatePathwayPriority(e){let t;this.pathwayPriority=e;const i=this.penalizedPathways,r=performance.now();Object.keys(i).forEach((e=>{r-i[e]>3e5&&delete i[e]}));for(let s=0;s<e.length;s++){const r=e[s];if(i[r])continue;if(r===this.pathwayId)return;const n=this.hls.nextLoadLevel,a=this.hls.levels[n];if(t=this.getLevelsForPathway(r),t.length>0){this.log(`Setting Pathway to "${r}"`),this.pathwayId=r,this.hls.trigger(te.LEVELS_UPDATED,{levels:t});const e=this.hls.levels[n];a&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==a.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==a.bitrate&&this.log(`Unstable Pathways change from bitrate ${a.bitrate} to ${e.bitrate}`),this.hls.nextLoadLevel=n);break}}}clonePathways(e){const t=this.levels;if(!t)return;const i={},r={};e.forEach((e=>{const{ID:s,"BASE-ID":n,"URI-REPLACEMENT":a}=e;if(t.some((e=>e.pathwayId===s)))return;const o=this.getLevelsForPathway(n).map((e=>{const t=J({},e);t.details=void 0,t.url=Xn(e.uri,e.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",a);const n=new he(e.attrs);n["PATHWAY-ID"]=s;const o=n.AUDIO&&`${n.AUDIO}_clone_${s}`,l=n.SUBTITLES&&`${n.SUBTITLES}_clone_${s}`;o&&(i[n.AUDIO]=o,n.AUDIO=o),l&&(r[n.SUBTITLES]=l,n.SUBTITLES=l),t.attrs=n;const d=new mi(t);return zi(d,"audio",o),zi(d,"text",l),d}));t.push(...o),Zn(this.audioTracks,i,a,s),Zn(this.subtitleTracks,r,a,s)}))}loadSteeringManifest(e){const t=this.hls.config,i=t.loader;let r;this.loader&&this.loader.destroy(),this.loader=new i(t);try{r=new self.URL(e)}catch(d){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${e}`)}if("data:"!==r.protocol){const e=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+e)}const s={responseType:"json",url:r.href},n=t.steeringManifestLoadPolicy.default,a=n.errorRetry||n.timeoutRetry||{},o={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(e,t,i,s)=>{this.log(`Loaded steering manifest: "${r}"`);const n=e.data;if(1!==n.VERSION)return void this.log(`Steering VERSION ${n.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=n.TTL;const{"RELOAD-URI":a,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":l}=n;if(a)try{this.uri=new self.URL(a,r).href}catch(d){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${a}`)}this.scheduleRefresh(this.uri||i.url),o&&this.clonePathways(o),l&&this.updatePathwayPriority(l)},onError:(e,t,i,r)=>{if(this.log(`Error loading steering manifest: ${e.code} ${e.text} (${t.url})`),this.stopLoad(),410===e.code)return this.enabled=!1,void this.log(`Steering manifest ${t.url} no longer available`);let s=1e3*this.timeToLoad;if(429!==e.code)this.scheduleRefresh(this.uri||t.url,s);else{const e=this.loader;if("function"==typeof(null==e?void 0:e.getResponseHeader)){const t=e.getResponseHeader("Retry-After");t&&(s=1e3*parseFloat(t))}this.log(`Steering manifest ${t.url} rate limited`)}},onTimeout:(e,t,i)=>{this.log(`Timeout loading steering manifest (${t.url})`),this.scheduleRefresh(this.uri||t.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(s,o,l)}scheduleRefresh(e,t=1e3*this.timeToLoad){self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout((()=>{this.loadSteeringManifest(e)}),t)}}});function la(e){return e&&"object"==typeof e?Array.isArray(e)?e.map(la):Object.keys(e).reduce(((t,i)=>(t[i]=la(e[i]),t)),{}):e}function da(e){const t=e.loader;if(t!==ia&&t!==ea)le.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{(function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1})()&&(e.loader=ia,e.progressive=!0,e.enableSoftwareAES=!0,le.log("[config]: Progressive streaming enabled, using FetchLoader"))}}class ca{static get version(){return"1.4.4"}static isSupported(){return function(){const e=wt();if(!e)return!1;const t=kr(),i=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!i&&!!r}()}static get Events(){return te}static get ErrorTypes(){return ie}static get ErrorDetails(){return re}static get DefaultConfig(){return ca.defaultConfig?ca.defaultConfig:oa}static set DefaultConfig(e){ca.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new xs,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,function(e,t){if(self.console&&!0===e||"object"==typeof e){oe(e,"debug","log","info","warn","error");try{ae.log(`Debug logs enabled for "${t}" in hls.js version 1.4.4`)}catch(i){ae=ne}}else ae=ne}(e.debug||!1,"Hls instance");const t=this.config=function(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=la(e),r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach((e=>{const s=`${"level"===e?"playlist":e}LoadPolicy`,n=void 0===t[s],a=[];r.forEach((r=>{const o=`${e}Loading${r}`,l=t[o];if(void 0!==l&&n){a.push(o);const e=i[s].default;switch(t[s]={default:e},r){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}})),a.length&&le.warn(`hls.js config: "${a.join('", "')}" setting(s) are deprecated, use "${s}": ${JSON.stringify(t[s])}`)})),Z(Z({},i),t)}(ca.DefaultConfig,e);this.userConfig=e,this._autoLevelCapping=-1,t.progressive&&da(t);const{abrController:i,bufferController:r,capLevelController:s,errorController:n,fpsController:a}=t,o=new n(this),l=this.abrController=new i(this),d=this.bufferController=new r(this),c=this.capLevelController=new s(this),h=new a(this),u=new Zt(this),f=new li(this),p=t.contentSteeringController,m=p?new p(this):null,g=this.levelController=new Gi(this,m),y=new Wi(this),v=new ir(this.config),_=this.streamController=new Os(this,y,v);c.setStreamController(_),h.setStreamController(_);const E=[u,g,_];m&&E.splice(1,0,m),this.networkControllers=E;const b=[l,d,c,h,f,y];this.audioTrackController=this.createController(t.audioTrackController,E);const S=t.audioStreamController;S&&E.push(new S(this,y,v)),this.subtitleTrackController=this.createController(t.subtitleTrackController,E);const T=t.subtitleStreamController;T&&E.push(new T(this,y,v)),this.createController(t.timelineController,b),v.emeController=this.emeController=this.createController(t.emeController,b),this.cmcdController=this.createController(t.cmcdController,b),this.latencyController=this.createController(di,b),this.coreComponents=b,E.push(o);const A=o.onErrorOut;"function"==typeof A&&this.on(te.ERROR,A,o)}createController(e,t){if(e){const i=new e(this);return t&&t.push(i),i}return null}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,r){this._emitter.off(e,t,i,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,i){return this._emitter.emit(e,t,i)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(i){le.error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),this.trigger(te.ERROR,{type:ie.OTHER_ERROR,details:re.INTERNAL_EXCEPTION,fatal:!1,event:e,error:i})}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){le.log("destroy"),this.trigger(te.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((e=>e.destroy())),this.networkControllers.length=0,this.coreComponents.forEach((e=>e.destroy())),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){le.log("attachMedia"),this._media=e,this.trigger(te.MEDIA_ATTACHING,{media:e})}detachMedia(){le.log("detachMedia"),this.trigger(te.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();const t=this.media,i=this.url,r=this.url=q.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});le.log(`loadSource:${r}`),t&&i&&(i!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(te.MANIFEST_LOADING,{url:e})}startLoad(e=-1){le.log(`startLoad(${e})`),this.networkControllers.forEach((t=>{t.startLoad(e)}))}stopLoad(){le.log("stopLoad"),this.networkControllers.forEach((e=>{e.stopLoad()}))}swapAudioCodec(){le.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){le.log("recoverMediaError");const e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e,t=0){this.levelController.removeLevel(e,t)}get levels(){const e=this.levelController.levels;return e||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){le.log(`set currentLevel:${e}`),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){le.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){le.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){le.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){return this.levelController.startLevel}set startLevel(e){le.log(`set startLevel:${e}`),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(le.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e)}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){ci.indexOf(e)>-1&&(this._maxHdcpLevel=e)}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const i=e.length;for(let r=0;r<i;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:i}=this;let r;if(r=-1===t&&e&&e.length?e.length-1:t,i)for(let s=r;s--;){const t=e[s].attrs["HDCP-LEVEL"];if(t&&t<=i)return s}return r}get nextAutoLevel(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)}set nextAutoLevel(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}ca.defaultConfig=void 0;const ha=e=>(_("data-v-37e3f9e9"),e=e(),E(),e),ua=ha((()=>o("div",{class:"artplayer-app"},null,-1))),fa={key:0,class:"zfile-video-switch-tools"},pa=ha((()=>o("img",{src:"/assets/video-download-DSRxd9O5.png",alt:"下载"},null,-1))),ma=ha((()=>o("img",{src:"/assets/video-thunder-B-AgczIg.png",alt:"迅雷"},null,-1))),ga=ha((()=>o("img",{src:"/assets/video-motrix-gUmFYsB9.png",alt:"motrix"},null,-1))),ya=ha((()=>o("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAOeUlEQVR4Xu3dy5EjuRWF4TMGyA550ibIgPZirJjFODIeaDVOaDMvSREKRdRKGy0UVF1mZTV5yGS+ACSA/G/EV1F1p7unu4pA4nEB6nK5fIeG/UN/vvyuL5df9fXyi75///zHq9/00+UP/fye+9vVr3q7cZnw7deMvy/+jPiz4s+MPz/+PyH+v//Wnx7+PmiKPIEKRUMbG/nYuIdG7Q34GPF3GTuJ4e/4hc6hDfIEDjY29njaRqN6/cSu29gxDCMTOoUKyRMoLIbS8dSs7ameS/wbx5FC/Nv9+4Gi5AlkNj7hhzl1/w1+ztghMEI4hDyBDOJJF8PgWFDzBoB745SB0UER8gQSGRs9T/nthl0MOoOM5AnswJM+n7EzYJqQlDyBDWL+OqzYP75wkd6w5fjl4eeA1eQJLDQU4MRqdrvbdK0bipWYIuwgT2AGT/s6xc+EjmA1eQITYt+auX394mfE9GAxeQI3YsGJlfw2DT+zrywaviZP4MNw8IX5fevoCF6SJ04tXiTDqTqe+L0ZOwL/mZ+cPHFaNPxzGEqPWSP4IE+cTrwYWNw7H3YNruSJ0/i2j//44sB5xGvgxOsD8sQpsMCHe/FaOOX6gDzRNYb7eCVeGyebFsgTXRrO4DPcxzIxQvTXUKfkie4M12uxuo91TrJbIE90g6c+Uuh8NCBPdGE4l89TH2l0vDYgTzRvuLf+8YcI7NfdToE80awY8nNMF7nFa6yjugF5okkM+VFSvNY6mRLIE81hyI9jdFE8JE80g1V+1CBeg/7abIg80YRo/FT0oRYNrwvIE9Vjvo8aNbouIE9UbXiHXA7xoFZvrXUC8kS1WOxDG95aKiGWJ6pE40d7mtghkCeqM5zd928uUL8GzhHIE1Vhmw+tq7wTkCeqQeNHLyruBOSJKtD40ZtKC4bkicPR+NGrCkcC8sShaPzoXWWdgDxxGFb7cRYVdQLyxCHY58f5VFEnIE8UN5T3+jcH6F8FFYPyRFHU9uPcDi8blieKiUMTNH7g0ANE8kQRcXaaI73AINrCQfcJyBNFcJkHcC8uFfF2UoA8kR17/cBzB2wPyhNZsd0HvFZ4UVCeyIZFP2CJoouC8kQWLPoByxVcFJQnsuAde4B1Ci0KyhPJMe8HtspeLixPJDXM+/0fBWCZ7OsB8kQyzPuB/aJmxttWQvJEMuz3A2lkrA+QJ5LghB+QVqapgDyRBEN/IK1oU97OEpAnduNmHyCPDFMBeWIXVv2BvBJPBeSJXTjlB+SVeFdAntiMgh+glGQFQvLEJrHnz0EfoJS3VGcF5IlN2PMHykr0TkPyxGos/AHHSLAgKE+sxsIfcIwEC4LyxCpU/AHH2nmDkDyxChV/wLF2VgjKE4ux7QfUYvO2oDyxGE9/oA47rhCTJxbh6b/Pv969/WXw9yf/HVhv0yhAnpjFRR/7/Pevl4f4zw90BNhn4yhAnpjF03+7eOJPxf/+Ofx3/z3AcqtHAfLELJ7+2z17+nvEr2E0gC027AjIEy+x77/Pmohpgf9+YN6qUYA88RJVf/usjZgWxIKh/znAlJXVgfLEJJ7++20NpgVYY0V1oDwxiXf32W9vsEiIJVa8q5A88RQn/tJIEUwLsMTCk4LyxFNc9JlGyqB2AK8svEBUnniK237SSB3UDmDa28Xb8RPyxAMW/9LJFbFIyLQAbsFioDzxgMW/dHIHtQO4tWAxUJ64M1z2+fgHY5sSwbQAt2bOB8gTd1j8S6tkUDuAMLMYKE/cofIvrSOC0cC5zVQGyhOf2PtP76igduDcXtQEyBOfGP6nd3RQO3BOL6YB8sQnhv/p1RJMC87lxTRAnrhi+J9HTUHtwLlMTAPkiSuG/3nUGNQOnMPENECeuKL4J49ag9qB/k0UBckTFP9kVHtQO9C3J0VB8gS1/xm1EkwL+vTkbIA8wVt9Z9RSUDvQnydvKS5PcOtvRi0G04J+PLk1WHcJtv/yajVYJOyHbQfq9osLb/qRV+tB7UAP7q4N1+0XzP8z6yUoKW6XrQPo9gvKfzPrKZgWtMnKgvX5Bfv/+fUYLBK256YeQOMn7P8X0HNQO9COm3oAjZ9Q/19A70HtQBtuzgVo/IT6/wLOEkwL6nZzLkDjJxQAFXC2YJGwTjcFQbp+wgJgGWcMpgV1+lgIVHygArCQMwe1A3X5WAhUfLhQAVjG2YPagZpcKwIVH6gALIQYgkXC431UBCo+sANQCHEf1A4c52MnQPGBEuBCiMdgkfAYHzsBig8X3v67DGI6mBaUd+0A2AIsh5gPFgnLeW/7YguwIGJZMC0o43d9EYeACiLWBbUDeV07AGoAyiHWB7UD+fyi78UpwIKI7cEiYXrXDoAioHKI/UHtQDrvbZ8OoCQiTbBImMZv+klUARZEpA2mBfv8oZ9FFWBBRJ5gkXCbawfARSDlEPmCacF6722fDqAkIn9QO7DGW9QBcA6gFKJMUDuw1LUD8CRyIcoGb2U2iw6gJOKYoHZgEh1AScRxEaMB/3mADqAo4thgXeABHUBJxLERi4P+Mzk5OoCSiOPDfyYnRwdQEnFssA7wgA6gJOLYYEvwAYVAJRHHBQuAz1AJWBRRPjgx+MobZwFKIsoF5cDzroeBOA5cDlEmOBC0zLUD4EKQcoi8Qe3/Otf7AOgAyiHyBMP9ba5XgnEnYDlE+mC4v931UlCuBS+HSBfcALTftQPgjUHKIdIEw/00Pt4XgLcGK4XYF+zpp/aVNwctidgWDPfzuL43IG8PXg6xPhju5/P+8H//ePnuQjlwGcTyYLif33vbj4/fUQ5cCDEfDPfLiDb/2QFQDFQG8Tq4vLOcaPOfHQDFQGUQz4PhfnnR5j87AGoByiDugxLeI3293IwAqAUogfgWDPePFW3+swNgK7AMguF+LaLNf3YA7ASUceZguF+Tt8tHu9f4CTsBBZw1OLFXl48dgKDxE04FFnC24IKOOkVbf+gAWAjM7yzBcL9uHwuAQeMnLAQWcIZguF+/jwXAoPGTKxYC8+o5GO634aMEeKTbL6gIzKzHYLjflo8KwJFuv7hQEZhXb8Fwv0XXCsCRbr/gcpDMeglO7LUr2vhkBxBYB8inh2C43y6b/wd5gnWAjFoOSnjbZ/P/IE9QD5BRi8Fwvx83+/8jeYJ6gIxaC4b7fbnZ/x/JE1e8YWgerQTD/f5Em/Z2PtkBcC4gj9qD4X6/bur/b8kTV2wH5lFzcEFH32z7byRPfGI7ML0ag+F+/55s/43kiU9MA9KrKSjhPY+J4X+QJz4xDUivlmC4fy4Tw/8gT9xhGpDW0cFw/3xeDP+DPHGHaUBaRwXD/fN6MfwP8sQdpgFpHRGc2Du3F8P/IE884LLQdEoGF3Tg5vLPKfLEA84GpFMiGO5j9KT238kTD4azAbx9eAq5g+E+vvm8+/8VeeIpjginkSsY7sM9Ofr7jDzxFIuBaaQOhvuYMrP4N5InJrEYuF/KYLiPKQsW/0byxCQWA/dLEZzYw5wFi38jeeIl7gnYZ28w3Mecmco/J0+8xLXh+2wNSnix3N2133PkiZdiS5DzAdutDYb7WCPa5pNrv16RJ2ZxPmC7NcFwH2vN1P0/I0/MojBouxjKzwXDfWzztvbpH+SJRRgFbBNP9alguI89Njz9gzyxCKOA7WL/3oPhPvbZ9PQP8sRi7AhsF0P8aPQ88ZHGqpX/W/LEYuwIAMfbsPJ/S55YhVEAcLTNT/8gT6xGdSBwjIl3+1lDnliNMwLAMVbU/E+RJzbhpCBQ1ooTf6/IE5sM9wWwLQiU8bb0vP8ceWIzioOAMjYW/TwjT2zGtiCQ38rjvnPkiV1YEATySrDwd0ue2I0LRIE8Fl70uYY8sRtTASC9nRV/U+SJJJgKAGklHvqP5IlkmAoAaWQY+o/kiWSYCgD7ZRr6j+SJpJgKAPskKviZIk8kR4EQsE3Cgp8p8kQWnBgE1klU6z9HnsiC9QBguczz/lvyRDasBwBLJDvos4Q8kRU3CAFzdt3ws5Y8kR31AcBzGff7p8gT2cXchkVB4F6C6722kCeKYFEQ+Kbgop+TJ4qIfyy3CAGh6KKfkyeKYmcA5/aW65DPUvJEcewM4KwObvxBnjgE5cI4n6LbfVPkicOwPYizKFDjv5Q8cSg6AfTugL3+V+SJw9EJoFeVNf4gT1SBdxpCbyps/EGeqAYjAfSi0sYf5Imq0AmgdRU3/iBPVIdOAK2qaLV/ijxRJeoE0J4q9vnnyBPVomIQbTi8vHcNeaJqw9kBDhChVoce7NlCnqhefIM5SozaxGuyscYf5IkmcKkIahJ1Kwed599LnmhGfMPZIcDRKt/mmyNPNIfFQRyjqcW+KfJEk1gXQEmNzvefkSeaFVMCzhAgt4bn+8/IE82jaAh5xPZzE8U9a8gTXWBKgJRix6mTIb+TJ7rBLgFSaKCefw95ojuxUstoAGvFa6aDVf458kSXGA1gjXjqd7TQ94o80TXWBvBKx3P9KfLEKQw7BRwqwqjLFf4l5InTYFqAEK+Bkwz3n5EnTmP8oceQj4NF5xMFPScb7j8jT5xWDAFZH+jfSVb3l5InTi1GBcPhItYHejN07qec578iT+AydAQsFPaBhv+SPAETHQFTg/bQ8BeRJzCBNYI2xIIuc/zF5AnMiBcXx47rw6r+JvIEFhqqClknOFKMyE5UtpuDPIENGBWU9Hb9XjPMT0KewA7jqIDCovSG7+lXnvZpyRNIZOwMWDjcLhp9fA+Z22cjTyADRgZLDcP7eNLT6IuQJ5DZcAjpy/UQCqODsTT3x+v3hOF9cfIECosnXTzxztIhDPv0NPhKyBM42DhCiClDDIdb7hTi7z78G76nwddJnkCFouHcjhSiUQ3rCTXUILxd/y5jQx/n7zT2JsgTaMzYOQxvnR7lyvG0jSH2t45iKJiJkUR0GKPHhjwaf/3YsIfpSexoDA08/l808i78HzPcPJXn8KhQAAAAAElFTkSuQmCC",alt:"PotPlayer"},null,-1))),va=ha((()=>o("img",{src:"/assets/video-iina-Dbd-ofBP.png",alt:"IINA"},null,-1))),_a=ha((()=>o("img",{src:"/assets/video-vlc-BAv5hqOe.png",alt:"VLC"},null,-1))),Ea=ha((()=>o("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAK2UlEQVR4Xu2dC3BUZxXHD4g4VlukLRTEIKhYochjeBRaCoggpQaqBSrQWFuCwLbFDpRhQIs4Y8YRO1Lr4JSWJkCJVihgy0PerxapUhqaQrCFIkUghM1rs7sJVCYcz3d3v+Tuud+9e/dFdpPvP/OfwAzs3j0//v9zv2x2ANDS0tLS0tLS0tLS0tLS0tLS0tJqEHrhi1gJM+jrOqyAf2A5vEFeSr8exP+sVopFg59C9pJR6UrYRu7F/55WCkQJWGABoPY1Ss9K+tqZP4ZWkkQwRtGAryuG7+QAgfmFqDj+eFoJiob7nmLgbl1KNTYdEVrzx9WKQ1gFvRVDjt2VcIx8P398rRhFdfWoZbiJ2AvbCcxd/Hm0XIqAeCxDTdz19Lj5qBd/7EoREOkApWWJXvwxKMVADFdXQmkRLX7Qiz+6UgHkagXgyWrAzTWAvw0APh1s8Im5Qb34HZUMINfJ5yoBd/sAl/sB5zYCUHpOELaT+/Jr0YL4gVwmAIcpBQUEYKFi6C5cPy8I+TNr9eKPkFsgAQLwPgFYTzX0K+tw43ctBH4WgLwlevGHZAfkGu2BjwjAVgLwXOQeSJrnRLqU4OSORGjDr7FFSQIRe+A8pWAfQXiRaugZxQCTaQajwU8FoeSJlrz4j1SBZw2lYJFiaKk0BxGGYZiA4Owg7JpdC/359TZ7zQuAhw8rleYQzCBMMKTr6ff5U2rhy/y6m61uJBAnEAoYODPsWQGom9FSFv+NAhIPDAKBPyXnkh8nT/dD6fQAzG7Wiz/VQDgIFQwzCDMMAULCkP4xOccPJVOb6+JPJRAOgsPgqZAwZCrMMH4ShvEIeSr5R+TJftg3obkt/lQA4RDcwFBVlDkVAoSwAYI8iW7Nf0B3hxNqoH68Dwqyq6Arf20ZqWQC4QDcgrCDoUrFw/5GGNnkB8hjyCN8UDe8BvImZ/riTxYQDoGDsNsV5oqyS4WAIVPxkN9IhQFiLHmUgEG+hzzEBwjVUAYXBzwB+5dk5uJPFAiHoAJhB0O1uM2pUFWUTIWAIUAMEhAudUU4PQeheBfCOz6Ew36EQ/4SeNufzV9v2iteIByCHQwVCGEOQqbCXFEShLBIhYAhQEA5+VwOQsk6hCNlCP8MEogAgRAmGG+HfZD8ln8/HKzOnMWfTCBOu8IpFbyieCp6VxKAiw8ifLQC4djHCO8SgH+F3QDD3whDgBDeXxPy3pp62Fv9KuyuS//FHw8QDiIWGHxfqCpqXLWoodEI/1mKcPwownvBEAThIyYYAoSEYU7FwTCIfQYMhN1UY7vIO6vrYIcvD/5eeQufQ9ooViDxgHBa3MJTKAntL/emGlqEcHIvpYCGVxQMgVDBcKqoAyYYe3xmGAjbydsMl8OW6sf5LNJCsQCxA+EEwy4VA6taIVzw0DLeRMvYSxDqCIJwbSOIoyYQFhh+sbitFSVTIWBIEDsEDF8Ixpaw36xCeKPqZUBsxWfSpHIDxCkV0hyEeV8ICA+Ku6GL06iGChBOnCEINPz360IgGmC4SIWqosyp2OuLhCFSIZMhQGw2QCBsqgz5b1WL+EyaVNGAcBgcCE+GhDGNauhm71iET36P8CHtgeJgCIJ0BIjaRhgyFSoY5oqyLm5TRclUmEA0pCIMYiN5A/n1iquwtjZ93te3A8IhcBAcxgzy3RX9qIZ+iXCK9sBxGswHtZEQLKkQIEwVxUEYMEypiKgotridKmpzdSgVEoYBgrxOuBzhLxUL+FyaTBwIh6ACISsqu0rcDT1FNbSRaqgsBECagzDD4KlQwVClQsKQqZAVpV7c1lREwKhA+KuAIVy5jc+lySSBcAgqGI/QmaBVGR3IzuVTDZ0mCDTYD65EglDBsOwKxeK2gxHv4hapUFXUegajkPzn8nf5XJpMAgiHIEGIu6O+5fcjnF9GNUR74EQwBEH4eIww3KTC6WzBFzdPRcTiDleUJRXhinpNwqC7u7XkV737+FyaTHNMQASEMVV0HihdjHBmD0KJrxGA2W5ACMebCleL2xe5uLc6VJQqFRLGGgPI83wuTaaJPvAYe+CTDQj/LrUO3+xYU6GCwUHEe7YwUuGwuEVFOaVCwlgtvl4eyufSdDp51WMZvMoGiBhg8IqKNRXRKsq8uI2zBUuFZXFHVFQIhHDBpfRZ6IbcAHEDIu6K8lthSBDy2x92i5tXVMPZIkpFGSDIq8pOQUGgAx9J08oJiNuKkiAaYIRBqCrK6cTNzxY8FU6L21xRAgSvKJEKM4z8SzvgT95OfBxNLzsgqoriIOJOhaKilItbpsIEgqfCrqJUqRBeVVYKr5RN42NIH6mAcBDxwrA7catguF3cvKKUi7vcurgLvNdglfcP8MfT6futd0MSiKgntxVlt7hVFSXPFqoTd6oXt4SRX3YI8i9nyAeEJJBYQDilQllRNqmwragYFrdTKlZ7vbQrHku7b7E7SgBJFAYHwSvKdnErUqFa3KqKclrcKz6sh8cWvzhs2LD2/OWmv4oFEAcQsVaUanFLGDIVzu/mWVMRraJWX0CY9xL2HTsa87vdcQQBBvKXmTkqDjQCsQOhSkXK381jqTC+/WFKRd4W7PDQw/jz/t3xU6BSAqC/BLPIGf7RawGEg7CkQjjOVERb3KqKsqSC/NIxhNz5mDNiIJ6F1gKA9HVyAfl2/tIyU8W1ViDRUhENhtPibkiFCYQqFYXnEBa+gNnjx+CBrDvMAMwmSnAPf0mZLQ7EDgYHwRe307t5blKxkXbB0k1497SpuGbAN/nguenB4GlyZv64qKMkEA4iGRUVbXGvPIRZT87F34wZhFegLR+6yqKeCsnp8x540iWAcBiuKoqnIlxRTot73SmEZ5ehZ9I4PNPtK3zY0VxCHskvv/lJAnGbiljOFlvLEJa9hlOnP4pvDfk2H7Bb0xPCAnJbfunNU0UExHUqoi1uSsLqA/jdZ+bj+ux7ETu348ON1a+Ts/glN28JIBxGxOKWMGwqatNx7J23DJfnjMcrfboj3vYZxC+0QmxtGW4sPk3+Hr/UlqEiOofYpULcRfHFvfMCtl1eiM8+mYtnRw5A7EYp6HIzpeEmxHZtENtahhuLqTthMflz/DJbjo4SEBUMWVEH6ZZ07U6ctXghvjNxNGKfLog9b0P8xi2IXQlEFwLRke6Q2iWcis3k7vzyWp4EEH62eLMIf/jc87hlxkTE+76F2K8zgaDDWc+OiHfeHoIhU5F4RZ0lj+eX1XIlgOw5i/e9XIj582fhlQcGIw7thjj4q4iDskIwenUKpeLO9o0VJVMRf0V9Sv41+fP8klq0/pszzoPf6YE4/OuI9xKIIWEQ/ama+lEqeplSISsq8VTsJPfg16JFwlFf8+Dw7qFUSBgRFRVOhYDRWaRCLO64YZwnT+bXoGUSjiAgsqKMVIQrykjFreFUJFxR/yP/jpzZnyG/EcIhWZ5QRYVTwSsq8cV9gKz/iwu3olR4lBWV+NmilJxDzqD3s9NA2Kejx5IKubjjO1tcI79A/hJ/Li0Xwrs6TYpc3OFUxFdRh8n9+HNoxSDs2aFHEs4W5eRc1PWUHGGnmw7HubjrySvIt/LH1EpA2AaGUirEyZkP3MlHyYP5Y2klSTTcmRj6F88Hz11N9mDG/7hNBoiG/H3yxwoIwuJw9wo5zT5P0cyFMOCzNPQJGLp13UBeSZ5HTsPPUmhpaWlpaWlpaWlpaWlpaWlpaWlpaWklqv8Da8GBU4g36CAAAAAASUVORK5CYII=",alt:"nPlayer"},null,-1))),ba=ha((()=>o("img",{src:"/assets/video-mxplayer-BlcXbT3z.png",alt:"MXPlayer(Free)"},null,-1))),Sa=ha((()=>o("img",{src:"/assets/video-mxplayer-pro-BXOuRw84.png",alt:"MXPlayer(Pro)"},null,-1))),Ta=R({__name:"VideoPlayer",setup(i){let r=L();l();let{getPathPwd:s}=w(),{currentPath:_,storageKey:E}=d(),b=S(),R=T();const D=e=>{let t=[];return b.filterFileByType("video").forEach((i=>{t.push({default:i.name===e,html:i.name,url:i.url})})),t};let k=c(null);const x=e=>{switch(e){case"download":window.location=k.value.url;break;case"thunder":window.location=`thunder://${btoa("AA"+k.value.url+"ZZ")}`;break;case"motrix":window.location=`motrix://new-task?uri=${encodeURIComponent(k.value.url)}&out=${encodeURIComponent(k.value.name)}`;break;case"potplayer":window.location=`potplayer://${k.value.url}`;break;case"iina":window.location=`iina://weblink?url=${encodeURIComponent(k.value.url)}`;break;case"vlc":window.location=`vlc://${k.value.url}`;break;case"nplayer":window.location=`nplayer-${k.value.url}`;break;case"mxplayer":window.location="intent:"+k.value.url+"#Intent;package=com.mxtech.videoplayer.ad;S.title="+k.value.name+";end";break;case"mxplayer-pro":window.location="intent:"+k.value.url+"#Intent;package=com.mxtech.videoplayer.pro;S.title="+k.value.name+";end"}},M=e=>{let t=b.filterFileByType("video");P();for(let i=0;i<t.length;i++){if(t[i].name===e)return{prev:t[i-1]||null,next:t[i+1]||null}}},P=()=>{let e=JSON.parse(localStorage.getItem("_h5_player_play_progress_"));if(e){for(let t of Object.keys(e))t.endsWith(e[t].progress)&&delete e[t];localStorage.setItem("_h5_player_play_progress_",JSON.stringify(e))}};let N='<i class="art-icon art-icon-not-hidden"><svg t="1662978336444" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="968" width="128" height="128"><path d="M711.456 377.184c32.736 31.52 60.928 72.256 84.64 122.208a40.64 40.64 0 0 1 0 34.72c-63.776 135.04-160.48 202.528-290.112 202.528-46.752 0-89.248-8.832-127.456-26.464l37.184-37.184c27.52 10.048 57.6 15.104 90.272 15.104 108.864 0 188.48-55.168 244.608-171.296-21.088-43.584-45.44-78.56-73.44-105.28l34.304-34.336z m13.024-122.816l28.768 28.8a5.376 5.376 0 0 1 0 7.616L272.96 771.04a5.408 5.408 0 0 1-7.648 0l-28.8-28.8a5.376 5.376 0 0 1 0-7.616l71.36-71.36c-35.84-32.384-66.56-75.392-92.032-129.088a40.64 40.64 0 0 1 0-34.72C279.68 364.48 376.384 296.96 505.984 296.96c50.752 0 96.448 10.4 137.12 31.168l73.76-73.728a5.376 5.376 0 0 1 7.616 0z m-218.496 91.136c-108.8 0-188.416 55.168-244.608 171.296 22.944 47.36 49.792 84.608 80.928 112.096l56.256-56.256a118.688 118.688 0 0 1 160.576-160.576l47.424-47.424c-30.336-12.832-63.776-19.136-100.576-19.136z m-70.016 137.088a75.616 75.616 0 0 0-4.64 57.28l95.04-95.04a75.616 75.616 0 0 0-90.4 37.76z m60.416 109.504a75.456 75.456 0 0 0 82.144-82.112l35.616-35.616a118.72 118.72 0 0 1-153.376 153.344l35.616-35.616z" p-id="969"></path></svg></i>',F='<i class="art-icon art-icon-hidden"><svg t="1662978261880" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4451" width="128" height="128"><path d="M512.032 648a136.128 136.128 0 0 1-136-136c0-74.976 60.992-136 136-136s136 61.024 136 136a136.128 136.128 0 0 1-136 136z m0-224c-48.544 0-88 39.456-88 88s39.456 88 88 88 88-39.456 88-88-39.456-88-88-88z" p-id="4452"></path><path d="M512.032 743.616a327.68 327.68 0 0 1-231.872-95.616L142.88 512l137.28-136a327.68 327.68 0 0 1 231.872-95.584c87.328 0 169.664 33.952 231.872 95.584l137.28 136-137.28 136a327.52 327.52 0 0 1-231.872 95.616zM206.528 512l107.424 101.952c53.152 52.672 123.488 81.696 198.048 81.696s144.896-29.024 198.08-81.696L817.536 512l-107.424-101.952c-53.152-52.672-123.488-81.696-198.048-81.696s-144.896 29.024-198.08 81.696L206.528 512z" p-id="4453"></path></svg></i>',U='<i class="art-icon art-icon-video-list"><svg t="1650551038453" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="12028" width="20" height="20"><path d="M111.395066 179.64038l801.208844 0 0 87.866187-801.208844 0 0-87.866187Z" p-id="12029"></path><path d="M111.395066 468.067418l801.208844 0 0 87.866187-801.208844 0 0-87.866187Z" p-id="12030"></path><path d="M111.395066 756.493433l801.208844 0 0 87.866187-801.208844 0 0-87.866187Z" p-id="12031"></path></svg></i>',j='<i class="art-icon art-icon-subtitle"><svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 48 48">\n    <path d="M0 0h48v48H0z" fill="none"></path>\n    <path d="M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM8 24h8v4H8v-4zm20 12H8v-4h20v4zm12 0h-8v-4h8v4zm0-8H20v-4h20v4z"></path>\n</svg></i>';const z=I("zfile-video-auto-player-next",!1),V=I("zfile-video-auto-player",!1),$=I("zfile-video-hiddle-tools",!1);let H=null;const Y=async(e,t)=>{k.value={name:e,url:t},document.querySelector(".zfile-video-dialog .el-dialog__title").innerHTML=e,H&&H.destroy();let i="mp4";e.toLowerCase().endsWith("flv")?i="flv":e.toLowerCase().endsWith("m3u8")&&(i="m3u8"),r.removeDuplicateSeparator(`${_.value}/${e}`);let n=r.removeDuplicateSeparator(`${_.value}/__${e}__/video.m3u8`),a={storageKey:E.value,path:n,password:s()},o=await A(a);0===o?.data?.code&&(i="m3u8");let l={container:".artplayer-app",title:e,url:k.value.url,type:i,setting:!0,playbackRate:!0,flip:!0,fullscreen:!0,fastForward:!0,autoOrientation:!0,aspectRatio:!0,fullscreenWeb:!0,theme:"#23ade5",lock:!0,subtitleOffset:!0,miniProgressBar:!0,autoplay:V.value,whitelist:["*"],airplay:!0,moreVideoAttr:{"x5-video-player-type":"h5","x5-video-player-fullscreen":!1,"x5-video-orientation":"portraint",preload:"metadata",crossOrigin:"anonymous"},customType:{flv:function(e,t){if(G.isSupported()){const i=G.createPlayer({type:"flv",url:t});i.attachMediaElement(e),i.load()}else H.notice.show="不支持播放格式：flv"},m3u8:function(e,t){if(ca.isSupported()){const i=new ca({xhrSetup:(e,i)=>{let r=i.substring(i.lastIndexOf("/")+1);if(i!==t){let t=b.getFileUrlByName(r);t?e.open("GET",t,!0):e.open("GET",i,!0)}}});i.loadSource(t),i.attachMedia(e)}else{const i=e.canPlayType("application/vnd.apple.mpegurl");"probably"===i||"maybe"==i?e.src=t:H.notice.show="不支持播放格式：m3u8"}}},contextmenu:[{html:"下载",click:function(){window.open(t)}}],settings:[{html:"自动播放",tooltip:V.value?"开启":"关闭",icon:'<img width="22" heigth="22" src="data:image/svg+xml;base64,Cjxzdmcgdmlld0JveD0iMCAwIDgwIDgwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48ZGVmcz48cGF0aCBpZD0icGlkLTY0LXN2Z28tYSIgZD0iTTAgMGg4MHY4MEgweiI+PC9wYXRoPjxwYXRoIGQ9Ik01Mi41NDYgOC4wMTRhMy45OTggMy45OTggMCAwMTQuMjIyIDMuMDc3Yy4xMDQuNDQ2LjA5My44MDguMDM5IDEuMTM4YTIuNzQgMi43NCAwIDAxLS4zMTIuODgxYy0uMDczLjEzMi0uMTYuMjU0LS4yNDYuMzc2bC0uMjU3LjM2Ni0uNTIxLjczYy0uNy45NjktMS40MTUgMS45MjYtMi4xNTQgMi44NjZsLS4wMTUuMDJhMjQwLjk0NSAyNDAuOTQ1IDAgMDE1Ljk4Ni4zNDFsMS42NDMuMTIzLjgyMi4wNjYuNDEuMDM0LjIwNi4wMTguMTAzLjAwOC4xMTUuMDEyYzEuMjY2LjExNiAyLjUxNi40NSAzLjY3Ny45NzVhMTEuNjYzIDExLjY2MyAwIDAxMy4xNjYgMi4xMTRjLjkzMS44NyAxLjcxOSAxLjg5NSAyLjMyMSAzLjAyMmExMS41OTUgMTEuNTk1IDAgMDExLjIyNCAzLjYxM2MuMDMuMTU3LjA0Ni4zMTYuMDY4LjQ3NGwuMDE1LjExOS4wMTMuMTEyLjAyMi4yMDYuMDg1LjgyMi4xNTkgMS42NDZjLjEgMS4wOTguMTkgMi4xOTguMjcgMy4yOTguMzE1IDQuNC40NjMgOC44MjkuMzYgMTMuMjU1YTE2Ni40ODkgMTY2LjQ4OSAwIDAxLS44NDMgMTMuMjEzYy0uMDEyLjEyNy0uMDM0LjI5Ny0uMDUzLjQ1NGE3LjU4OSA3LjU4OSAwIDAxLS4wNzIuNDc1bC0uMDQuMjM3LS4wNS4yMzZhMTEuNzYyIDExLjc2MiAwIDAxLS43NCAyLjI4NyAxMS43NTUgMTEuNzU1IDAgMDEtNS4xMTggNS41NyAxMS43MDUgMTEuNzA1IDAgMDEtMy42MjMgMS4yNjNjLS4xNTguMDI0LS4zMTYuMDUyLS40NzUuMDcybC0uNDc3LjA1My0uODIxLjA3MS0xLjY0NC4xMzRjLTEuMDk2LjA4Ni0yLjE5Mi4xNi0zLjI4OC4yM2EyNjAuMDggMjYwLjA4IDAgMDEtNi41NzguMzI1Yy04Ljc3Mi4zMjQtMTcuNTQ2LjIyLTI2LjMxMy0uMzAyYTI0Mi40NTggMjQyLjQ1OCAwIDAxLTMuMjg3LS4yMmwtMS42NDMtLjEyOS0uODIyLS4wNjktLjQxLS4wMzUtLjIwNi0uMDE4Yy0uMDY4LS4wMDYtLjEzMy0uMDEtLjIxOC0uMDJhMTEuNTY2IDExLjU2NiAwIDAxLTMuNy0uOTkyIDExLjczMiAxMS43MzIgMCAwMS01LjQ5Ny01LjE3OCAxMS43MyAxMS43MyAwIDAxLTEuMjE1LTMuNjI3Yy0uMDI0LS4xNTgtLjA1MS0uMzE2LS4wNjctLjQ3NWwtLjAyNi0uMjM4LS4wMTMtLjExOS0uMDEtLjEwMy0uMDctLjgyMy0uMTMyLTEuNjQ4YTE5MC42MzcgMTkwLjYzNyAwIDAxLS4yMi0zLjI5OGMtLjI1Ni00LjM5OS0uMzU4LTguODE3LS4yNTgtMTMuMjMzLjA5OS00LjQxMi4zNzItOC44MTEuNzg4LTEzLjE5N2ExMS42NSAxMS42NSAwIDAxMy4wMzktNi44MzUgMTEuNTg1IDExLjU4NSAwIDAxNi41NzItMy41NjNjLjE1Ny0uMDIzLjMxMi0uMDUxLjQ3LS4wN2wuNDctLjA1LjgyLS4wNyAxLjY0My0uMTNhMjI4LjQ5MyAyMjguNDkzIDAgMDE2LjY0Ny0uNDA1bC0uMDQxLS4wNWE4OC4xNDUgODguMTQ1IDAgMDEtMi4xNTQtMi44NjdsLS41Mi0uNzMtLjI1OC0uMzY2Yy0uMDg2LS4xMjItLjE3My0uMjQ0LS4yNDYtLjM3NmEyLjc0IDIuNzQgMCAwMS0uMzEyLS44ODEgMi44MDggMi44MDggMCAwMS4wNC0xLjEzOCAzLjk5OCAzLjk5OCAwIDAxNC4yMi0zLjA3NyAyLjggMi44IDAgMDExLjA5My4zMTNjLjI5NC4xNTUuNTM4LjM0Ny43NDIuNTY4LjEwMi4xMS4xOS4yMy4yOC4zNWwuMjcuMzU5LjUzMi43MmE4OC4wNTkgODguMDU5IDAgMDEyLjA2IDIuOTM2IDczLjAzNiA3My4wMzYgMCAwMTEuOTI5IDMuMDNjLjE4Ny4zMTMuMzczLjYyOC41NTYuOTQ1IDIuNzI0LS4wNDcgNS40NDctLjA1NiA4LjE3LS4wMzguNzQ4LjAwNiAxLjQ5Ni4wMTUgMi4yNDQuMDI2LjE4LS4zMTMuMzY0LS42MjQuNTQ5LS45MzRhNzMuMjgxIDczLjI4MSAwIDAxMS45My0zLjAzIDg4LjczNyA4OC43MzcgMCAwMTIuMDU5LTIuOTM1bC41MzMtLjcyLjI2OC0uMzU5Yy4wOS0uMTIuMTc5LS4yNC4yODEtLjM1YTIuOCAyLjggMCAwMTEuODM0LS44ODF6TTMwLjEzIDM0LjYzMWE0IDQgMCAwMC0uNDE4IDEuNDIgOTEuMTU3IDkxLjE1NyAwIDAwLS40NDYgOS4xMjhjMCAyLjgyOC4xMjEgNS42NTYuMzY0IDguNDgzbC4xMSAxLjIxMmE0IDQgMCAwMDUuODU4IDMuMTQzYzIuODItMS40OTggNS41NS0zLjAzMyA4LjE5My00LjYwNmExNzcuNDEgMTc3LjQxIDAgMDA1Ljg5Ni0zLjY2NmwxLjQzNC0uOTQyYTQgNCAwIDAwLjA0Ny02LjYzMiAxMzcuNzAzIDEzNy43MDMgMCAwMC03LjM3Ny00LjcwOCAxNDYuODggMTQ2Ljg4IDAgMDAtNi44NzktMy44NDlsLTEuNC0uNzI1YTQgNCAwIDAwLTUuMzgyIDEuNzQyeiIgaWQ9InBpZC02NC1zdmdvLWQiPjwvcGF0aD48ZmlsdGVyIHg9Ii0xNS40JSIgeT0iLTE2LjMlIiB3aWR0aD0iMTMwLjklIiBoZWlnaHQ9IjEzMi41JSIgZmlsdGVyVW5pdHM9Im9iamVjdEJvdW5kaW5nQm94IiBpZD0icGlkLTY0LXN2Z28tYyI+PGZlT2Zmc2V0IGR5PSIyIiBpbj0iU291cmNlQWxwaGEiIHJlc3VsdD0ic2hhZG93T2Zmc2V0T3V0ZXIxIj48L2ZlT2Zmc2V0PjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjEiIGluPSJzaGFkb3dPZmZzZXRPdXRlcjEiIHJlc3VsdD0ic2hhZG93Qmx1ck91dGVyMSI+PC9mZUdhdXNzaWFuQmx1cj48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMyAwIiBpbj0ic2hhZG93Qmx1ck91dGVyMSIgcmVzdWx0PSJzaGFkb3dNYXRyaXhPdXRlcjEiPjwvZmVDb2xvck1hdHJpeD48ZmVPZmZzZXQgaW49IlNvdXJjZUFscGhhIiByZXN1bHQ9InNoYWRvd09mZnNldE91dGVyMiI+PC9mZU9mZnNldD48ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIzLjUiIGluPSJzaGFkb3dPZmZzZXRPdXRlcjIiIHJlc3VsdD0ic2hhZG93Qmx1ck91dGVyMiI+PC9mZUdhdXNzaWFuQmx1cj48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMiAwIiBpbj0ic2hhZG93Qmx1ck91dGVyMiIgcmVzdWx0PSJzaGFkb3dNYXRyaXhPdXRlcjIiPjwvZmVDb2xvck1hdHJpeD48ZmVNZXJnZT48ZmVNZXJnZU5vZGUgaW49InNoYWRvd01hdHJpeE91dGVyMSI+PC9mZU1lcmdlTm9kZT48ZmVNZXJnZU5vZGUgaW49InNoYWRvd01hdHJpeE91dGVyMiI+PC9mZU1lcmdlTm9kZT48L2ZlTWVyZ2U+PC9maWx0ZXI+PC9kZWZzPjxnIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgb3BhY2l0eT0iLjgiPjxtYXNrIGlkPSJwaWQtNjQtc3Znby1iIiBmaWxsPSIjZmZmIj48dXNlIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1hIj48L3VzZT48L21hc2s+PGcgbWFzaz0idXJsKCNwaWQtNjQtc3Znby1iKSI+PHVzZSBmaWxsPSIjMDAwIiBmaWx0ZXI9InVybCgjcGlkLTY0LXN2Z28tYykiIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1kIj48L3VzZT48dXNlIGZpbGw9IiNGRkYiIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1kIj48L3VzZT48L2c+PC9nPjwvc3ZnPg==">',switch:V.value,onSwitch:function(e,t,i){const r=!e.switch;return V.value=r,H.autoplay=r,e.tooltip=r?"开启":"关闭",r}},{html:"自动播放下一个视频",tooltip:z.value?"开启":"关闭",icon:'<img width="22" heigth="22" src="data:image/svg+xml;base64,Cjxzdmcgdmlld0JveD0iMCAwIDgwIDgwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48ZGVmcz48cGF0aCBpZD0icGlkLTY0LXN2Z28tYSIgZD0iTTAgMGg4MHY4MEgweiI+PC9wYXRoPjxwYXRoIGQ9Ik01Mi41NDYgOC4wMTRhMy45OTggMy45OTggMCAwMTQuMjIyIDMuMDc3Yy4xMDQuNDQ2LjA5My44MDguMDM5IDEuMTM4YTIuNzQgMi43NCAwIDAxLS4zMTIuODgxYy0uMDczLjEzMi0uMTYuMjU0LS4yNDYuMzc2bC0uMjU3LjM2Ni0uNTIxLjczYy0uNy45NjktMS40MTUgMS45MjYtMi4xNTQgMi44NjZsLS4wMTUuMDJhMjQwLjk0NSAyNDAuOTQ1IDAgMDE1Ljk4Ni4zNDFsMS42NDMuMTIzLjgyMi4wNjYuNDEuMDM0LjIwNi4wMTguMTAzLjAwOC4xMTUuMDEyYzEuMjY2LjExNiAyLjUxNi40NSAzLjY3Ny45NzVhMTEuNjYzIDExLjY2MyAwIDAxMy4xNjYgMi4xMTRjLjkzMS44NyAxLjcxOSAxLjg5NSAyLjMyMSAzLjAyMmExMS41OTUgMTEuNTk1IDAgMDExLjIyNCAzLjYxM2MuMDMuMTU3LjA0Ni4zMTYuMDY4LjQ3NGwuMDE1LjExOS4wMTMuMTEyLjAyMi4yMDYuMDg1LjgyMi4xNTkgMS42NDZjLjEgMS4wOTguMTkgMi4xOTguMjcgMy4yOTguMzE1IDQuNC40NjMgOC44MjkuMzYgMTMuMjU1YTE2Ni40ODkgMTY2LjQ4OSAwIDAxLS44NDMgMTMuMjEzYy0uMDEyLjEyNy0uMDM0LjI5Ny0uMDUzLjQ1NGE3LjU4OSA3LjU4OSAwIDAxLS4wNzIuNDc1bC0uMDQuMjM3LS4wNS4yMzZhMTEuNzYyIDExLjc2MiAwIDAxLS43NCAyLjI4NyAxMS43NTUgMTEuNzU1IDAgMDEtNS4xMTggNS41NyAxMS43MDUgMTEuNzA1IDAgMDEtMy42MjMgMS4yNjNjLS4xNTguMDI0LS4zMTYuMDUyLS40NzUuMDcybC0uNDc3LjA1My0uODIxLjA3MS0xLjY0NC4xMzRjLTEuMDk2LjA4Ni0yLjE5Mi4xNi0zLjI4OC4yM2EyNjAuMDggMjYwLjA4IDAgMDEtNi41NzguMzI1Yy04Ljc3Mi4zMjQtMTcuNTQ2LjIyLTI2LjMxMy0uMzAyYTI0Mi40NTggMjQyLjQ1OCAwIDAxLTMuMjg3LS4yMmwtMS42NDMtLjEyOS0uODIyLS4wNjktLjQxLS4wMzUtLjIwNi0uMDE4Yy0uMDY4LS4wMDYtLjEzMy0uMDEtLjIxOC0uMDJhMTEuNTY2IDExLjU2NiAwIDAxLTMuNy0uOTkyIDExLjczMiAxMS43MzIgMCAwMS01LjQ5Ny01LjE3OCAxMS43MyAxMS43MyAwIDAxLTEuMjE1LTMuNjI3Yy0uMDI0LS4xNTgtLjA1MS0uMzE2LS4wNjctLjQ3NWwtLjAyNi0uMjM4LS4wMTMtLjExOS0uMDEtLjEwMy0uMDctLjgyMy0uMTMyLTEuNjQ4YTE5MC42MzcgMTkwLjYzNyAwIDAxLS4yMi0zLjI5OGMtLjI1Ni00LjM5OS0uMzU4LTguODE3LS4yNTgtMTMuMjMzLjA5OS00LjQxMi4zNzItOC44MTEuNzg4LTEzLjE5N2ExMS42NSAxMS42NSAwIDAxMy4wMzktNi44MzUgMTEuNTg1IDExLjU4NSAwIDAxNi41NzItMy41NjNjLjE1Ny0uMDIzLjMxMi0uMDUxLjQ3LS4wN2wuNDctLjA1LjgyLS4wNyAxLjY0My0uMTNhMjI4LjQ5MyAyMjguNDkzIDAgMDE2LjY0Ny0uNDA1bC0uMDQxLS4wNWE4OC4xNDUgODguMTQ1IDAgMDEtMi4xNTQtMi44NjdsLS41Mi0uNzMtLjI1OC0uMzY2Yy0uMDg2LS4xMjItLjE3My0uMjQ0LS4yNDYtLjM3NmEyLjc0IDIuNzQgMCAwMS0uMzEyLS44ODEgMi44MDggMi44MDggMCAwMS4wNC0xLjEzOCAzLjk5OCAzLjk5OCAwIDAxNC4yMi0zLjA3NyAyLjggMi44IDAgMDExLjA5My4zMTNjLjI5NC4xNTUuNTM4LjM0Ny43NDIuNTY4LjEwMi4xMS4xOS4yMy4yOC4zNWwuMjcuMzU5LjUzMi43MmE4OC4wNTkgODguMDU5IDAgMDEyLjA2IDIuOTM2IDczLjAzNiA3My4wMzYgMCAwMTEuOTI5IDMuMDNjLjE4Ny4zMTMuMzczLjYyOC41NTYuOTQ1IDIuNzI0LS4wNDcgNS40NDctLjA1NiA4LjE3LS4wMzguNzQ4LjAwNiAxLjQ5Ni4wMTUgMi4yNDQuMDI2LjE4LS4zMTMuMzY0LS42MjQuNTQ5LS45MzRhNzMuMjgxIDczLjI4MSAwIDAxMS45My0zLjAzIDg4LjczNyA4OC43MzcgMCAwMTIuMDU5LTIuOTM1bC41MzMtLjcyLjI2OC0uMzU5Yy4wOS0uMTIuMTc5LS4yNC4yODEtLjM1YTIuOCAyLjggMCAwMTEuODM0LS44ODF6TTMwLjEzIDM0LjYzMWE0IDQgMCAwMC0uNDE4IDEuNDIgOTEuMTU3IDkxLjE1NyAwIDAwLS40NDYgOS4xMjhjMCAyLjgyOC4xMjEgNS42NTYuMzY0IDguNDgzbC4xMSAxLjIxMmE0IDQgMCAwMDUuODU4IDMuMTQzYzIuODItMS40OTggNS41NS0zLjAzMyA4LjE5My00LjYwNmExNzcuNDEgMTc3LjQxIDAgMDA1Ljg5Ni0zLjY2NmwxLjQzNC0uOTQyYTQgNCAwIDAwLjA0Ny02LjYzMiAxMzcuNzAzIDEzNy43MDMgMCAwMC03LjM3Ny00LjcwOCAxNDYuODggMTQ2Ljg4IDAgMDAtNi44NzktMy44NDlsLTEuNC0uNzI1YTQgNCAwIDAwLTUuMzgyIDEuNzQyeiIgaWQ9InBpZC02NC1zdmdvLWQiPjwvcGF0aD48ZmlsdGVyIHg9Ii0xNS40JSIgeT0iLTE2LjMlIiB3aWR0aD0iMTMwLjklIiBoZWlnaHQ9IjEzMi41JSIgZmlsdGVyVW5pdHM9Im9iamVjdEJvdW5kaW5nQm94IiBpZD0icGlkLTY0LXN2Z28tYyI+PGZlT2Zmc2V0IGR5PSIyIiBpbj0iU291cmNlQWxwaGEiIHJlc3VsdD0ic2hhZG93T2Zmc2V0T3V0ZXIxIj48L2ZlT2Zmc2V0PjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjEiIGluPSJzaGFkb3dPZmZzZXRPdXRlcjEiIHJlc3VsdD0ic2hhZG93Qmx1ck91dGVyMSI+PC9mZUdhdXNzaWFuQmx1cj48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMyAwIiBpbj0ic2hhZG93Qmx1ck91dGVyMSIgcmVzdWx0PSJzaGFkb3dNYXRyaXhPdXRlcjEiPjwvZmVDb2xvck1hdHJpeD48ZmVPZmZzZXQgaW49IlNvdXJjZUFscGhhIiByZXN1bHQ9InNoYWRvd09mZnNldE91dGVyMiI+PC9mZU9mZnNldD48ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIzLjUiIGluPSJzaGFkb3dPZmZzZXRPdXRlcjIiIHJlc3VsdD0ic2hhZG93Qmx1ck91dGVyMiI+PC9mZUdhdXNzaWFuQmx1cj48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMiAwIiBpbj0ic2hhZG93Qmx1ck91dGVyMiIgcmVzdWx0PSJzaGFkb3dNYXRyaXhPdXRlcjIiPjwvZmVDb2xvck1hdHJpeD48ZmVNZXJnZT48ZmVNZXJnZU5vZGUgaW49InNoYWRvd01hdHJpeE91dGVyMSI+PC9mZU1lcmdlTm9kZT48ZmVNZXJnZU5vZGUgaW49InNoYWRvd01hdHJpeE91dGVyMiI+PC9mZU1lcmdlTm9kZT48L2ZlTWVyZ2U+PC9maWx0ZXI+PC9kZWZzPjxnIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgb3BhY2l0eT0iLjgiPjxtYXNrIGlkPSJwaWQtNjQtc3Znby1iIiBmaWxsPSIjZmZmIj48dXNlIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1hIj48L3VzZT48L21hc2s+PGcgbWFzaz0idXJsKCNwaWQtNjQtc3Znby1iKSI+PHVzZSBmaWxsPSIjMDAwIiBmaWx0ZXI9InVybCgjcGlkLTY0LXN2Z28tYykiIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1kIj48L3VzZT48dXNlIGZpbGw9IiNGRkYiIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1kIj48L3VzZT48L2c+PC9nPjwvc3ZnPg==">',switch:z.value,onSwitch:function(e,t,i){const r=!e.switch;return z.value=r,e.tooltip=r?"开启":"关闭",r}}],controls:[{position:"right",html:$.value?N:F,click:function(e,t){$.value=!$.value,t.target.parentNode.parentNode.innerHTML=$.value?N:F}},{name:"video-list",position:"right",html:U,selector:D(e),onSelect:function(e,t){return Y(e.html,e.url),U}}]},d=(e=>{let t=[];return b.fileList.find((i=>{let r=e.split(".")[0],s=i.name;s!==e+".vtt"&&s!==e+".srt"&&s!==e+".ass"&&s!==r+".vtt"&&s!==r+".srt"&&s!==r+".ass"||t.push({default:0===t.length,url:i.url,html:s})})),t.length>0&&t.push({url:"",html:"关闭字幕"}),t})(e);d.length>0&&d.length>1&&l.controls.push({name:"video-subtitle",position:"right",html:j,selector:d,onSelect:e=>("关闭字幕"===e.html?H.subtitle.show=!1:(H.subtitle.show=!0,H.subtitle.url=e.url),j)}),H=new C(l),H.on("destory",(()=>{})),!1===r.isMobile.value&&H.on("ready",(()=>{let e=M(H.option.title);e.prev&&H.controls.add({name:"prev-video",position:"left",index:5,tooltip:"播放上一个",html:'<i class="art-icon art-icon-prev-video" style="transform: scale(-1,1);"><svg height="25" width="25"  viewBox="0 0 22 22"><path d="M16 5a1 1 0 00-1 1v4.615a1.431 1.431 0 00-.615-.829L7.21 5.23A1.439 1.439 0 005 6.445v9.11a1.44 1.44 0 002.21 1.215l7.175-4.555a1.436 1.436 0 00.616-.828V16a1 1 0 002 0V6C17 5.448 16.552 5 16 5z"></path></svg></i>',click:()=>{W()}}),e.next&&H.controls.add({name:"next-video",position:"left",index:15,tooltip:"播放下一个",html:'<i class="art-icon art-icon-next-video"><svg height="25" width="25"  viewBox="0 0 22 22"><path d="M16 5a1 1 0 00-1 1v4.615a1.431 1.431 0 00-.615-.829L7.21 5.23A1.439 1.439 0 005 6.445v9.11a1.44 1.44 0 002.21 1.215l7.175-4.555a1.436 1.436 0 00.616-.828V16a1 1 0 002 0V6C17 5.448 16.552 5 16 5z"></path></svg></i>',click:()=>{K()}})})),H.on("video:ended",(()=>{z.value&&K()})),d.length>0&&(H.subtitle.url=d[0].url)},K=()=>{const e=M(H.option.title).next;e&&Y(e.name,e.url)},W=()=>{const e=M(H.option.title).prev;e&&Y(e.name,e.url)};return h((()=>{Y(b.currentClickRow.name,b.currentClickRow.url)})),(i,s)=>{const l=e,d=t;return n(),a("div",null,[ua,u(k)&&u(r).isMobile.value?(n(),a("div",fa,[f(l,{disabled:!M(u(k).name).prev,icon:u(O),onClick:W},{default:p((()=>[m("上一个视频")])),_:1},8,["disabled","icon"]),f(l,{disabled:!M(u(k).name).next,icon:u(B),onClick:K},{default:p((()=>[m("下一个视频")])),_:1},8,["disabled","icon"])])):g("",!0),o("div",{class:v(["zfile-video-tools",u($)?"hidden-important":""])},[u(R).permission.download?(n(),a(y,{key:0},[o("div",{class:"zfile-video-tools-item",onClick:s[0]||(s[0]=e=>x("download"))},[f(d,{placement:"top"},{content:p((()=>[m(" 直接下载 ")])),default:p((()=>[pa])),_:1})]),o("div",{class:"zfile-video-tools-item",onClick:s[1]||(s[1]=e=>x("thunder"))},[f(d,{placement:"top"},{content:p((()=>[m(" 使用迅雷下载 ")])),default:p((()=>[ma])),_:1})]),o("div",{class:"zfile-video-tools-item",onClick:s[2]||(s[2]=e=>x("motrix"))},[f(d,{placement:"top"},{content:p((()=>[m(" 使用 motrix 下载 ")])),default:p((()=>[ga])),_:1})])],64)):g("",!0),o("div",{class:"zfile-video-tools-item",onClick:s[3]||(s[3]=e=>x("potplayer"))},[f(d,{placement:"top"},{content:p((()=>[m(" 使用 PotPlayer 播放 ")])),default:p((()=>[ya])),_:1})]),o("div",{class:"zfile-video-tools-item",onClick:s[4]||(s[4]=e=>x("iina"))},[f(d,{placement:"top"},{content:p((()=>[m(" 使用 IINA 播放 ")])),default:p((()=>[va])),_:1})]),o("div",{class:"zfile-video-tools-item",onClick:s[5]||(s[5]=e=>x("vlc"))},[f(d,{placement:"top"},{content:p((()=>[m(" 使用 VLC 播放 ")])),default:p((()=>[_a])),_:1})]),o("div",{class:"zfile-video-tools-item",onClick:s[6]||(s[6]=e=>x("nplayer"))},[f(d,{placement:"top"},{content:p((()=>[m(" 使用 nPlayer 播放 ")])),default:p((()=>[Ea])),_:1})]),o("div",{class:"zfile-video-tools-item",onClick:s[7]||(s[7]=e=>x("mxplayer"))},[f(d,{placement:"top"},{content:p((()=>[m(" 使用 MXPlayer(Free) 播放 ")])),default:p((()=>[ba])),_:1})]),o("div",{class:"zfile-video-tools-item",onClick:s[8]||(s[8]=e=>x("mxplayer-pro"))},[f(d,{placement:"top"},{content:p((()=>[m(" 使用 MXPlayer(Pro) 播放 ")])),default:p((()=>[Sa])),_:1})])],2),o("div",{class:v(["zfile-video-tools-tips",u($)?"hidden-important":""])}," tips: 可点击上方的软件图标进行下载播放, 本地播放器解码效果更佳. ",2)])}}},[["__scopeId","data-v-37e3f9e9"]]);export{Ta as default};
