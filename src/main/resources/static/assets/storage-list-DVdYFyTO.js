import{d as e,s as a,b as t,c as s,a as r,e as o}from"./admin-storage-D0L6B7uH.js";import{S as n}from"./sortable.esm-CQGo0vDY.js";import{u as i}from"./useCommon-CGwVn2w-.js";import{r as c,c as l}from"./index-B6LbRxzB.js";import{u as d}from"./storage-copy-B8gmsv5L.js";import{E as u}from"./index-XSoVjJxG.js";import{E as g}from"./request-B2kMKzxx.js";const{isMobile:m}=i();let h=c(!1),p=c(),b=c(!1),f=c([]),w=c("");const{openDialog:v}=d();function x(i){const c=e=>{i.push("/admin/storage-edit/"+e.id)},d=a=>{u.confirm("是否确认删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",callback:t=>{"confirm"===t&&e(a.id).then((e=>{g.success("删除成功"),S()}))}})},x=e=>{i.push("/admin/storage-filter/"+e.id)},C=e=>{i.push("/admin/storage-readme/"+e.id)},y=e=>{i.push("/admin/storage-password/"+e.id)},k=e=>{u.confirm(`是否确认${e.enable?"停止":"启用"}存储源。`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",callback:t=>{if("confirm"===t){let t=e.enable?"disable":"enable";a(e.id,t).then((()=>{g.success((e.enable?"停止":"启用")+"成功"),e.enable=!e.enable}))}}})},L=e=>{p.value=e.id,h.value=!0},S=()=>{b.value=!0,r().then((e=>{f.value=e.data,(()=>{const e=document.querySelector(".storage-container");n.create(e,{draggable:".storage-item",filter:".add-storage-btn",delay:m.value?300:0,onEnd:e=>{if(e.oldIndex===e.newIndex)return;const a=f.value.splice(e.oldIndex,1)[0];f.value.splice(e.newIndex,0,a),o(f.value).then((()=>{g.success("调整排序成功")}))}})})(),b.value=!1}))},M=l((()=>""===w.value?f.value:f.value.filter((e=>!(!e.name||-1===e.name.toLowerCase().indexOf(w.value.toLowerCase()))||(!(!e.remark||-1===e.remark.toLowerCase().indexOf(w.value.toLowerCase()))||(!(!e.type||-1===e.type.description.toLowerCase().indexOf(w.value.toLowerCase()))||!(!e.type||-1===e.type.key.toLowerCase().indexOf(w.value.toLowerCase()))))))));return{init:S,loading:b,searchKey:w,storageListSearchResult:M,handleOperator:e=>{switch(e.operator){case"edit":c(e.storage);break;case"enable":k(e.storage);break;case"readmeManager":C(e.storage);break;case"cacheManager":L(e.storage);break;case"filterManager":x(e.storage);break;case"pwdManager":y(e.storage);break;case"delete":d(e.storage);break;case"copy":v(e.storage)}},addStorage:()=>{i.push("/admin/storage-edit")},editStorage:c,deleteStorage:d,handleClose:e=>{u.confirm("是否确认关闭？关闭后填写的数据不会保留。",{type:"warning"}).then((a=>{e()})).catch((e=>{}))},showFilterPage:x,showReadmePage:C,showPasswordPage:y,switchEnableStatus:k,cacheManageVisible:h,currentCacheManageId:p,switchCacheEnableStatus:e=>{let a=e.enableCache?"enable":"disable";t(e.id,a).then((()=>{g.success("修改成功")}))},switchCacheAutoRefreshStatus:e=>{let a=e.autoRefreshCache?"start":"stop";s(e.id,a).then((()=>{g.success("修改成功")}))},cacheManage:L}}export{x as u};
